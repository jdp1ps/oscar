import{a as y,o as h,c as a,b as i,d as c,t as n,e as u,w as p,l as g,i as v,j as S,F as _,f as x,n as k,k as b}from"./vendor.js";import{_ as w}from"./vendor4.js";const V={props:{value:{default:null}},emits:["update:value"],components:{},data(){return{options:[],lastUpdatedSearch:0,delay:null,preloadedValue:!1,selectedValue:null,selectedLabel:"",displayClosed:!1,showSelector:!1,searchFor:"",latency:null,highlightedIndex:null,loading:!1,inside:!1,displayValue:!1,error:"",hideOff:!1}},computed:{filteredOptions(){let t=[];return this.displayClosed?this.options:(this.options.forEach(e=>{e.closed||t.push(e)}),t)},optionsFiltered(){if(this.hideOff)return this.options;{let t=[];return this.options.forEach(e=>{e.closed||t.push(e)}),t}}},mounted(){document.addEventListener("click",this.handlerGlobalClick,!0),this.value},methods:{handlerGlobalClick(t){this.inside?(this.displayValue=!1,this.showSelector=!0):(this.showSelector=!1,this.displayValue=!0)},handlerMouseLeave(){this.inside=!1},handlerMouseEnter(){this.inside=!0},handlerClick(t){this.displayValue=!1},handlerUnselect(){this.selectedValue=null,this.selectedLabel="",this.showSelector=!1,this.displayValue=!1,this.$emit("change",null),this.$emit("update:value",null),this.$emit("input",null)},handlerSelectIndex(t){this.options.forEach(e=>{e.id==t&&(this.selectedValue=e.id,this.selectedLabel=e.label,this.showSelector=!1,this.displayValue=!0)}),this.$emit("change",{id:this.selectedValue,label:this.selectedLabel}),this.$emit("update:value",this.selectedValue),this.$emit("input",this.selectedValue)},handlerSelectPrev(t=!1){if(this.highlightedIndex==0&&(this.showSelector=!1),this.highlightedIndex>0&&(this.showSelector||(this.showSelector=!0),this.highlightedIndex--),t==!0){let e="#item_"+this.highlightedIndex,r=this.$el.querySelector(e),d=this.$el.querySelectorAll(".options")[0];d.scrollTop=r.offsetTop,console.log("SCROLL",d.scrollTop),console.log("ITEM",e,r)}},handlerSelectNext(t=!1){if(this.showSelector?this.highlightedIndex<this.options.length-1&&this.highlightedIndex++:this.showSelector=!0,t==!0){let e="#item_"+this.highlightedIndex,r=this.$el.querySelector(e),d=this.$el.querySelectorAll(".options")[0];d.scrollTop=r.offsetTop,console.log("SCROLL",d.scrollTop),console.log("ITEM",e,r)}},updateSelectedDate(){},handlerKeyUp(t){switch(t.code){case"ArrowUp":this.handlerSelectPrev(!0);break;case"ArrowDown":this.handlerSelectNext(!0);break;case"ArrowLeft":case"ArrowRight":break;case"Enter":t.preventDefault(),this.handlerSelectIndex(this.highlightedIndex);break;default:this.searchFor&&this.searchFor.length>1&&this.handlerChange()}},handlerChange(t){this.latency!=null&&clearTimeout(this.latency);let e=function(){this.search(),clearTimeout(this.latency)}.bind(this);this.latency=setTimeout(e,1e3)},search(){this.loading=!0,this.showSelector=!1,y.get("/organization?f=json&l=m&q="+encodeURI(this.searchFor)).then(t=>{this.options=t.data.datas,this.options.length>0&&(this.highlightedIndex=0,this.showSelector=!0)},t=>{switch(console.log(t),t.status){case 401:case 403:this.error="Vous avez été déconnecté (actualisé votre page pour vous reconnecter)";break;case 500:this.error="La recherche a provoqué une erreur";break;default:this.error="Un problème inconnu est survenu"}}).then(t=>{this.loading=!1})},setSelected(t){console.log("setSelected",t),this.value=t,this.$emit("change",this.value),this.$emit("input",this.value)},handlerSearchOrganisation(t,e){if(t.length){e(!0);let r=function(){this.searchOrganization(e,t,this),this.delay=null}.bind(this);this.delay!=null&&clearTimeout(this.delay),this.delay=setTimeout(r,1e3)}}}},C={class:"input-group",style:{position:"relative"}},I={key:0,class:"displayed-value text-danger",style:{}},L=i("i",{class:"icon-attention-1"},null,-1),M={key:1,class:"displayed-value",style:{}},T={class:"input-group-addon"},F={class:"icon-spinner animate-spin"},U={class:"icon-building-filled"},E={class:"options"},O={for:"hidder"},A=["onMouseover","onClick","id"],q={class:"option-title"},z={class:"cartouche code"},R={class:"fullname"},D={key:0},N={key:0,class:"option-infos"},K=i("i",{class:"icon-location"},null,-1);function B(t,e,r,d,s,o){return h(),a("div",{class:"oscar-selector organization-selector",onClick:e[5]||(e[5]=(...l)=>o.handlerClick&&o.handlerClick(...l)),onMouseleave:e[6]||(e[6]=(...l)=>o.handlerMouseLeave&&o.handlerMouseLeave(...l)),onMouseenter:e[7]||(e[7]=(...l)=>o.handlerMouseEnter&&o.handlerMouseEnter(...l))},[i("div",C,[s.error?(h(),a("div",I,[L,c(" "+n(s.error)+" ",1),i("i",{onClick:e[0]||(e[0]=l=>s.error=""),class:"icon-cancel-circled-outline button-cancel-value"})])):u("",!0),s.displayValue?(h(),a("div",M,[c(n(s.selectedLabel)+" ",1),s.selectedValue?(h(),a("i",{key:0,onClick:e[1]||(e[1]=(...l)=>o.handlerUnselect&&o.handlerUnselect(...l)),class:"icon-cancel-circled-outline button-cancel-value"})):u("",!0)])):u("",!0),i("span",T,[p(i("i",F,null,512),[[g,s.loading]]),p(i("i",U,null,512),[[g,!s.loading]])]),p(i("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=l=>s.searchFor=l),onKeyup:e[3]||(e[3]=(...l)=>o.handlerKeyUp&&o.handlerKeyUp(...l)),placeholder:"Rechercher une organisation...",class:"form-control"},null,544),[[v,s.searchFor]])]),p(i("div",E,[i("header",null,[c(" Résultat(s) : "+n(s.options.length)+" / ",1),i("label",O,[c(" Afficher les structures fermées "),p(i("input",{type:"checkbox",id:"hidder",value:"on","onUpdate:modelValue":e[4]||(e[4]=l=>s.hideOff=l)},null,512),[[S,s.hideOff]])])]),(h(!0),a(_,null,x(o.optionsFiltered,(l,f)=>(h(),a("div",{class:k(["option",{active:f==s.highlightedIndex,selected:l.id==s.selectedValue,closed:l.closed}]),onMouseover:m=>s.highlightedIndex=f,onClick:b(m=>o.handlerSelectIndex(l.id),["prevent","stop"]),id:"item_"+f},[i("div",q,[i("em",z,n(l.code),1),i("span",R,[i("strong",null,n(l.shortname),1),i("em",null,n(l.longname),1)]),l.type?(h(),a("span",D," ("+n(l.type)+") ",1)):u("",!0)]),l.city||l.country?(h(),a("div",N,[i("small",null,[K,c(" "+n(l.city)+" - "+n(l.country),1)])])):u("",!0)],42,A))),256))],512),[[g,s.showSelector&&s.options.length]])],32)}const P=w(V,[["render",B]]);export{P as O};
