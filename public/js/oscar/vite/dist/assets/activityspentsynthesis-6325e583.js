import{a as C,c as n,b as h,w as p,T as m,F as _,f,d as e,g as r,t as i,e as u,o,h as k,v as M,l as D}from"../vendor.js";import{_ as N}from"../vendor3.js";const T={props:{url:{required:!0}},computed:{synthesis(){return this.infos}},data(){return{infos:null,pendingMsg:null,showCuration:!1,masses:[]}},methods:{fetch(){this.pendingMsg="Chargement des données financières",C.get(this.url).then(s=>{console.log("OK",s),this.infos=s.data.synthesis,this.masses=s.data.masses},s=>{console.log(s)}).then(s=>{this.pendingMsg=!1})}},mounted(){this.fetch()}},V={key:0,class:"overlay"},A={class:"overlay-content"},B=e("p",null,"Les comptes suivants ne sont pas qualifiés, vous pouvez utiliser cet écran pour les attribuer à une masse budgétaire :",-1),F={class:"card row"},L={class:"col-md-4"},q={class:"col-md-8"},U=["onUpdate:modelValue","onChange"],j=e("option",{value:"0"},"Ignorer",-1),E=e("option",{value:"1"},"Traiter comme une recette",-1),I=["value"],S=e("hr",null,null,-1),z=e("i",{class:"icon-cancel-circled"},null,-1),O=e("i",{class:"icon-floppy"},null,-1),Q={key:0,class:"alert alert-danger"},R=e("i",{class:"icon-attention-1"},null,-1),H={key:0,class:"alert-warning alert"},K=e("i",{class:"icon-warning-empty"},null,-1),P={key:0,class:"pending"},X={class:""},G=e("i",{class:"icon-spinner animate-spin"},null,-1),J={key:0,class:"table table-condensed"},W=e("tr",null,[e("th",null,"masse"),e("th",{style:{"text-align":"right"}},"Réalisées"),e("th",{style:{"text-align":"right"}},"Engagées")],-1),Y={style:{"text-align":"right","white-space":"nowrap"}},Z={style:{"text-align":"right","white-space":"nowrap"}},x={key:0,style:{"border-top":"solid #000 thin"}},$=e("br",null,null,-1),ee={style:{"font-weight":"300"},class:"error-block"},se=e("i",{class:"icon-attention"},null,-1),te={key:0},ne=e("i",{class:"icon-cog"},null,-1),oe={key:1},le={style:{"text-align":"right","white-space":"nowrap"}},ie={style:{"border-top":"solid #000 thin","font-size":"1.6em"}},ae=e("th",null,"TOTAL : ",-1),re={style:{"text-align":"right","white-space":"nowrap"}},de={style:{"text-align":"right","white-space":"nowrap"}},ue={key:1,class:"table table-condensed"},ce=e("th",null,[e("i",{class:"icon-euro"}),r("Recettes")],-1),he={style:{"text-align":"right","white-space":"nowrap"}},pe={key:0};function me(s,d,g,y,a,l){return o(),n("section",null,[h(m,{name:"fade"},{default:p(()=>[a.showCuration?(o(),n("div",V,[e("div",A,[e("h3",null,[r(" Qualification des comptes "),e("span",{class:"overlay-closer",onClick:d[0]||(d[0]=t=>a.showCuration=!1)},"X")]),B,(o(!0),n(_,null,f(l.synthesis.curations,t=>(o(),n("div",F,[e("div",L,[e("strong",null,i(t.compte),1),r(" - "),e("em",null,i(t.compteInfos.label),1)]),e("div",q,[k(e("select",{name:"",id:"",class:"form-control","onUpdate:modelValue":c=>s.affectations[t.compte]=c,onChange:c=>s.updateAffectations(t.compte,c)},[j,E,(o(!0),n(_,null,f(a.masses,(c,w)=>(o(),n("option",{value:w},i(c),9,I))),256))],40,U),[[M,s.affectations[t.compte]]])])]))),256)),S,e("button",{onClick:d[1]||(d[1]=(...t)=>s.handlerCurationCancel&&s.handlerCurationCancel(...t)),class:"btn btn-danger"},[z,r("Annuler")]),e("button",{onClick:d[2]||(d[2]=(...t)=>s.handlerCurationConfirm&&s.handlerCurationConfirm(...t)),class:"btn btn-success"},[O,r("Enregistrer")])])])):u("",!0)]),_:1}),h(m,{name:"fade"},{default:p(()=>[s.error?(o(),n("div",Q,[R,r(" Il y'a eut un problème lors de la récupération des données financières : "+i(s.error),1)])):u("",!0)]),_:1}),h(m,{name:"fade"},{default:p(()=>[s.warning?(o(),n("div",H,[K,r(" Les données affichées peuvent ne pas être à jour : "+i(s.warning),1)])):u("",!0)]),_:1}),h(m,{name:"fade"},{default:p(()=>[a.pendingMsg?(o(),n("div",P,[e("div",X,[G,r(" "+i(a.pendingMsg),1)])])):u("",!0)]),_:1}),!a.pendingMsg&&l.synthesis!=null?(o(),n("table",J,[W,(o(!0),n(_,null,f(a.masses,(t,c)=>(o(),n("tr",null,[e("th",null,i(t),1),e("td",Y,i(s.$filters.money(l.synthesis.effective_totals[c]))+" €",1),e("td",Z,i(s.$filters.money(l.synthesis.predicted_totals[c]))+" €",1)]))),256)),l.synthesis["N.B"]?(o(),n("tr",x,[e("th",null,[r(" Hors masse"),$,e("small",ee,[se,r(" Les annexes de certains comptes ne sont pas renseignés : "),e("ul",null,[(o(!0),n(_,null,f(s.getNoMasse,t=>(o(),n("li",null,[e("strong",null,i(t),1),l.synthesis.curations?(o(),n("div",te)):u("",!0)]))),256))]),s.manageDepense?(o(),n("a",{key:0,onClick:d[3]||(d[3]=(...t)=>s.handlerCuration&&s.handlerCuration(...t)),class:"btn btn-xs btn-default"},[ne,r("Qualifer les comptes")])):(o(),n("span",oe,"Merci de contacter un administrateur pour que les annexes des comptes soient configurés."))])]),e("td",le,"$filters.money("+i(l.synthesis["N.B"])+") €",1)])):u("",!0),e("tr",ie,[ae,e("td",re,i(s.$filters.money(l.synthesis.effective_total))+" €",1),e("td",de,i(s.$filters.money(l.synthesis.predicted_total))+" €",1)])])):u("",!0),l.synthesis&&l.synthesis.recettes?(o(),n("table",ue,[e("tr",null,[ce,e("td",he,i(s.$filters.money(l.synthesis.recettes.total))+" €",1)])])):u("",!0),e("small",null,[r("Données mise à jour : "),s.dateUpdated?(o(),n("strong",pe,i(s.dateUpdated.date|s.dateFull),1)):u("",!0)])])}const _e=N(T,[["render",me]]),fe={money(s){for(var d=s.toFixed(2),a="",g=!1,y=0,a=[],l=d.length-1;l>=0;l--){var t=d[l];t=="."?(a.push(","),g=!0):(a.push(t),g==!0&&t!="-"&&l>0&&(y++,y%3==0&&a.push(" ")))}return a.reverse().join("")}};let v=document.querySelector("#depenses2");const b=D(_e,{url:v.dataset.url,syncurl:v.dataset.syncurl});b.config.globalProperties.$filters={money:function(s){return fe.money(s)}};b.mount("#depenses2");
