import{d as m,e as M,c as i,f as h,a as e,t as a,h as u,w as k,T as C,F as _,r as f,b as n,g as p,v as x,n as g,o as r,k as D,l as S,i as w,j as N}from"../vendor.js";import{O as T}from"../vendor4.js";import{_ as A}from"../vendor2.js";const V={components:{OscarDialog:T},props:{url:{required:!0},manage:!1,bootbox:{required:!0}},data(){return{types:[],loadingMsg:null,form:null,dialogDelete:{display:!1},untyped_documents:0,documents_location:"",documents_pcru_type:"",migrate_dest:null}},computed:{loading(){return this.loadingMsg!=null}},methods:{formNew(){this.form={label:"",description:""}},handlerEdit(s){this.form=JSON.parse(JSON.stringify(s))},handlerSave(){if(this.form.id){this.loadingMsg="Mise à jour du type de document...";let o={typedocumentid:this.form.id,label:this.form.label,description:this.form.description,default:this.form.default?"on":""};m.put(this.url+"",o).then(c=>{flashMessage("success","Type de document mis à jour"),this.fetch()},c=>{flashMessage("error",c.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})}else{this.loadingMsg="Ajout d'un nouveau type de document...";var s=new FormData;s.append("label",this.form.label),s.append("description",this.form.description),s.append("default",this.form.default?"on":""),m.post(this.url,s).then(o=>{flashMessage("success","Type de document créé"),this.fetch()},o=>{flashMessage("error",o.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})}},remove(s){this.dialogDelete.title="Supprimer ce type de document ?",this.dialogDelete.message=`La suppression du type de document '${s.label}' sera définitive.`,this.dialogDelete.display=!0,this.dialogDelete.onSuccess=()=>this.removeConfirm(s)},removeConfirm(s){this.loadingMsg="Suppression du type de document...",m.delete(this.url+"?typedocumentid="+s.id).then(o=>{this.fetch()},o=>{flashMessage("error",o.body)}).then(()=>{this.loadingMsg=null,this.form=null})},fetch(){this.loadingMsg="Chargement des types de documents",m.get(this.url).then(s=>{this.types=s.data.types,this.untyped_documents=s.data.untyped_documents,this.documents_location=s.data.documents_location,this.documents_pcru_type=s.data.documents_pcru_type}).catch(s=>flashMessage("error","Impossible de charger les types de documents : "+s)).finally(()=>{this.loadingMsg=null})}},created(){this.fetch()}},q={key:0,class:"vue-loader"},j={key:0,class:"form-wrapper"},E={key:0},O={key:1},I={class:"form-group"},L=e("label",null,"Intitulé",-1),U={class:"form-group"},B={for:"typedoc_default"},F=e("div",{class:"alert alert-info"},[n(" L'option "),e("strong",null,"par défaut"),n(" définira ce type de document comme celui à utilisé si rien n'est précisé. Par exemple, lors des demandes d'activité, les documents envoyés par les utilisateurs seront qualifiés avec ce type (cela peut être modifié par la suite). ")],-1),P={class:"buttons-bar"},z={class:"btn-group"},J=e("button",{type:"submit",class:"btn btn-primary"},[e("i",{class:"icon-floppy"}),n(" Enregistrer ")],-1),R=e("i",{class:"icon-floppy"},null,-1),G={class:"row"},H={class:"col-md-8"},K=e("h1",null,"Types de documents disponibles",-1),Q={class:"card-title"},W={key:0},X=["href"],Y={key:2},Z={key:0,class:"card-footer"},$=["onClick"],ee=e("i",{class:"icon-pencil"},null,-1),te=["onClick"],se=e("i",{class:"icon-trash"},null,-1),oe={class:"col-md-4"},ne=e("h2",null,"Informations",-1),le=e("div",{class:"alert alert-info"},[n(" Les "),e("strong",null,"types de document"),n(" permettent de qualifier les documents ")],-1),ie=e("br",null,null,-1),re={class:"cartouche"},ae=e("br",null,null,-1),de={key:0,class:"alert alert-danger"},ue=e("h3",null,[e("i",{class:"icon-attention-1"}),n(" Documents non-typés détéctés")],-1),ce=e("strong",null,"Attention",-1),me=e("br",null,null,-1),pe=e("hr",null,null,-1),he={action:"",method:"post"},_e=e("input",{type:"hidden",name:"action",value:"migrate"},null,-1),fe={for:"migrator"},ge=["value"],ye=e("i",{class:"icon-circled-plus"},null,-1);function be(s,o,c,ke,l,d){const b=M("oscar-dialog");return r(),i("section",null,[h(b,{options:l.dialogDelete},null,8,["options"]),d.loading?(r(),i("div",q,[e("span",null,a(l.loadingMsg),1)])):u("",!0),h(C,{name:"popup"},{default:k(()=>[l.form?(r(),i("div",j,[e("form",{action:"",onSubmit:o[3]||(o[3]=w((...t)=>d.handlerSave&&d.handlerSave(...t),["prevent"])),class:"container oscar-form"},[e("header",null,[e("h1",null,[l.form-s.id?(r(),i("span",E,[n("Modification de "),e("strong",null,a(l.form.label),1)])):(r(),i("span",O,"Nouveau type de documents"))])]),e("div",I,[L,p(e("input",{id:"typedoc_label",type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=t=>l.form.label=t),name:"label"},null,512),[[D,l.form.label]])]),e("div",U,[e("label",B,[n(" Par défaut "),p(e("input",{id:"typedoc_default",type:"checkbox",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=t=>l.form.default=t),name:"default"},null,512),[[S,l.form.default]])]),F]),e("footer",P,[e("div",z,[J,e("button",{type:"reset",class:"btn btn-default",onClick:o[2]||(o[2]=t=>l.form=null)},[R,n(" Annuler ")])])])],32)])):u("",!0)]),_:1}),e("div",G,[e("div",H,[K,(r(!0),i(_,null,f(l.types,t=>(r(),i("article",{class:g(["card xs",{"selected active":t.default}])},[e("h1",Q,[e("span",null,[n(a(t.label)+" ",1),t.default?(r(),i("small",W," (par défaut)")):u("",!0),n(" - "),t.documents_total?(r(),i("a",{key:1,href:t.documents_view,title:"Afficher les activités contenant ce type de document"},a(t.documents_total)+" document(s) ",9,X)):(r(),i("em",Y,"Aucun document"))])]),c.manage?(r(),i("nav",Z,[e("button",{class:"btn btn-xs btn-primary",onClick:v=>d.handlerEdit(t)},[ee,n(" Éditer ")],8,$),e("button",{class:"btn btn-xs btn-default",onClick:v=>d.remove(t)},[se,n(" Supprimer ")],8,te)])):u("",!0)],2))),256))]),e("div",oe,[ne,le,e("div",null,[e("p",null,[n(" Emplacement où sont stoqués les documents :"),ie,e("code",re,a(l.documents_location),1)]),e("p",null,[n(" Type de document utilisé pour les envois PCRU :"),ae,e("strong",null,a(l.documents_pcru_type),1)])]),l.untyped_documents?(r(),i("div",de,[ue,ce,n(", il y'a "),e("strong",null,a(l.untyped_documents),1),n(" documents sans type de document. Ils correspondent généralement à des documents envoyés via les demandes d'activités ou envoyés dans une version plus ancienne de Oscar. "),me,n(" Vous pouvez leurs attribuer automatiquement un type avec la procédure ci-dessous : "),pe,e("form",he,[_e,e("label",fe,[n(" Migrer vers ce type "),p(e("select",{"onUpdate:modelValue":o[4]||(o[4]=t=>l.migrate_dest=t),id:"migrator",class:"form-control",name:"destination"},[(r(!0),i(_,null,f(l.types,t=>(r(),i("option",{value:t.id},a(t.label),9,ge))),256))],512),[[x,l.migrate_dest]])]),e("button",{type:"submit",class:g(["btn btn-success",{disabled:!l.migrate_dest}])}," Migrer les documents non-typés ",2)])])):u("",!0)])]),c.manage?(r(),i("button",{key:1,onClick:o[5]||(o[5]=(...t)=>d.formNew&&d.formNew(...t)),class:"btn btn-primary"},[ye,n(" Ajouter ")])):u("",!0)])}const ve=A(V,[["render",be]]);let y=document.querySelector("#admintypedocument");const Me=N(ve,{url:y.dataset.url,manage:y.dataset.manage});Me.mount("#admintypedocument");
