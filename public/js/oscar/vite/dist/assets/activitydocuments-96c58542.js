import{h as D,o as n,c as i,a as e,w as y,v as x,b as S,d as b,t as a,F as f,r as v,e as m,n as w,f as p,g as U,i as F,j as R,k as C,l as T,m as M,p as Y,q as O,s as E}from"../vendor.js";import{_ as P}from"../vendor2.js";D.locale("fr");const q={model:{prop:"modelValue",event:"update:modelValue"},props:{value:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:D().format(),pickerYearRef:D().format("YYYY"),pickerMonthRef:D().month(),realValue:this.value,manualChange:""}},computed:{years(){let s=this.pickerYearRef-11,t=this.pickerYearRef+11,h=[];for(var _=s;_<t;_++)h.push(_);return h},mmValue(){return this.realValue?(D.locale("fr"),D(this.realValue)):D()},pickerData(){var s=this.daysShort,t=D(this.realValue).format(this.valueFormat);let h=D(this.pickerDayRef).startOf("month").startOf("isoWeek"),_=D(this.pickerDayRef).endOf("month").startOf("isoWeek"),l=[];for(;h.unix()<=_.unix();){let r={num:h.week(),days:[]};for(let c=1;c<=7;c++){let g=!this.limitFrom||this.limitFrom&&this.limitFrom<h.format();r.days.push({enabled:g,date:h.format(),active:h.format(this.valueFormat)==t,day:h.format("D")}),h.add(1,"day")}l.push(r)}return{dayslabels:s,weeks:l}},currentMonth(){return D(this.pickerDayRef).format("MMMM")},currentYear(){return D(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(D.locale("fr"),D(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(s){console.log("convert ",s);try{let t=D(s,this.displayFormat);t.isValid()&&this.changeDate(t.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(s){try{var t=D(s.target.value);this.changeDate(t.format(this.valueFormat))}catch(h){console.error("WTF DATE",h)}},handlerSelectMonth(s){let t=this.months.indexOf(s);this.pickerDayRef=D(this.pickerDayRef).month(t).format(),this.pickerMode="day"},handlerSelectYear(s){this.pickerDayRef=D(this.pickerDayRef).year(s).format(),this.pickerMode="day"},changeDate(s){console.log("Modification de la date",s),this.picker=!1,this.realValue=s?D(s).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=D(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=D(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(s){s.preventDefault(),s.stopImmediatePropagation(),s.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(s){this.picker=!1},initPickerVar(){var s=D(this.pickerDayRef?this.pickerDayRef:D());this.pickerYearRef=s.year(),this.pickerMonthRef=s.format("MMMM")}},created(){D.locale(this.i18n),this.pickerDayRef=this.value?this.value:D().format(),this.initPickerVar()}},A={class:"input-group"},W=e("div",{class:"input-group-addon"},[e("i",{class:"icon-calendar"})],-1),L={class:"datepicker-wrapper"},z=e("i",{class:"icon-angle-left"},null,-1),j=[z],J={class:"heading"},X=e("i",{class:"icon-angle-right"},null,-1),H=[X],B={key:0,class:"day-labels week"},K=e("span",{class:"week-label"}," ",-1),G={class:"day-label"},Q={key:0},Z={class:"weeks"},$={class:"week"},ee={class:"week-label"},te=["onClick"],se={key:1,class:"months"},le=["onClick"],oe={key:2,class:"years"},ne=["onClick"],ie=e("i",{class:"icon-cancel-alt"},null,-1);function re(s,t,h,_,l,r){return n(),i("div",{onMouseenter:t[9]||(t[9]=(...c)=>r.handlerShow&&r.handlerShow(...c)),onMouseleave:t[10]||(t[10]=(...c)=>r.handlerHide&&r.handlerHide(...c))},[e("div",A,[y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=c=>r.renderValue=c)},null,512),[[x,r.renderValue]]),W]),y(e("div",{class:"datepicker-selector",onMouseleave:t[8]||(t[8]=(...c)=>r.handlerHide&&r.handlerHide(...c))},[e("div",L,[e("header",null,[e("nav",null,[e("span",{href:"#",onClick:t[1]||(t[1]=b((...c)=>r.pickerPrevMonth&&r.pickerPrevMonth(...c),["stop","prevent"]))},j),e("strong",J,[e("span",{class:"currentMonth",onClick:t[2]||(t[2]=b((...c)=>r.handlerPickerMonth&&r.handlerPickerMonth(...c),["stop"]))},a(r.currentMonth),1),e("span",{class:"currentYear",onClick:t[3]||(t[3]=b((...c)=>r.handlerPickerYear&&r.handlerPickerYear(...c),["stop"]))},a(r.currentYear),1)]),e("span",{href:"#",onClick:t[4]||(t[4]=b((...c)=>r.pickerNextMonth&&r.pickerNextMonth(...c),["stop"]))},H)]),l.pickerMode=="day"?(n(),i("div",B,[K,(n(!0),i(f,null,v(r.pickerData.dayslabels,c=>(n(),i("span",G,a(c),1))),256))])):m("",!0)]),l.pickerMode=="day"?(n(),i("section",Q,[(n(!0),i(f,null,v(r.pickerData.weeks,c=>(n(),i("div",Z,[e("span",$,[e("span",ee,a(c.num),1),(n(!0),i(f,null,v(c.days,g=>(n(),i("span",{class:w(["week-day",{active:g.active,disabled:!g.enabled}]),onClick:b(o=>r.changeDate(g.date),["prevent","stop"])},a(g.day),11,te))),256))])]))),256))])):m("",!0),l.pickerMode=="month"?(n(),i("section",se,[(n(!0),i(f,null,v(h.months,c=>(n(),i("span",{class:w(["month",{active:l.pickerMonthRef==c}]),onClick:b(g=>r.handlerSelectMonth(c),["prevent","stop"])},a(c),11,le))),256))])):m("",!0),l.pickerMode=="year"?(n(),i("section",oe,[e("span",{class:"year",onClick:t[5]||(t[5]=b(c=>l.pickerYearRef-=22,["prevent","stop"]))},"<<"),(n(!0),i(f,null,v(r.years,c=>(n(),i("span",{class:w(["year",{active:l.pickerYearRef==c}]),onClick:b(g=>r.handlerSelectYear(c),["prevent","stop"])},a(c),11,ne))),256)),e("span",{class:"year",onClick:t[6]||(t[6]=b(c=>l.pickerYearRef+=22,["prevent","stop"]))},">>")])):m("",!0)]),e("div",{style:{"text-align":"center",cursor:"pointer"},onClick:t[7]||(t[7]=(...c)=>r.handlerClear&&r.handlerClear(...c))},[ie,p(" Supprimer la date ")])],544),[[S,l.picker]])],32)}const ae=P(q,[["render",re]]);let V;const ce={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(s,t){s.length>=2&&(V&&clearTimeout(V),V=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,U.get(this.url+this.expression+"&f=json",{before(s){this.request&&this.request.abort(),this.request=s}}).then(s=>{console.log(s),this.persons=s.data.datas,this.showSelector=!0},s=>{console.log(s),s.status==403?this.error="403 Unauthorized":s.message?this.error="ERROR : "+s.message:s.body&&(this.error=s.body)}).then(s=>{this.loading=!1,this.request=null})},handlerSelectPerson(s){let t=this.persons.find(h=>h.id==s);console.log("handlerSelectPerson",t),this.selectedPerson=t,this.showSelector=!1,this.expression="",this.$emit("change",t)}}},de={key:0,class:"alert alert-danger"},ue=e("i",{class:"icon-spinner animate-spin"},null,-1),he=[ue],pe={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},me=["onClick"],_e={style:{display:"block",width:"50px",height:"50px"}},fe=["src","alt"],ve={class:"infos"},De={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},ye=e("br",null,null,-1),be={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},ke=e("i",{class:"icon-location"},null,-1),ge={key:0},we=e("br",null,null,-1),Ce={style:{"font-weight":"100","font-size":".8em"}},Me=e("i",{class:"icon-mail"},null,-1),xe={key:1,class:"alert alert-danger"},Se=e("i",{class:"icon-attention-1"},null,-1);function Te(s,t,h,_,l,r){return n(),i("div",null,[l.error?(n(),i("div",de,[p(a(l.error)+" ",1),e("button",{class:"btn btn-default",onClick:t[0]||(t[0]=c=>l.error="")},"Fermer")])):m("",!0),y(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=c=>l.expression=c),onKeyup:t[2]||(t[2]=F(b((...c)=>r.search&&r.search(...c),["prevent"]),["enter"]))},null,544),[[x,l.expression]]),y(e("span",null,he,512),[[S,l.loading]]),y(e("div",pe,[(n(!0),i(f,null,v(l.persons,c=>(n(),i("div",{class:"choice",key:c.id,onClick:b(g=>r.handlerSelectPerson(c.id),["prevent","stop"])},[e("div",_e,[e("img",{src:"https://www.gravatar.com/avatar/"+c.mailMd5+"?s=50",alt:c.displayname,style:{width:"100%"}},null,8,fe)]),e("div",ve,[e("strong",De,a(c.displayname),1),ye,e("span",be,[ke,p(" "+a(c.affectation)+" ",1),c.ucbnSiteLocalisation?(n(),i("span",ge," ~ "+a(c.ucbnSiteLocalisation),1)):m("",!0)]),we,e("em",Ce,[Me,p(a(c.email),1)])])],8,me))),128))],512),[[S,l.persons.length>0&&l.showSelector]]),l.error?(n(),i("div",xe,[Se,p(" "+a(l.error),1)])):m("",!0)])}const Ue=P(ce,[["render",Te]]);const I="private",Ve={components:{"date-picker":ae,"person-auto-completer":Ue},props:{urlUploadNewDoc:{required:!0},url:{required:!0}},data(){return{idCurrentPerson:null,persons:[],computedDocuments:[],dateDeposit:"",dateSend:"",fileUrl:"",fileUrlLabel:"",privateDocument:!1,selectedIdTypeDocument:null,selectedIdTabDocument:null,informationsDocument:"",fileToDownload:null,uploadNewDocData:{dateDeposit:this.dateDeposit,dateSend:this.dateSend,private:this.privateDocument,type:this.selectedIdTypeDocument,tab:this.selectedIdTabDocument,informations:this.informationsDocument,persons:this.persons,baseUrlUpload:this.urlUploadNewDoc,url:"",init:!1},errorMessages:[],tabId:null,tabsWithDocuments:null,formData:null,error:null,deleteData:null,editData:null,uploadDoc:null,documents:[],loading:!0,sortField:"dateUpload",sortDirection:-1,editable:!0,remoterState:null,displayComputed:!1,editedDocument:null,processDetails:null,mode_url:!1,typesDocuments:[],selectedTab:null,selectedTabId:null}},computed:{selectedTypeDocument(){return this.selectedIdTypeDocument?(console.log(this.typesDocuments),this.typesDocuments.find(s=>s.id==this.selectedIdTypeDocument)):null},documentsPacked(){let s=[];return this.documents&&(s=this.documents.sort(function(h,_){return h[this.sortField]<_[this.sortField]?-1*this.sortDirection:h[this.sortField]>_[this.sortField]?1*this.sortDirection:0}.bind(this))),s},packedDocuments(){let s={};if(this.tabsWithDocuments)for(const[t,h]of Object.entries(this.tabsWithDocuments)){let _={};for(const[l,r]of Object.entries(h.documents)){let c=r.fileName;_.hasOwnProperty(c)?_[c].versions.push(r):(r.versions=[],_[c]=r)}s[t]={id:h.id,label:h.label,total:h.total,description:h.description,manage:h.manage,roles:h.roles,documents:_}}return s}},methods:{handlerProcessDetailsOn(s){this.processDetails=s},handlerProcessDetailsOff(){this.processDetails=null},activeTab(s){this.tabId=s},deleteDocument(s){this.deleteData=s},order:function(s){this.sortField==s?this.sortDirection*=-1:this.sortField=s},cssStepCurrent(s){return s===this.tabId?"current":""},cssSort:function(s){return s===this.sortField?"active":""},handlerEdit(s){this.editedDocument=s},handlerSelectPersons(s){if(console.log("handlerSelectPersons",s),s.id){let t={personName:s.displayname,personId:s.id,affectation:s.affectation},h=s.id,_=!1;this.persons.forEach(function(l){l.personId===h&&(_=!0)}),_===!1&&(this.editedDocument?(this.editedDocument.persons||(this.editedDocument.persons=[]),this.editedDocument.persons.push(t)):this.persons.push(t))}},handlerDeletePerson(s){this.persons.splice(this.persons.indexOf(s),1)},handlerUploadNewDoc(s){this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=this.urlUploadNewDoc+"/"+s,this.initUploadDatas(s)},handlerNewVersion(s){console.log(JSON.parse(JSON.stringify(s))),this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=s.urlReupload,this.selectedIdTypeDocument=this.uploadNewDocData.selectedIdTypeDocument=s.category.id,this.uploadNewDocData.tab=s.tabDocument.id,this.privateDocument=this.uploadNewDocData.private=s.private,this.informationsDocument="",this.persons=[],s.persons.forEach(t=>{this.persons.push(t)}),this.uploadNewDocData.init=!0,this.fileToDownload=null},handlerUploadNewVersionDoc(s,t,h){this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=t,this.selectedIdTypeDocument=h,this.initUploadDatas(s,h)},initUploadDatas(s,t=null){this.dateDeposit="",this.dateSend="";let h=!1;s===I&&(h=!0),this.privateDocument=h,this.selectedIdTypeDocument=t,this.informationsDocument="",this.fileUrl=this.uploadNewDocData.url="",this.fileUrlLabel="",this.persons=[],this.uploadNewDocData.init=!0,this.fileToDownload=null,this.uploadNewDocData.tab=s},uploadFile(s){s.target.files.length!==0&&(this.fileToDownload=s.target.files[0])},performUpload(){this.uploadNewDocData.dateDeposit=this.dateDeposit,this.uploadNewDocData.dateSend=this.dateSend,this.uploadNewDocData.private=this.privateDocument===!0?"1":"0",this.uploadNewDocData.type=this.selectedIdTypeDocument,this.uploadNewDocData.informations=this.informationsDocument;let s=[];this.persons.length!==0&&this.persons.forEach(function(h){s.push(h.personId)}),this.uploadNewDocData.persons=s;const t=new FormData;for(let h in this.uploadNewDocData){let _=this.uploadNewDocData[h];t.append(h,_)}this.mode_url?(t.append("url",this.fileUrl),t.append("label_url",this.fileUrlLabel)):this.fileToDownload!==null?t.append("file",this.fileToDownload,this.fileToDownload.name):this.errorMessages.push("Aucun fichier sélectionner a téléverser !"),this.uploadNewDocData.type===null&&this.errorMessages.push("Vous devez qualifier le type de votre document !"),this.errorMessages.length===0&&(this.uploadDoc=null,this.persons=[],console.log(this.uploadNewDocData.baseUrlUpload),U.post(this.uploadNewDocData.baseUrlUpload,t).then(h=>{console.log("SUCCESS ",h),this.fetch()},h=>{console.log("ERROR ",h),this.error=h.response.data}))},applyEdit(){let s=new FormData;s.append("data",JSON.stringify(this.editedDocument)),s.append("action","edit"),U.post(this.editedDocument.urlReupload,s).then(t=>{console.log("SUCCESS",t),this.editedDocument=null,this.fetch()},t=>{console.log("ERROR",t),this.error=t})},performEdit(){this.errorMessages=[];let s=[],t="",h=!0;if(this.editData.private===!0?(h=1,this.persons.length!==0&&this.persons.forEach(c=>{s.push(c.personId)})):(h=0,this.editData.tabDocument_id===I||this.editData.tabDocument_id===""?this.errorMessages.push("Vous devez sélectionner un onglet pour la modification (ce n'est pas un document qualifié privé)"):t=this.editData.tabDocument_id),this.errorMessages.length!==0)return;let _=this.editData.document.id,l=this.editData.documentype_id;this.editData=null,this.persons=[];let r=new FormData;r.append("documentId",_),r.append("type",l),r.append("tabDocument",t),r.append("private",h),r.append("persons",s)},handlerSuccess(s){try{this.idCurrentPerson=s.data.idCurrentPerson;let t=Array.isArray(s.data.tabsWithDocuments)?{}:s.data.tabsWithDocuments,h=null,_=null;if(Object.keys(t).forEach(l=>{let r=t[l];r.total=r.documents.length,r.documents.sort((c,g)=>g.version-c.version),r.documents.forEach(c=>{console.log(c.fileName,c.version),c.explode=!0}),h==null&&(h=r.id),_==null&&r.documents.length>0&&(_=r.id)}),this.tabsWithDocuments=t,this.computedDocuments=s.data.computedDocuments,this.typesDocuments=s.data.typesDocuments,this.selectedTabId==null&&(this.selectedTabId=_||h),this.tabsWithDocuments.unclassified&&this.tabsWithDocuments.unclassified.documents.length)this.selectedTab=this.tabsWithDocuments.unclassified;else{let l=Object.keys(this.tabsWithDocuments)[0];l.length&&(this.selectedTab=this.tabsWithDocuments[l[0]])}}catch(t){console.log("Erreur de traitement ",t)}},handlerSelectTab(s){s=="computed"?(this.displayComputed=!0,this.selectedTab=null,this.selectedTabId=null):(this.displayComputed=!1,this.selectedTab=s,this.selectedTabId=s.id)},fetch(){console.log("fetch()"+this.url),U.get(this.url).then(s=>{this.handlerSuccess(s)},s=>{this.error=s})}},mounted(){this.fetch()}},u=s=>(Y("data-v-74d0bb24"),s=s(),O(),s),Ne={key:0,class:"overlay"},Pe={class:"overlay-content",style:{"max-width":"50%"}},Re={class:"alert-danger alert"},Ie=u(()=>e("i",{class:"icon-attention-1"},null,-1)),Fe=u(()=>e("i",{class:"icon-cancel-outline"},null,-1)),Ye={key:1,class:"overlay"},Oe={class:"overlay-content",style:{"max-width":"50%"}},Ee=u(()=>e("small",null,[e("i",{class:"icon-edit"}),p(" Procédure")],-1)),qe=u(()=>e("br",null,null,-1)),Ae=u(()=>e("br",null,null,-1)),We={class:"signature-status-101"},Le={class:"status"},ze={class:"metas"},je={class:"meta"},Je={class:"meta"},Xe={class:"fullname"},He={class:"email"},Be={class:"status"},Ke={class:"status-text"},Ge=u(()=>e("i",{class:"icon-cancel-outline"},null,-1)),Qe={style:{position:"relative","min-height":"100px"}},Ze={key:0,class:"overlay"},$e={class:"overlay-content"},et={class:"alert-danger alert"},tt=u(()=>e("i",{class:"icon-attention-1"},null,-1)),st=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),lt=["href"],ot=u(()=>e("i",{class:"icon-valid"},null,-1)),nt={key:1,class:"overlay"},it={class:"overlay-content"},rt=u(()=>e("small",null,[e("i",{class:"icon-doc"}),p(" Modification du document : ")],-1)),at=u(()=>e("br",null,null,-1)),ct={class:"row"},dt={class:"col-md-6"},ut=u(()=>e("label",{for:"typedocument"},"Type de document",-1)),ht={key:0,class:"alert alert-warning"},pt={key:1},mt=["value","disabled"],_t={class:"col-md-6"},ft={class:"row"},vt={key:0},Dt=u(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),yt=["value"],bt=u(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),kt={class:"col-md-6"},gt={key:0},wt=u(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),Ct=u(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),Mt=u(()=>e("i",{class:"icon-cube"},null,-1)),xt={class:"addon"},St=["onClick"],Tt={class:"row"},Ut={class:"col-md-12"},Vt=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Nt=u(()=>e("i",{class:"icon-valid"},null,-1)),Pt={key:2,class:"overlay"},Rt={class:"overlay-content"},It=u(()=>e("i",{class:"icon-doc"},null,-1)),Ft={class:"row"},Yt={class:"col-md-6"},Ot=u(()=>e("label",{for:"typedocument"},"Type de document",-1)),Et=["selected","value"],qt={class:"col-md-6"},At={class:"row",style:{"margin-top":"20px"}},Wt={key:0},Lt=u(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),zt=["selected","value"],jt=u(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),Jt={class:"col-md-6"},Xt={key:0},Ht=u(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),Bt=u(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),Kt=u(()=>e("i",{class:"icon-cube"},null,-1)),Gt={key:0,class:"addon"},Qt=["onClick"],Zt={class:"row"},$t={class:"col-md-12"},es=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),ts=u(()=>e("i",{class:"icon-valid"},null,-1)),ss={key:3,class:"overlay"},ls={class:"overlay-content"},os={class:"alert"},ns={for:"switch_mode"},is={style:{width:"90%","margin-left":"5%"}},rs={class:"row"},as={class:"col-md-6"},cs={key:0},ds=u(()=>e("label",{for:"url"},"URL du fichier",-1)),us=u(()=>e("label",{for:"label"},"Description de l'URL",-1)),hs={key:1},ps=u(()=>e("label",{for:"file"},"Fichier",-1)),ms=u(()=>e("label",null,"Date de dépôt",-1)),_s=u(()=>e("p",{class:"help"},"Date à laquelle le fichier a été reçu",-1)),fs=u(()=>e("label",null,"Date d'envoi",-1)),vs=u(()=>e("p",{class:"help"},"Date à laquelle le fichier a été envoyé",-1)),Ds={class:"col-md-6"},ys=u(()=>e("label",{for:"type"},"Type de document",-1)),bs=["value"],ks={key:0},gs=u(()=>e("h3",null,"Procédure de signature : ",-1)),ws={class:"metas"},Cs={class:"meta"},Ms={class:"meta"},xs={class:"meta"},Ss={class:"recipient"},Ts={class:"email"},Us={class:"fullname"},Vs={key:1,class:"row",style:{"margin-top":"20px"}},Ns=u(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),Ps={class:"col-md-6"},Rs={key:2,class:"alert alert-info"},Is={key:3},Fs=u(()=>e("h4",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),Ys=u(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),Os=u(()=>e("i",{class:"icon-cube"},null,-1)),Es={key:0,class:"addon"},qs=["onClick"],As={class:"row"},Ws={class:"col-md-12"},Ls=u(()=>e("label",{for:"informations"},"Note",-1)),zs=u(()=>e("hr",null,null,-1)),js={class:"buttons text-center"},Js=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Xs=u(()=>e("i",{class:"icon-valid"},null,-1)),Hs={key:4,class:"overlay"},Bs={class:"overlay-content"},Ks=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Gs={class:"documents-content"},Qs={class:"tabs"},Zs=["onClick"],$s={class:"label label-default"},el={class:"tab-content"},tl={class:""},sl=u(()=>e("i",{class:"picto icon-doc"},null,-1)),ll=u(()=>e("small",{class:"text-light"},"  (Document généré automatiquement) ",-1)),ol={class:"text-right show-over"},nl=["href"],il=u(()=>e("i",{class:"icon-upload-outline"},null,-1)),rl={class:"tab-content"},al={key:0,class:"text-right"},cl=["onClick"],dl=u(()=>e("i",{class:"icon-download"},null,-1)),ul=u(()=>e("hr",null,null,-1)),hl={class:""},pl={key:0,class:"picto icon-anchor-outline"},ml={class:"text-light"},_l=["title"],fl={key:0},vl=u(()=>e("i",{class:"icon-lock"},null,-1)),Dl={class:"cartouche"},yl={class:"card-content"},bl={key:0,class:"alert alert-info"},kl=["onClick"],gl={key:1},wl=u(()=>e("div",{class:"exploder"}," Versions précédentes : ",-1)),Cl={class:"subdoc text-highlight"},Ml={key:0},xl=["href"],Sl=u(()=>e("i",{class:"icon-download-outline"},null,-1)),Tl={class:"text-right show-over"},Ul=["href"],Vl=u(()=>e("i",{class:"icon-link-ext"},null,-1)),Nl=["href"],Pl=u(()=>e("i",{class:"icon-upload-outline"},null,-1)),Rl=["onClick"],Il=u(()=>e("i",{class:"icon-download-outline"},null,-1)),Fl=["onClick"],Yl=u(()=>e("i",{class:"icon-trash"},null,-1)),Ol=["onClick"],El=u(()=>e("i",{class:"icon-pencil"},null,-1));function ql(s,t,h,_,l,r){const c=R("person-auto-completer"),g=R("date-picker");return n(),i(f,null,[l.error?(n(),i("div",Ne,[e("div",Pe,[e("h2",null,[p(" Erreur documents "),e("span",{class:"overlay-closer",onClick:t[0]||(t[0]=o=>l.error=null)},"X")]),e("p",Re,[Ie,p(a(l.error),1)]),e("button",{class:"btn btn-default",onClick:t[1]||(t[1]=o=>l.error=null)},[Fe,p(" Fermer ")])])])):m("",!0),l.processDetails?(n(),i("div",Ye,[e("div",Oe,[e("h2",null,[Ee,p(),qe,e("strong",null,a(l.processDetails.label),1),p(),Ae,e("span",We,[p(a(l.processDetails.status_text)+" - ",1),e("em",null,"étape "+a(l.processDetails.current_step)+" / "+a(l.processDetails.total_steps),1)]),e("span",{class:"overlay-closer",onClick:t[2]||(t[2]=(...o)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...o))},"X")]),(n(!0),i(f,null,v(l.processDetails.steps,o=>(n(),i("section",{class:w(["signature","signature-status-"+o.status])},[e("h4",null,[e("small",null,"étape "+a(o.order)+" : ",1),e("strong",null,a(o.label),1),e("span",Le," ("+a(o.status_text)+")",1)]),e("ul",ze,[e("li",je,[p("Parapheur "),e("strong",null,a(o.letterfile),1)]),e("li",Je,[p("Niveau "),e("strong",null,a(o.level),1)])]),(n(!0),i(f,null,v(o.recipients,d=>(n(),i("article",{class:w(["recipient","signature-status-"+d.status])},[e("strong",Xe,a(d.fullname),1),e("em",He,a(d.email),1),e("span",Be,[e("span",Ke,a(d.status_text),1)])],2))),256))],2))),256)),e("button",{class:"btn btn-default",onClick:t[3]||(t[3]=(...o)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...o))},[Ge,p(" Fermer ")])])])):m("",!0),e("section",Qe,[l.deleteData?(n(),i("div",Ze,[e("div",$e,[e("h2",null,[p(" Suppression du fichier ? "),e("span",{class:"overlay-closer",onClick:t[4]||(t[4]=o=>l.deleteData=null)},"X")]),e("p",et,[tt,p(" Souhaitez-vous supprimer le fichier "),e("strong",null,a(l.deleteData.fileName),1),p(" ? ")]),e("button",{class:"btn btn-danger",onClick:t[5]||(t[5]=o=>l.deleteData=null)},[st,p(" Annuler ")]),e("a",{class:"btn btn-success",href:l.deleteData.urlDelete},[ot,p(" Confirmer ")],8,lt)])])):m("",!0),l.editedDocument?(n(),i("div",nt,[e("div",it,[e("h2",null,[rt,at,p(" "+a(l.editedDocument.fileName)+" ",1),e("span",{class:"overlay-closer",onClick:t[6]||(t[6]=o=>l.editedDocument=null)},"X")]),e("div",ct,[e("div",dt,[e("div",null,[ut,l.editedDocument.process?(n(),i("div",ht," Vous ne pouvez pas modifier le type d'un document engagé dans un processus de signature. ")):(n(),i("div",pt,[y(e("select",{class:"form-control",name:"type",id:"typedocument","onUpdate:modelValue":t[7]||(t[7]=o=>l.editedDocument.category.id=o)},[(n(!0),i(f,null,v(l.typesDocuments,(o,d)=>(n(),i("option",{value:o.id,key:o.id,disabled:o.flow},a(o.label)+" "+a(o.flow&&l.editedDocument.id?"(signature)":""),9,mt))),128))],512),[[C,l.editedDocument.category.id]])]))])]),e("div",_t,[e("div",ft,[l.editedDocument.private===!1?(n(),i("span",vt,[Dt,e("div",null,[y(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":t[8]||(t[8]=o=>l.editedDocument.tabDocument.id=o),class:"form-control"},[(n(!0),i(f,null,v(l.tabsWithDocuments,(o,d)=>(n(),i("option",{value:d,key:d},a(o.label),9,yt))),128))],512),[[C,l.editedDocument.tabDocument.id]])])])):m("",!0),bt,e("div",kt,[y(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=o=>l.editedDocument.private=o)},null,512),[[T,l.editedDocument.private]])])]),l.editedDocument.private===!0?(n(),i("span",gt,[wt,Ct,M(c,{onChange:r.handlerSelectPersons},null,8,["onChange"]),(n(!0),i(f,null,v(l.editedDocument.persons,o=>(n(),i("span",{key:o.id,class:"cartouche"},[Mt,e("span",null,a(o.personName),1),e("span",xt,a(o.affectation),1),o.personId!==l.idCurrentPerson?(n(),i("i",{key:0,onClick:d=>r.handlerDeletePerson(o),class:"icon-trash icon-clickable"},null,8,St)):m("",!0)]))),128))])):m("",!0)])]),e("div",Tt,[e("div",Ut,[p(a(l.editedDocument)+" ",1),e("button",{class:"btn btn-danger",onClick:t[10]||(t[10]=o=>l.editedDocument=null)},[Vt,p(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:t[11]||(t[11]=b(o=>r.applyEdit(),["prevent"]))},[Nt,p(" Enregistrer ")])])])])])):m("",!0),l.editData?(n(),i("div",Pt,[e("div",Rt,[e("h2",null,[p(" Modification du document : "),It,p(" "+a(l.editData.basename)+" ",1),e("span",{class:"overlay-closer",onClick:t[12]||(t[12]=o=>l.editData=null)},"X")]),e("div",Ft,[e("div",Yt,[Ot,e("div",null,[y(e("select",{name:"type",id:"typedocument","onUpdate:modelValue":t[13]||(t[13]=o=>l.editData.documentype_id=o)},[(n(!0),i(f,null,v(s.documentTypes,(o,d)=>(n(),i("option",{selected:l.editData.documentype_id==d,value:d,key:d},a(o),9,Et))),128))],512),[[C,l.editData.documentype_id]])])]),e("div",qt,[e("div",At,[l.editData.private===!1?(n(),i("span",Wt,[Lt,e("div",null,[y(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":t[14]||(t[14]=o=>l.editData.tabDocument_id=o)},[s.tabDoc.manage===!0&&s.tabDoc.id!="private"?(n(!0),i(f,{key:0},v(l.tabsWithDocuments,(o,d)=>(n(),i("option",{selected:l.editData.tabDocument_id==d,value:d,key:d},a(o.label),9,zt))),128)):m("",!0)],512),[[C,l.editData.tabDocument_id]])])])):m("",!0),jt,e("div",Jt,[y(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=o=>l.editData.private=o)},null,512),[[T,l.editData.private]])])]),l.editData.private===!0?(n(),i("span",Xt,[Ht,Bt,M(c,{onChange:r.handlerSelectPersons},null,8,["onChange"]),l.persons.length!==0?(n(!0),i(f,{key:0},v(l.persons,o=>(n(),i("span",{key:o.personId,class:"cartouche"},[Kt,e("span",null,a(o.personName),1),o.affectation.trim()!==""?(n(),i("span",Gt,a(o.affectation),1)):m("",!0),o.personId!==l.idCurrentPerson?(n(),i("i",{key:1,onClick:d=>r.handlerDeletePerson(o),class:"icon-trash icon-clickable"},null,8,Qt)):m("",!0)]))),128)):m("",!0)])):m("",!0)])]),e("div",Zt,[e("div",$t,[e("button",{class:"btn btn-danger",onClick:t[16]||(t[16]=o=>l.editData=null)},[es,p(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:t[17]||(t[17]=b(o=>r.performEdit(),["prevent"]))},[ts,p(" Enregistrer ")])])])])])):m("",!0),l.uploadDoc?(n(),i("div",ss,[e("div",ls,[e("h2",null,[p(" Téléverser un nouveau document dans "),e("strong",null,a(l.selectedTab.label),1),e("span",{class:"overlay-closer",onClick:t[18]||(t[18]=o=>l.uploadDoc=null)},"X")]),e("div",os,[e("label",ns,[p(" Cochez cette case si le fichier est un URL "),y(e("input",{type:"checkbox",name:"switch_mode","onUpdate:modelValue":t[19]||(t[19]=o=>l.mode_url=o)},null,512),[[T,l.mode_url]])])]),e("div",is,[p(a()+" ",1),e("div",rs,[e("div",as,[l.mode_url?(n(),i("div",cs,[ds,y(e("input",{type:"text",class:"form-control",name:"url",id:"url",placeholder:"Lien vers la ressource","onUpdate:modelValue":t[20]||(t[20]=o=>l.fileUrl=o)},null,512),[[x,l.fileUrl]]),us,y(e("input",{type:"text",class:"form-control",name:"label",id:"label",placeholder:"Description rapide de la ressource","onUpdate:modelValue":t[21]||(t[21]=o=>l.fileUrlLabel=o)},null,512),[[x,l.fileUrlLabel]])])):(n(),i("div",hs,[ps,e("input",{onChange:t[22]||(t[22]=(...o)=>r.uploadFile&&r.uploadFile(...o)),type:"file",class:"form-control",name:"file",id:"file"},null,32)])),ms,_s,M(g,{modelValue:l.dateDeposit,"onUpdate:modelValue":t[23]||(t[23]=o=>l.dateDeposit=o)},null,8,["modelValue"]),fs,vs,M(g,{modelValue:l.dateSend,"onUpdate:modelValue":t[24]||(t[24]=o=>l.dateSend=o)},null,8,["modelValue"])]),e("div",Ds,[ys,y(e("select",{"onUpdate:modelValue":t[25]||(t[25]=o=>l.selectedIdTypeDocument=o),name:"type",id:"type",class:"form-control"},[(n(!0),i(f,null,v(l.typesDocuments,o=>(n(),i("option",{value:o.id,key:o.id},a(o.label),9,bs))),128))],512),[[C,l.selectedIdTypeDocument]]),r.selectedTypeDocument&&r.selectedTypeDocument.flow?(n(),i("section",ks,[gs,(n(!0),i(f,null,v(r.selectedTypeDocument.flow,o=>(n(),i("article",{key:o.id,class:"signature"},[e("h2",null,a(o.label),1),(n(!0),i(f,null,v(o.steps,d=>(n(),i("article",null,[e("ul",ws,[e("li",Cs,[p("Parapheur: "),e("strong",null,a(d.letterfile_label),1)]),e("li",Ms,[p("Type: "),e("strong",null,a(d.level_label),1)]),e("li",xs,[p("Tous signent: "),e("strong",null,a(d.allSignToComplete?"Oui":"non"),1)])]),(n(!0),i(f,null,v(d.recipients,k=>(n(),i("div",Ss,[e("strong",Ts,a(k.email),1),e("span",Us,a(k.firstname)+" "+a(k.lastname),1)]))),256))]))),256))]))),128))])):m("",!0),l.mode_url!=!0?(n(),i("div",Vs,[Ns,e("div",Ps,[y(e("input",{type:"checkbox",name:"private",id:"private",class:"form-control","onUpdate:modelValue":t[26]||(t[26]=o=>l.privateDocument=o)},null,512),[[T,l.privateDocument]])])])):(n(),i("div",Rs," Les URL ne peuvent pas être définie comme privée dans Oscar ")),l.privateDocument===!0?(n(),i("span",Is,[Fs,Ys,M(c,{onChange:r.handlerSelectPersons},null,8,["onChange"]),l.persons.length!==0?(n(!0),i(f,{key:0},v(l.persons,o=>(n(),i("span",{key:o.personId,class:"cartouche"},[Os,e("span",null,a(o.personName),1),o.affectation.trim()!=""?(n(),i("span",Es,a(o.affectation),1)):m("",!0),o.affectation.trim()===""?(n(),i("i",{key:1,onClick:d=>r.handlerDeletePerson(o),class:"icon-trash icon-clickable"},null,8,qs)):m("",!0)]))),128)):m("",!0)])):m("",!0)]),e("div",As,[e("div",Ws,[Ls,y(e("textarea",{"onUpdate:modelValue":t[27]||(t[27]=o=>l.informationsDocument=o),name:"informations",id:"informations",class:"form-control",cols:"30",rows:"10"},null,512),[[x,l.informationsDocument]])])]),zs,e("nav",js,[e("button",{class:"btn btn-danger",onClick:t[28]||(t[28]=o=>l.uploadDoc=null)},[Js,p(" Annuler ")]),e("button",{class:"btn btn-success",href:"#",onClick:t[29]||(t[29]=b(o=>r.performUpload(),["prevent"]))},[Xs,p(" Enregistrer ")])])])])])])):m("",!0),l.errorMessages.length!==0?(n(),i("div",Hs,[e("div",Bs,[e("h2",null,[e("span",{class:"overlay-closer",onClick:t[30]||(t[30]=o=>l.errorMessages=[])},"X")]),e("ul",null,[(n(!0),i(f,null,v(l.errorMessages,o=>(n(),i("li",null,a(o),1))),256))]),e("button",{class:"btn btn-danger",onClick:t[31]||(t[31]=o=>l.errorMessages=[])},[Ks,p(" Retour ")])])])):m("",!0),e("section",Gs,[e("div",Qs,[(n(!0),i(f,null,v(r.packedDocuments,o=>(n(),i("div",{class:w(["tab",{selected:l.selectedTabId===o.id}]),onClick:b(d=>r.handlerSelectTab(o),["prevent"])},[p(a(o.label)+" ",1),e("sup",$s,a(o.total),1)],10,Zs))),256)),e("div",{class:w(["tab",{selected:l.displayComputed}]),onClick:t[32]||(t[32]=b(o=>r.handlerSelectTab("computed"),["prevent"]))}," Documents générés ",2)]),y(e("div",el,[(n(!0),i(f,null,v(l.computedDocuments,o=>(n(),i("article",{class:"card xs",key:o.key},[e("div",tl,[sl,e("strong",null,a(o.label),1),ll]),e("nav",ol,[e("a",{class:"btn btn-default btn-xs",href:o.url},[il,p(" Télécharger ")],8,nl)])]))),128))],512),[[S,l.displayComputed]]),(n(!0),i(f,null,v(r.packedDocuments,o=>y((n(),i("div",rl,[o.manage?(n(),i("nav",al,[o.manage?(n(),i("button",{key:0,onClick:d=>r.handlerUploadNewDoc(o.id),class:"btn btn-xs btn-default"},[dl,p(" Téléverser un document ")],8,cl)):m("",!0)])):m("",!0),ul,(n(!0),i(f,null,v(o.documents,d=>(n(),i("article",{class:w(["card xs",{"private-document":d.private}]),key:d.id},[e("div",hl,[d.location=="link"?(n(),i("i",pl)):(n(),i("i",{key:1,class:w(["picto icon-doc","doc"+d.extension])},null,2)),e("small",ml,a(d.category.label)+" ~ ",1),e("strong",null,a(d.fileName),1),d.location!="url"?(n(),i("small",{key:2,class:"text-light",title:d.fileSize+" octet(s)"},"  ("+a(d.fileSize|s.filesize)+") - Version "+a(d.version),9,_l)):m("",!0)]),d.private?(n(),i("section",fl,[vl,p(" Ce document est privé, accessible par : "),(n(!0),i(f,null,v(d.persons,k=>(n(),i("span",Dl,a(k.personName),1))),256))])):m("",!0),e("p",null,a(d.information),1),e("div",yl,[d.process&&d.process.status!=200?(n(),i("section",bl,[p(" Procédure de signature "),e("em",null,a(d.process.label),1),p(" - "),e("strong",null,a(d.process.status_text),1),p(" - "),e("span",null,"étape "+a(d.process.current_step)+" / "+a(d.process.total_steps),1),p(" - "),e("button",{class:"btn btn-xs btn-info",onClick:k=>r.handlerProcessDetailsOn(d.process)}," Détails ",8,kl)])):m("",!0),d.versions.length?(n(),i("div",gl,[wl,(n(!0),i(f,null,v(d.versions,k=>(n(),i("article",Cl,[e("i",{class:w(["picto icon-doc","doc"+k.extension])},null,2),e("strong",null,a(k.fileName),1),p(" version "),e("em",null,a(k.version),1),p(", téléchargé le "),e("time",null,a(k.dateUpload|s.dateFullSort),1),k.uploader?(n(),i("span",Ml,[p(" par "),e("strong",null,a(k.uploader.displayname),1)])):m("",!0),e("a",{href:k.urlDownload},[Sl,p(" Télécharger cette version ")],8,xl)]))),256))])):m("",!0),e("nav",Tl,[d.location=="url"?(n(),i("a",{key:0,class:"btn btn-default btn-xs",href:d.basename,target:"_blank"},[Vl,p(" Accéder au lien ")],8,Ul)):m("",!0),d.urlDownload&&d.location!="url"?(n(),i("a",{key:1,class:"btn btn-default btn-xs",href:d.urlDownload},[Pl,p(" Télécharger ")],8,Nl)):m("",!0),o.manage&&d.location!="url"?(n(),i("button",{key:2,onClick:k=>r.handlerNewVersion(d),class:"btn btn-default btn-xs"},[Il,p(" Nouvelle Version ")],8,Rl)):m("",!0),o.manage?(n(),i("a",{key:3,class:"btn btn-default btn-xs",onClick:b(k=>r.deleteDocument(d),["prevent"])},[Yl,p(" Supprimer ")],8,Fl)):m("",!0),o.manage&&d.location!="url"?(n(),i("a",{key:4,class:"btn btn-xs btn-default",href:"#",onClick:b(k=>r.handlerEdit(d),["prevent"])},[El,p(" Modifier ")],8,Ol)):m("",!0)])])],2))),128))],512)),[[S,l.selectedTabId===o.id]])),256))])])],64)}const Al=P(Ve,[["render",ql],["__scopeId","data-v-74d0bb24"]]);let N=document.querySelector("#activitydocuments");const Wl=E(Al,{url:N.dataset.url,urlUploadNewDoc:N.dataset.urlUploadNewDoc,manage:N.dataset.manage});Wl.mount("#activitydocuments");
