import{h as _,o as n,c as o,a as e,w as b,v as V,b as C,d as y,t as c,F as D,r as v,e as m,n as w,f as h,g as M,i as R,j as P,k as F,l as S,m as I,p as Y,q as O,s as E}from"../vendor.js";import{_ as N}from"../vendor2.js";_.locale("fr");const W={model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:_().format(),pickerYearRef:_().format("YYYY"),pickerMonthRef:_().month(),realValue:this.modelValue,manualChange:""}},computed:{years(){let t=this.pickerYearRef-11,s=this.pickerYearRef+11,d=[];for(var f=t;f<s;f++)d.push(f);return d},mmValue(){return this.realValue?(_.locale("fr"),_(this.realValue)):_()},pickerData(){var t=this.daysShort,s=_(this.realValue).format(this.valueFormat);let d=_(this.pickerDayRef).startOf("month").startOf("isoWeek"),f=_(this.pickerDayRef).endOf("month").startOf("isoWeek"),l=[];for(;d.unix()<=f.unix();){let r={num:d.week(),days:[]};for(let a=1;a<=7;a++){let k=!this.limitFrom||this.limitFrom&&this.limitFrom<d.format();r.days.push({enabled:k,date:d.format(),active:d.format(this.valueFormat)==s,day:d.format("D")}),d.add(1,"day")}l.push(r)}return{dayslabels:t,weeks:l}},currentMonth(){return _(this.pickerDayRef).format("MMMM")},currentYear(){return _(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(_.locale("fr"),_(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(t){console.log("convert ",t);try{let s=_(t,this.displayFormat);s.isValid()&&this.changeDate(s.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(t){try{var s=_(t.target.value);this.changeDate(s.format(this.valueFormat))}catch(d){console.error("WTF DATE",d)}},handlerSelectMonth(t){let s=this.months.indexOf(t);this.pickerDayRef=_(this.pickerDayRef).month(s).format(),this.pickerMode="day"},handlerSelectYear(t){this.pickerDayRef=_(this.pickerDayRef).year(t).format(),this.pickerMode="day"},changeDate(t){console.log("Modification de la date",t),this.picker=!1,this.realValue=t?_(t).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=_(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=_(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(t){t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(t){this.picker=!1},initPickerVar(){var t=_(this.pickerDayRef?this.pickerDayRef:_());this.pickerYearRef=t.year(),this.pickerMonthRef=t.format("MMMM")}},created(){_.locale(this.i18n),this.pickerDayRef=this.value?this.value:_().format(),this.initPickerVar()}},A={class:"input-group"},q=e("div",{class:"input-group-addon"},[e("i",{class:"icon-calendar"})],-1),z={class:"datepicker-wrapper"},j=e("i",{class:"icon-angle-left"},null,-1),J=[j],L={class:"heading"},B=e("i",{class:"icon-angle-right"},null,-1),H=[B],X={key:0,class:"day-labels week"},K=e("span",{class:"week-label"}," ",-1),G={class:"day-label"},Q={key:0},Z={class:"weeks"},$={class:"week"},ee={class:"week-label"},te=["onClick"],se={key:1,class:"months"},le=["onClick"],ne={key:2,class:"years"},oe=["onClick"],ie=e("i",{class:"icon-cancel-alt"},null,-1);function re(t,s,d,f,l,r){return n(),o("div",{onMouseenter:s[9]||(s[9]=(...a)=>r.handlerShow&&r.handlerShow(...a)),onMouseleave:s[10]||(s[10]=(...a)=>r.handlerHide&&r.handlerHide(...a))},[e("div",A,[b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=a=>r.renderValue=a)},null,512),[[V,r.renderValue]]),q]),b(e("div",{class:"datepicker-selector",onMouseleave:s[8]||(s[8]=(...a)=>r.handlerHide&&r.handlerHide(...a))},[e("div",z,[e("header",null,[e("nav",null,[e("span",{href:"#",onClick:s[1]||(s[1]=y((...a)=>r.pickerPrevMonth&&r.pickerPrevMonth(...a),["stop","prevent"]))},J),e("strong",L,[e("span",{class:"currentMonth",onClick:s[2]||(s[2]=y((...a)=>r.handlerPickerMonth&&r.handlerPickerMonth(...a),["stop"]))},c(r.currentMonth),1),e("span",{class:"currentYear",onClick:s[3]||(s[3]=y((...a)=>r.handlerPickerYear&&r.handlerPickerYear(...a),["stop"]))},c(r.currentYear),1)]),e("span",{href:"#",onClick:s[4]||(s[4]=y((...a)=>r.pickerNextMonth&&r.pickerNextMonth(...a),["stop"]))},H)]),l.pickerMode=="day"?(n(),o("div",X,[K,(n(!0),o(D,null,v(r.pickerData.dayslabels,a=>(n(),o("span",G,c(a),1))),256))])):m("",!0)]),l.pickerMode=="day"?(n(),o("section",Q,[(n(!0),o(D,null,v(r.pickerData.weeks,a=>(n(),o("div",Z,[e("span",$,[e("span",ee,c(a.num),1),(n(!0),o(D,null,v(a.days,k=>(n(),o("span",{class:w(["week-day",{active:k.active,disabled:!k.enabled}]),onClick:y(i=>r.changeDate(k.date),["prevent","stop"])},c(k.day),11,te))),256))])]))),256))])):m("",!0),l.pickerMode=="month"?(n(),o("section",se,[(n(!0),o(D,null,v(d.months,a=>(n(),o("span",{class:w(["month",{active:l.pickerMonthRef==a}]),onClick:y(k=>r.handlerSelectMonth(a),["prevent","stop"])},c(a),11,le))),256))])):m("",!0),l.pickerMode=="year"?(n(),o("section",ne,[e("span",{class:"year",onClick:s[5]||(s[5]=y(a=>l.pickerYearRef-=22,["prevent","stop"]))},"<<"),(n(!0),o(D,null,v(r.years,a=>(n(),o("span",{class:w(["year",{active:l.pickerYearRef==a}]),onClick:y(k=>r.handlerSelectYear(a),["prevent","stop"])},c(a),11,oe))),256)),e("span",{class:"year",onClick:s[6]||(s[6]=y(a=>l.pickerYearRef+=22,["prevent","stop"]))},">>")])):m("",!0)]),e("div",{style:{"text-align":"center",cursor:"pointer"},onClick:s[7]||(s[7]=(...a)=>r.handlerClear&&r.handlerClear(...a))},[ie,h(" Supprimer la date ")])],544),[[C,l.picker]])],32)}const ae=N(W,[["render",re]]);let x;const ce={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(t,s){t.length>=2&&(x&&clearTimeout(x),x=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,M.get(this.url+this.expression+"&f=json",{before(t){this.request&&this.request.abort(),this.request=t}}).then(t=>{console.log(t),this.persons=t.data.datas,this.showSelector=!0},t=>{console.log(t),t.status==403?this.error="403 Unauthorized":t.message?this.error="ERROR : "+t.message:t.body&&(this.error=t.body)}).then(t=>{this.loading=!1,this.request=null})},handlerSelectPerson(t){let s=this.persons.find(d=>d.id==t);console.log("handlerSelectPerson",s),this.selectedPerson=s,this.showSelector=!1,this.expression="",this.$emit("change",s)}}},de={key:0,class:"alert alert-danger"},ue=e("i",{class:"icon-spinner animate-spin"},null,-1),he=[ue],pe={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},me=["onClick"],fe={style:{display:"block",width:"50px",height:"50px"}},_e=["src","alt"],De={class:"infos"},ve={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},ye=e("br",null,null,-1),ke={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},ge=e("i",{class:"icon-location"},null,-1),be={key:0},we=e("br",null,null,-1),Ce={style:{"font-weight":"100","font-size":".8em"}},Me=e("i",{class:"icon-mail"},null,-1),Se={key:1,class:"alert alert-danger"},xe=e("i",{class:"icon-attention-1"},null,-1);function Te(t,s,d,f,l,r){return n(),o("div",null,[l.error?(n(),o("div",de,[h(c(l.error)+" ",1),e("button",{class:"btn btn-default",onClick:s[0]||(s[0]=a=>l.error="")},"Fermer")])):m("",!0),b(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=a=>l.expression=a),onKeyup:s[2]||(s[2]=R(y((...a)=>r.search&&r.search(...a),["prevent"]),["enter"]))},null,544),[[V,l.expression]]),b(e("span",null,he,512),[[C,l.loading]]),b(e("div",pe,[(n(!0),o(D,null,v(l.persons,a=>(n(),o("div",{class:"choice",key:a.id,onClick:y(k=>r.handlerSelectPerson(a.id),["prevent","stop"])},[e("div",fe,[e("img",{src:"https://www.gravatar.com/avatar/"+a.mailMd5+"?s=50",alt:a.displayname,style:{width:"100%"}},null,8,_e)]),e("div",De,[e("strong",ve,c(a.displayname),1),ye,e("span",ke,[ge,h(" "+c(a.affectation)+" ",1),a.ucbnSiteLocalisation?(n(),o("span",be," ~ "+c(a.ucbnSiteLocalisation),1)):m("",!0)]),we,e("em",Ce,[Me,h(c(a.email),1)])])],8,me))),128))],512),[[C,l.persons.length>0&&l.showSelector]]),l.error?(n(),o("div",Se,[xe,h(" "+c(l.error),1)])):m("",!0)])}const Ve=N(ce,[["render",Te]]);const U="private",Ne={components:{"date-picker":ae,"person-auto-completer":Ve},props:{urlUploadNewDoc:{required:!0},url:{required:!0}},data(){return{idCurrentPerson:null,persons:[],computedDocuments:[],dateDeposit:"",dateSend:"",fileUrl:"",fileUrlLabel:"",privateDocument:!1,selectedIdTypeDocument:null,selectedIdTabDocument:null,informationsDocument:"",fileToDownload:null,uploadNewDocData:{dateDeposit:this.dateDeposit,dateSend:this.dateSend,private:this.privateDocument,type:this.selectedIdTypeDocument,tab:this.selectedIdTabDocument,informations:this.informationsDocument,persons:this.persons,baseUrlUpload:this.urlUploadNewDoc,url:"",init:!1},errorMessages:[],tabId:null,tabsWithDocuments:null,formData:null,error:null,deleteData:null,editData:null,uploadDoc:null,documents:[],loading:!0,sortField:"dateUpload",sortDirection:-1,editable:!0,remoterState:null,displayComputed:!1,editedDocument:null,mode:null,processDetails:null,mode_url:!1,typesDocuments:[],selectedTab:null,selectedTabId:null}},computed:{currentFlow(){if(this.editedDocument.category.id){let t=this.typesDocuments.find(s=>s.id==this.editedDocument.category.id);if(console.log(t),t.flow)return t.flow.signatureflow}return!1},selectedTypeDocument(){return this.selectedIdTypeDocument?(console.log(this.typesDocuments),this.typesDocuments.find(t=>t.id==this.selectedIdTypeDocument)):null},documentsPacked(){let t=[];return this.documents&&(t=this.documents.sort(function(d,f){return d[this.sortField]<f[this.sortField]?-1*this.sortDirection:d[this.sortField]>f[this.sortField]?1*this.sortDirection:0}.bind(this))),t},packedDocuments(){let t={};if(this.tabsWithDocuments)for(const[s,d]of Object.entries(this.tabsWithDocuments)){let f={};for(const[l,r]of Object.entries(d.documents)){let a=r.fileName;f.hasOwnProperty(a)?f[a].versions.push(r):(r.versions=[],f[a]=r)}t[s]={id:d.id,label:d.label,total:d.total,description:d.description,manage:d.manage,roles:d.roles,documents:f}}return t}},methods:{handlerProcessDetailsOn(t){this.processDetails=t},handlerProcessDetailsOff(){this.processDetails=null},activeTab(t){this.tabId=t},deleteDocument(t){this.deleteData=t},order:function(t){this.sortField==t?this.sortDirection*=-1:this.sortField=t},cssStepCurrent(t){return t===this.tabId?"current":""},cssSort:function(t){return t===this.sortField?"active":""},handlerEdit(t){this.editedDocument=t,this.mode="edit"},handlerSelectPersons(t){if(console.log("handlerSelectPersons",t),t.id){let s={personName:t.displayname,personId:t.id,affectation:t.affectation},d=t.id,f=!1;this.persons.forEach(function(l){l.personId===d&&(f=!0)}),f===!1&&(this.editedDocument?(this.editedDocument.persons||(this.editedDocument.persons=[]),this.editedDocument.persons.push(s)):this.persons.push(s))}},handlerDeletePerson(t){this.persons.splice(this.persons.indexOf(t),1)},handlerUploadNewDoc(t){this.mode="new",this.editedDocument={id:-1,version:1,information:"",fileName:"",process:!1,process_sendable:null,fileSize:0,typeMime:null,dateUpload:null,dateDeposit:null,dateSend:null,extension:null,category:{id:null},tabDocument:this.getTabById(t),private:!1,persons:[],location:"local",urlDelete:"",urlDownload:"",urlReupload:"",uploader:null,urlPerson:!1}},handlerNewVersion(t){console.log(JSON.parse(JSON.stringify(t))),this.editedDocument=t,this.mode="version"},handlerUploadNewVersionDoc(t,s,d){this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=s,this.selectedIdTypeDocument=d,this.initUploadDatas(t,d)},initUploadDatas(t,s=null){this.dateDeposit="",this.dateSend="";let d=!1;t===U&&(d=!0),this.privateDocument=d,this.selectedIdTypeDocument=s,this.informationsDocument="",this.fileUrl=this.uploadNewDocData.url="",this.fileUrlLabel="",this.persons=[],this.uploadNewDocData.init=!0,this.fileToDownload=null,this.uploadNewDocData.tab=t},uploadFile(t){t.target.files.length!==0&&(this.fileToDownload=t.target.files[0])},performUpload(){this.uploadNewDocData.dateDeposit=this.dateDeposit,this.uploadNewDocData.dateSend=this.dateSend,this.uploadNewDocData.private=this.privateDocument===!0?"1":"0",this.uploadNewDocData.type=this.selectedIdTypeDocument,this.uploadNewDocData.informations=this.informationsDocument;let t=[];this.persons.length!==0&&this.persons.forEach(function(d){t.push(d.personId)}),this.uploadNewDocData.persons=t;const s=new FormData;for(let d in this.uploadNewDocData){let f=this.uploadNewDocData[d];s.append(d,f)}this.mode_url?(s.append("url",this.fileUrl),s.append("label_url",this.fileUrlLabel)):this.fileToDownload!==null?s.append("file",this.fileToDownload,this.fileToDownload.name):this.errorMessages.push("Aucun fichier sélectionner a téléverser !"),this.uploadNewDocData.type===null&&this.errorMessages.push("Vous devez qualifier le type de votre document !"),this.errorMessages.length===0&&(this.uploadDoc=null,this.persons=[],console.log(this.uploadNewDocData.baseUrlUpload),M.post(this.uploadNewDocData.baseUrlUpload,s).then(d=>{console.log("SUCCESS ",d),this.fetch()},d=>{console.log("ERROR ",d),this.error=d.response.data}))},applyEdit(){let t=new FormData,s="";t.append("data",JSON.stringify(this.editedDocument)),this.mode=="new"&&(t.append("action","new"),s=this.urlUploadNewDoc,this.fileToDownload!==null?t.append("file",this.fileToDownload,this.fileToDownload.name):this.errorMessages.push("Aucun fichier sélectionner a téléverser !")),this.mode=="edit"&&(t.append("action","edit"),s=this.editedDocument.urlReupload),M.post(s,t).then(d=>{console.log("SUCCESS",d),this.editedDocument=null,this.fetch()},d=>{console.log("ERROR",d),this.error=d})},performEdit(){this.errorMessages=[];let t=[],s="",d=!0;if(this.editData.private===!0?(d=1,this.persons.length!==0&&this.persons.forEach(a=>{t.push(a.personId)})):(d=0,this.editData.tabDocument_id===U||this.editData.tabDocument_id===""?this.errorMessages.push("Vous devez sélectionner un onglet pour la modification (ce n'est pas un document qualifié privé)"):s=this.editData.tabDocument_id),this.errorMessages.length!==0)return;let f=this.editData.document.id,l=this.editData.documentype_id;this.editData=null,this.persons=[];let r=new FormData;r.append("documentId",f),r.append("type",l),r.append("tabDocument",s),r.append("private",d),r.append("persons",t)},getTabById(t){let s=this.tabsWithDocuments[t];return{id:s.id,label:s.label}},handlerSuccess(t){try{this.idCurrentPerson=t.data.idCurrentPerson;let s=Array.isArray(t.data.tabsWithDocuments)?{}:t.data.tabsWithDocuments,d=null,f=null;if(Object.keys(s).forEach(l=>{let r=s[l];r.total=r.documents.length,r.documents.sort((a,k)=>k.version-a.version),r.documents.forEach(a=>{console.log(a.fileName,a.version),a.explode=!0}),d==null&&(d=r.id),f==null&&r.documents.length>0&&(f=r.id)}),this.tabsWithDocuments=s,this.computedDocuments=t.data.computedDocuments,this.typesDocuments=t.data.typesDocuments,this.selectedTabId==null&&(this.selectedTabId=f||d),this.tabsWithDocuments.unclassified&&this.tabsWithDocuments.unclassified.documents.length)this.selectedTab=this.tabsWithDocuments.unclassified;else{let l=Object.keys(this.tabsWithDocuments)[0];l.length&&(this.selectedTab=this.tabsWithDocuments[l[0]])}}catch(s){console.log("Erreur de traitement ",s)}},handlerSelectTab(t){t=="computed"?(this.displayComputed=!0,this.selectedTab=null,this.selectedTabId=null):(this.displayComputed=!1,this.selectedTab=t,this.selectedTabId=t.id)},fetch(){console.log("fetch()"+this.url),M.get(this.url).then(t=>{this.handlerSuccess(t)},t=>{this.error=t})}},mounted(){this.fetch()}},p=t=>(Y("data-v-45487dc6"),t=t(),O(),t),Pe={key:0,class:"overlay"},Fe={class:"overlay-content",style:{"max-width":"50%"}},Ue={class:"alert-danger alert"},Re=p(()=>e("i",{class:"icon-attention-1"},null,-1)),Ie=p(()=>e("i",{class:"icon-cancel-outline"},null,-1)),Ye={key:1,class:"overlay"},Oe={class:"overlay-content",style:{"max-width":"50%"}},Ee=p(()=>e("small",null,[e("i",{class:"icon-edit"}),h(" Procédure")],-1)),We=p(()=>e("br",null,null,-1)),Ae=p(()=>e("br",null,null,-1)),qe={class:"signature-status-101"},ze={class:"status"},je={class:"metas"},Je={class:"meta"},Le={class:"meta"},Be={class:"fullname"},He={class:"email"},Xe={class:"status"},Ke={class:"status-text"},Ge=p(()=>e("i",{class:"icon-cancel-outline"},null,-1)),Qe={style:{position:"relative","min-height":"100px"}},Ze={key:0,class:"overlay"},$e={class:"overlay-content"},et={class:"alert-danger alert"},tt=p(()=>e("i",{class:"icon-attention-1"},null,-1)),st=p(()=>e("i",{class:"icon-cancel-alt"},null,-1)),lt=["href"],nt=p(()=>e("i",{class:"icon-valid"},null,-1)),ot={key:1,class:"overlay"},it={class:"overlay-content"},rt=p(()=>e("small",null,[e("span"),e("i",{class:"icon-doc"}),h(" Téléversement d'un document : ")],-1)),at=p(()=>e("br",null,null,-1)),ct={key:0},dt={key:1},ut={class:"row"},ht={key:0,class:"col-md-6"},pt=p(()=>e("label",{for:"file"},"Fichier",-1)),mt={class:"col-md-6"},ft=p(()=>e("label",{for:"typedocument"},"Type de document",-1)),_t={key:0,class:"alert alert-warning"},Dt={key:1},vt=["value","disabled"],yt={key:0},kt={class:"metas"},gt={class:"meta"},bt={class:"meta"},wt={class:"meta"},Ct={class:"recipient"},Mt={class:"email"},St={class:"fullname"},xt={class:"col-md-6"},Tt=p(()=>e("label",{for:"dateDeposit"},"Date de dépôt",-1)),Vt={class:"col-md-6"},Nt=p(()=>e("label",{for:"dateSend"},"Date d'envoi",-1)),Pt={class:"col-md-12"},Ft=p(()=>e("label",{for:"informations"},"Informations",-1)),Ut={key:1,class:"col-md-6"},Rt={class:"row"},It={key:0},Yt=p(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),Ot=["value"],Et=p(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),Wt={class:"col-md-6"},At={key:0},qt=p(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),zt=p(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),jt=p(()=>e("i",{class:"icon-cube"},null,-1)),Jt={class:"addon"},Lt=["onClick"],Bt={class:"row"},Ht={class:"col-md-12"},Xt=p(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Kt=p(()=>e("i",{class:"icon-valid"},null,-1)),Gt={key:2,class:"overlay"},Qt={class:"overlay-content"},Zt=p(()=>e("i",{class:"icon-cancel-alt"},null,-1)),$t={class:"documents-content"},es={class:"tabs"},ts=["onClick"],ss={class:"label label-default"},ls={class:"tab-content"},ns={class:""},os=p(()=>e("i",{class:"picto icon-doc"},null,-1)),is=p(()=>e("small",{class:"text-light"},"  (Document généré automatiquement) ",-1)),rs={class:"text-right show-over"},as=["href"],cs=p(()=>e("i",{class:"icon-upload-outline"},null,-1)),ds={class:"tab-content"},us={key:0,class:"text-right"},hs=["onClick"],ps=p(()=>e("i",{class:"icon-download"},null,-1)),ms=p(()=>e("hr",null,null,-1)),fs={class:""},_s={key:0,class:"picto icon-anchor-outline"},Ds={class:"text-light"},vs=["title"],ys={key:0},ks=p(()=>e("i",{class:"icon-lock"},null,-1)),gs={class:"cartouche"},bs={class:"card-content"},ws={key:0,class:"alert alert-info"},Cs=["onClick"],Ms={key:1},Ss=p(()=>e("div",{class:"exploder"}," Versions précédentes : ",-1)),xs={class:"subdoc text-highlight"},Ts={key:0},Vs=["href"],Ns=p(()=>e("i",{class:"icon-download-outline"},null,-1)),Ps={class:"text-right show-over"},Fs=["href"],Us=p(()=>e("i",{class:"icon-link-ext"},null,-1)),Rs=["href"],Is=p(()=>e("i",{class:"icon-upload-outline"},null,-1)),Ys=["onClick"],Os=p(()=>e("i",{class:"icon-download-outline"},null,-1)),Es=["onClick"],Ws=p(()=>e("i",{class:"icon-trash"},null,-1)),As=["onClick"],qs=p(()=>e("i",{class:"icon-pencil"},null,-1));function zs(t,s,d,f,l,r){const a=P("date-picker"),k=P("person-auto-completer");return n(),o(D,null,[l.error?(n(),o("div",Pe,[e("div",Fe,[e("h2",null,[h(" Erreur documents "),e("span",{class:"overlay-closer",onClick:s[0]||(s[0]=i=>l.error=null)},"X")]),e("p",Ue,[Re,h(c(l.error),1)]),e("button",{class:"btn btn-default",onClick:s[1]||(s[1]=i=>l.error=null)},[Ie,h(" Fermer ")])])])):m("",!0),l.processDetails?(n(),o("div",Ye,[e("div",Oe,[e("h2",null,[Ee,h(),We,e("strong",null,c(l.processDetails.label),1),h(),Ae,e("span",qe,[h(c(l.processDetails.status_text)+" - ",1),e("em",null,"étape "+c(l.processDetails.current_step)+" / "+c(l.processDetails.total_steps),1)]),e("span",{class:"overlay-closer",onClick:s[2]||(s[2]=(...i)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...i))},"X")]),(n(!0),o(D,null,v(l.processDetails.steps,i=>(n(),o("section",{class:w(["signature","signature-status-"+i.status])},[e("h4",null,[e("small",null,"étape "+c(i.order)+" : ",1),e("strong",null,c(i.label),1),e("span",ze," ("+c(i.status_text)+")",1)]),e("ul",je,[e("li",Je,[h("Parapheur "),e("strong",null,c(i.letterfile),1)]),e("li",Le,[h("Niveau "),e("strong",null,c(i.level),1)])]),(n(!0),o(D,null,v(i.recipients,u=>(n(),o("article",{class:w(["recipient","signature-status-"+u.status])},[e("strong",Be,c(u.fullname),1),e("em",He,c(u.email),1),e("span",Xe,[e("span",Ke,c(u.status_text),1)])],2))),256))],2))),256)),e("button",{class:"btn btn-default",onClick:s[3]||(s[3]=(...i)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...i))},[Ge,h(" Fermer ")])])])):m("",!0),e("section",Qe,[l.deleteData?(n(),o("div",Ze,[e("div",$e,[e("h2",null,[h(" Suppression du fichier ? "),e("span",{class:"overlay-closer",onClick:s[4]||(s[4]=i=>l.deleteData=null)},"X")]),e("p",et,[tt,h(" Souhaitez-vous supprimer le fichier "),e("strong",null,c(l.deleteData.fileName),1),h(" ? ")]),e("button",{class:"btn btn-danger",onClick:s[5]||(s[5]=i=>l.deleteData=null)},[st,h(" Annuler ")]),e("a",{class:"btn btn-success",href:l.deleteData.urlDelete},[nt,h(" Confirmer ")],8,lt)])])):m("",!0),l.editedDocument?(n(),o("div",ot,[e("div",it,[e("h2",null,[rt,at,l.editedDocument.id>0?(n(),o("span",ct,[h(" Modification du document "),e("strong",null,c(l.editedDocument.fileName),1)])):(n(),o("span",dt,[h(" Nouveau document dans "),e("strong",null,c(l.editedDocument.tabDocument.label),1)])),e("span",{class:"overlay-closer",onClick:s[6]||(s[6]=i=>l.editedDocument=null)},"X")]),h(" "+c(l.editedDocument)+" ",1),e("div",ut,[l.mode!="edit"?(n(),o("div",ht,[pt,e("input",{onChange:s[7]||(s[7]=(...i)=>r.uploadFile&&r.uploadFile(...i)),type:"file",class:"form-control",name:"file",id:"file"},null,32)])):m("",!0),e("div",mt,[e("div",null,[ft,l.editedDocument.process?(n(),o("div",_t," Vous ne pouvez pas modifier le type d'un document engagé dans un processus de signature. ")):(n(),o("div",Dt,[b(e("select",{class:"form-control",name:"type",id:"typedocument","onUpdate:modelValue":s[8]||(s[8]=i=>l.editedDocument.category.id=i)},[(n(!0),o(D,null,v(l.typesDocuments,(i,u)=>(n(),o("option",{value:i.id,key:i.id,disabled:i.flow&&l.editedDocument.id>0},c(i.label)+" "+c(i.flow&&l.editedDocument.id?"(signature)":""),9,vt))),128))],512),[[F,l.editedDocument.category.id]]),r.currentFlow?(n(),o("section",yt,[e("h3",null,[h("Procédure de signature "),e("strong",null,c(r.currentFlow.label),1),h(": ")]),(n(!0),o(D,null,v(r.currentFlow.steps,i=>(n(),o("article",null,[e("ul",kt,[e("li",gt,[h("Parapheur: "),e("strong",null,c(i.letterfile_label),1)]),e("li",bt,[h("Type: "),e("strong",null,c(i.level_label),1)]),e("li",wt,[h("Tous signent: "),e("strong",null,c(i.allSignToComplete?"Oui":"non"),1)])]),(n(!0),o(D,null,v(i.recipients,u=>(n(),o("div",Ct,[e("strong",Mt,c(u.email),1),e("span",St,c(u.firstname)+" "+c(u.lastname),1)]))),256))]))),256))])):m("",!0)]))])]),e("div",xt,[Tt,S(a,{modelValue:l.editedDocument.dateDeposit,"onUpdate:modelValue":s[9]||(s[9]=i=>l.editedDocument.dateDeposit=i),id:"dateDeposit"},null,8,["modelValue"])]),e("div",Vt,[Nt,S(a,{modelValue:l.editedDocument.dateSend,"onUpdate:modelValue":s[10]||(s[10]=i=>l.editedDocument.dateSend=i),id:"dateSend"},null,8,["modelValue"])]),e("div",Pt,[Ft,b(e("textarea",{"onUpdate:modelValue":s[11]||(s[11]=i=>l.editedDocument.informations=i),id:"informations",class:"form-control"},null,512),[[V,l.editedDocument.informations]])]),l.mode=="change"?(n(),o("div",Ut,[e("div",Rt,[l.editedDocument.private===!1?(n(),o("span",It,[Yt,e("div",null,[b(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":s[12]||(s[12]=i=>l.editedDocument.tabDocument.id=i),class:"form-control"},[(n(!0),o(D,null,v(l.tabsWithDocuments,(i,u)=>(n(),o("option",{value:u,key:u},c(i.label),9,Ot))),128))],512),[[F,l.editedDocument.tabDocument.id]])])])):m("",!0),Et,e("div",Wt,[b(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":s[13]||(s[13]=i=>l.editedDocument.private=i)},null,512),[[I,l.editedDocument.private]])])]),l.editedDocument.private===!0?(n(),o("span",At,[qt,zt,S(k,{onChange:r.handlerSelectPersons},null,8,["onChange"]),(n(!0),o(D,null,v(l.editedDocument.persons,i=>(n(),o("span",{key:i.id,class:"cartouche"},[jt,e("span",null,c(i.personName),1),e("span",Jt,c(i.affectation),1),i.personId!==l.idCurrentPerson?(n(),o("i",{key:0,onClick:u=>r.handlerDeletePerson(i),class:"icon-trash icon-clickable"},null,8,Lt)):m("",!0)]))),128))])):m("",!0)])):m("",!0)]),e("div",Bt,[e("div",Ht,[e("button",{class:"btn btn-danger",onClick:s[14]||(s[14]=i=>l.editedDocument=null)},[Xt,h(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:s[15]||(s[15]=y(i=>r.applyEdit(),["prevent"]))},[Kt,h(" Enregistrer ")])])])])])):m("",!0),l.errorMessages.length!==0?(n(),o("div",Gt,[e("div",Qt,[e("h2",null,[e("span",{class:"overlay-closer",onClick:s[16]||(s[16]=i=>l.errorMessages=[])},"X")]),e("ul",null,[(n(!0),o(D,null,v(l.errorMessages,i=>(n(),o("li",null,c(i),1))),256))]),e("button",{class:"btn btn-danger",onClick:s[17]||(s[17]=i=>l.errorMessages=[])},[Zt,h(" Retour ")])])])):m("",!0),e("section",$t,[e("div",es,[(n(!0),o(D,null,v(r.packedDocuments,i=>(n(),o("div",{class:w(["tab",{selected:l.selectedTabId===i.id}]),onClick:y(u=>r.handlerSelectTab(i),["prevent"])},[h(c(i.label)+" ",1),e("sup",ss,c(i.total),1)],10,ts))),256)),e("div",{class:w(["tab",{selected:l.displayComputed}]),onClick:s[18]||(s[18]=y(i=>r.handlerSelectTab("computed"),["prevent"]))}," Documents générés ",2)]),b(e("div",ls,[(n(!0),o(D,null,v(l.computedDocuments,i=>(n(),o("article",{class:"card xs",key:i.key},[e("div",ns,[os,e("strong",null,c(i.label),1),is]),e("nav",rs,[e("a",{class:"btn btn-default btn-xs",href:i.url},[cs,h(" Télécharger ")],8,as)])]))),128))],512),[[C,l.displayComputed]]),(n(!0),o(D,null,v(r.packedDocuments,i=>b((n(),o("div",ds,[i.manage?(n(),o("nav",us,[i.manage?(n(),o("button",{key:0,onClick:u=>r.handlerUploadNewDoc(i.id),class:"btn btn-xs btn-default"},[ps,h(" Téléverser un document ")],8,hs)):m("",!0)])):m("",!0),ms,(n(!0),o(D,null,v(i.documents,u=>(n(),o("article",{class:w(["card xs",{"private-document":u.private}]),key:u.id},[e("div",fs,[u.location=="link"?(n(),o("i",_s)):(n(),o("i",{key:1,class:w(["picto icon-doc","doc"+u.extension])},null,2)),e("small",Ds,c(u.category.label)+" ~ ",1),e("strong",null,c(u.fileName),1),u.location!="url"?(n(),o("small",{key:2,class:"text-light",title:u.fileSize+" octet(s)"},"  ("+c(u.fileSize|t.filesize)+") - Version "+c(u.version),9,vs)):m("",!0)]),h(" "+c(u.informations)+" - "+c(u.dateSend)+" - "+c(u.dateDeposit)+" ",1),u.private?(n(),o("section",ys,[ks,h(" Ce document est privé, accessible par : "),(n(!0),o(D,null,v(u.persons,g=>(n(),o("span",gs,c(g.personName),1))),256))])):m("",!0),e("p",null,c(u.information),1),e("div",bs,[u.process&&u.process.status!=200?(n(),o("section",ws,[h(" Procédure de signature "),e("em",null,c(u.process.label),1),h(" - "),e("strong",null,c(u.process.status_text),1),h(" - "),e("span",null,"étape "+c(u.process.current_step)+" / "+c(u.process.total_steps),1),h(" - "),e("button",{class:"btn btn-xs btn-info",onClick:g=>r.handlerProcessDetailsOn(u.process)}," Détails ",8,Cs)])):m("",!0),u.versions.length?(n(),o("div",Ms,[Ss,(n(!0),o(D,null,v(u.versions,g=>(n(),o("article",xs,[e("i",{class:w(["picto icon-doc","doc"+g.extension])},null,2),e("strong",null,c(g.fileName),1),h(" version "),e("em",null,c(g.version),1),h(", téléchargé le "),e("time",null,c(g.dateUpload|t.dateFullSort),1),g.uploader?(n(),o("span",Ts,[h(" par "),e("strong",null,c(g.uploader.displayname),1)])):m("",!0),e("a",{href:g.urlDownload},[Ns,h(" Télécharger cette version ")],8,Vs)]))),256))])):m("",!0),e("nav",Ps,[u.location=="url"?(n(),o("a",{key:0,class:"btn btn-default btn-xs",href:u.basename,target:"_blank"},[Us,h(" Accéder au lien ")],8,Fs)):m("",!0),u.urlDownload&&u.location!="url"?(n(),o("a",{key:1,class:"btn btn-default btn-xs",href:u.urlDownload},[Is,h(" Télécharger ")],8,Rs)):m("",!0),i.manage&&u.location!="url"?(n(),o("button",{key:2,onClick:g=>r.handlerNewVersion(u),class:"btn btn-default btn-xs"},[Os,h(" Nouvelle Version ")],8,Ys)):m("",!0),i.manage?(n(),o("a",{key:3,class:"btn btn-default btn-xs",onClick:y(g=>r.deleteDocument(u),["prevent"])},[Ws,h(" Supprimer ")],8,Es)):m("",!0),i.manage&&u.location!="url"?(n(),o("a",{key:4,class:"btn btn-xs btn-default",href:"#",onClick:y(g=>r.handlerEdit(u),["prevent"])},[qs,h(" Modifier ")],8,As)):m("",!0)])])],2))),128))],512)),[[C,l.selectedTabId===i.id]])),256))])])],64)}const js=N(Ne,[["render",zs],["__scopeId","data-v-45487dc6"]]);let T=document.querySelector("#activitydocuments");const Js=E(js,{url:T.dataset.url,urlUploadNewDoc:T.dataset.urlUploadNewDoc,manage:T.dataset.manage});Js.mount("#activitydocuments");
