import{w as p,v as f,o as r,c as a,a as e,b as n,t as d,d as h,r as S,e as y,f as u,g as w,T as x,F as g,h as v,i as D,n as b,j as N,k as A,l as T,m as O}from"../vendor.js";const k=(s,t)=>{const c=s.__vccOpts||s;for(const[_,o]of t)c[_]=o;return c},V={props:{options:{default:null}},computed:{displayed(){return this.options==null?!1:this.options.hasOwnProperty("display")?this.options.display:!0},title(){return this.options&&this.options.hasOwnProperty("title")?this.options.title:""},message(){return this.options&&this.options.hasOwnProperty("message")?this.options.message:""}},methods:{handlerCancel(){this.options.display=!1},handlerSuccess(){this.options.display=!1,this.options.onSuccess&&this.options.onSuccess()}}},q={class:"overlay"},j={class:"overlay-content"},P={class:"overlay-title"},E=e("i",{class:"icon-help-circled"},null,-1),I={class:"overlay-message"},L={class:"buttons-bar"},U=e("i",{class:"icon-cancel-circled-outline"},null,-1),B=e("i",{class:"icon-valid"},null,-1);function F(s,t,c,_,o,i){return p((r(),a("div",q,[e("div",j,[p(e("h1",P,[E,n(" "+d(i.title),1)],512),[[f,i.title]]),e("div",I,d(i.message),1),e("nav",L,[e("button",{onClick:t[0]||(t[0]=(...m)=>i.handlerCancel&&i.handlerCancel(...m)),class:"btn btn-danger"},[U,n(" Annuler ")]),e("button",{onClick:t[1]||(t[1]=(...m)=>i.handlerSuccess&&i.handlerSuccess(...m)),class:"btn btn-success"},[B,n(" Confirmer ")])])])],512)),[[f,i.displayed]])}const z=k(V,[["render",F]]),J={components:{OscarDialog:z},props:{url:{required:!0},manage:!1,bootbox:{required:!0}},data(){return{types:[],loadingMsg:null,form:null,dialogDelete:{display:!1},untyped_documents:0,documents_location:"",documents_pcru_type:"",migrate_dest:null}},computed:{loading(){return this.loadingMsg!=null}},methods:{formNew(){this.form={label:"",description:""}},handlerEdit(s){this.form=JSON.parse(JSON.stringify(s))},handlerSave(){if(this.form.id){this.loadingMsg="Mise à jour du type de document...";let t={typedocumentid:this.form.id,label:this.form.label,description:this.form.description,default:this.form.default?"on":""};h.put(this.url+"",t).then(c=>{flashMessage("success","Type de document mis à jour"),this.fetch()},c=>{flashMessage("error",c.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})}else{this.loadingMsg="Ajout d'un nouveau type de document...";var s=new FormData;s.append("label",this.form.label),s.append("description",this.form.description),s.append("default",this.form.default?"on":""),h.post(this.url,s).then(t=>{flashMessage("success","Type de document créé"),this.fetch()},t=>{flashMessage("error",t.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})}},remove(s){this.dialogDelete.title="Supprimer ce type de document ?",this.dialogDelete.message=`La suppression du type de document '${s.label}' sera définitive.`,this.dialogDelete.display=!0,this.dialogDelete.onSuccess=()=>this.removeConfirm(s)},removeConfirm(s){this.loadingMsg="Suppression du type de document...",h.delete(this.url+"?typedocumentid="+s.id).then(t=>{this.fetch()},t=>{flashMessage("error",t.body)}).then(()=>{this.loadingMsg=null,this.form=null})},fetch(){this.loadingMsg="Chargement des types de documents",h.get(this.url).then(s=>{this.types=s.data.types,this.untyped_documents=s.data.untyped_documents,this.documents_location=s.data.documents_location,this.documents_pcru_type=s.data.documents_pcru_type}).catch(s=>flashMessage("error","Impossible de charger les types de documents : "+s)).finally(()=>{this.loadingMsg=null})}},created(){this.fetch()}},R={key:0,class:"vue-loader"},G={key:0,class:"form-wrapper"},H={key:0},K={key:1},Q={class:"form-group"},W=e("label",null,"Intitulé",-1),X={class:"form-group"},Y={for:"typedoc_default"},Z=e("div",{class:"alert alert-info"},[n(" L'option "),e("strong",null,"par défaut"),n(" définira ce type de document comme celui à utilisé si rien n'est précisé. Par exemple, lors des demandes d'activité, les documents envoyés par les utilisateurs seront qualifiés avec ce type (cela peut être modifié par la suite). ")],-1),$={class:"buttons-bar"},ee={class:"btn-group"},te=e("button",{type:"submit",class:"btn btn-primary"},[e("i",{class:"icon-floppy"}),n(" Enregistrer ")],-1),se=e("i",{class:"icon-floppy"},null,-1),ne={class:"row"},oe={class:"col-md-8"},le=e("h1",null,"Types de documents disponibles",-1),ie={class:"card-title"},re={key:0},ae=["href"],de={key:2},ce={key:0,class:"card-footer"},ue=["onClick"],me=e("i",{class:"icon-pencil"},null,-1),pe=["onClick"],he=e("i",{class:"icon-trash"},null,-1),_e={class:"col-md-4"},fe=e("h2",null,"Informations",-1),ye=e("div",{class:"alert alert-info"},[n(" Les "),e("strong",null,"types de document"),n(" permettent de qualifier les documents ")],-1),ge=e("br",null,null,-1),ve={class:"cartouche"},be=e("br",null,null,-1),Me={key:0,class:"alert alert-danger"},ke=e("h3",null,[e("i",{class:"icon-attention-1"}),n(" Documents non-typés détéctés")],-1),Ce=e("strong",null,"Attention",-1),Se=e("br",null,null,-1),we=e("hr",null,null,-1),xe={action:"",method:"post"},De=e("input",{type:"hidden",name:"action",value:"migrate"},null,-1),Ne={for:"migrator"},Ae=["value"],Te=e("i",{class:"icon-circled-plus"},null,-1);function Oe(s,t,c,_,o,i){const m=S("oscar-dialog");return r(),a("section",null,[y(m,{options:o.dialogDelete},null,8,["options"]),i.loading?(r(),a("div",R,[e("span",null,d(o.loadingMsg),1)])):u("",!0),y(x,{name:"popup"},{default:w(()=>[o.form?(r(),a("div",G,[e("form",{action:"",onSubmit:t[3]||(t[3]=T((...l)=>i.handlerSave&&i.handlerSave(...l),["prevent"])),class:"container oscar-form"},[e("header",null,[e("h1",null,[o.form-s.id?(r(),a("span",H,[n("Modification de "),e("strong",null,d(o.form.label),1)])):(r(),a("span",K,"Nouveau type de documents"))])]),e("div",Q,[W,p(e("input",{id:"typedoc_label",type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=l=>o.form.label=l),name:"label"},null,512),[[N,o.form.label]])]),e("div",X,[e("label",Y,[n(" Par défaut "),p(e("input",{id:"typedoc_default",type:"checkbox",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=l=>o.form.default=l),name:"default"},null,512),[[A,o.form.default]])]),Z]),e("footer",$,[e("div",ee,[te,e("button",{type:"reset",class:"btn btn-default",onClick:t[2]||(t[2]=l=>o.form=null)},[se,n(" Annuler ")])])])],32)])):u("",!0)]),_:1}),e("div",ne,[e("div",oe,[le,(r(!0),a(g,null,v(o.types,l=>(r(),a("article",{class:b(["card xs",{"selected active":l.default}])},[e("h1",ie,[e("span",null,[n(d(l.label)+" ",1),l.default?(r(),a("small",re," (par défaut)")):u("",!0),n(" - "),l.documents_total?(r(),a("a",{key:1,href:l.documents_view,title:"Afficher les activités contenant ce type de document"},d(l.documents_total)+" document(s) ",9,ae)):(r(),a("em",de,"Aucun document"))])]),c.manage?(r(),a("nav",ce,[e("button",{class:"btn btn-xs btn-primary",onClick:C=>i.handlerEdit(l)},[me,n(" Éditer ")],8,ue),e("button",{class:"btn btn-xs btn-default",onClick:C=>i.remove(l)},[he,n(" Supprimer ")],8,pe)])):u("",!0)],2))),256))]),e("div",_e,[fe,ye,e("div",null,[e("p",null,[n(" Emplacement où sont stoqués les documents :"),ge,e("code",ve,d(o.documents_location),1)]),e("p",null,[n(" Type de document utilisé pour les envois PCRU :"),be,e("strong",null,d(o.documents_pcru_type),1)])]),o.untyped_documents?(r(),a("div",Me,[ke,Ce,n(", il y'a "),e("strong",null,d(o.untyped_documents),1),n(" documents sans type de document. Ils correspondent généralement à des documents envoyés via les demandes d'activités ou envoyés dans une version plus ancienne de Oscar. "),Se,n(" Vous pouvez leurs attribuer automatiquement un type avec la procédure ci-dessous : "),we,e("form",xe,[De,e("label",Ne,[n(" Migrer vers ce type "),p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>o.migrate_dest=l),id:"migrator",class:"form-control",name:"destination"},[(r(!0),a(g,null,v(o.types,l=>(r(),a("option",{value:l.id},d(l.label),9,Ae))),256))],512),[[D,o.migrate_dest]])]),e("button",{type:"submit",class:b(["btn btn-success",{disabled:!o.migrate_dest}])}," Migrer les documents non-typés ",2)])])):u("",!0)])]),c.manage?(r(),a("button",{key:1,onClick:t[5]||(t[5]=(...l)=>i.formNew&&i.formNew(...l)),class:"btn btn-primary"},[Te,n(" Ajouter ")])):u("",!0)])}const Ve=k(J,[["render",Oe]]);let M=document.querySelector("#admintypedocument");const qe=O(Ve,{url:M.dataset.url,manage:M.dataset.manage});qe.mount("#admintypedocument");
