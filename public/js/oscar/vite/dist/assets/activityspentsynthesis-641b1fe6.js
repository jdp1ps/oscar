import{a as k,c as o,b as c,w as y,T as f,d as s,F as g,f as m,t as n,e as h,g as r,k as w,o as l,h as M,v as I,l as N}from"../vendor.js";import{_ as B}from"../vendor3.js";const D={props:{url:{required:!0}},computed:{synthesis(){return this.infos}},data(){return{infos:null,pendingMsg:null,showCuration:!1,masses:[],synthesis:null}},methods:{fetch(){this.pendingMsg="Chargement des données financières",k.get(this.url).then(e=>{this.synthesis=e.data.synthesis,this.masses=e.data.masses},e=>{console.log(e)}).then(e=>{this.pendingMsg=!1})}},mounted(){this.fetch()}},T={key:0,class:"overlay"},V={class:"overlay-content"},F=s("p",null,"Les comptes suivants ne sont pas qualifiés, vous pouvez utiliser cet écran pour les attribuer à une masse budgétaire :",-1),A={class:"card row"},R={class:"col-md-4"},U={class:"col-md-8"},j=["onUpdate:modelValue","onChange"],q=s("option",{value:"0"},"Ignorer",-1),E=s("option",{value:"1"},"Traiter comme une recette",-1),L=["value"],S=s("hr",null,null,-1),z=s("i",{class:"icon-cancel-circled"},null,-1),H=s("i",{class:"icon-floppy"},null,-1),P={key:0,class:"alert alert-danger"},Q=s("i",{class:"icon-attention-1"},null,-1),X={key:0,class:"alert-warning alert"},G=s("i",{class:"icon-warning-empty"},null,-1),J={key:0,class:"pending"},K={class:""},O=s("i",{class:"icon-spinner animate-spin"},null,-1),W={key:0,class:"table table-condensed card synthesis"},Y=s("thead",null,[s("tr",null,[s("th",null,"Masse"),s("th",{style:{"text-align":"right"}},"Engagé"),s("th",{style:{"text-align":"right"}},"Réalisé")])],-1),Z=["href"],$={style:{"text-align":"right"}},x={style:{"text-align":"right"}},ss={class:"total"},es=s("th",null,"Total",-1),ts={style:{"text-align":"right"}},ns={style:{"text-align":"right"}},os={key:0},ls=s("small",null,[s("i",{class:"icon-attention"}),r(" Hors-masse")],-1),is={href:"#repport-nb",class:"label label-info"},rs={style:{"text-align":"right"}},as={style:{"text-align":"right"}},ds={key:1},hs=s("h3",null,[s("i",{class:"icon-calculator"}),r("Recettes")],-1),us={key:0,class:"table table-condensed card synthesis"},cs={class:"label label-info xs",href:"#repport-1"},ys={style:{"text-align":"right"}},fs={key:2},_s={key:0},ps=s("i",{class:"icon-eye-off"},null,-1),gs={key:1},ms=s("i",{class:"icon-eye"},null,-1),bs={key:0,class:"table table-condensed card synthesis"},vs={class:"label label-info",href:"#repport-0"},Cs={style:{"text-align":"right"}},ks={key:0};function ws(e,a,_,p,t,u){return l(),o("section",null,[c(f,{name:"fade"},{default:y(()=>[t.showCuration?(l(),o("div",T,[s("div",V,[s("h3",null,[r(" Qualification des comptes "),s("span",{class:"overlay-closer",onClick:a[0]||(a[0]=i=>t.showCuration=!1)},"X")]),F,(l(!0),o(g,null,m(t.synthesis.curations,i=>(l(),o("div",A,[s("div",R,[s("strong",null,n(i.compte),1),r(" - "),s("em",null,n(i.compteInfos.label),1)]),s("div",U,[M(s("select",{name:"",id:"",class:"form-control","onUpdate:modelValue":d=>e.affectations[i.compte]=d,onChange:d=>e.updateAffectations(i.compte,d)},[q,E,(l(!0),o(g,null,m(t.masses,(d,C)=>(l(),o("option",{value:C},n(d),9,L))),256))],40,j),[[I,e.affectations[i.compte]]])])]))),256)),S,s("button",{onClick:a[1]||(a[1]=(...i)=>e.handlerCurationCancel&&e.handlerCurationCancel(...i)),class:"btn btn-danger"},[z,r("Annuler")]),s("button",{onClick:a[2]||(a[2]=(...i)=>e.handlerCurationConfirm&&e.handlerCurationConfirm(...i)),class:"btn btn-success"},[H,r("Enregistrer")])])])):h("",!0)]),_:1}),c(f,{name:"fade"},{default:y(()=>[e.error?(l(),o("div",P,[Q,r(" Il y'a eut un problème lors de la récupération des données financières : "+n(e.error),1)])):h("",!0)]),_:1}),c(f,{name:"fade"},{default:y(()=>[e.warning?(l(),o("div",X,[G,r(" Les données affichées peuvent ne pas être à jour : "+n(e.warning),1)])):h("",!0)]),_:1}),c(f,{name:"fade"},{default:y(()=>[t.pendingMsg?(l(),o("div",J,[s("div",K,[O,r(" "+n(t.pendingMsg),1)])])):h("",!0)]),_:1}),t.synthesis?(l(),o("table",W,[Y,s("tbody",null,[(l(!0),o(g,null,m(t.synthesis.masses,(i,d)=>(l(),o("tr",null,[s("th",null,[s("small",null,n(i),1),s("a",{class:"label label-info xs",href:"#repport-"+d},n(t.synthesis.synthesis[d].nbr_effectue)+" / "+n(t.synthesis.synthesis[d].nbr_engage),9,Z)]),s("td",$,n(e.$filters.money(t.synthesis.synthesis[d].total_engage)),1),s("td",x,n(e.$filters.money(t.synthesis.synthesis[d].total_effectue)),1)]))),256))]),s("tbody",null,[s("tr",ss,[es,s("td",ts,n(e.$filters.money(t.synthesis.synthesis.totaux.engage)),1),s("td",ns,n(e.$filters.money(t.synthesis.synthesis.totaux.effectue)),1)])]),s("tbody",null,[t.synthesis.synthesis["N.B"].total!=0?(l(),o("tr",os,[s("th",null,[ls,s("a",is,n(t.synthesis.synthesis["N.B"].nbr),1)]),s("td",rs,n(e.$filters.money(t.synthesis.synthesis["N.B"].total_engage)),1),s("td",as,n(e.$filters.money(t.synthesis.synthesis["N.B"].total_effectue)),1)])):h("",!0)])])):h("",!0),e.manageRecettes?(l(),o("div",ds,[hs,e.spentlines?(l(),o("table",us,[s("tbody",null,[s("tr",null,[s("th",null,[r("Recette "),s("a",cs,n(t.synthesis.synthesis[1].nbr),1)]),s("td",ys,n(e.$filters.money(t.synthesis.synthesis[1].total)),1)])])])):h("",!0)])):h("",!0),e.manageIgnored&&t.synthesis.synthesis[0].total!=0?(l(),o("div",fs,[s("a",{href:"#",onClick:a[3]||(a[3]=w(i=>e.displayIgnored=!e.displayIgnored,["prevent"]))},[e.displayIgnored?(l(),o("span",_s,[ps,r(" Cacher")])):(l(),o("span",gs,[ms,r(" Montrer")])),r(" les données ignorées ")]),e.spentlines&&e.displayIgnored?(l(),o("table",bs,[s("tbody",null,[s("tr",null,[s("th",null,[r(" Ignorées "),s("a",vs,n(t.synthesis.synthesis[0].nbr),1)]),s("td",Cs,n(e.$filters.money(t.synthesis.synthesis[0].total)),1)])])])):h("",!0)])):h("",!0),s("small",null,[r("Données mise à jour : "),e.dateUpdated?(l(),o("strong",ks,n(e.dateUpdated.date|e.dateFull),1)):h("",!0)])])}const Ms=B(D,[["render",ws]]),Is={money(e){for(var a=e.toFixed(2),t="",_=!1,p=0,t=[],u=a.length-1;u>=0;u--){var i=a[u];i=="."?(t.push(","),_=!0):(t.push(i),_==!0&&i!="-"&&u>0&&(p++,p%3==0&&t.push(" ")))}return t.reverse().join("")}};let b=document.querySelector("#depenses2");const v=N(Ms,{url:b.dataset.url,syncurl:b.dataset.syncurl});v.config.globalProperties.$filters={money:function(e){return Is.money(e)}};v.mount("#depenses2");
