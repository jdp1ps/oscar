import{g as m,j as M,c as i,k as f,a as e,t as a,e as u,u as k,T as C,F as _,r as h,f as l,w as p,l as g,n as y,o as r,v as x,m as D,d as S,s as N}from"../vendor.js";import{O as A}from"../vendor5.js";import{_ as T}from"../vendor3.js";const V={components:{OscarDialog:A},props:{url:{required:!0},manage:!1,bootbox:{required:!0}},data(){return{types:[],loadingMsg:null,form:null,dialogDelete:{display:!1},untyped_documents:0,documents_location:"",documents_pcru_type:"",signatureflows:[],migrate_dest:null}},computed:{loading(){return this.loadingMsg!=null}},methods:{signatureFlow(o){return this.signatureflows.find(s=>s.id==o)},formNew(){this.form={label:"",description:""}},handlerEdit(o){this.form=JSON.parse(JSON.stringify(o))},handlerSave(){if(this.form.id){this.loadingMsg="Mise à jour du type de document...";let s={typedocumentid:this.form.id,label:this.form.label,signatureflow_id:this.form.signatureflow_id,description:this.form.description,default:this.form.default?"on":""};m.put(this.url+"",s).then(c=>{flashMessage("success","Type de document mis à jour"),this.fetch()},c=>{flashMessage("error",c.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})}else{this.loadingMsg="Ajout d'un nouveau type de document...";var o=new FormData;o.append("label",this.form.label),o.append("description",this.form.description),o.append("default",this.form.default?"on":""),m.post(this.url,o).then(s=>{flashMessage("success","Type de document créé"),this.fetch()},s=>{flashMessage("error",s.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})}},remove(o){this.dialogDelete.title="Supprimer ce type de document ?",this.dialogDelete.message=`La suppression du type de document '${o.label}' sera définitive.`,this.dialogDelete.display=!0,this.dialogDelete.onSuccess=()=>this.removeConfirm(o)},removeConfirm(o){this.loadingMsg="Suppression du type de document...",m.delete(this.url+"?typedocumentid="+o.id).then(s=>{this.fetch()},s=>{flashMessage("error",s.body)}).then(()=>{this.loadingMsg=null,this.form=null})},fetch(){this.loadingMsg="Chargement des types de documents",m.get(this.url).then(o=>{this.types=o.data.types,this.untyped_documents=o.data.untyped_documents,this.documents_location=o.data.documents_location,this.documents_pcru_type=o.data.documents_pcru_type,this.signatureflows=o.data.signatureflows}).catch(o=>flashMessage("error","Impossible de charger les types de documents : "+o)).finally(()=>{this.loadingMsg=null})}},created(){this.fetch()}},q={key:0,class:"vue-loader"},j={key:0,class:"form-wrapper"},P={key:0},E={key:1},F={class:"form-group"},O=e("label",null,"Intitulé",-1),U={class:"form-group"},I=e("label",{for:"signatureflow"},"Procédure de signature",-1),L=e("option",{value:""},"Aucune",-1),B=["value"],z={class:"form-group"},J={for:"typedoc_default"},R=e("div",{class:"alert alert-info"},[l(" L'option "),e("strong",null,"par défaut"),l(" définira ce type de document comme celui à utilisé si rien n'est précisé. Par exemple, lors des demandes d'activité, les documents envoyés par les utilisateurs seront qualifiés avec ce type (cela peut être modifié par la suite). ")],-1),G={class:"buttons-bar"},H={class:"btn-group"},K=e("button",{type:"submit",class:"btn btn-primary"},[e("i",{class:"icon-floppy"}),l(" Enregistrer ")],-1),Q=e("i",{class:"icon-floppy"},null,-1),W={class:"row"},X={class:"col-md-8"},Y=e("h1",null,"Types de documents disponibles",-1),Z={class:"card-title"},$={key:0},ee=["href"],te={key:2},se={key:3,class:"cartouche info"},oe={key:0,class:"card-footer"},ne=["onClick"],le=e("i",{class:"icon-pencil"},null,-1),ie=["onClick"],re=e("i",{class:"icon-trash"},null,-1),ae={class:"col-md-4"},de=e("h2",null,"Informations",-1),ue=e("div",{class:"alert alert-info"},[l(" Les "),e("strong",null,"types de document"),l(" permettent de qualifier les documents ")],-1),ce=e("br",null,null,-1),me={class:"cartouche"},pe=e("br",null,null,-1),_e=e("p",null,"Procédures de signature disponibles : ",-1),he={key:0,class:"alert alert-danger"},fe=e("h3",null,[e("i",{class:"icon-attention-1"}),l(" Documents non-typés détéctés")],-1),ge=e("strong",null,"Attention",-1),ye=e("br",null,null,-1),be=e("hr",null,null,-1),ve={action:"",method:"post"},we=e("input",{type:"hidden",name:"action",value:"migrate"},null,-1),Me={for:"migrator"},ke=["value"],Ce=e("i",{class:"icon-circled-plus"},null,-1);function xe(o,s,c,Ne,n,d){const v=M("oscar-dialog");return r(),i("section",null,[f(v,{options:n.dialogDelete},null,8,["options"]),d.loading?(r(),i("div",q,[e("span",null,a(n.loadingMsg),1)])):u("",!0),f(C,{name:"popup"},{default:k(()=>[n.form?(r(),i("div",j,[e("form",{action:"",onSubmit:s[4]||(s[4]=S((...t)=>d.handlerSave&&d.handlerSave(...t),["prevent"])),class:"container oscar-form"},[e("header",null,[e("h1",null,[n.form-o.id?(r(),i("span",P,[l("Modification de "),e("strong",null,a(n.form.label),1)])):(r(),i("span",E,"Nouveau type de documents"))])]),e("div",F,[O,p(e("input",{id:"typedoc_label",type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=t=>n.form.label=t),name:"label"},null,512),[[x,n.form.label]])]),e("div",U,[I,p(e("select",{name:"signatureflow",id:"signatureflow","onUpdate:modelValue":s[1]||(s[1]=t=>n.form.signatureflow_id=t)},[L,(r(!0),i(_,null,h(n.signatureflows,t=>(r(),i("option",{value:t.id},a(t.label),9,B))),256))],512),[[g,n.form.signatureflow_id]])]),e("div",z,[e("label",J,[l(" Par défaut "),p(e("input",{id:"typedoc_default",type:"checkbox",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=t=>n.form.default=t),name:"default"},null,512),[[D,n.form.default]])]),R]),e("footer",G,[e("div",H,[K,e("button",{type:"reset",class:"btn btn-default",onClick:s[3]||(s[3]=t=>n.form=null)},[Q,l(" Annuler ")])])])],32)])):u("",!0)]),_:1}),e("div",W,[e("div",X,[Y,(r(!0),i(_,null,h(n.types,t=>(r(),i("article",{class:y(["card xs",{"selected active":t.default}])},[e("h1",Z,[e("span",null,[l(a(t.label)+" ",1),t.default?(r(),i("small",$," (par défaut)")):u("",!0),l(" - "),t.documents_total?(r(),i("a",{key:1,href:t.documents_view,title:"Afficher les activités contenant ce type de document"},a(t.documents_total)+" document(s) ",9,ee)):(r(),i("em",te,"Aucun document")),t.signatureflow_id?(r(),i("span",se,[l(" Procédure : "),e("strong",null,a(d.signatureFlow(t.signatureflow_id).label),1)])):u("",!0)])]),c.manage?(r(),i("nav",oe,[e("button",{class:"btn btn-xs btn-primary",onClick:w=>d.handlerEdit(t)},[le,l(" Éditer ")],8,ne),e("button",{class:"btn btn-xs btn-default",onClick:w=>d.remove(t)},[re,l(" Supprimer ")],8,ie)])):u("",!0)],2))),256))]),e("div",ae,[de,ue,e("div",null,[e("p",null,[l(" Emplacement où sont stoqués les documents :"),ce,e("code",me,a(n.documents_location),1)]),e("p",null,[l(" Type de document utilisé pour les envois PCRU :"),pe,e("strong",null,a(n.documents_pcru_type),1)]),_e,e("pre",null,a(n.signatureflows),1)]),n.untyped_documents?(r(),i("div",he,[fe,ge,l(", il y'a "),e("strong",null,a(n.untyped_documents),1),l(" documents sans type de document. Ils correspondent généralement à des documents envoyés via les demandes d'activités ou envoyés dans une version plus ancienne de Oscar. "),ye,l(" Vous pouvez leurs attribuer automatiquement un type avec la procédure ci-dessous : "),be,e("form",ve,[we,e("label",Me,[l(" Migrer vers ce type "),p(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>n.migrate_dest=t),id:"migrator",class:"form-control",name:"destination"},[(r(!0),i(_,null,h(n.types,t=>(r(),i("option",{value:t.id},a(t.label),9,ke))),256))],512),[[g,n.migrate_dest]])]),e("button",{type:"submit",class:y(["btn btn-success",{disabled:!n.migrate_dest}])}," Migrer les documents non-typés ",2)])])):u("",!0)])]),c.manage?(r(),i("button",{key:1,onClick:s[6]||(s[6]=(...t)=>d.formNew&&d.formNew(...t)),class:"btn btn-primary"},[Ce,l(" Ajouter ")])):u("",!0)])}const De=T(V,[["render",xe]]);let b=document.querySelector("#admintypedocument");const Se=N(De,{url:b.dataset.url,manage:b.dataset.manage});Se.mount("#admintypedocument");
