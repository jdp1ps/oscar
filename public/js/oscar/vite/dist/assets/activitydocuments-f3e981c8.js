import{h as f,o,c as n,a as e,w as b,v as C,b as M,d as k,t as d,F as v,r as D,e as m,n as w,f as p,g as R,i as Y,j as F,k as S,l as x,m as T,p as O,q as E,s as q}from"../vendor.js";import{_ as P}from"../vendor2.js";f.locale("fr");const L={model:{prop:"modelValue",event:"update:modelValue"},props:{value:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:f().format(),pickerYearRef:f().format("YYYY"),pickerMonthRef:f().month(),realValue:this.value,manualChange:""}},computed:{years(){let s=this.pickerYearRef-11,t=this.pickerYearRef+11,c=[];for(var _=s;_<t;_++)c.push(_);return c},mmValue(){return this.realValue?(f.locale("fr"),f(this.realValue)):f()},pickerData(){var s=this.daysShort,t=f(this.realValue).format(this.valueFormat);let c=f(this.pickerDayRef).startOf("month").startOf("isoWeek"),_=f(this.pickerDayRef).endOf("month").startOf("isoWeek"),l=[];for(;c.unix()<=_.unix();){let r={num:c.week(),days:[]};for(let a=1;a<=7;a++){let g=!this.limitFrom||this.limitFrom&&this.limitFrom<c.format();r.days.push({enabled:g,date:c.format(),active:c.format(this.valueFormat)==t,day:c.format("D")}),c.add(1,"day")}l.push(r)}return{dayslabels:s,weeks:l}},currentMonth(){return f(this.pickerDayRef).format("MMMM")},currentYear(){return f(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(f.locale("fr"),f(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(s){console.log("convert ",s);try{let t=f(s,this.displayFormat);t.isValid()&&this.changeDate(t.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(s){try{var t=f(s.target.value);this.changeDate(t.format(this.valueFormat))}catch(c){console.error("WTF DATE",c)}},handlerSelectMonth(s){let t=this.months.indexOf(s);this.pickerDayRef=f(this.pickerDayRef).month(t).format(),this.pickerMode="day"},handlerSelectYear(s){this.pickerDayRef=f(this.pickerDayRef).year(s).format(),this.pickerMode="day"},changeDate(s){console.log("Modification de la date",s),this.picker=!1,this.realValue=s?f(s).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=f(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=f(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(s){s.preventDefault(),s.stopImmediatePropagation(),s.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(s){this.picker=!1},initPickerVar(){var s=f(this.pickerDayRef?this.pickerDayRef:f());this.pickerYearRef=s.year(),this.pickerMonthRef=s.format("MMMM")}},created(){f.locale(this.i18n),this.pickerDayRef=this.value?this.value:f().format(),this.initPickerVar()}},A={class:"input-group"},W=e("div",{class:"input-group-addon"},[e("i",{class:"icon-calendar"})],-1),z={class:"datepicker-wrapper"},J=e("i",{class:"icon-angle-left"},null,-1),j=[J],H={class:"heading"},X=e("i",{class:"icon-angle-right"},null,-1),B=[X],K={key:0,class:"day-labels week"},G=e("span",{class:"week-label"}," ",-1),Q={class:"day-label"},Z={key:0},$={class:"weeks"},ee={class:"week"},te={class:"week-label"},se=["onClick"],le={key:1,class:"months"},oe=["onClick"],ne={key:2,class:"years"},ie=["onClick"],re=e("i",{class:"icon-cancel-alt"},null,-1);function ae(s,t,c,_,l,r){return o(),n("div",{onMouseenter:t[9]||(t[9]=(...a)=>r.handlerShow&&r.handlerShow(...a)),onMouseleave:t[10]||(t[10]=(...a)=>r.handlerHide&&r.handlerHide(...a))},[e("div",A,[b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=a=>r.renderValue=a)},null,512),[[C,r.renderValue]]),W]),b(e("div",{class:"datepicker-selector",onMouseleave:t[8]||(t[8]=(...a)=>r.handlerHide&&r.handlerHide(...a))},[e("div",z,[e("header",null,[e("nav",null,[e("span",{href:"#",onClick:t[1]||(t[1]=k((...a)=>r.pickerPrevMonth&&r.pickerPrevMonth(...a),["stop","prevent"]))},j),e("strong",H,[e("span",{class:"currentMonth",onClick:t[2]||(t[2]=k((...a)=>r.handlerPickerMonth&&r.handlerPickerMonth(...a),["stop"]))},d(r.currentMonth),1),e("span",{class:"currentYear",onClick:t[3]||(t[3]=k((...a)=>r.handlerPickerYear&&r.handlerPickerYear(...a),["stop"]))},d(r.currentYear),1)]),e("span",{href:"#",onClick:t[4]||(t[4]=k((...a)=>r.pickerNextMonth&&r.pickerNextMonth(...a),["stop"]))},B)]),l.pickerMode=="day"?(o(),n("div",K,[G,(o(!0),n(v,null,D(r.pickerData.dayslabels,a=>(o(),n("span",Q,d(a),1))),256))])):m("",!0)]),l.pickerMode=="day"?(o(),n("section",Z,[(o(!0),n(v,null,D(r.pickerData.weeks,a=>(o(),n("div",$,[e("span",ee,[e("span",te,d(a.num),1),(o(!0),n(v,null,D(a.days,g=>(o(),n("span",{class:w(["week-day",{active:g.active,disabled:!g.enabled}]),onClick:k(i=>r.changeDate(g.date),["prevent","stop"])},d(g.day),11,se))),256))])]))),256))])):m("",!0),l.pickerMode=="month"?(o(),n("section",le,[(o(!0),n(v,null,D(c.months,a=>(o(),n("span",{class:w(["month",{active:l.pickerMonthRef==a}]),onClick:k(g=>r.handlerSelectMonth(a),["prevent","stop"])},d(a),11,oe))),256))])):m("",!0),l.pickerMode=="year"?(o(),n("section",ne,[e("span",{class:"year",onClick:t[5]||(t[5]=k(a=>l.pickerYearRef-=22,["prevent","stop"]))},"<<"),(o(!0),n(v,null,D(r.years,a=>(o(),n("span",{class:w(["year",{active:l.pickerYearRef==a}]),onClick:k(g=>r.handlerSelectYear(a),["prevent","stop"])},d(a),11,ie))),256)),e("span",{class:"year",onClick:t[6]||(t[6]=k(a=>l.pickerYearRef+=22,["prevent","stop"]))},">>")])):m("",!0)]),e("div",{style:{"text-align":"center",cursor:"pointer"},onClick:t[7]||(t[7]=(...a)=>r.handlerClear&&r.handlerClear(...a))},[re,p(" Supprimer la date ")])],544),[[M,l.picker]])],32)}const ce=P(L,[["render",ae]]);let U;const de={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(s,t){s.length>=2&&(U&&clearTimeout(U),U=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,R.get(this.url+this.expression+"&f=json",{before(s){this.request&&this.request.abort(),this.request=s}}).then(s=>{console.log(s),this.persons=s.data.datas,this.showSelector=!0},s=>{console.log(s),s.status==403?this.error="403 Unauthorized":s.message?this.error="ERROR : "+s.message:s.body&&(this.error=s.body)}).then(s=>{this.loading=!1,this.request=null})},handlerSelectPerson(s){let t=this.persons.find(c=>c.id==s);console.log("handlerSelectPerson",t),this.selectedPerson=t,this.showSelector=!1,this.expression="",this.$emit("change",t)}}},ue={key:0,class:"alert alert-danger"},he=e("i",{class:"icon-spinner animate-spin"},null,-1),pe=[he],me={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},_e=["onClick"],fe={style:{display:"block",width:"50px",height:"50px"}},ve=["src","alt"],De={class:"infos"},ye={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},ke=e("br",null,null,-1),be={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},ge=e("i",{class:"icon-location"},null,-1),we={key:0},Ce=e("br",null,null,-1),Me={style:{"font-weight":"100","font-size":".8em"}},Te=e("i",{class:"icon-mail"},null,-1),Se={key:1,class:"alert alert-danger"},xe=e("i",{class:"icon-attention-1"},null,-1);function Ue(s,t,c,_,l,r){return o(),n("div",null,[l.error?(o(),n("div",ue,[p(d(l.error)+" ",1),e("button",{class:"btn btn-default",onClick:t[0]||(t[0]=a=>l.error="")},"Fermer")])):m("",!0),b(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>l.expression=a),onKeyup:t[2]||(t[2]=Y(k((...a)=>r.search&&r.search(...a),["prevent"]),["enter"]))},null,544),[[C,l.expression]]),b(e("span",null,pe,512),[[M,l.loading]]),b(e("div",me,[(o(!0),n(v,null,D(l.persons,a=>(o(),n("div",{class:"choice",key:a.id,onClick:k(g=>r.handlerSelectPerson(a.id),["prevent","stop"])},[e("div",fe,[e("img",{src:"https://www.gravatar.com/avatar/"+a.mailMd5+"?s=50",alt:a.displayname,style:{width:"100%"}},null,8,ve)]),e("div",De,[e("strong",ye,d(a.displayname),1),ke,e("span",be,[ge,p(" "+d(a.affectation)+" ",1),a.ucbnSiteLocalisation?(o(),n("span",we," ~ "+d(a.ucbnSiteLocalisation),1)):m("",!0)]),Ce,e("em",Me,[Te,p(d(a.email),1)])])],8,_e))),128))],512),[[M,l.persons.length>0&&l.showSelector]]),l.error?(o(),n("div",Se,[xe,p(" "+d(l.error),1)])):m("",!0)])}const Ve=P(de,[["render",Ue]]);const V="private",Ne={components:{"date-picker":ce,"person-auto-completer":Ve},props:{urlUploadNewDoc:{required:!0},url:{required:!0}},data(){return{idCurrentPerson:null,persons:[],computedDocuments:[],dateDeposit:"",dateSend:"",fileUrl:"",fileUrlLabel:"",privateDocument:!1,selectedIdTypeDocument:null,selectedIdTabDocument:null,informationsDocument:"",fileToDownload:null,uploadNewDocData:{dateDeposit:this.dateDeposit,dateSend:this.dateSend,private:this.privateDocument,type:this.selectedIdTypeDocument,tab:this.selectedIdTabDocument,informations:this.informationsDocument,persons:this.persons,baseUrlUpload:this.urlUploadNewDoc,url:"",init:!1},errorMessages:[],tabId:null,tabsWithDocuments:null,formData:null,error:null,deleteData:null,editData:null,uploadDoc:null,documents:[],loading:!0,sortField:"dateUpload",sortDirection:-1,editable:!0,remoterState:null,displayComputed:!1,mode_url:!1,typesDocuments:[],selectedTab:null,selectedTabId:null}},computed:{selectedTypeDocument(){return this.selectedIdTypeDocument?(console.log(this.typesDocuments),this.typesDocuments.find(s=>s.id==this.selectedIdTypeDocument)):null},documentsPacked(){let s=[];return this.documents&&(s=this.documents.sort(function(c,_){return c[this.sortField]<_[this.sortField]?-1*this.sortDirection:c[this.sortField]>_[this.sortField]?1*this.sortDirection:0}.bind(this))),s},packedDocuments(){let s={};if(this.tabsWithDocuments)for(const[t,c]of Object.entries(this.tabsWithDocuments)){let _={};for(const[l,r]of Object.entries(c.documents)){let a=r.fileName;_.hasOwnProperty(a)?_[a].versions.push(r):(r.versions=[],_[a]=r)}s[t]={id:c.id,label:c.label,total:c.total,description:c.description,manage:c.manage,roles:c.roles,documents:_}}return s}},methods:{activeTab(s){this.tabId=s},deleteDocument(s){this.deleteData=s},order:function(s){this.sortField==s?this.sortDirection*=-1:this.sortField=s},cssStepCurrent(s){return s===this.tabId?"current":""},cssSort:function(s){return s===this.sortField?"active":""},handlerEdit(s){console.log(JSON.parse(JSON.stringify(s)));let t=s.tabDocument;t==null||t.trim===""?t=V:t=t.id,this.persons=[],s.persons.forEach(c=>{this.persons.push(c)}),this.editData={documentype_id:s.category.id,basename:s.basename,document:s,tabDocument_id:t,private:s.private}},handlerSelectPersons(s){if(s.id){let t={personName:s.displayname,personId:s.id,affectation:s.affectation},c=s.id,_=!1;this.persons.forEach(function(l){l.personId===c&&(_=!0)}),_===!1&&this.persons.push(t)}},handlerDeletePerson(s){this.persons.splice(this.persons.indexOf(s),1)},handlerUploadNewDoc(s){this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=this.urlUploadNewDoc+"/"+s,this.initUploadDatas(s)},handlerNewVersion(s){console.log(JSON.parse(JSON.stringify(s))),this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=s.urlReupload,this.selectedIdTypeDocument=this.uploadNewDocData.selectedIdTypeDocument=s.category.id,this.uploadNewDocData.tab=s.tabDocument.id,this.privateDocument=this.uploadNewDocData.private=s.private,this.informationsDocument="",this.persons=[],s.persons.forEach(t=>{this.persons.push(t)}),this.uploadNewDocData.init=!0,this.fileToDownload=null},handlerUploadNewVersionDoc(s,t,c){this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=t,this.selectedIdTypeDocument=c,this.initUploadDatas(s,c)},initUploadDatas(s,t=null){this.dateDeposit="",this.dateSend="";let c=!1;s===V&&(c=!0),this.privateDocument=c,this.selectedIdTypeDocument=t,this.informationsDocument="",this.fileUrl=this.uploadNewDocData.url="",this.fileUrlLabel="",this.persons=[],this.uploadNewDocData.init=!0,this.fileToDownload=null,this.uploadNewDocData.tab=s},uploadFile(s){s.target.files.length!==0&&(this.fileToDownload=s.target.files[0])},performUpload(){this.uploadNewDocData.dateDeposit=this.dateDeposit,this.uploadNewDocData.dateSend=this.dateSend,this.uploadNewDocData.private=this.privateDocument===!0?"1":"0",this.uploadNewDocData.type=this.selectedIdTypeDocument,this.uploadNewDocData.informations=this.informationsDocument;let s=[];this.persons.length!==0&&this.persons.forEach(function(c){s.push(c.personId)}),this.uploadNewDocData.persons=s;const t=new FormData;for(let c in this.uploadNewDocData){let _=this.uploadNewDocData[c];t.append(c,_)}this.mode_url?(t.append("url",this.fileUrl),t.append("label_url",this.fileUrlLabel)):this.fileToDownload!==null?t.append("file",this.fileToDownload,this.fileToDownload.name):this.errorMessages.push("Aucun fichier sélectionner a téléverser !"),this.uploadNewDocData.type===null&&this.errorMessages.push("Vous devez qualifier le type de votre document !"),this.errorMessages.length===0&&(this.uploadDoc=null,this.persons=[],console.log(this.uploadNewDocData.baseUrlUpload),R.post(this.uploadNewDocData.baseUrlUpload,t).then(c=>{console.log("SUCCESS ",c),this.fetch()},c=>{console.log("ERROR ",c),this.error=c.response.data}))},performEdit(){this.errorMessages=[];let s=[],t="",c=!0;if(this.editData.private===!0?(c=1,this.persons.length!==0&&this.persons.forEach(a=>{s.push(a.personId)})):(c=0,this.editData.tabDocument_id===V||this.editData.tabDocument_id===""?this.errorMessages.push("Vous devez sélectionner un onglet pour la modification (ce n'est pas un document qualifié privé)"):t=this.editData.tabDocument_id),this.errorMessages.length!==0)return;let _=this.editData.document.id,l=this.editData.documentype_id;this.editData=null,this.persons=[];let r=new FormData;r.append("documentId",_),r.append("type",l),r.append("tabDocument",t),r.append("private",c),r.append("persons",s)},handlerSuccess(s){console.log("handlerSuccess(",s);try{this.idCurrentPerson=s.data.idCurrentPerson;let t=Array.isArray(s.data.tabsWithDocuments)?{}:s.data.tabsWithDocuments,c=null,_=null;if(Object.keys(t).forEach(l=>{let r=t[l];r.total=r.documents.length,r.documents.sort((a,g)=>g.version-a.version),r.documents.forEach(a=>{console.log(a.fileName,a.version),a.explode=!0}),c==null&&(c=r.id),_==null&&r.documents.length>0&&(_=r.id)}),this.tabsWithDocuments=t,this.computedDocuments=s.data.computedDocuments,this.typesDocuments=s.data.typesDocuments,this.selectedTabId==null&&(this.selectedTabId=_||c),this.tabsWithDocuments.unclassified&&this.tabsWithDocuments.unclassified.documents.length)this.selectedTab=this.tabsWithDocuments.unclassified;else{let l=Object.keys(this.tabsWithDocuments)[0];l.length&&(this.selectedTab=this.tabsWithDocuments[l[0]])}}catch(t){console.log("Erreur de traitement ",t)}},handlerSelectTab(s){s=="computed"?(this.displayComputed=!0,this.selectedTab=null,this.selectedTabId=null):(this.displayComputed=!1,this.selectedTab=s,this.selectedTabId=s.id)},fetch(){console.log("fetch()"+this.url),R.get(this.url).then(s=>{this.handlerSuccess(s)})}},mounted(){this.fetch()}},h=s=>(O("data-v-eebedc87"),s=s(),E(),s),Re={key:0,class:"overlay"},Pe={class:"overlay-content",style:{"max-width":"50%"}},Ie={class:"alert-danger alert"},Fe=h(()=>e("i",{class:"icon-attention-1"},null,-1)),Ye=h(()=>e("i",{class:"icon-cancel-outline"},null,-1)),Oe={style:{position:"relative","min-height":"100px"}},Ee={key:0,class:"overlay"},qe={class:"overlay-content"},Le={class:"alert-danger alert"},Ae=h(()=>e("i",{class:"icon-attention-1"},null,-1)),We=h(()=>e("i",{class:"icon-cancel-alt"},null,-1)),ze=["href"],Je=h(()=>e("i",{class:"icon-valid"},null,-1)),je={key:1,class:"overlay"},He={class:"overlay-content"},Xe=h(()=>e("i",{class:"icon-doc"},null,-1)),Be={class:"row"},Ke={class:"col-md-6"},Ge=h(()=>e("label",{for:"typedocument"},"Type de document",-1)),Qe=["selected","value"],Ze={class:"col-md-6"},$e={class:"row",style:{"margin-top":"20px"}},et={key:0},tt=h(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),st=["selected","value"],lt=h(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),ot={class:"col-md-6"},nt={key:0},it=h(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),rt=h(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),at=h(()=>e("i",{class:"icon-cube"},null,-1)),ct={key:0,class:"addon"},dt=["onClick"],ut={class:"row"},ht={class:"col-md-12"},pt=h(()=>e("i",{class:"icon-cancel-alt"},null,-1)),mt=h(()=>e("i",{class:"icon-valid"},null,-1)),_t={key:2,class:"overlay"},ft={class:"overlay-content"},vt={class:"alert"},Dt={for:"switch_mode"},yt={style:{width:"90%","margin-left":"5%"}},kt={class:"row"},bt={class:"col-md-6"},gt={key:0},wt=h(()=>e("label",{for:"url"},"URL du fichier",-1)),Ct=h(()=>e("label",{for:"label"},"Description de l'URL",-1)),Mt={key:1},Tt=h(()=>e("label",{for:"file"},"Fichier",-1)),St=h(()=>e("label",null,"Date de dépôt",-1)),xt=h(()=>e("p",{class:"help"},"Date à laquelle le fichier a été reçu",-1)),Ut=h(()=>e("label",null,"Date d'envoi",-1)),Vt=h(()=>e("p",{class:"help"},"Date à laquelle le fichier a été envoyé",-1)),Nt={class:"col-md-6"},Rt=h(()=>e("label",{for:"type"},"Type de document",-1)),Pt=["value"],It={key:0},Ft=h(()=>e("h3",null,"Procédure de signature : ",-1)),Yt={class:"metas"},Ot={class:"meta"},Et={class:"meta"},qt={class:"meta"},Lt={class:"recipient"},At={class:"email"},Wt={class:"fullname"},zt={key:1,class:"row",style:{"margin-top":"20px"}},Jt=h(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),jt={class:"col-md-6"},Ht={key:2,class:"alert alert-info"},Xt={key:3},Bt=h(()=>e("h4",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),Kt=h(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),Gt=h(()=>e("i",{class:"icon-cube"},null,-1)),Qt={key:0,class:"addon"},Zt=["onClick"],$t={class:"row"},es={class:"col-md-12"},ts=h(()=>e("label",{for:"informations"},"Note",-1)),ss=h(()=>e("hr",null,null,-1)),ls={class:"buttons text-center"},os=h(()=>e("i",{class:"icon-cancel-alt"},null,-1)),ns=h(()=>e("i",{class:"icon-valid"},null,-1)),is={key:3,class:"overlay"},rs={class:"overlay-content"},as=h(()=>e("i",{class:"icon-cancel-alt"},null,-1)),cs={class:"documents-content"},ds={class:"tabs"},us=["onClick"],hs={class:"label label-default"},ps={class:"tab-content"},ms={class:""},_s=h(()=>e("i",{class:"picto icon-doc"},null,-1)),fs=h(()=>e("small",{class:"text-light"},"  (Document généré automatiquement) ",-1)),vs={class:"text-right show-over"},Ds=["href"],ys=h(()=>e("i",{class:"icon-upload-outline"},null,-1)),ks={class:"tab-content"},bs={key:0,class:"text-right"},gs=["onClick"],ws=h(()=>e("i",{class:"icon-download"},null,-1)),Cs=h(()=>e("hr",null,null,-1)),Ms={class:""},Ts={key:0,class:"picto icon-anchor-outline"},Ss={class:"text-light"},xs=["title"],Us={key:0},Vs=h(()=>e("i",{class:"icon-lock"},null,-1)),Ns={class:"cartouche"},Rs=h(()=>e("hr",null,null,-1)),Ps={key:1},Is={class:"card-content"},Fs={key:0},Ys=h(()=>e("div",{class:"exploder"}," Versions précédentes : ",-1)),Os={class:"subdoc text-highlight"},Es={key:0},qs=["href"],Ls=h(()=>e("i",{class:"icon-download-outline"},null,-1)),As={class:"text-right show-over"},Ws=["href"],zs=h(()=>e("i",{class:"icon-link-ext"},null,-1)),Js=["href"],js=h(()=>e("i",{class:"icon-upload-outline"},null,-1)),Hs=["onClick"],Xs=h(()=>e("i",{class:"icon-download-outline"},null,-1)),Bs=["onClick"],Ks=h(()=>e("i",{class:"icon-trash"},null,-1)),Gs=["onClick"],Qs=h(()=>e("i",{class:"icon-pencil"},null,-1));function Zs(s,t,c,_,l,r){const a=F("person-auto-completer"),g=F("date-picker");return o(),n(v,null,[l.error?(o(),n("div",Re,[e("div",Pe,[e("h2",null,[p(" Erreur "),e("span",{class:"overlay-closer",onClick:t[0]||(t[0]=i=>l.error=null)},"X")]),e("p",Ie,[Fe,p(d(l.error),1)]),e("button",{class:"btn btn-default",onClick:t[1]||(t[1]=i=>l.error=null)},[Ye,p(" Fermer ")])])])):m("",!0),e("section",Oe,[l.deleteData?(o(),n("div",Ee,[e("div",qe,[e("h2",null,[p(" Suppression du fichier ? "),e("span",{class:"overlay-closer",onClick:t[2]||(t[2]=i=>l.deleteData=null)},"X")]),e("p",Le,[Ae,p(" Souhaitez-vous supprimer le fichier "),e("strong",null,d(l.deleteData.fileName),1),p(" ? ")]),e("button",{class:"btn btn-danger",onClick:t[3]||(t[3]=i=>l.deleteData=null)},[We,p(" Annuler ")]),e("a",{class:"btn btn-success",href:l.deleteData.urlDelete},[Je,p(" Confirmer ")],8,ze)])])):m("",!0),l.editData?(o(),n("div",je,[e("div",He,[e("h2",null,[p(" Modification du document : "),Xe,p(" "+d(l.editData.basename)+" ",1),e("span",{class:"overlay-closer",onClick:t[4]||(t[4]=i=>l.editData=null)},"X")]),e("div",Be,[e("div",Ke,[Ge,e("div",null,[b(e("select",{name:"type",id:"typedocument","onUpdate:modelValue":t[5]||(t[5]=i=>l.editData.documentype_id=i)},[(o(!0),n(v,null,D(s.documentTypes,(i,u)=>(o(),n("option",{selected:l.editData.documentype_id==u,value:u,key:u},d(i),9,Qe))),128))],512),[[S,l.editData.documentype_id]])])]),e("div",Ze,[e("div",$e,[l.editData.private===!1?(o(),n("span",et,[tt,e("div",null,[b(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":t[6]||(t[6]=i=>l.editData.tabDocument_id=i)},[s.tabDoc.manage===!0&&s.tabDoc.id!="private"?(o(!0),n(v,{key:0},D(l.tabsWithDocuments,(i,u)=>(o(),n("option",{selected:l.editData.tabDocument_id==u,value:u,key:u},d(i.label),9,st))),128)):m("",!0)],512),[[S,l.editData.tabDocument_id]])])])):m("",!0),lt,e("div",ot,[b(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=i=>l.editData.private=i)},null,512),[[x,l.editData.private]])])]),l.editData.private===!0?(o(),n("span",nt,[it,rt,T(a,{onChange:r.handlerSelectPersons},null,8,["onChange"]),l.persons.length!==0?(o(!0),n(v,{key:0},D(l.persons,i=>(o(),n("span",{key:i.personId,class:"cartouche"},[at,e("span",null,d(i.personName),1),i.affectation.trim()!==""?(o(),n("span",ct,d(i.affectation),1)):m("",!0),i.personId!==l.idCurrentPerson?(o(),n("i",{key:1,onClick:u=>r.handlerDeletePerson(i),class:"icon-trash icon-clickable"},null,8,dt)):m("",!0)]))),128)):m("",!0)])):m("",!0)])]),e("div",ut,[e("div",ht,[e("button",{class:"btn btn-danger",onClick:t[8]||(t[8]=i=>l.editData=null)},[pt,p(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:t[9]||(t[9]=k(i=>r.performEdit(),["prevent"]))},[mt,p(" Enregistrer ")])])])])])):m("",!0),l.uploadDoc?(o(),n("div",_t,[e("div",ft,[e("h2",null,[p(" Téléverser un nouveau document dans "),e("strong",null,d(l.selectedTab.label),1),e("span",{class:"overlay-closer",onClick:t[10]||(t[10]=i=>l.uploadDoc=null)},"X")]),e("div",vt,[e("label",Dt,[p(" Cochez cette case si le fichier est un URL "),b(e("input",{type:"checkbox",name:"switch_mode","onUpdate:modelValue":t[11]||(t[11]=i=>l.mode_url=i)},null,512),[[x,l.mode_url]])])]),e("div",yt,[p(d()+" ",1),e("div",kt,[e("div",bt,[l.mode_url?(o(),n("div",gt,[wt,b(e("input",{type:"text",class:"form-control",name:"url",id:"url",placeholder:"Lien vers la ressource","onUpdate:modelValue":t[12]||(t[12]=i=>l.fileUrl=i)},null,512),[[C,l.fileUrl]]),Ct,b(e("input",{type:"text",class:"form-control",name:"label",id:"label",placeholder:"Description rapide de la ressource","onUpdate:modelValue":t[13]||(t[13]=i=>l.fileUrlLabel=i)},null,512),[[C,l.fileUrlLabel]])])):(o(),n("div",Mt,[Tt,e("input",{onChange:t[14]||(t[14]=(...i)=>r.uploadFile&&r.uploadFile(...i)),type:"file",class:"form-control",name:"file",id:"file"},null,32)])),St,xt,T(g,{modelValue:l.dateDeposit,"onUpdate:modelValue":t[15]||(t[15]=i=>l.dateDeposit=i)},null,8,["modelValue"]),Ut,Vt,T(g,{modelValue:l.dateSend,"onUpdate:modelValue":t[16]||(t[16]=i=>l.dateSend=i)},null,8,["modelValue"])]),e("div",Nt,[Rt,b(e("select",{"onUpdate:modelValue":t[17]||(t[17]=i=>l.selectedIdTypeDocument=i),name:"type",id:"type",class:"form-control"},[(o(!0),n(v,null,D(l.typesDocuments,i=>(o(),n("option",{value:i.id,key:i.id},d(i.label),9,Pt))),128))],512),[[S,l.selectedIdTypeDocument]]),r.selectedTypeDocument&&r.selectedTypeDocument.flow?(o(),n("section",It,[Ft,(o(!0),n(v,null,D(r.selectedTypeDocument.flow,i=>(o(),n("article",{key:i.id,class:"signature"},[e("h2",null,d(i.label),1),(o(!0),n(v,null,D(i.steps,u=>(o(),n("article",null,[e("ul",Yt,[e("li",Ot,[p("Parapheur: "),e("strong",null,d(u.letterfile_label),1)]),e("li",Et,[p("Type: "),e("strong",null,d(u.level_label),1)]),e("li",qt,[p("Tous signent: "),e("strong",null,d(u.allSignToComplete?"Oui":"non"),1)])]),(o(!0),n(v,null,D(u.recipients,y=>(o(),n("div",Lt,[e("strong",At,d(y.email),1),e("span",Wt,d(y.firstname)+" "+d(y.lastname),1)]))),256))]))),256))]))),128))])):m("",!0),l.mode_url!=!0?(o(),n("div",zt,[Jt,e("div",jt,[b(e("input",{type:"checkbox",name:"private",id:"private",class:"form-control","onUpdate:modelValue":t[18]||(t[18]=i=>l.privateDocument=i)},null,512),[[x,l.privateDocument]])])])):(o(),n("div",Ht," Les URL ne peuvent pas être définie comme privée dans Oscar ")),l.privateDocument===!0?(o(),n("span",Xt,[Bt,Kt,T(a,{onChange:r.handlerSelectPersons},null,8,["onChange"]),l.persons.length!==0?(o(!0),n(v,{key:0},D(l.persons,i=>(o(),n("span",{key:i.personId,class:"cartouche"},[Gt,e("span",null,d(i.personName),1),i.affectation.trim()!=""?(o(),n("span",Qt,d(i.affectation),1)):m("",!0),i.affectation.trim()===""?(o(),n("i",{key:1,onClick:u=>r.handlerDeletePerson(i),class:"icon-trash icon-clickable"},null,8,Zt)):m("",!0)]))),128)):m("",!0)])):m("",!0)]),e("div",$t,[e("div",es,[ts,b(e("textarea",{"onUpdate:modelValue":t[19]||(t[19]=i=>l.informationsDocument=i),name:"informations",id:"informations",class:"form-control",cols:"30",rows:"10"},null,512),[[C,l.informationsDocument]])])]),ss,e("nav",ls,[e("button",{class:"btn btn-danger",onClick:t[20]||(t[20]=i=>l.uploadDoc=null)},[os,p(" Annuler ")]),e("button",{class:"btn btn-success",href:"#",onClick:t[21]||(t[21]=k(i=>r.performUpload(),["prevent"]))},[ns,p(" Enregistrer ")])])])])])])):m("",!0),l.errorMessages.length!==0?(o(),n("div",is,[e("div",rs,[e("h2",null,[e("span",{class:"overlay-closer",onClick:t[22]||(t[22]=i=>l.errorMessages=[])},"X")]),e("ul",null,[(o(!0),n(v,null,D(l.errorMessages,i=>(o(),n("li",null,d(i),1))),256))]),e("button",{class:"btn btn-danger",onClick:t[23]||(t[23]=i=>l.errorMessages=[])},[as,p(" Retour ")])])])):m("",!0),e("section",cs,[e("div",ds,[(o(!0),n(v,null,D(r.packedDocuments,i=>(o(),n("div",{class:w(["tab",{selected:l.selectedTabId===i.id}]),onClick:k(u=>r.handlerSelectTab(i),["prevent"])},[p(d(i.label)+" ",1),e("sup",hs,d(i.total),1)],10,us))),256)),e("div",{class:w(["tab",{selected:l.displayComputed}]),onClick:t[24]||(t[24]=k(i=>r.handlerSelectTab("computed"),["prevent"]))}," Documents générés ",2)]),b(e("div",ps,[(o(!0),n(v,null,D(l.computedDocuments,i=>(o(),n("article",{class:"card xs",key:i.key},[e("div",ms,[_s,e("strong",null,d(i.label),1),fs]),e("nav",vs,[e("a",{class:"btn btn-default btn-xs",href:i.url},[ys,p(" Télécharger ")],8,Ds)])]))),128))],512),[[M,l.displayComputed]]),(o(!0),n(v,null,D(r.packedDocuments,i=>b((o(),n("div",ks,[i.manage?(o(),n("nav",bs,[i.manage?(o(),n("button",{key:0,onClick:u=>r.handlerUploadNewDoc(i.id),class:"btn btn-xs btn-default"},[ws,p(" Téléverser un document ")],8,gs)):m("",!0),p(" URL : "+d(c.urlUploadNewDoc),1)])):m("",!0),Cs,(o(!0),n(v,null,D(i.documents,u=>(o(),n("article",{class:w(["card xs",{"private-document":u.private}]),key:u.id},[e("div",Ms,[u.location=="link"?(o(),n("i",Ts)):(o(),n("i",{key:1,class:w(["picto icon-doc","doc"+u.extension])},null,2)),e("small",Ss,d(u.category.label)+" ~ ",1),e("strong",null,d(u.fileName),1),u.location!="url"?(o(),n("small",{key:2,class:"text-light",title:u.fileSize+" octet(s)"},"  ("+d(u.fileSize|s.filesize)+") - Version "+d(u.version),9,xs)):m("",!0)]),u.private?(o(),n("section",Us,[Vs,p(" Ce document est privé, accessible par : "),(o(!0),n(v,null,D(u.persons,y=>(o(),n("span",Ns,d(y.personName),1))),256))])):m("",!0),e("p",null,d(u.information),1),Rs,u.process&&u.process.status!=200?(o(),n("section",Ps,[e("h4",null,[p("Procédure de signature "),e("strong",null,d(u.process.label)+" ("+d(u.process.status_text)+")",1)]),(o(!0),n(v,null,D(u.process.steps,y=>(o(),n("section",{class:w(["step","signature-status-"+y.status])},[e("h3",null,d(y.label)+" ("+d(y.status_text)+")",1),(o(!0),n(v,null,D(y.recipients,I=>(o(),n("article",{class:w(["recipient","signature-status-"+I.status])},d(I.fullname),3))),256))],2))),256))])):m("",!0),e("div",Is,[u.versions.length?(o(),n("div",Fs,[Ys,(o(!0),n(v,null,D(u.versions,y=>(o(),n("article",Os,[e("i",{class:w(["picto icon-doc","doc"+y.extension])},null,2),e("strong",null,d(y.fileName),1),p(" version "),e("em",null,d(y.version),1),p(", téléchargé le "),e("time",null,d(y.dateUpload|s.dateFullSort),1),y.uploader?(o(),n("span",Es,[p(" par "),e("strong",null,d(y.uploader.displayname),1)])):m("",!0),e("a",{href:y.urlDownload},[Ls,p(" Télécharger cette version ")],8,qs)]))),256))])):m("",!0),e("nav",As,[u.location=="url"?(o(),n("a",{key:0,class:"btn btn-default btn-xs",href:u.basename,target:"_blank"},[zs,p(" Accéder au lien ")],8,Ws)):m("",!0),u.urlDownload&&u.location!="url"?(o(),n("a",{key:1,class:"btn btn-default btn-xs",href:u.urlDownload},[js,p(" Télécharger ")],8,Js)):m("",!0),i.manage&&u.location!="url"?(o(),n("button",{key:2,onClick:y=>r.handlerNewVersion(u),class:"btn btn-default btn-xs"},[Xs,p(" Nouvelle Version ")],8,Hs)):m("",!0),i.manage?(o(),n("a",{key:3,class:"btn btn-default btn-xs",onClick:k(y=>r.deleteDocument(u),["prevent"])},[Ks,p(" Supprimer ")],8,Bs)):m("",!0),i.manage&&u.location!="url"?(o(),n("a",{key:4,class:"btn btn-xs btn-default",href:"#",onClick:k(y=>r.handlerEdit(u),["prevent"])},[Qs,p(" Modifier ")],8,Gs)):m("",!0)])])],2))),128))],512)),[[M,l.selectedTabId===i.id]])),256))])])],64)}const $s=P(Ne,[["render",Zs],["__scopeId","data-v-eebedc87"]]);let N=document.querySelector("#activitydocuments");const el=q($s,{url:N.dataset.url,urlUploadNewDoc:N.dataset.urlUploadNewDoc,manage:N.dataset.manage});el.mount("#activitydocuments");
