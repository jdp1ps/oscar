import{g as b,c as o,k as u,u as c,T as y,a as s,F as _,r as f,t as n,e as d,f as i,d as v,o as l,w as C,l as k,s as w}from"../vendor.js";import{_ as M}from"../vendor3.js";import{M as I}from"../vendor4.js";const N={props:{url:{required:!0}},computed:{synthesis(){return this.infos}},data(){return{infos:null,pendingMsg:null,showCuration:!1,masses:[],synthesis:null}},methods:{fetch(){this.pendingMsg="Chargement des données financières",b.get(this.url).then(e=>{this.synthesis=e.data.synthesis,this.masses=e.data.masses},e=>{console.log(e)}).then(e=>{this.pendingMsg=!1})}},mounted(){this.fetch()}},B={key:0,class:"overlay"},T={class:"overlay-content"},V=s("p",null,"Les comptes suivants ne sont pas qualifiés, vous pouvez utiliser cet écran pour les attribuer à une masse budgétaire :",-1),D={class:"card row"},A={class:"col-md-4"},F={class:"col-md-8"},R=["onUpdate:modelValue","onChange"],U=s("option",{value:"0"},"Ignorer",-1),q=s("option",{value:"1"},"Traiter comme une recette",-1),E=["value"],L=s("hr",null,null,-1),S=s("i",{class:"icon-cancel-circled"},null,-1),j=s("i",{class:"icon-floppy"},null,-1),z={key:0,class:"alert alert-danger"},H=s("i",{class:"icon-attention-1"},null,-1),P={key:0,class:"alert-warning alert"},Q=s("i",{class:"icon-warning-empty"},null,-1),X={key:0,class:"pending"},G={class:""},J=s("i",{class:"icon-spinner animate-spin"},null,-1),K={key:0,class:"table table-condensed card synthesis"},O=s("thead",null,[s("tr",null,[s("th",null,"Masse"),s("th",{style:{"text-align":"right"}},"Engagé"),s("th",{style:{"text-align":"right"}},"Réalisé")])],-1),W=["href"],Y={style:{"text-align":"right"}},Z={style:{"text-align":"right"}},$={class:"total"},x=s("th",null,"Total",-1),ss={style:{"text-align":"right"}},es={style:{"text-align":"right"}},ts={key:0},ns=s("small",null,[s("i",{class:"icon-attention"}),i(" Hors-masse")],-1),os={href:"#repport-nb",class:"label label-info"},ls={style:{"text-align":"right"}},is={style:{"text-align":"right"}},rs={key:1},as=s("h3",null,[s("i",{class:"icon-calculator"}),i("Recettes")],-1),ds={key:0,class:"table table-condensed card synthesis"},hs={class:"label label-info xs",href:"#repport-1"},us={style:{"text-align":"right"}},cs={key:2},ys={key:0},_s=s("i",{class:"icon-eye-off"},null,-1),fs={key:1},ps=s("i",{class:"icon-eye"},null,-1),gs={key:0,class:"table table-condensed card synthesis"},ms={class:"label label-info",href:"#repport-0"},bs={style:{"text-align":"right"}},vs={key:0};function Cs(e,h,ws,Ms,t,Is){return l(),o("section",null,[u(y,{name:"fade"},{default:c(()=>[t.showCuration?(l(),o("div",B,[s("div",T,[s("h3",null,[i(" Qualification des comptes "),s("span",{class:"overlay-closer",onClick:h[0]||(h[0]=r=>t.showCuration=!1)},"X")]),V,(l(!0),o(_,null,f(t.synthesis.curations,r=>(l(),o("div",D,[s("div",A,[s("strong",null,n(r.compte),1),i(" - "),s("em",null,n(r.compteInfos.label),1)]),s("div",F,[C(s("select",{name:"",id:"",class:"form-control","onUpdate:modelValue":a=>e.affectations[r.compte]=a,onChange:a=>e.updateAffectations(r.compte,a)},[U,q,(l(!0),o(_,null,f(t.masses,(a,m)=>(l(),o("option",{value:m},n(a),9,E))),256))],40,R),[[k,e.affectations[r.compte]]])])]))),256)),L,s("button",{onClick:h[1]||(h[1]=(...r)=>e.handlerCurationCancel&&e.handlerCurationCancel(...r)),class:"btn btn-danger"},[S,i("Annuler")]),s("button",{onClick:h[2]||(h[2]=(...r)=>e.handlerCurationConfirm&&e.handlerCurationConfirm(...r)),class:"btn btn-success"},[j,i("Enregistrer")])])])):d("",!0)]),_:1}),u(y,{name:"fade"},{default:c(()=>[e.error?(l(),o("div",z,[H,i(" Il y'a eut un problème lors de la récupération des données financières : "+n(e.error),1)])):d("",!0)]),_:1}),u(y,{name:"fade"},{default:c(()=>[e.warning?(l(),o("div",P,[Q,i(" Les données affichées peuvent ne pas être à jour : "+n(e.warning),1)])):d("",!0)]),_:1}),u(y,{name:"fade"},{default:c(()=>[t.pendingMsg?(l(),o("div",X,[s("div",G,[J,i(" "+n(t.pendingMsg),1)])])):d("",!0)]),_:1}),t.synthesis?(l(),o("table",K,[O,s("tbody",null,[(l(!0),o(_,null,f(t.synthesis.masses,(r,a)=>(l(),o("tr",null,[s("th",null,[s("small",null,n(r),1),s("a",{class:"label label-info xs",href:"#repport-"+a},n(t.synthesis.synthesis[a].nbr_effectue)+" / "+n(t.synthesis.synthesis[a].nbr_engage),9,W)]),s("td",Y,n(e.$filters.money(t.synthesis.synthesis[a].total_engage)),1),s("td",Z,n(e.$filters.money(t.synthesis.synthesis[a].total_effectue)),1)]))),256))]),s("tbody",null,[s("tr",$,[x,s("td",ss,n(e.$filters.money(t.synthesis.synthesis.totaux.engage)),1),s("td",es,n(e.$filters.money(t.synthesis.synthesis.totaux.effectue)),1)])]),s("tbody",null,[t.synthesis.synthesis["N.B"].total!=0?(l(),o("tr",ts,[s("th",null,[ns,s("a",os,n(t.synthesis.synthesis["N.B"].nbr),1)]),s("td",ls,n(e.$filters.money(t.synthesis.synthesis["N.B"].total_engage)),1),s("td",is,n(e.$filters.money(t.synthesis.synthesis["N.B"].total_effectue)),1)])):d("",!0)])])):d("",!0),e.manageRecettes?(l(),o("div",rs,[as,e.spentlines?(l(),o("table",ds,[s("tbody",null,[s("tr",null,[s("th",null,[i("Recette "),s("a",hs,n(t.synthesis.synthesis[1].nbr),1)]),s("td",us,n(e.$filters.money(t.synthesis.synthesis[1].total)),1)])])])):d("",!0)])):d("",!0),e.manageIgnored&&t.synthesis.synthesis[0].total!=0?(l(),o("div",cs,[s("a",{href:"#",onClick:h[3]||(h[3]=v(r=>e.displayIgnored=!e.displayIgnored,["prevent"]))},[e.displayIgnored?(l(),o("span",ys,[_s,i(" Cacher")])):(l(),o("span",fs,[ps,i(" Montrer")])),i(" les données ignorées ")]),e.spentlines&&e.displayIgnored?(l(),o("table",gs,[s("tbody",null,[s("tr",null,[s("th",null,[i(" Ignorées "),s("a",ms,n(t.synthesis.synthesis[0].nbr),1)]),s("td",bs,n(e.$filters.money(t.synthesis.synthesis[0].total)),1)])])])):d("",!0)])):d("",!0),s("small",null,[i("Données mise à jour : "),e.dateUpdated?(l(),o("strong",vs,n(e.dateUpdated.date|e.dateFull),1)):d("",!0)])])}const ks=M(N,[["render",Cs]]);let p=document.querySelector("#depenses2");const g=w(ks,{url:p.dataset.url,syncurl:p.dataset.syncurl});g.config.globalProperties.$filters={money:function(e){return I.money(e)}};g.mount("#depenses2");
