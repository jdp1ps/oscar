import{h as f,o as n,c as i,a as e,w as b,v as C,b as M,d as k,t as c,F as D,r as v,e as m,n as w,f as h,g as P,i as F,j as I,k as T,l as S,m as x,p as Y,q as O,s as E}from"../vendor.js";import{_ as R}from"../vendor2.js";f.locale("fr");const q={model:{prop:"modelValue",event:"update:modelValue"},props:{value:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:f().format(),pickerYearRef:f().format("YYYY"),pickerMonthRef:f().month(),realValue:this.value,manualChange:""}},computed:{years(){let s=this.pickerYearRef-11,t=this.pickerYearRef+11,d=[];for(var _=s;_<t;_++)d.push(_);return d},mmValue(){return this.realValue?(f.locale("fr"),f(this.realValue)):f()},pickerData(){var s=this.daysShort,t=f(this.realValue).format(this.valueFormat);let d=f(this.pickerDayRef).startOf("month").startOf("isoWeek"),_=f(this.pickerDayRef).endOf("month").startOf("isoWeek"),l=[];for(;d.unix()<=_.unix();){let r={num:d.week(),days:[]};for(let a=1;a<=7;a++){let g=!this.limitFrom||this.limitFrom&&this.limitFrom<d.format();r.days.push({enabled:g,date:d.format(),active:d.format(this.valueFormat)==t,day:d.format("D")}),d.add(1,"day")}l.push(r)}return{dayslabels:s,weeks:l}},currentMonth(){return f(this.pickerDayRef).format("MMMM")},currentYear(){return f(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(f.locale("fr"),f(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(s){console.log("convert ",s);try{let t=f(s,this.displayFormat);t.isValid()&&this.changeDate(t.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(s){try{var t=f(s.target.value);this.changeDate(t.format(this.valueFormat))}catch(d){console.error("WTF DATE",d)}},handlerSelectMonth(s){let t=this.months.indexOf(s);this.pickerDayRef=f(this.pickerDayRef).month(t).format(),this.pickerMode="day"},handlerSelectYear(s){this.pickerDayRef=f(this.pickerDayRef).year(s).format(),this.pickerMode="day"},changeDate(s){console.log("Modification de la date",s),this.picker=!1,this.realValue=s?f(s).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=f(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=f(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(s){s.preventDefault(),s.stopImmediatePropagation(),s.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(s){this.picker=!1},initPickerVar(){var s=f(this.pickerDayRef?this.pickerDayRef:f());this.pickerYearRef=s.year(),this.pickerMonthRef=s.format("MMMM")}},created(){f.locale(this.i18n),this.pickerDayRef=this.value?this.value:f().format(),this.initPickerVar()}},A={class:"input-group"},L=e("div",{class:"input-group-addon"},[e("i",{class:"icon-calendar"})],-1),W={class:"datepicker-wrapper"},z=e("i",{class:"icon-angle-left"},null,-1),J=[z],j={class:"heading"},H=e("i",{class:"icon-angle-right"},null,-1),X=[H],B={key:0,class:"day-labels week"},K=e("span",{class:"week-label"}," ",-1),G={class:"day-label"},Q={key:0},Z={class:"weeks"},$={class:"week"},ee={class:"week-label"},te=["onClick"],se={key:1,class:"months"},le=["onClick"],oe={key:2,class:"years"},ne=["onClick"],ie=e("i",{class:"icon-cancel-alt"},null,-1);function re(s,t,d,_,l,r){return n(),i("div",{onMouseenter:t[9]||(t[9]=(...a)=>r.handlerShow&&r.handlerShow(...a)),onMouseleave:t[10]||(t[10]=(...a)=>r.handlerHide&&r.handlerHide(...a))},[e("div",A,[b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=a=>r.renderValue=a)},null,512),[[C,r.renderValue]]),L]),b(e("div",{class:"datepicker-selector",onMouseleave:t[8]||(t[8]=(...a)=>r.handlerHide&&r.handlerHide(...a))},[e("div",W,[e("header",null,[e("nav",null,[e("span",{href:"#",onClick:t[1]||(t[1]=k((...a)=>r.pickerPrevMonth&&r.pickerPrevMonth(...a),["stop","prevent"]))},J),e("strong",j,[e("span",{class:"currentMonth",onClick:t[2]||(t[2]=k((...a)=>r.handlerPickerMonth&&r.handlerPickerMonth(...a),["stop"]))},c(r.currentMonth),1),e("span",{class:"currentYear",onClick:t[3]||(t[3]=k((...a)=>r.handlerPickerYear&&r.handlerPickerYear(...a),["stop"]))},c(r.currentYear),1)]),e("span",{href:"#",onClick:t[4]||(t[4]=k((...a)=>r.pickerNextMonth&&r.pickerNextMonth(...a),["stop"]))},X)]),l.pickerMode=="day"?(n(),i("div",B,[K,(n(!0),i(D,null,v(r.pickerData.dayslabels,a=>(n(),i("span",G,c(a),1))),256))])):m("",!0)]),l.pickerMode=="day"?(n(),i("section",Q,[(n(!0),i(D,null,v(r.pickerData.weeks,a=>(n(),i("div",Z,[e("span",$,[e("span",ee,c(a.num),1),(n(!0),i(D,null,v(a.days,g=>(n(),i("span",{class:w(["week-day",{active:g.active,disabled:!g.enabled}]),onClick:k(o=>r.changeDate(g.date),["prevent","stop"])},c(g.day),11,te))),256))])]))),256))])):m("",!0),l.pickerMode=="month"?(n(),i("section",se,[(n(!0),i(D,null,v(d.months,a=>(n(),i("span",{class:w(["month",{active:l.pickerMonthRef==a}]),onClick:k(g=>r.handlerSelectMonth(a),["prevent","stop"])},c(a),11,le))),256))])):m("",!0),l.pickerMode=="year"?(n(),i("section",oe,[e("span",{class:"year",onClick:t[5]||(t[5]=k(a=>l.pickerYearRef-=22,["prevent","stop"]))},"<<"),(n(!0),i(D,null,v(r.years,a=>(n(),i("span",{class:w(["year",{active:l.pickerYearRef==a}]),onClick:k(g=>r.handlerSelectYear(a),["prevent","stop"])},c(a),11,ne))),256)),e("span",{class:"year",onClick:t[6]||(t[6]=k(a=>l.pickerYearRef+=22,["prevent","stop"]))},">>")])):m("",!0)]),e("div",{style:{"text-align":"center",cursor:"pointer"},onClick:t[7]||(t[7]=(...a)=>r.handlerClear&&r.handlerClear(...a))},[ie,h(" Supprimer la date ")])],544),[[M,l.picker]])],32)}const ae=R(q,[["render",re]]);let U;const ce={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(s,t){s.length>=2&&(U&&clearTimeout(U),U=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,P.get(this.url+this.expression+"&f=json",{before(s){this.request&&this.request.abort(),this.request=s}}).then(s=>{console.log(s),this.persons=s.data.datas,this.showSelector=!0},s=>{console.log(s),s.status==403?this.error="403 Unauthorized":s.message?this.error="ERROR : "+s.message:s.body&&(this.error=s.body)}).then(s=>{this.loading=!1,this.request=null})},handlerSelectPerson(s){let t=this.persons.find(d=>d.id==s);console.log("handlerSelectPerson",t),this.selectedPerson=t,this.showSelector=!1,this.expression="",this.$emit("change",t)}}},de={key:0,class:"alert alert-danger"},ue=e("i",{class:"icon-spinner animate-spin"},null,-1),he=[ue],pe={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},me=["onClick"],_e={style:{display:"block",width:"50px",height:"50px"}},fe=["src","alt"],De={class:"infos"},ve={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},ye=e("br",null,null,-1),ke={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},be=e("i",{class:"icon-location"},null,-1),ge={key:0},we=e("br",null,null,-1),Ce={style:{"font-weight":"100","font-size":".8em"}},Me=e("i",{class:"icon-mail"},null,-1),xe={key:1,class:"alert alert-danger"},Te=e("i",{class:"icon-attention-1"},null,-1);function Se(s,t,d,_,l,r){return n(),i("div",null,[l.error?(n(),i("div",de,[h(c(l.error)+" ",1),e("button",{class:"btn btn-default",onClick:t[0]||(t[0]=a=>l.error="")},"Fermer")])):m("",!0),b(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>l.expression=a),onKeyup:t[2]||(t[2]=F(k((...a)=>r.search&&r.search(...a),["prevent"]),["enter"]))},null,544),[[C,l.expression]]),b(e("span",null,he,512),[[M,l.loading]]),b(e("div",pe,[(n(!0),i(D,null,v(l.persons,a=>(n(),i("div",{class:"choice",key:a.id,onClick:k(g=>r.handlerSelectPerson(a.id),["prevent","stop"])},[e("div",_e,[e("img",{src:"https://www.gravatar.com/avatar/"+a.mailMd5+"?s=50",alt:a.displayname,style:{width:"100%"}},null,8,fe)]),e("div",De,[e("strong",ve,c(a.displayname),1),ye,e("span",ke,[be,h(" "+c(a.affectation)+" ",1),a.ucbnSiteLocalisation?(n(),i("span",ge," ~ "+c(a.ucbnSiteLocalisation),1)):m("",!0)]),we,e("em",Ce,[Me,h(c(a.email),1)])])],8,me))),128))],512),[[M,l.persons.length>0&&l.showSelector]]),l.error?(n(),i("div",xe,[Te,h(" "+c(l.error),1)])):m("",!0)])}const Ue=R(ce,[["render",Se]]);const V="private",Ve={components:{"date-picker":ae,"person-auto-completer":Ue},props:{urlUploadNewDoc:{required:!0},url:{required:!0}},data(){return{idCurrentPerson:null,persons:[],computedDocuments:[],dateDeposit:"",dateSend:"",fileUrl:"",fileUrlLabel:"",privateDocument:!1,selectedIdTypeDocument:null,selectedIdTabDocument:null,informationsDocument:"",fileToDownload:null,uploadNewDocData:{dateDeposit:this.dateDeposit,dateSend:this.dateSend,private:this.privateDocument,type:this.selectedIdTypeDocument,tab:this.selectedIdTabDocument,informations:this.informationsDocument,persons:this.persons,baseUrlUpload:this.urlUploadNewDoc,url:"",init:!1},errorMessages:[],tabId:null,tabsWithDocuments:null,formData:null,error:null,deleteData:null,editData:null,uploadDoc:null,documents:[],loading:!0,sortField:"dateUpload",sortDirection:-1,editable:!0,remoterState:null,displayComputed:!1,processDetails:null,mode_url:!1,typesDocuments:[],selectedTab:null,selectedTabId:null}},computed:{selectedTypeDocument(){return this.selectedIdTypeDocument?(console.log(this.typesDocuments),this.typesDocuments.find(s=>s.id==this.selectedIdTypeDocument)):null},documentsPacked(){let s=[];return this.documents&&(s=this.documents.sort(function(d,_){return d[this.sortField]<_[this.sortField]?-1*this.sortDirection:d[this.sortField]>_[this.sortField]?1*this.sortDirection:0}.bind(this))),s},packedDocuments(){let s={};if(this.tabsWithDocuments)for(const[t,d]of Object.entries(this.tabsWithDocuments)){let _={};for(const[l,r]of Object.entries(d.documents)){let a=r.fileName;_.hasOwnProperty(a)?_[a].versions.push(r):(r.versions=[],_[a]=r)}s[t]={id:d.id,label:d.label,total:d.total,description:d.description,manage:d.manage,roles:d.roles,documents:_}}return s}},methods:{handlerProcessDetailsOn(s){this.processDetails=s},handlerProcessDetailsOff(){this.processDetails=null},activeTab(s){this.tabId=s},deleteDocument(s){this.deleteData=s},order:function(s){this.sortField==s?this.sortDirection*=-1:this.sortField=s},cssStepCurrent(s){return s===this.tabId?"current":""},cssSort:function(s){return s===this.sortField?"active":""},handlerEdit(s){console.log(JSON.parse(JSON.stringify(s)));let t=s.tabDocument;t==null||t.trim===""?t=V:t=t.id,this.persons=[],s.persons.forEach(d=>{this.persons.push(d)}),this.editData={documentype_id:s.category.id,basename:s.basename,document:s,tabDocument_id:t,private:s.private}},handlerSelectPersons(s){if(s.id){let t={personName:s.displayname,personId:s.id,affectation:s.affectation},d=s.id,_=!1;this.persons.forEach(function(l){l.personId===d&&(_=!0)}),_===!1&&this.persons.push(t)}},handlerDeletePerson(s){this.persons.splice(this.persons.indexOf(s),1)},handlerUploadNewDoc(s){this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=this.urlUploadNewDoc+"/"+s,this.initUploadDatas(s)},handlerNewVersion(s){console.log(JSON.parse(JSON.stringify(s))),this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=s.urlReupload,this.selectedIdTypeDocument=this.uploadNewDocData.selectedIdTypeDocument=s.category.id,this.uploadNewDocData.tab=s.tabDocument.id,this.privateDocument=this.uploadNewDocData.private=s.private,this.informationsDocument="",this.persons=[],s.persons.forEach(t=>{this.persons.push(t)}),this.uploadNewDocData.init=!0,this.fileToDownload=null},handlerUploadNewVersionDoc(s,t,d){this.uploadDoc=!0,this.uploadNewDocData.baseUrlUpload=t,this.selectedIdTypeDocument=d,this.initUploadDatas(s,d)},initUploadDatas(s,t=null){this.dateDeposit="",this.dateSend="";let d=!1;s===V&&(d=!0),this.privateDocument=d,this.selectedIdTypeDocument=t,this.informationsDocument="",this.fileUrl=this.uploadNewDocData.url="",this.fileUrlLabel="",this.persons=[],this.uploadNewDocData.init=!0,this.fileToDownload=null,this.uploadNewDocData.tab=s},uploadFile(s){s.target.files.length!==0&&(this.fileToDownload=s.target.files[0])},performUpload(){this.uploadNewDocData.dateDeposit=this.dateDeposit,this.uploadNewDocData.dateSend=this.dateSend,this.uploadNewDocData.private=this.privateDocument===!0?"1":"0",this.uploadNewDocData.type=this.selectedIdTypeDocument,this.uploadNewDocData.informations=this.informationsDocument;let s=[];this.persons.length!==0&&this.persons.forEach(function(d){s.push(d.personId)}),this.uploadNewDocData.persons=s;const t=new FormData;for(let d in this.uploadNewDocData){let _=this.uploadNewDocData[d];t.append(d,_)}this.mode_url?(t.append("url",this.fileUrl),t.append("label_url",this.fileUrlLabel)):this.fileToDownload!==null?t.append("file",this.fileToDownload,this.fileToDownload.name):this.errorMessages.push("Aucun fichier sélectionner a téléverser !"),this.uploadNewDocData.type===null&&this.errorMessages.push("Vous devez qualifier le type de votre document !"),this.errorMessages.length===0&&(this.uploadDoc=null,this.persons=[],console.log(this.uploadNewDocData.baseUrlUpload),P.post(this.uploadNewDocData.baseUrlUpload,t).then(d=>{console.log("SUCCESS ",d),this.fetch()},d=>{console.log("ERROR ",d),this.error=d.response.data}))},performEdit(){this.errorMessages=[];let s=[],t="",d=!0;if(this.editData.private===!0?(d=1,this.persons.length!==0&&this.persons.forEach(a=>{s.push(a.personId)})):(d=0,this.editData.tabDocument_id===V||this.editData.tabDocument_id===""?this.errorMessages.push("Vous devez sélectionner un onglet pour la modification (ce n'est pas un document qualifié privé)"):t=this.editData.tabDocument_id),this.errorMessages.length!==0)return;let _=this.editData.document.id,l=this.editData.documentype_id;this.editData=null,this.persons=[];let r=new FormData;r.append("documentId",_),r.append("type",l),r.append("tabDocument",t),r.append("private",d),r.append("persons",s)},handlerSuccess(s){console.log("handlerSuccess(",s);try{this.idCurrentPerson=s.data.idCurrentPerson;let t=Array.isArray(s.data.tabsWithDocuments)?{}:s.data.tabsWithDocuments,d=null,_=null;if(Object.keys(t).forEach(l=>{let r=t[l];r.total=r.documents.length,r.documents.sort((a,g)=>g.version-a.version),r.documents.forEach(a=>{console.log(a.fileName,a.version),a.explode=!0}),d==null&&(d=r.id),_==null&&r.documents.length>0&&(_=r.id)}),this.tabsWithDocuments=t,this.computedDocuments=s.data.computedDocuments,this.typesDocuments=s.data.typesDocuments,this.selectedTabId==null&&(this.selectedTabId=_||d),this.tabsWithDocuments.unclassified&&this.tabsWithDocuments.unclassified.documents.length)this.selectedTab=this.tabsWithDocuments.unclassified;else{let l=Object.keys(this.tabsWithDocuments)[0];l.length&&(this.selectedTab=this.tabsWithDocuments[l[0]])}}catch(t){console.log("Erreur de traitement ",t)}},handlerSelectTab(s){s=="computed"?(this.displayComputed=!0,this.selectedTab=null,this.selectedTabId=null):(this.displayComputed=!1,this.selectedTab=s,this.selectedTabId=s.id)},fetch(){console.log("fetch()"+this.url),P.get(this.url).then(s=>{this.handlerSuccess(s)})}},mounted(){this.fetch()}},p=s=>(Y("data-v-922561a1"),s=s(),O(),s),Ne={key:0,class:"overlay"},Pe={class:"overlay-content",style:{"max-width":"50%"}},Re={class:"alert-danger alert"},Ie=p(()=>e("i",{class:"icon-attention-1"},null,-1)),Fe=p(()=>e("i",{class:"icon-cancel-outline"},null,-1)),Ye={key:1,class:"overlay"},Oe={class:"overlay-content",style:{"max-width":"50%"}},Ee=p(()=>e("small",null,[e("i",{class:"icon-edit"}),h(" Procédure")],-1)),qe=p(()=>e("br",null,null,-1)),Ae=p(()=>e("br",null,null,-1)),Le={class:"signature-status-101"},We={class:"status"},ze={class:"metas"},Je={class:"meta"},je={class:"meta"},He={class:"fullname"},Xe={class:"email"},Be={class:"status"},Ke={class:"status-text"},Ge=p(()=>e("i",{class:"icon-cancel-outline"},null,-1)),Qe={style:{position:"relative","min-height":"100px"}},Ze={key:0,class:"overlay"},$e={class:"overlay-content"},et={class:"alert-danger alert"},tt=p(()=>e("i",{class:"icon-attention-1"},null,-1)),st=p(()=>e("i",{class:"icon-cancel-alt"},null,-1)),lt=["href"],ot=p(()=>e("i",{class:"icon-valid"},null,-1)),nt={key:1,class:"overlay"},it={class:"overlay-content"},rt=p(()=>e("i",{class:"icon-doc"},null,-1)),at={class:"row"},ct={class:"col-md-6"},dt=p(()=>e("label",{for:"typedocument"},"Type de document",-1)),ut=["selected","value"],ht={class:"col-md-6"},pt={class:"row",style:{"margin-top":"20px"}},mt={key:0},_t=p(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),ft=["selected","value"],Dt=p(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),vt={class:"col-md-6"},yt={key:0},kt=p(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),bt=p(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),gt=p(()=>e("i",{class:"icon-cube"},null,-1)),wt={key:0,class:"addon"},Ct=["onClick"],Mt={class:"row"},xt={class:"col-md-12"},Tt=p(()=>e("i",{class:"icon-cancel-alt"},null,-1)),St=p(()=>e("i",{class:"icon-valid"},null,-1)),Ut={key:2,class:"overlay"},Vt={class:"overlay-content"},Nt={class:"alert"},Pt={for:"switch_mode"},Rt={style:{width:"90%","margin-left":"5%"}},It={class:"row"},Ft={class:"col-md-6"},Yt={key:0},Ot=p(()=>e("label",{for:"url"},"URL du fichier",-1)),Et=p(()=>e("label",{for:"label"},"Description de l'URL",-1)),qt={key:1},At=p(()=>e("label",{for:"file"},"Fichier",-1)),Lt=p(()=>e("label",null,"Date de dépôt",-1)),Wt=p(()=>e("p",{class:"help"},"Date à laquelle le fichier a été reçu",-1)),zt=p(()=>e("label",null,"Date d'envoi",-1)),Jt=p(()=>e("p",{class:"help"},"Date à laquelle le fichier a été envoyé",-1)),jt={class:"col-md-6"},Ht=p(()=>e("label",{for:"type"},"Type de document",-1)),Xt=["value"],Bt={key:0},Kt=p(()=>e("h3",null,"Procédure de signature : ",-1)),Gt={class:"metas"},Qt={class:"meta"},Zt={class:"meta"},$t={class:"meta"},es={class:"recipient"},ts={class:"email"},ss={class:"fullname"},ls={key:1,class:"row",style:{"margin-top":"20px"}},os=p(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),ns={class:"col-md-6"},is={key:2,class:"alert alert-info"},rs={key:3},as=p(()=>e("h4",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),cs=p(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),ds=p(()=>e("i",{class:"icon-cube"},null,-1)),us={key:0,class:"addon"},hs=["onClick"],ps={class:"row"},ms={class:"col-md-12"},_s=p(()=>e("label",{for:"informations"},"Note",-1)),fs=p(()=>e("hr",null,null,-1)),Ds={class:"buttons text-center"},vs=p(()=>e("i",{class:"icon-cancel-alt"},null,-1)),ys=p(()=>e("i",{class:"icon-valid"},null,-1)),ks={key:3,class:"overlay"},bs={class:"overlay-content"},gs=p(()=>e("i",{class:"icon-cancel-alt"},null,-1)),ws={class:"documents-content"},Cs={class:"tabs"},Ms=["onClick"],xs={class:"label label-default"},Ts={class:"tab-content"},Ss={class:""},Us=p(()=>e("i",{class:"picto icon-doc"},null,-1)),Vs=p(()=>e("small",{class:"text-light"},"  (Document généré automatiquement) ",-1)),Ns={class:"text-right show-over"},Ps=["href"],Rs=p(()=>e("i",{class:"icon-upload-outline"},null,-1)),Is={class:"tab-content"},Fs={key:0,class:"text-right"},Ys=["onClick"],Os=p(()=>e("i",{class:"icon-download"},null,-1)),Es=p(()=>e("hr",null,null,-1)),qs={class:""},As={key:0,class:"picto icon-anchor-outline"},Ls={class:"text-light"},Ws=["title"],zs={key:0},Js=p(()=>e("i",{class:"icon-lock"},null,-1)),js={class:"cartouche"},Hs={class:"card-content"},Xs={key:0,class:"alert alert-info"},Bs=["onClick"],Ks={key:1},Gs=p(()=>e("div",{class:"exploder"}," Versions précédentes : ",-1)),Qs={class:"subdoc text-highlight"},Zs={key:0},$s=["href"],el=p(()=>e("i",{class:"icon-download-outline"},null,-1)),tl={class:"text-right show-over"},sl=["href"],ll=p(()=>e("i",{class:"icon-link-ext"},null,-1)),ol=["href"],nl=p(()=>e("i",{class:"icon-upload-outline"},null,-1)),il=["onClick"],rl=p(()=>e("i",{class:"icon-download-outline"},null,-1)),al=["onClick"],cl=p(()=>e("i",{class:"icon-trash"},null,-1)),dl=["onClick"],ul=p(()=>e("i",{class:"icon-pencil"},null,-1));function hl(s,t,d,_,l,r){const a=I("person-auto-completer"),g=I("date-picker");return n(),i(D,null,[l.error?(n(),i("div",Ne,[e("div",Pe,[e("h2",null,[h(" Erreur "),e("span",{class:"overlay-closer",onClick:t[0]||(t[0]=o=>l.error=null)},"X")]),e("p",Re,[Ie,h(c(l.error),1)]),e("button",{class:"btn btn-default",onClick:t[1]||(t[1]=o=>l.error=null)},[Fe,h(" Fermer ")])])])):m("",!0),l.processDetails?(n(),i("div",Ye,[e("div",Oe,[e("h2",null,[Ee,h(),qe,e("strong",null,c(l.processDetails.label),1),h(),Ae,e("span",Le,[h(c(l.processDetails.status_text)+" - ",1),e("em",null,"étape "+c(l.processDetails.current_step)+" / "+c(l.processDetails.total_steps),1)]),e("span",{class:"overlay-closer",onClick:t[2]||(t[2]=(...o)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...o))},"X")]),(n(!0),i(D,null,v(l.processDetails.steps,o=>(n(),i("section",{class:w(["signature","signature-status-"+o.status])},[e("h4",null,[e("small",null,"étape "+c(o.order)+" : ",1),e("strong",null,c(o.label),1),e("span",We," ("+c(o.status_text)+")",1)]),e("ul",ze,[e("li",Je,[h("Parapheur "),e("strong",null,c(o.letterfile),1)]),e("li",je,[h("Niveau "),e("strong",null,c(o.level),1)])]),(n(!0),i(D,null,v(o.recipients,u=>(n(),i("article",{class:w(["recipient","signature-status-"+u.status])},[e("strong",He,c(u.fullname),1),e("em",Xe,c(u.email),1),e("span",Be,[e("span",Ke,c(u.status_text),1)])],2))),256))],2))),256)),e("button",{class:"btn btn-default",onClick:t[3]||(t[3]=(...o)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...o))},[Ge,h(" Fermer ")])])])):m("",!0),e("section",Qe,[l.deleteData?(n(),i("div",Ze,[e("div",$e,[e("h2",null,[h(" Suppression du fichier ? "),e("span",{class:"overlay-closer",onClick:t[4]||(t[4]=o=>l.deleteData=null)},"X")]),e("p",et,[tt,h(" Souhaitez-vous supprimer le fichier "),e("strong",null,c(l.deleteData.fileName),1),h(" ? ")]),e("button",{class:"btn btn-danger",onClick:t[5]||(t[5]=o=>l.deleteData=null)},[st,h(" Annuler ")]),e("a",{class:"btn btn-success",href:l.deleteData.urlDelete},[ot,h(" Confirmer ")],8,lt)])])):m("",!0),l.editData?(n(),i("div",nt,[e("div",it,[e("h2",null,[h(" Modification du document : "),rt,h(" "+c(l.editData.basename)+" ",1),e("span",{class:"overlay-closer",onClick:t[6]||(t[6]=o=>l.editData=null)},"X")]),e("div",at,[e("div",ct,[dt,e("div",null,[b(e("select",{name:"type",id:"typedocument","onUpdate:modelValue":t[7]||(t[7]=o=>l.editData.documentype_id=o)},[(n(!0),i(D,null,v(s.documentTypes,(o,u)=>(n(),i("option",{selected:l.editData.documentype_id==u,value:u,key:u},c(o),9,ut))),128))],512),[[T,l.editData.documentype_id]])])]),e("div",ht,[e("div",pt,[l.editData.private===!1?(n(),i("span",mt,[_t,e("div",null,[b(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":t[8]||(t[8]=o=>l.editData.tabDocument_id=o)},[s.tabDoc.manage===!0&&s.tabDoc.id!="private"?(n(!0),i(D,{key:0},v(l.tabsWithDocuments,(o,u)=>(n(),i("option",{selected:l.editData.tabDocument_id==u,value:u,key:u},c(o.label),9,ft))),128)):m("",!0)],512),[[T,l.editData.tabDocument_id]])])])):m("",!0),Dt,e("div",vt,[b(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=o=>l.editData.private=o)},null,512),[[S,l.editData.private]])])]),l.editData.private===!0?(n(),i("span",yt,[kt,bt,x(a,{onChange:r.handlerSelectPersons},null,8,["onChange"]),l.persons.length!==0?(n(!0),i(D,{key:0},v(l.persons,o=>(n(),i("span",{key:o.personId,class:"cartouche"},[gt,e("span",null,c(o.personName),1),o.affectation.trim()!==""?(n(),i("span",wt,c(o.affectation),1)):m("",!0),o.personId!==l.idCurrentPerson?(n(),i("i",{key:1,onClick:u=>r.handlerDeletePerson(o),class:"icon-trash icon-clickable"},null,8,Ct)):m("",!0)]))),128)):m("",!0)])):m("",!0)])]),e("div",Mt,[e("div",xt,[e("button",{class:"btn btn-danger",onClick:t[10]||(t[10]=o=>l.editData=null)},[Tt,h(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:t[11]||(t[11]=k(o=>r.performEdit(),["prevent"]))},[St,h(" Enregistrer ")])])])])])):m("",!0),l.uploadDoc?(n(),i("div",Ut,[e("div",Vt,[e("h2",null,[h(" Téléverser un nouveau document dans "),e("strong",null,c(l.selectedTab.label),1),e("span",{class:"overlay-closer",onClick:t[12]||(t[12]=o=>l.uploadDoc=null)},"X")]),e("div",Nt,[e("label",Pt,[h(" Cochez cette case si le fichier est un URL "),b(e("input",{type:"checkbox",name:"switch_mode","onUpdate:modelValue":t[13]||(t[13]=o=>l.mode_url=o)},null,512),[[S,l.mode_url]])])]),e("div",Rt,[h(c()+" ",1),e("div",It,[e("div",Ft,[l.mode_url?(n(),i("div",Yt,[Ot,b(e("input",{type:"text",class:"form-control",name:"url",id:"url",placeholder:"Lien vers la ressource","onUpdate:modelValue":t[14]||(t[14]=o=>l.fileUrl=o)},null,512),[[C,l.fileUrl]]),Et,b(e("input",{type:"text",class:"form-control",name:"label",id:"label",placeholder:"Description rapide de la ressource","onUpdate:modelValue":t[15]||(t[15]=o=>l.fileUrlLabel=o)},null,512),[[C,l.fileUrlLabel]])])):(n(),i("div",qt,[At,e("input",{onChange:t[16]||(t[16]=(...o)=>r.uploadFile&&r.uploadFile(...o)),type:"file",class:"form-control",name:"file",id:"file"},null,32)])),Lt,Wt,x(g,{modelValue:l.dateDeposit,"onUpdate:modelValue":t[17]||(t[17]=o=>l.dateDeposit=o)},null,8,["modelValue"]),zt,Jt,x(g,{modelValue:l.dateSend,"onUpdate:modelValue":t[18]||(t[18]=o=>l.dateSend=o)},null,8,["modelValue"])]),e("div",jt,[Ht,b(e("select",{"onUpdate:modelValue":t[19]||(t[19]=o=>l.selectedIdTypeDocument=o),name:"type",id:"type",class:"form-control"},[(n(!0),i(D,null,v(l.typesDocuments,o=>(n(),i("option",{value:o.id,key:o.id},c(o.label),9,Xt))),128))],512),[[T,l.selectedIdTypeDocument]]),r.selectedTypeDocument&&r.selectedTypeDocument.flow?(n(),i("section",Bt,[Kt,(n(!0),i(D,null,v(r.selectedTypeDocument.flow,o=>(n(),i("article",{key:o.id,class:"signature"},[e("h2",null,c(o.label),1),(n(!0),i(D,null,v(o.steps,u=>(n(),i("article",null,[e("ul",Gt,[e("li",Qt,[h("Parapheur: "),e("strong",null,c(u.letterfile_label),1)]),e("li",Zt,[h("Type: "),e("strong",null,c(u.level_label),1)]),e("li",$t,[h("Tous signent: "),e("strong",null,c(u.allSignToComplete?"Oui":"non"),1)])]),(n(!0),i(D,null,v(u.recipients,y=>(n(),i("div",es,[e("strong",ts,c(y.email),1),e("span",ss,c(y.firstname)+" "+c(y.lastname),1)]))),256))]))),256))]))),128))])):m("",!0),l.mode_url!=!0?(n(),i("div",ls,[os,e("div",ns,[b(e("input",{type:"checkbox",name:"private",id:"private",class:"form-control","onUpdate:modelValue":t[20]||(t[20]=o=>l.privateDocument=o)},null,512),[[S,l.privateDocument]])])])):(n(),i("div",is," Les URL ne peuvent pas être définie comme privée dans Oscar ")),l.privateDocument===!0?(n(),i("span",rs,[as,cs,x(a,{onChange:r.handlerSelectPersons},null,8,["onChange"]),l.persons.length!==0?(n(!0),i(D,{key:0},v(l.persons,o=>(n(),i("span",{key:o.personId,class:"cartouche"},[ds,e("span",null,c(o.personName),1),o.affectation.trim()!=""?(n(),i("span",us,c(o.affectation),1)):m("",!0),o.affectation.trim()===""?(n(),i("i",{key:1,onClick:u=>r.handlerDeletePerson(o),class:"icon-trash icon-clickable"},null,8,hs)):m("",!0)]))),128)):m("",!0)])):m("",!0)]),e("div",ps,[e("div",ms,[_s,b(e("textarea",{"onUpdate:modelValue":t[21]||(t[21]=o=>l.informationsDocument=o),name:"informations",id:"informations",class:"form-control",cols:"30",rows:"10"},null,512),[[C,l.informationsDocument]])])]),fs,e("nav",Ds,[e("button",{class:"btn btn-danger",onClick:t[22]||(t[22]=o=>l.uploadDoc=null)},[vs,h(" Annuler ")]),e("button",{class:"btn btn-success",href:"#",onClick:t[23]||(t[23]=k(o=>r.performUpload(),["prevent"]))},[ys,h(" Enregistrer ")])])])])])])):m("",!0),l.errorMessages.length!==0?(n(),i("div",ks,[e("div",bs,[e("h2",null,[e("span",{class:"overlay-closer",onClick:t[24]||(t[24]=o=>l.errorMessages=[])},"X")]),e("ul",null,[(n(!0),i(D,null,v(l.errorMessages,o=>(n(),i("li",null,c(o),1))),256))]),e("button",{class:"btn btn-danger",onClick:t[25]||(t[25]=o=>l.errorMessages=[])},[gs,h(" Retour ")])])])):m("",!0),e("section",ws,[e("div",Cs,[(n(!0),i(D,null,v(r.packedDocuments,o=>(n(),i("div",{class:w(["tab",{selected:l.selectedTabId===o.id}]),onClick:k(u=>r.handlerSelectTab(o),["prevent"])},[h(c(o.label)+" ",1),e("sup",xs,c(o.total),1)],10,Ms))),256)),e("div",{class:w(["tab",{selected:l.displayComputed}]),onClick:t[26]||(t[26]=k(o=>r.handlerSelectTab("computed"),["prevent"]))}," Documents générés ",2)]),b(e("div",Ts,[(n(!0),i(D,null,v(l.computedDocuments,o=>(n(),i("article",{class:"card xs",key:o.key},[e("div",Ss,[Us,e("strong",null,c(o.label),1),Vs]),e("nav",Ns,[e("a",{class:"btn btn-default btn-xs",href:o.url},[Rs,h(" Télécharger ")],8,Ps)])]))),128))],512),[[M,l.displayComputed]]),(n(!0),i(D,null,v(r.packedDocuments,o=>b((n(),i("div",Is,[o.manage?(n(),i("nav",Fs,[o.manage?(n(),i("button",{key:0,onClick:u=>r.handlerUploadNewDoc(o.id),class:"btn btn-xs btn-default"},[Os,h(" Téléverser un document ")],8,Ys)):m("",!0)])):m("",!0),Es,(n(!0),i(D,null,v(o.documents,u=>(n(),i("article",{class:w(["card xs",{"private-document":u.private}]),key:u.id},[e("div",qs,[u.location=="link"?(n(),i("i",As)):(n(),i("i",{key:1,class:w(["picto icon-doc","doc"+u.extension])},null,2)),e("small",Ls,c(u.category.label)+" ~ ",1),e("strong",null,c(u.fileName),1),u.location!="url"?(n(),i("small",{key:2,class:"text-light",title:u.fileSize+" octet(s)"},"  ("+c(u.fileSize|s.filesize)+") - Version "+c(u.version),9,Ws)):m("",!0)]),u.private?(n(),i("section",zs,[Js,h(" Ce document est privé, accessible par : "),(n(!0),i(D,null,v(u.persons,y=>(n(),i("span",js,c(y.personName),1))),256))])):m("",!0),e("p",null,c(u.information),1),e("div",Hs,[u.process&&u.process.status!=200?(n(),i("section",Xs,[h(" Procédure de signature "),e("em",null,c(u.process.label),1),h(" - "),e("strong",null,c(u.process.status_text),1),h(" - "),e("span",null,"étape "+c(u.process.current_step)+" / "+c(u.process.total_steps),1),h(" - "),e("button",{class:"btn btn-xs btn-info",onClick:y=>r.handlerProcessDetailsOn(u.process)}," Détails ",8,Bs)])):m("",!0),u.versions.length?(n(),i("div",Ks,[Gs,(n(!0),i(D,null,v(u.versions,y=>(n(),i("article",Qs,[e("i",{class:w(["picto icon-doc","doc"+y.extension])},null,2),e("strong",null,c(y.fileName),1),h(" version "),e("em",null,c(y.version),1),h(", téléchargé le "),e("time",null,c(y.dateUpload|s.dateFullSort),1),y.uploader?(n(),i("span",Zs,[h(" par "),e("strong",null,c(y.uploader.displayname),1)])):m("",!0),e("a",{href:y.urlDownload},[el,h(" Télécharger cette version ")],8,$s)]))),256))])):m("",!0),e("nav",tl,[u.location=="url"?(n(),i("a",{key:0,class:"btn btn-default btn-xs",href:u.basename,target:"_blank"},[ll,h(" Accéder au lien ")],8,sl)):m("",!0),u.urlDownload&&u.location!="url"?(n(),i("a",{key:1,class:"btn btn-default btn-xs",href:u.urlDownload},[nl,h(" Télécharger ")],8,ol)):m("",!0),o.manage&&u.location!="url"?(n(),i("button",{key:2,onClick:y=>r.handlerNewVersion(u),class:"btn btn-default btn-xs"},[rl,h(" Nouvelle Version ")],8,il)):m("",!0),o.manage?(n(),i("a",{key:3,class:"btn btn-default btn-xs",onClick:k(y=>r.deleteDocument(u),["prevent"])},[cl,h(" Supprimer ")],8,al)):m("",!0),o.manage&&u.location!="url"?(n(),i("a",{key:4,class:"btn btn-xs btn-default",href:"#",onClick:k(y=>r.handlerEdit(u),["prevent"])},[ul,h(" Modifier ")],8,dl)):m("",!0)])])],2))),128))],512)),[[M,l.selectedTabId===o.id]])),256))])])],64)}const pl=R(Ve,[["render",hl],["__scopeId","data-v-922561a1"]]);let N=document.querySelector("#activitydocuments");const ml=E(pl,{url:N.dataset.url,urlUploadNewDoc:N.dataset.urlUploadNewDoc,manage:N.dataset.manage});ml.mount("#activitydocuments");
