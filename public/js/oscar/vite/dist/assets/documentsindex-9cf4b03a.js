import{a as b,r as D,c as r,b as e,t as u,w as p,i as k,v as g,F as T,f as F,e as d,d as h,g as S,o as l,q as x}from"../vendor.js";import{D as A,m as f,f as C}from"../vendor2.js";import{_ as N}from"../vendor4.js";import"../vendor3.js";var m=null;const V={components:{DocumentsList:A},props:{manage:{default:!1},url:{required:!0}},data(){return{documents:[],tabsWithDocuments:[],typesDocuments:[],totalDocuments:0,totalPages:0,currentPage:1,loading:!0,error:null,filterType:null,filterActivity:"",filterSign:""}},computed:{displayedPages(){},filtersTypes(){let t={};return this.typesDocuments.forEach(s=>{t[s.id]=s.label}),t},packedDocuments(){let t={};if(this.documents)for(const[s,a]of Object.entries(this.documents)){let c=a.fileName;t.hasOwnProperty(c)?t[c].versions.push(a):(a.versions=[],t[c]=a)}return t}},methods:{onResponse(t){this.tabsWithDocuments=t.data.tabsWithDocuments,this.typesDocuments=t.data.typesDocuments,this.documents=t.data.documents,this.totalPages=t.data.total_pages,this.totalDocuments=t.data.total,this.currentPage=t.data.page,this.loading=!1},fetch(t=!1,s=null){let a=this.currentPage;this.loading=!0,t?a=1:s!==null&&(a=s),b.get(this.url+"&page="+a+"&type="+this.filterType+"&sign="+this.filterSign+"&s="+this.filterActivity).then(c=>{this.onResponse(c)},c=>{this.error=c})},fetchPage(t){this.fetch(!1,t)},fetchFiltered(){this.fetch(!0,!1)},handlerInput(t){m&&clearTimeout(m),m=setTimeout(()=>{this.fetchFiltered(),clearTimeout(m)},1e3)}},mounted(){this.fetch()}},I={class:"documents-content"},R={class:"documents-pager"},W={class:"row"},q={class:"col-md-6"},w={class:"input-group"},z=e("span",{class:"input-group-addon"},[e("i",{class:"icon-cubes"}),h(" Recherche textuelle ")],-1),B={class:"col-md-3"},O={class:"input-group"},U=e("span",{class:"input-group-addon"},[e("i",{class:"icon-tag"}),h(" Type ")],-1),j=e("option",{value:"0"},"Ignorer",-1),E=["value"],L={class:"col-md-3"},M={class:"input-group"},K=e("span",{class:"input-group-addon"},[e("i",{class:"icon-edit"}),h(" Signature ")],-1),G=e("option",{value:""},"Ignorer",-1),H=e("option",{value:"1"},"Avec",-1),J=e("option",{value:"0"},"Sans",-1),Q=[G,H,J],X={"aria-label":"Page navigation"},Y={class:"pagination"},Z={key:0,class:"page-item"},$=e("span",{"aria-hidden":"true"},"««",-1),ee=[$],te={key:1,class:"page-item"},se=e("span",{"aria-hidden":"true"},"«",-1),ie=[se],oe={class:"page-item"},ne={href:"#","aria-label":"infos"},re=e("span",{"aria-hidden":"true"},"»",-1),le=[re],ae=e("span",{"aria-hidden":"true"},"»»",-1),ce=[ae],ue={key:0,class:"card card-danger"},de=e("i",{class:"icon-attention-1"},null,-1),he={key:1,class:"card text-center"},me=e("i",{class:"icon-spinner animate-spin"},null,-1),pe={key:2,class:"tab-content"};function fe(t,s,a,c,i,n){const y=D("documents-list");return l(),r("section",I,[e("div",R,u(i.filterActivity),1),e("div",W,[e("div",q,[e("div",w,[z,p(e("input",{type:"text",placeholder:"Recherche dans l'activité",class:"form-control",onInput:s[0]||(s[0]=(...o)=>n.handlerInput&&n.handlerInput(...o)),"onUpdate:modelValue":s[1]||(s[1]=o=>i.filterActivity=o)},null,544),[[k,i.filterActivity]])])]),e("div",B,[e("div",O,[U,p(e("select",{name:"filterType",id:"filterType","onUpdate:modelValue":s[2]||(s[2]=o=>i.filterType=o),class:"form-control",onChange:s[3]||(s[3]=(...o)=>n.fetchFiltered&&n.fetchFiltered(...o))},[j,(l(!0),r(T,null,F(n.filtersTypes,(o,P)=>(l(),r("option",{value:P},u(o),9,E))),256))],544),[[g,i.filterType]])])]),e("div",L,[e("div",M,[K,p(e("select",{name:"filterSign",id:"filterSign","onUpdate:modelValue":s[4]||(s[4]=o=>i.filterSign=o),class:"form-control",onChange:s[5]||(s[5]=(...o)=>n.fetchFiltered&&n.fetchFiltered(...o))},Q,544),[[g,i.filterSign]])])])]),e("nav",X,[e("ul",Y,[i.currentPage>10?(l(),r("li",Z,[e("a",{href:"#","aria-label":"Previous",onClick:s[6]||(s[6]=o=>n.fetchPage(i.currentPage-10))},ee)])):d("",!0),i.currentPage>1?(l(),r("li",te,[e("a",{href:"#","aria-label":"Previous",onClick:s[7]||(s[7]=o=>n.fetchPage(i.currentPage-1))},ie)])):d("",!0),e("li",oe,[e("a",ne,u(i.totalDocuments)+" document(s) au total / page "+u(i.currentPage)+" sur "+u(i.totalPages),1)]),e("li",null,[i.currentPage<i.totalPages?(l(),r("a",{key:0,href:"#","aria-label":"Next",onClick:s[8]||(s[8]=o=>n.fetchPage(i.currentPage+1))},le)):d("",!0)]),e("li",null,[i.currentPage<i.totalPages-10?(l(),r("a",{key:0,href:"#","aria-label":"Next",onClick:s[9]||(s[9]=o=>n.fetchPage(i.currentPage+10))},ce)):d("",!0)])])]),i.error?(l(),r("div",ue,[de,h(" "+u(i.error),1)])):d("",!0),i.loading?(l(),r("div",he,[me,h(" Chargement ici ")])):(l(),r("div",pe,[S(y,{documents:n.packedDocuments,tabs:i.tabsWithDocuments,types:i.typesDocuments,"display-button-sign":!1,"display-activity":!0,onFetch:n.fetch},null,8,["documents","tabs","types","onFetch"])]))])}const ge=N(V,[["render",fe]]);let _=document.querySelector("#documents");const v=x(ge,{url:_.dataset.url,manage:_.dataset.manage});v.config.globalProperties.$filters={timeAgo(t){return f.timeAgo(t)},date(t){return f.date(t)},dateFull(t){return f.dateFull(t)},filesize(t){return C.filesize(t)}};v.mount("#documents");
