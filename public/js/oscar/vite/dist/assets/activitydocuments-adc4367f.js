import{h as f,o as l,c as o,a as e,w,v as R,b as C,d as b,t as a,F as v,r as g,e as p,n as k,f as h,g as S,i as O,j as N,k as M,l as x,m as V,p as U,q as E,s as z}from"../vendor.js";import{m as T,f as A}from"../vendor2.js";import{_ as I}from"../vendor3.js";f.locale("fr");const W={model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:f().format(),pickerYearRef:f().format("YYYY"),pickerMonthRef:f().month(),realValue:this.modelValue,manualChange:""}},computed:{years(){let t=this.pickerYearRef-11,s=this.pickerYearRef+11,u=[];for(var _=t;_<s;_++)u.push(_);return u},mmValue(){return this.realValue?(f.locale("fr"),f(this.realValue)):f()},pickerData(){var t=this.daysShort,s=f(this.realValue).format(this.valueFormat);let u=f(this.pickerDayRef).startOf("month").startOf("isoWeek"),_=f(this.pickerDayRef).endOf("month").startOf("isoWeek"),n=[];for(;u.unix()<=_.unix();){let r={num:u.week(),days:[]};for(let d=1;d<=7;d++){let y=!this.limitFrom||this.limitFrom&&this.limitFrom<u.format();r.days.push({enabled:y,date:u.format(),active:u.format(this.valueFormat)==s,day:u.format("D")}),u.add(1,"day")}n.push(r)}return{dayslabels:t,weeks:n}},currentMonth(){return f(this.pickerDayRef).format("MMMM")},currentYear(){return f(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(f.locale("fr"),f(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(t){console.log("convert ",t);try{let s=f(t,this.displayFormat);s.isValid()&&this.changeDate(s.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(t){try{var s=f(t.target.value);this.changeDate(s.format(this.valueFormat))}catch(u){console.error("WTF DATE",u)}},handlerSelectMonth(t){let s=this.months.indexOf(t);this.pickerDayRef=f(this.pickerDayRef).month(s).format(),this.pickerMode="day"},handlerSelectYear(t){this.pickerDayRef=f(this.pickerDayRef).year(t).format(),this.pickerMode="day"},changeDate(t){console.log("Modification de la date",t),this.picker=!1,this.realValue=t?f(t).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=f(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=f(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(t){t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(t){this.picker=!1},initPickerVar(){var t=f(this.pickerDayRef?this.pickerDayRef:f());this.pickerYearRef=t.year(),this.pickerMonthRef=t.format("MMMM")}},created(){f.locale(this.i18n),this.pickerDayRef=this.value?this.value:f().format(),this.initPickerVar()}},q={class:"input-group"},j=e("div",{class:"input-group-addon"},[e("i",{class:"icon-calendar"})],-1),B={class:"datepicker-wrapper"},H=e("i",{class:"icon-angle-left"},null,-1),J=[H],L={class:"heading"},X=e("i",{class:"icon-angle-right"},null,-1),K=[X],G={key:0,class:"day-labels week"},Q=e("span",{class:"week-label"}," ",-1),Z={class:"day-label"},$={key:0},ee={class:"weeks"},te={class:"week"},se={class:"week-label"},ne=["onClick"],le={key:1,class:"months"},oe=["onClick"],ie={key:2,class:"years"},re=["onClick"],ae=e("i",{class:"icon-cancel-alt"},null,-1);function ce(t,s,u,_,n,r){return l(),o("div",{onMouseenter:s[9]||(s[9]=(...d)=>r.handlerShow&&r.handlerShow(...d)),onMouseleave:s[10]||(s[10]=(...d)=>r.handlerHide&&r.handlerHide(...d))},[e("div",q,[w(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=d=>r.renderValue=d)},null,512),[[R,r.renderValue]]),j]),w(e("div",{class:"datepicker-selector",onMouseleave:s[8]||(s[8]=(...d)=>r.handlerHide&&r.handlerHide(...d))},[e("div",B,[e("header",null,[e("nav",null,[e("span",{href:"#",onClick:s[1]||(s[1]=b((...d)=>r.pickerPrevMonth&&r.pickerPrevMonth(...d),["stop","prevent"]))},J),e("strong",L,[e("span",{class:"currentMonth",onClick:s[2]||(s[2]=b((...d)=>r.handlerPickerMonth&&r.handlerPickerMonth(...d),["stop"]))},a(r.currentMonth),1),e("span",{class:"currentYear",onClick:s[3]||(s[3]=b((...d)=>r.handlerPickerYear&&r.handlerPickerYear(...d),["stop"]))},a(r.currentYear),1)]),e("span",{href:"#",onClick:s[4]||(s[4]=b((...d)=>r.pickerNextMonth&&r.pickerNextMonth(...d),["stop"]))},K)]),n.pickerMode=="day"?(l(),o("div",G,[Q,(l(!0),o(v,null,g(r.pickerData.dayslabels,d=>(l(),o("span",Z,a(d),1))),256))])):p("",!0)]),n.pickerMode=="day"?(l(),o("section",$,[(l(!0),o(v,null,g(r.pickerData.weeks,d=>(l(),o("div",ee,[e("span",te,[e("span",se,a(d.num),1),(l(!0),o(v,null,g(d.days,y=>(l(),o("span",{class:k(["week-day",{active:y.active,disabled:!y.enabled}]),onClick:b(i=>r.changeDate(y.date),["prevent","stop"])},a(y.day),11,ne))),256))])]))),256))])):p("",!0),n.pickerMode=="month"?(l(),o("section",le,[(l(!0),o(v,null,g(u.months,d=>(l(),o("span",{class:k(["month",{active:n.pickerMonthRef==d}]),onClick:b(y=>r.handlerSelectMonth(d),["prevent","stop"])},a(d),11,oe))),256))])):p("",!0),n.pickerMode=="year"?(l(),o("section",ie,[e("span",{class:"year",onClick:s[5]||(s[5]=b(d=>n.pickerYearRef-=22,["prevent","stop"]))},"<<"),(l(!0),o(v,null,g(r.years,d=>(l(),o("span",{class:k(["year",{active:n.pickerYearRef==d}]),onClick:b(y=>r.handlerSelectYear(d),["prevent","stop"])},a(d),11,re))),256)),e("span",{class:"year",onClick:s[6]||(s[6]=b(d=>n.pickerYearRef+=22,["prevent","stop"]))},">>")])):p("",!0)]),e("div",{style:{"text-align":"center",cursor:"pointer"},onClick:s[7]||(s[7]=(...d)=>r.handlerClear&&r.handlerClear(...d))},[ae,h(" Supprimer la date ")])],544),[[C,n.picker]])],32)}const de=I(W,[["render",ce]]);let F;const ue={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(t,s){t.length>=2&&(F&&clearTimeout(F),F=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,S.get(this.url+this.expression+"&f=json",{before(t){this.request&&this.request.abort(),this.request=t}}).then(t=>{console.log(t),this.persons=t.data.datas,this.showSelector=!0},t=>{console.log(t),t.status==403?this.error="403 Unauthorized":t.message?this.error="ERROR : "+t.message:t.body&&(this.error=t.body)}).then(t=>{this.loading=!1,this.request=null})},handlerSelectPerson(t){let s=this.persons.find(u=>u.id==t);console.log("handlerSelectPerson",s),this.selectedPerson=s,this.showSelector=!1,this.expression="",this.$emit("change",s)}}},he={key:0,class:"alert alert-danger"},me=e("i",{class:"icon-spinner animate-spin"},null,-1),pe=[me],_e={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},fe=["onClick"],ve={style:{display:"block",width:"50px",height:"50px"}},ge=["src","alt"],De={class:"infos"},be={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},ye=e("br",null,null,-1),ke={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},we=e("i",{class:"icon-location"},null,-1),Se={key:0},Ce=e("br",null,null,-1),Pe={style:{"font-weight":"100","font-size":".8em"}},Me=e("i",{class:"icon-mail"},null,-1),xe={key:1,class:"alert alert-danger"},Ve=e("i",{class:"icon-attention-1"},null,-1);function Te(t,s,u,_,n,r){return l(),o("div",null,[n.error?(l(),o("div",he,[h(a(n.error)+" ",1),e("button",{class:"btn btn-default",onClick:s[0]||(s[0]=d=>n.error="")},"Fermer")])):p("",!0),w(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=d=>n.expression=d),onKeyup:s[2]||(s[2]=O(b((...d)=>r.search&&r.search(...d),["prevent"]),["enter"]))},null,544),[[R,n.expression]]),w(e("span",null,pe,512),[[C,n.loading]]),w(e("div",_e,[(l(!0),o(v,null,g(n.persons,d=>(l(),o("div",{class:"choice",key:d.id,onClick:b(y=>r.handlerSelectPerson(d.id),["prevent","stop"])},[e("div",ve,[e("img",{src:"https://www.gravatar.com/avatar/"+d.mailMd5+"?s=50",alt:d.displayname,style:{width:"100%"}},null,8,ge)]),e("div",De,[e("strong",be,a(d.displayname),1),ye,e("span",ke,[we,h(" "+a(d.affectation)+" ",1),d.ucbnSiteLocalisation?(l(),o("span",Se," ~ "+a(d.ucbnSiteLocalisation),1)):p("",!0)]),Ce,e("em",Pe,[Me,h(a(d.email),1)])])],8,fe))),128))],512),[[C,n.persons.length>0&&n.showSelector]]),n.error?(l(),o("div",xe,[Ve,h(" "+a(n.error),1)])):p("",!0)])}const Fe=I(ue,[["render",Te]]);const Re="private",Ie={components:{"date-picker":de,"person-auto-completer":Fe},props:{urlUploadNewDoc:{required:!0},urlSignDocument:{required:!1},url:{required:!0}},data(){return{idCurrentPerson:null,persons:[],computedDocuments:[],dateDeposit:"",dateSend:"",fileUrl:"",fileUrlLabel:"",privateDocument:!1,selectedIdTypeDocument:null,selectedIdTabDocument:null,informationsDocument:"",fileToDownload:null,uploadNewDocData:{dateDeposit:this.dateDeposit,dateSend:this.dateSend,private:this.privateDocument,type:this.selectedIdTypeDocument,tab:this.selectedIdTabDocument,informations:this.informationsDocument,persons:this.persons,baseUrlUpload:this.urlUploadNewDoc,url:"",init:!1},errorMessages:[],tabId:null,tabsWithDocuments:null,formData:null,error:null,deleteData:null,editData:null,uploadDoc:null,documents:[],loading:!0,sortField:"dateUpload",sortDirection:-1,editable:!0,remoterState:null,displayComputed:!1,signDocument:null,signProcess:null,selectedSignProcess:null,signProcessError:"",editedDocument:null,mode:null,processDetails:null,mode_url:!1,typesDocuments:[],selectedTab:null,selectedTabId:null}},computed:{currentFlow(){if(this.editedDocument.category.id){let t=this.typesDocuments.find(s=>s.id==this.editedDocument.category.id);if(console.log(t),t.flow)return t.flow.signatureflow}return!1},selectedTypeDocument(){return this.selectedIdTypeDocument?(console.log(this.typesDocuments),this.typesDocuments.find(t=>t.id==this.selectedIdTypeDocument)):null},documentsPacked(){let t=[];return this.documents&&(t=this.documents.sort(function(u,_){return u[this.sortField]<_[this.sortField]?-1*this.sortDirection:u[this.sortField]>_[this.sortField]?1*this.sortDirection:0}.bind(this))),t},packedDocuments(){let t={};if(this.tabsWithDocuments)for(const[s,u]of Object.entries(this.tabsWithDocuments)){let _={};for(const[n,r]of Object.entries(u.documents)){let d=r.fileName;_.hasOwnProperty(d)?_[d].versions.push(r):(r.versions=[],_[d]=r)}t[s]={id:u.id,label:u.label,total:u.total,description:u.description,manage:u.manage,roles:u.roles,documents:_}}return t}},methods:{handlerPerformSignDocumentDisabled(t,s){if(!s||s.missing_recipients)return!0;for(let u=0;u<s.steps.length;u++){let _=s.steps[u],n=_.editable,r=0;for(let d=0;d<_.recipients.length;d++){let y=_.recipients[d];n?y.selected==!0&&r++:r++}if(r==0)return this.signProcessError="L'étape "+_.order+' "'+_.label+`" n'a pas de destinataire.`,!0}return this.signProcessError="",!1},handlerSelectProcess(t){this.signProcessError="",this.selectedSignProcess=t},handlerPerformSignDocument(t,s){let u=new FormData,_=this.urlSignDocument;return u.append("document_id",t.id),u.append("flow_datas",JSON.stringify(s)),S.post(_,u).then(n=>{console.log("SUCCESS",n),this.signDocument=null,this.selectedSignProcess=null,this.fetch()},n=>{console.log("ERROR",n),this.error=n.response.data?n.response.data:n.message}),!1},renderDate(t){return t?f(t).fromNow():"non précisé"},handlerProcessDetailsOn(t){this.processDetails=t},handlerProcessDetailsOff(){this.processDetails=null},activeTab(t){this.tabId=t},deleteDocument(t){this.deleteData=t},handlerSignDocument(t){this.signDocument=t},order:function(t){this.sortField==t?this.sortDirection*=-1:this.sortField=t},cssStepCurrent(t){return t===this.tabId?"current":""},cssSort:function(t){return t===this.sortField?"active":""},handlerEdit(t){this.editedDocument=t,this.mode="edit"},handlerSelectPersons(t){if(t.id){let s={personName:t.displayname,personId:t.id,affectation:t.affectation},u=t.id,_=!1;this.persons.forEach(function(n){n.personId===u&&(_=!0)}),_===!1&&(this.editedDocument?(this.editedDocument.persons||(this.editedDocument.persons=[]),this.editedDocument.persons.push(s)):this.persons.push(s))}},handlerDeletePerson(t){this.persons.splice(this.persons.indexOf(t),1)},handlerNew(t){this.mode="new",this.editedDocument={id:-1,version:1,information:"",fileName:"",process:!1,process_sendable:null,fileSize:0,typeMime:null,dateUpload:null,dateDeposit:null,dateSend:null,extension:null,category:{id:null},tabDocument:this.getTabById(t),private:!1,persons:[],location:"local",urlDelete:"",urlDownload:"",urlReupload:"",uploader:null,urlPerson:!1}},handlerNewVersion(t){this.mode="version",this.editedDocument=t},uploadFile(t){t.target.files.length!==0&&(this.fileToDownload=t.target.files[0])},handlerProcessReload(t){let s=new FormData;S.post(t.manage_process,s).then(u=>{this.fetch()},u=>{console.log("ERROR",u),this.error=u.response&&u.response.data?u.response.data:u})},applyEdit(){let t=new FormData,s="";if(t.append("data",JSON.stringify(this.editedDocument)),this.mode=="version"?(t.append("action","version"),s=this.editedDocument.urlReupload):this.mode=="new"?(t.append("action","new"),t.append("flow",""),s=this.urlUploadNewDoc):this.mode=="edit"&&(t.append("action","edit"),s=this.editedDocument.urlReupload),this.mode!="edit")if(this.fileToDownload!==null)t.append("file",this.fileToDownload,this.fileToDownload.name);else{this.error="Aucun fichier sélectionner a téléverser !";return}S.post(s,t).then(u=>{console.log("SUCCESS",u),this.editedDocument=null,this.fetch()},u=>{console.log("ERROR",u),this.error=u.response&&u.response.data?u.response.data:u})},performEdit(){this.errorMessages=[];let t=[],s="",u=!0;if(this.editData.private===!0?(u=1,this.persons.length!==0&&this.persons.forEach(d=>{t.push(d.personId)})):(u=0,this.editData.tabDocument_id===Re||this.editData.tabDocument_id===""?this.errorMessages.push("Vous devez sélectionner un onglet pour la modification (ce n'est pas un document qualifié privé)"):s=this.editData.tabDocument_id),this.errorMessages.length!==0)return;let _=this.editData.document.id,n=this.editData.documentype_id;this.editData=null,this.persons=[];let r=new FormData;r.append("documentId",_),r.append("type",n),r.append("tabDocument",s),r.append("private",u),r.append("persons",t)},getTabById(t){let s=this.tabsWithDocuments[t];return{id:s.id,label:s.label}},handlerSuccess(t){try{if(!t.data.idCurrentPerson)throw"Impossible de charger les documents, vérifiez que vous êtes toujours connecté";this.idCurrentPerson=t.data.idCurrentPerson;let s=Array.isArray(t.data.tabsWithDocuments)?{}:t.data.tabsWithDocuments,u=null,_=null;if(s)if(Object.keys(s).forEach(n=>{let r=s[n];r.total=r.documents.length,r.documents.sort((d,y)=>y.version-d.version),r.documents.forEach(d=>{console.log(d.fileName,d.version),d.explode=!0}),u==null&&(u=r.id),_==null&&r.documents.length>0&&(_=r.id)}),this.tabsWithDocuments=s,this.computedDocuments=t.data.computedDocuments,this.signProcess=t.data.process_datas,this.typesDocuments=t.data.typesDocuments,this.selectedTabId==null&&(this.selectedTabId=_||u),this.tabsWithDocuments.unclassified&&this.tabsWithDocuments.unclassified.documents.length)this.selectedTab=this.tabsWithDocuments.unclassified;else{let n=Object.keys(this.tabsWithDocuments)[0];n.length&&(this.selectedTab=this.tabsWithDocuments[n[0]])}else throw new Error("Vous n'avez pas accès aux documents")}catch(s){this.error=s}},handlerSelectTab(t){t=="computed"?(this.displayComputed=!0,this.selectedTab=null,this.selectedTabId=null):(this.displayComputed=!1,this.selectedTab=t,this.selectedTabId=t.id)},fetch(){console.log("fetch()"+this.url),S.get(this.url).then(t=>{console.log("OK"),console.log(t),this.handlerSuccess(t)},t=>{console.log("KO"),console.log(t),this.error=t})}},mounted(){this.fetch()}},m=t=>(U("data-v-5454207b"),t=t(),E(),t),Ne={key:0,class:"overlay",style:{"z-index":"101"}},Ye={class:"overlay-content",style:{"max-width":"50%"}},Oe={class:"alert-danger alert"},Ue=m(()=>e("i",{class:"icon-attention-1"},null,-1)),Ee=m(()=>e("i",{class:"icon-cancel-outline"},null,-1)),ze={key:1,class:"overlay"},Ae={class:"overlay-content",style:{"max-width":"50%"}},We=m(()=>e("small",null,[e("i",{class:"icon-edit"}),h(" Procédure")],-1)),qe=m(()=>e("br",null,null,-1)),je=m(()=>e("br",null,null,-1)),Be={class:"signature-status-101"},He={class:"status"},Je={class:"metas"},Le={class:"meta"},Xe={class:"meta"},Ke={class:"fullname"},Ge={class:"email"},Qe={class:"status"},Ze={class:"status-text"},$e=m(()=>e("strong",null,"Observateurs : ",-1)),et={class:"buttons-bar"},tt=m(()=>e("i",{class:"icon-cancel-outline"},null,-1)),st={style:{position:"relative","min-height":"100px"}},nt={key:0,class:"overlay"},lt={class:"overlay-content"},ot={class:"alert-danger alert"},it=m(()=>e("i",{class:"icon-attention-1"},null,-1)),rt=m(()=>e("i",{class:"icon-cancel-alt"},null,-1)),at=["href"],ct=m(()=>e("i",{class:"icon-valid"},null,-1)),dt={key:1,class:"overlay"},ut={class:"overlay-content"},ht=m(()=>e("i",{class:"icon-doc"},null,-1)),mt={key:0},pt={key:1},_t={key:2},ft=m(()=>e("br",null,null,-1)),vt={key:0},gt={key:1},Dt={class:"row"},bt={class:"col-md-6"},yt={key:0},kt=m(()=>e("label",{for:"file"},"Fichier",-1)),wt=m(()=>e("label",{for:"dateDeposit"},"Date de dépôt",-1)),St=m(()=>e("label",{for:"dateSend"},"Date d'envoi",-1)),Ct={class:"col-md-6"},Pt={key:0},Mt=m(()=>e("label",{for:"tabdocument"},"Onglet",-1)),xt=["value"],Vt={key:1},Tt=m(()=>e("label",{for:"typedocument"},"Type de document",-1)),Ft={key:0,class:"alert alert-warning"},Rt={key:1},It=["value","disabled"],Nt={class:"col-md-12"},Yt=m(()=>e("label",{for:"information"},"Informations",-1)),Ot={key:0,class:"col-md-6"},Ut={class:"row"},Et={key:0},zt=m(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),At=["value"],Wt=m(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),qt={class:"col-md-6"},jt={key:0},Bt=m(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),Ht=m(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),Jt=m(()=>e("i",{class:"icon-cube"},null,-1)),Lt={class:"addon"},Xt=["onClick"],Kt={class:"row"},Gt={class:"col-md-12"},Qt={class:"buttons-bar"},Zt=m(()=>e("i",{class:"icon-cancel-alt"},null,-1)),$t=m(()=>e("i",{class:"icon-valid"},null,-1)),es={key:2,class:"overlay"},ts={class:"overlay-content"},ss=["onClick"],ns=m(()=>e("br",null,null,-1)),ls={key:0},os=m(()=>e("small",null,"Procédure de signature",-1)),is=m(()=>e("br",null,null,-1)),rs={class:"metas"},as={class:"meta"},cs={class:"meta"},ds={class:"meta"},us={key:0,class:"alert alert-danger"},hs={class:"row"},ms={class:"col-md-6"},ps=m(()=>e("h5",null,"Destinataires",-1)),_s={class:"recipient"},fs=["onUpdate:modelValue"],vs={class:"email"},gs={class:"fullname"},Ds={class:"col-md-6"},bs=m(()=>e("h5",null,"Observateurs",-1)),ys={class:"recipient"},ks=["onUpdate:modelValue"],ws={class:"email"},Ss={class:"fullname"},Cs={key:1,class:"alert alert-info"},Ps={key:1,class:"alert alert-danger"},Ms={class:"buttons-bar"},xs=m(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Vs=m(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Ts={key:3,class:"overlay"},Fs={class:"overlay-content"},Rs=m(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Is={class:"documents-content"},Ns={class:"tabs"},Ys=["onClick"],Os={class:"label label-default"},Us={class:"tab-content"},Es={class:""},zs=m(()=>e("i",{class:"picto icon-doc"},null,-1)),As=m(()=>e("small",{class:"text-light"},"  (Document généré automatiquement) ",-1)),Ws={class:"text-right show-over"},qs=["href"],js=m(()=>e("i",{class:"icon-upload-outline"},null,-1)),Bs={class:"tab-content"},Hs={key:0,class:"text-right"},Js=["onClick"],Ls=m(()=>e("i",{class:"icon-download"},null,-1)),Xs=m(()=>e("hr",null,null,-1)),Ks={class:"card-title"},Gs={key:0,class:"picto icon-anchor-outline"},Qs={class:"text-light"},Zs=["title"],$s=m(()=>e("i",{class:"icon-briefcase"},null,-1)),en=m(()=>e("i",{class:"icon-calendar"},null,-1)),tn=m(()=>e("i",{class:"icon-calendar"},null,-1)),sn=m(()=>e("i",{class:"icon-calendar"},null,-1)),nn=m(()=>e("i",{class:"icon-user"},null,-1)),ln={key:0},on=m(()=>e("i",{class:"icon-lock"},null,-1)),rn={class:"cartouche"},an={class:"card-content"},cn=m(()=>e("i",{class:"icon-hammer"},null,-1)),dn=["onClick"],un=["onClick"],hn=m(()=>e("i",{class:"icon-cw-outline"},null,-1)),mn={key:1},pn=m(()=>e("div",{class:"exploder"}," Versions précédentes : ",-1)),_n={class:"subdoc text-highlight"},fn={key:0},vn=["href"],gn=m(()=>e("i",{class:"icon-download-outline"},null,-1)),Dn={class:"text-right show-over"},bn=["href"],yn=m(()=>e("i",{class:"icon-link-ext"},null,-1)),kn=["onClick"],wn=m(()=>e("i",{class:"icon-bank"},null,-1)),Sn=["href"],Cn=m(()=>e("i",{class:"icon-upload-outline"},null,-1)),Pn=["onClick"],Mn=m(()=>e("i",{class:"icon-download-outline"},null,-1)),xn=["onClick"],Vn=m(()=>e("i",{class:"icon-trash"},null,-1)),Tn=["onClick"],Fn=m(()=>e("i",{class:"icon-pencil"},null,-1));function Rn(t,s,u,_,n,r){const d=N("date-picker"),y=N("person-auto-completer");return l(),o(v,null,[n.error?(l(),o("div",Ne,[e("div",Ye,[e("h2",null,[h(" Erreur documents "),e("span",{class:"overlay-closer",onClick:s[0]||(s[0]=i=>n.error=null)},"X")]),e("p",Oe,[Ue,h(a(n.error),1)]),e("button",{class:"btn btn-default",onClick:s[1]||(s[1]=i=>n.error=null)},[Ee,h(" Fermer ")])])])):p("",!0),n.processDetails?(l(),o("div",ze,[e("div",Ae,[e("h2",null,[We,h(),qe,e("strong",null,a(n.processDetails.label),1),h(),je,e("span",Be,[h(a(n.processDetails.status_text)+" - ",1),e("em",null,"étape "+a(n.processDetails.current_step)+" / "+a(n.processDetails.total_steps),1)]),e("span",{class:"overlay-closer",onClick:s[2]||(s[2]=(...i)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...i))},"X")]),(l(!0),o(v,null,g(n.processDetails.steps,i=>(l(),o("section",{class:k(["signature","signature-status-"+i.status])},[e("h4",null,[e("small",null,"étape "+a(i.order)+" : ",1),e("strong",null,a(i.label),1),e("span",He," ("+a(i.status_text)+")",1)]),e("ul",Je,[e("li",Le,[h("Parapheur "),e("strong",null,a(i.letterfile),1)]),e("li",Xe,[h("Niveau "),e("strong",null,a(i.level),1)])]),(l(!0),o(v,null,g(i.recipients,c=>(l(),o("article",{class:k(["recipient","signature-status-"+c.status])},[e("strong",Ke,a(c.fullname),1),e("em",Ge,a(c.email),1),e("small",null,a(t.$filters.dateFull(c.dateFinished)),1),e("span",Qe,[e("span",Ze,a(c.status_text),1)])],2))),256)),$e,(l(!0),o(v,null,g(i.observers,c=>(l(),o("span",null,[e("small",null,a(c.firstname),1),h(),e("span",null,a(c.lastname),1)]))),256))],2))),256)),e("div",et,[e("button",{class:"btn btn-default",onClick:s[3]||(s[3]=(...i)=>r.handlerProcessDetailsOff&&r.handlerProcessDetailsOff(...i))},[tt,h(" Fermer ")])])])])):p("",!0),e("section",st,[n.deleteData?(l(),o("div",nt,[e("div",lt,[e("h2",null,[h(" Suppression du fichier ? "),e("span",{class:"overlay-closer",onClick:s[4]||(s[4]=i=>n.deleteData=null)},"X")]),e("p",ot,[it,h(" Souhaitez-vous supprimer le fichier "),e("strong",null,a(n.deleteData.fileName),1),h(" ? ")]),e("button",{class:"btn btn-danger",onClick:s[5]||(s[5]=i=>n.deleteData=null)},[rt,h(" Annuler ")]),e("a",{class:"btn btn-success",href:n.deleteData.urlDelete},[ct,h(" Confirmer ")],8,at)])])):p("",!0),n.editedDocument?(l(),o("div",dt,[e("div",ut,[e("h2",null,[e("small",null,[ht,n.mode=="new"?(l(),o("span",mt,"Téléversement d'un document")):p("",!0),n.mode=="edit"?(l(),o("span",pt,"Modification des informations")):p("",!0),n.mode=="version"?(l(),o("span",_t,"Nouvelle version")):p("",!0)]),ft,n.editedDocument.id>0?(l(),o("span",vt,[e("strong",null,a(n.editedDocument.fileName),1)])):(l(),o("span",gt,[h(" Nouveau document dans "),e("strong",null,a(n.editedDocument.tabDocument.label),1)])),e("span",null," ("+a(n.mode)+") ",1),e("span",{class:"overlay-closer",onClick:s[6]||(s[6]=i=>n.editedDocument=null)},"X")]),e("div",Dt,[e("div",bt,[n.mode!="edit"?(l(),o("div",yt,[kt,e("input",{onChange:s[7]||(s[7]=(...i)=>r.uploadFile&&r.uploadFile(...i)),type:"file",class:"form-control",name:"file",id:"file"},null,32)])):p("",!0),e("div",null,[wt,M(d,{modelValue:n.editedDocument.dateDeposit,"onUpdate:modelValue":s[8]||(s[8]=i=>n.editedDocument.dateDeposit=i),id:"dateDeposit"},null,8,["modelValue"])]),e("div",null,[St,M(d,{modelValue:n.editedDocument.dateSend,"onUpdate:modelValue":s[9]||(s[9]=i=>n.editedDocument.dateSend=i),id:"dateSend"},null,8,["modelValue"])])]),e("div",Ct,[n.mode!="version"?(l(),o("div",Pt,[Mt,e("div",null,[w(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":s[10]||(s[10]=i=>n.editedDocument.tabDocument.id=i),class:"form-control"},[(l(!0),o(v,null,g(n.tabsWithDocuments,(i,c)=>(l(),o("option",{value:c,key:c},a(i.label),9,xt))),128))],512),[[x,n.editedDocument.tabDocument.id]])])])):p("",!0),n.mode!="version"?(l(),o("div",Vt,[Tt,n.editedDocument.process?(l(),o("div",Ft," Vous ne pouvez pas modifier le type d'un document engagé dans un processus de signature. ")):(l(),o("div",Rt,[w(e("select",{class:"form-control",name:"type",id:"typedocument","onUpdate:modelValue":s[11]||(s[11]=i=>n.editedDocument.category.id=i)},[(l(!0),o(v,null,g(n.typesDocuments,(i,c)=>(l(),o("option",{value:i.id,key:i.id,disabled:i.flow&&n.editedDocument.id>0},a(i.label)+" "+a(i.flow&&n.editedDocument.id?"(signature)":""),9,It))),128))],512),[[x,n.editedDocument.category.id]])]))])):p("",!0)]),e("div",Nt,[Yt,w(e("textarea",{"onUpdate:modelValue":s[12]||(s[12]=i=>n.editedDocument.information=i),id:"information",class:"form-control"},null,512),[[R,n.editedDocument.information]])]),n.mode=="change"?(l(),o("div",Ot,[e("div",Ut,[n.editedDocument.private===!1?(l(),o("span",Et,[zt,e("div",null,[w(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":s[13]||(s[13]=i=>n.editedDocument.tabDocument.id=i),class:"form-control"},[(l(!0),o(v,null,g(n.tabsWithDocuments,(i,c)=>(l(),o("option",{value:c,key:c},a(i.label),9,At))),128))],512),[[x,n.editedDocument.tabDocument.id]])])])):p("",!0),Wt,e("div",qt,[w(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":s[14]||(s[14]=i=>n.editedDocument.private=i)},null,512),[[V,n.editedDocument.private]])])]),n.editedDocument.private===!0?(l(),o("span",jt,[Bt,Ht,M(y,{onChange:r.handlerSelectPersons},null,8,["onChange"]),(l(!0),o(v,null,g(n.editedDocument.persons,i=>(l(),o("span",{key:i.id,class:"cartouche"},[Jt,e("span",null,a(i.personName),1),e("span",Lt,a(i.affectation),1),i.personId!==n.idCurrentPerson?(l(),o("i",{key:0,onClick:c=>r.handlerDeletePerson(i),class:"icon-trash icon-clickable"},null,8,Xt)):p("",!0)]))),128))])):p("",!0)])):p("",!0)]),e("div",Kt,[e("div",Gt,[e("nav",Qt,[e("button",{class:"btn btn-danger",onClick:s[15]||(s[15]=i=>n.editedDocument=null)},[Zt,h(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:s[16]||(s[16]=b(i=>r.applyEdit(),["prevent"]))},[$t,h(" Enregistrer ")])])])])])])):p("",!0),n.signDocument?(l(),o("div",es,[e("div",ts,[e("h2",null,[e("span",{class:"overlay-closer",onClick:s[17]||(s[17]=i=>n.signDocument=null)},"X")]),e("nav",null,[h(" Selectionnez un procédure de signature "),(l(!0),o(v,null,g(n.signProcess,i=>(l(),o("span",{class:k(["btn btn-lg btn-default",{"btn-success":n.selectedSignProcess&&n.selectedSignProcess.id==i.id}]),onClick:c=>r.handlerSelectProcess(i)},[e("strong",null,a(i.label),1),ns,e("em",null,a(i.description)+" ",1)],10,ss))),256))]),n.selectedSignProcess?(l(),o("section",ls,[e("h3",null,[os,is,e("strong",null,a(n.selectedSignProcess.label),1)]),(l(!0),o(v,null,g(n.selectedSignProcess.steps,i=>(l(),o("article",{class:k(["step",i.missing_recipients?"error":"ok"])},[e("h4",null,[h("étape "+a(i.order)+" :",1),e("strong",null,a(i.label),1)]),e("ul",rs,[e("li",as,[h("Parapheur: "),e("strong",null,a(i.letterfile_label),1)]),e("li",cs,[h("Type: "),e("strong",null,a(i.level_label),1)]),e("li",ds,[h("Tous signent: "),e("strong",null,a(i.allSignToComplete?"Oui":"non"),1)])]),i.missing_recipients?(l(),o("div",us," Il manque des destinataires pour cette procédure. ")):p("",!0),e("div",hs,[e("div",ms,[ps,(l(!0),o(v,null,g(i.recipients,c=>(l(),o("div",_s,[i.editable?w((l(),o("input",{key:0,type:"checkbox","onUpdate:modelValue":D=>c.selected=D},null,8,fs)),[[V,c.selected]]):p("",!0),e("strong",vs,a(c.email),1),e("span",gs,a(c.firstname)+" "+a(c.lastname),1)]))),256))]),e("div",Ds,[bs,i.observers.length?(l(!0),o(v,{key:0},g(i.observers,c=>(l(),o("div",ys,[i.editable?w((l(),o("input",{key:0,type:"checkbox","onUpdate:modelValue":D=>c.selected=D},null,8,ks)),[[V,c.selected]]):p("",!0),e("strong",ws,a(c.email),1),e("span",Ss,a(c.firstname)+" "+a(c.lastname),1)]))),256)):(l(),o("div",Cs," Pas d'observateur pour cette étape "))])])],2))),256))])):p("",!0),n.signProcessError?(l(),o("div",Ps,[h(" Signature non-disponible : "),e("strong",null,a(n.signProcessError),1)])):p("",!0),e("nav",Ms,[e("button",{class:"btn btn-default",onClick:s[18]||(s[18]=i=>n.signDocument=null)},[xs,h(" Annuler ")]),e("button",{class:k(["btn btn-success",{disabled:r.handlerPerformSignDocumentDisabled(n.signDocument,n.selectedSignProcess)}]),onClick:s[19]||(s[19]=i=>r.handlerPerformSignDocument(n.signDocument,n.selectedSignProcess))},[Vs,h(" Valider ")],2)])])])):p("",!0),n.errorMessages.length!==0?(l(),o("div",Ts,[e("div",Fs,[e("h2",null,[e("span",{class:"overlay-closer",onClick:s[20]||(s[20]=i=>n.errorMessages=[])},"X")]),e("ul",null,[(l(!0),o(v,null,g(n.errorMessages,i=>(l(),o("li",null,a(i),1))),256))]),e("button",{class:"btn btn-danger",onClick:s[21]||(s[21]=i=>n.errorMessages=[])},[Rs,h(" Retour ")])])])):p("",!0),e("section",Is,[e("div",Ns,[(l(!0),o(v,null,g(r.packedDocuments,i=>(l(),o("div",{class:k(["tab",{selected:n.selectedTabId===i.id}]),onClick:b(c=>r.handlerSelectTab(i),["prevent"])},[h(a(i.label)+" ",1),e("sup",Os,a(i.total),1)],10,Ys))),256)),e("div",{class:k(["tab",{selected:n.displayComputed}]),onClick:s[22]||(s[22]=b(i=>r.handlerSelectTab("computed"),["prevent"]))}," Documents générés ",2)]),w(e("div",Us,[(l(!0),o(v,null,g(n.computedDocuments,i=>(l(),o("article",{class:"card xs",key:i.key},[e("div",Es,[zs,e("strong",null,a(i.label),1),As]),e("nav",Ws,[e("a",{class:"btn btn-default btn-xs",href:i.url},[js,h(" Télécharger ")],8,qs)])]))),128))],512),[[C,n.displayComputed]]),(l(!0),o(v,null,g(r.packedDocuments,i=>w((l(),o("div",Bs,[i.manage?(l(),o("nav",Hs,[i.manage?(l(),o("button",{key:0,onClick:c=>r.handlerNew(i.id),class:"btn btn-xs btn-default"},[Ls,h(" Téléverser un document ")],8,Js)):p("",!0)])):p("",!0),Xs,(l(!0),o(v,null,g(i.documents,c=>(l(),o("article",{class:k(["card xs",{"private-document":c.private}]),key:c.id},[e("div",Ks,[c.location=="link"?(l(),o("i",Gs)):(l(),o("i",{key:1,class:k(["picto icon-doc","doc"+c.extension])},null,2)),e("small",Qs,a(c.category.label)+" ~ ",1),e("strong",null,a(c.fileName),1),c.location!="url"?(l(),o("small",{key:2,class:"text-light",title:c.fileSize+" octet(s)"},"  Version "+a(c.version),9,Zs)):p("",!0)]),e("small",null,[$s,h(" Taille "),e("strong",null,a(t.$filters.filesize(c.fileSize)),1),en,h(" Envoyé "),e("strong",null,a(t.$filters.timeAgo(c.dateSend)),1),tn,h(" Déposé "),e("strong",null,a(t.$filters.dateFull(c.dateDeposit)),1),sn,h(" Uploadé "),e("strong",null,a(t.$filters.dateFull(c.dateUpload)),1),nn,h(" par "),e("strong",null,a(c.uploader.displayname),1)]),e("p",null,a(c.information),1),c.private?(l(),o("section",ln,[on,h(" Ce document est privé, accessible par : "),(l(!0),o(v,null,g(c.persons,D=>(l(),o("span",rn,a(D.personName),1))),256))])):p("",!0),e("div",an,[c.process?(l(),o("section",{key:0,class:k(["alert",{"alert-success":c.process.status==201,"alert-danger":c.process.status>=400,"alert-info":c.process.status<200}])},[cn,h(" Procédure de signature "),e("strong",null,a(c.process.label),1),h(" ("),e("em",null,a(c.process.status_text),1),e("span",null," - étape "+a(c.process.current_step)+" / "+a(c.process.total_steps),1),h(") "),e("button",{class:"btn btn-xs btn-info",onClick:D=>r.handlerProcessDetailsOn(c.process)}," Détails ",8,dn),c.manage_process?(l(),o("button",{key:0,class:"btn btn-default btn-xs",onClick:D=>r.handlerProcessReload(c)},[hn,h(" Actualiser ")],8,un)):p("",!0)],2)):p("",!0),c.versions.length?(l(),o("div",mn,[pn,(l(!0),o(v,null,g(c.versions,D=>(l(),o("article",_n,[e("i",{class:k(["picto icon-doc","doc"+D.extension])},null,2),e("strong",null,a(D.fileName),1),h(" version "),e("em",null,a(D.version),1),h(", téléchargé le "),e("time",null,a(D.dateUpload|t.dateFullSort),1),D.uploader?(l(),o("span",fn,[h(" par "),e("strong",null,a(D.uploader.displayname),1)])):p("",!0),e("a",{href:D.urlDownload},[gn,h(" Télécharger cette version ")],8,vn)]))),256))])):p("",!0),e("nav",Dn,[c.location=="url"?(l(),o("a",{key:0,class:"btn btn-default btn-xs",href:c.basename,target:"_blank"},[yn,h(" Accéder au lien ")],8,bn)):p("",!0),c.process_triggerable?(l(),o("a",{key:1,class:"btn btn-default btn-xs",href:"#",onClick:D=>r.handlerSignDocument(c)},[wn,h(" Signer ce document ")],8,kn)):p("",!0),c.urlDownload&&c.location!="url"?(l(),o("a",{key:2,class:"btn btn-default btn-xs",href:c.urlDownload},[Cn,h(" Télécharger ")],8,Sn)):p("",!0),i.manage&&c.location!="url"&&!c.process?(l(),o("button",{key:3,onClick:D=>r.handlerNewVersion(c),class:"btn btn-default btn-xs"},[Mn,h(" Nouvelle Version ")],8,Pn)):p("",!0),i.manage?(l(),o("a",{key:4,class:"btn btn-default btn-xs",onClick:b(D=>r.deleteDocument(c),["prevent"])},[Vn,h(" Supprimer ")],8,xn)):p("",!0),i.manage&&c.location!="url"?(l(),o("a",{key:5,class:"btn btn-xs btn-default",href:"#",onClick:b(D=>r.handlerEdit(c),["prevent"])},[Fn,h(" Modifier ")],8,Tn)):p("",!0)])])],2))),128))],512)),[[C,n.selectedTabId===i.id]])),256))])])],64)}const In=I(Ie,[["render",Rn],["__scopeId","data-v-5454207b"]]);let P=document.querySelector("#activitydocuments");const Y=z(In,{url:P.dataset.url,urlUploadNewDoc:P.dataset.urlUploadNewDoc,urlSignDocument:P.dataset.urlSignDocument,manage:P.dataset.manage});Y.config.globalProperties.$filters={timeAgo(t){return T.timeAgo(t)},date(t){return T.date(t)},dateFull(t){return T.dateFull(t)},filesize(t){return A.filesize(t)}};Y.mount("#activitydocuments");
