import{a as g,r as _,c as n,e as i,g as b,b as e,d,t as l,k as p,F as h,f as m,o,q as S}from"../vendor.js";import{O}from"../vendor7.js";import{O as y}from"../vendor6.js";import{_ as k}from"../vendor4.js";const C={props:{url:{require:!0}},components:{OrganizationAutoComplete:O,OscarDialog:y},data(){return{selectedId:null,remote:"Initialisation",error:"",organizations:[],dialogDelete:null,manage:!1,manageSubOragnization:null}},methods:{fetch(){this.remote="Chargement des sous-structures",g.get(this.url).then(r=>{this.remote="",this.organizations=r.data.organizations,this.manage=r.data.manage},r=>{this.remote="",this.error="Impossible de charger les sous-structures : "+r.response.data})},handlerNew(){this.manageSubOragnization={idOrganization:null}},handlerRemoveSubStructure(r){this.remote="Suppression de la sous-structure",this.dialogDelete={dispayed:!0,title:"Suppression de la sous-structure",message:"Retirer '"+r.label+"' des sous-structures ?",onSuccess:()=>{console.log("sub structure",r),this.remote="Suppression de la sous-structure",g.delete(this.url+"?idsubstructure="+r.id).then(t=>{this.remote="",this.fetch()},t=>{this.remote="",this.error="Impossible de supprimer la sous-structure : "+t.response.data}).finally(t=>{this.manageSubOragnization=null})}}},handlerChange(r){this.manageSubOragnization.idOrganization=r.id},handlerSave(){this.remote="Chargement des sous-structures";let r=new FormData;r.append("idSubStructure",this.manageSubOragnization.idOrganization),g.post(this.url,r).then(t=>{this.remote="",this.fetch()},t=>{this.remote="",this.error=t.response.data}).finally(t=>{this.manageSubOragnization=null})}},mounted(){this.fetch()}},N={key:0},V={key:1,class:"overlay"},w={class:"overlay-content",style:{overflow:"visible"}},x=e("h2",null,"Nouvelle sous-structure",-1),D={class:"buttons-bar"},I=e("i",{class:"icon-cancel-circled"},null,-1),A=e("i",{class:"icon-floppy"},null,-1),F={key:2,class:"alert alert-danger"},R=e("hr",null,null,-1),q={class:"suborganizations"},B={class:"card suborganization"},j={class:"card-title"},E={class:"organization-code code"},L={class:"organization-shortname"},M={class:"card-title-subsection"},P={class:"organization-longname"},T={key:0,class:"card-content"},U=e("h4",null," Personnel ",-1),G=e("i",{class:"icon-user"},null,-1),H={key:0},J={key:1,class:"card-content suborganizations"},K=e("h4",null," Sous-structure ",-1),Q=e("i",{class:"icon-building"},null,-1),W={class:"card-footer buttons-bar"},X=["href"],Y=e("i",{class:"icon-link-outline"},null,-1),Z=["onClick"],$=e("i",{class:"icon-trash"},null,-1);function ee(r,t,ne,oe,a,c){const f=_("oscar-dialog"),v=_("organization-auto-complete");return o(),n(h,null,[a.remote?(o(),n("div",N," Chargement ")):i("",!0),b(f,{options:a.dialogDelete},null,8,["options"]),a.manageSubOragnization?(o(),n("div",V,[e("div",w,[x,b(v,{modelValue:a.manageSubOragnization.selectedId,"onUpdate:modelValue":t[0]||(t[0]=s=>a.manageSubOragnization.selectedId=s),onChange:c.handlerChange},null,8,["modelValue","onChange"]),e("div",D,[e("button",{class:"btn btn-danger",onClick:t[1]||(t[1]=s=>a.manageSubOragnization=null)},[I,d(" Annuler ")]),e("button",{class:"btn btn-success",onClick:t[2]||(t[2]=(...s)=>c.handlerSave&&c.handlerSave(...s))},[A,d(" Enregistrer ")])])])])):i("",!0),a.error?(o(),n("div",F,[d(l(a.error)+" ",1),R,e("a",{href:"#",onClick:t[3]||(t[3]=p(s=>a.error="",["prevent"]))},"Fermer")])):i("",!0),e("section",q,[(o(!0),n(h,null,m(a.organizations,s=>(o(),n("article",B,[e("h2",j,[e("code",E,l(s.code),1),e("strong",L,l(s.shortname),1),e("span",M,[e("i",P,l(s.longname),1)])]),s.persons.length!=0?(o(),n("section",T,[U,(o(!0),n(h,null,m(s.persons,u=>(o(),n("div",null,[G,e("strong",null,l(u.label),1),u.roles.length?(o(),n("em",H," ("+l(u.roles.join(", "))+") ",1)):i("",!0)]))),256))])):i("",!0),s.organizations.length!=0?(o(),n("section",J,[K,(o(!0),n(h,null,m(s.organizations,u=>(o(),n("div",null,[Q,e("strong",null,l(u.shortname),1),d(" Â  "),e("em",null,l(u.longname),1)]))),256))])):i("",!0),e("nav",W,[e("a",{href:s.show,class:"btn btn-info btn-xs"},[Y,d(" Voir la fiche ")],8,X),a.manage?(o(),n("a",{key:0,href:"#",class:"btn btn-danger btn-xs",onClick:p(u=>c.handlerRemoveSubStructure(s),["prevent"])},[$,d(" Retirer ")],8,Z)):i("",!0)])]))),256))]),a.manage?(o(),n("button",{key:3,class:"btn btn-primary",onClick:t[4]||(t[4]=(...s)=>c.handlerNew&&c.handlerNew(...s))}," Ajouter une sous-structure ")):i("",!0)],64)}const te=k(C,[["render",ee]]);let z=document.querySelector("#suborganizations");const se=S(te,{url:z.dataset.url,manage:z.dataset.manage});se.mount("#suborganizations");
