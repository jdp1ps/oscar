import{a as c,c as r,b as e,t as a,e as d,d as n,w as m,v as y,F as h,f,g as k,u as M,T as x,o as i,i as b,x as C,j as N,k as S,n as _,q as j}from"../vendor.js";import{_ as w}from"../vendor4.js";const q={data(){return{roles:[],loadingMsg:null,form:null,manage:!1,deleteRole:null,merged:null,merged_dest:null}},props:{url:{required:!0},manage:{default:!1}},computed:{loading(){return this.loadingMsg!=null}},methods:{mergeUi(o){this.merged_dest=null,this.merged=o},performMerge(){let o={action:"merge",from:this.merged,to:this.merged_dest};c.post(this.url,o).then(s=>{console.log("ok"),this.fetch()},s=>{console.log(s),flashMessage("error",s.response.data)}).then(()=>{this.loadingMsg=null,this.merged=null})},formNew(){this.form={label:"",description:"",principal:!1}},save(){this.form.id?(this.loadingMsg="Mise à jour du rôle...",c.put(this.url+"/"+this.form.id,this.form).then(o=>{for(let s=0;s<this.roles.length;s++)if(this.roles[s].id===this.form.id){this.roles.splice(s,1,o.data),flashMessage("success","le rôle a bien été mis à jour.");return}},o=>{flashMessage("error",o.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})):(this.loadingMsg="Ajout du nouveau rôle...",c.post(this.url+"",this.form).then(o=>{this.roles.push(o.data),flashMessage("success","le rôle a bien été ajouté.")},o=>{flashMessage("error",o.response.data)}).then(()=>{this.loadingMsg=null,this.form=null}))},performDelete(){this.loadingMsg="Suppression du rôle...";let o=this.deleteRole;c.delete(this.url+"/"+o.id,this.form).then(s=>{this.roles.splice(this.roles.indexOf(o),1),flashMessage("success","le rôle a bien été supprimé.")},s=>{flashMessage("error",s.response.data)}).then(()=>{this.loadingMsg=null,this.form=null,this.deleteRole=null})},remove(o){this.deleteRole=o},fetch(){this.loadingMsg="Chargement des rôles",c.get(this.url).then(o=>{this.roles=o.data},o=>{flashMessage("error",o.body)}).then(()=>this.loadingMsg=null)}},created(){this.fetch()}},R={key:0,class:"vue-loader"},A={key:1,class:"overlay"},V={class:"overlay-content container"},U={key:2,class:"overlay"},D={class:"overlay-content container"},z=["value"],O={key:0,class:"alert alert-danger"},T={key:0,class:"form-wrapper"},B={key:0},E={key:1},F=e("i",{class:"glyphicon glyphicon-remove"},null,-1),J=[F],L={class:"form-group"},P=e("label",null,"Nom du rôle",-1),G={class:"form-group"},H=e("p",{class:"alert alert-warning"},[e("i",{class:"icon-help-circled"}),n(" Un rôle définit comme principal débloque les droits des membres de l'organisation lorsqu'elle est affectée avec ce rôle à une activités ")],-1),I={class:"form-group"},K=e("label",null,"Description",-1),Q={class:"buttons-bar"},W={class:"btn-group"},X=e("button",{type:"submit",class:"btn btn-primary"},[e("i",{class:"icon-floppy"}),n(" Enregistrer ")],-1),Y=e("i",{class:"icon-block"},null,-1),Z={class:"card-title"},$={key:0,class:"icon-asterisk"},ee={key:0,class:"alert alert-warning"},se=e("i",{class:"icon-attention-1"},null,-1),te=e("strong",{style:{"text-decoration":"underline"}},"débloque les privilèges",-1),le={key:1,class:"card-footer"},ne=["onClick"],oe=e("i",{class:"icon-pencil"},null,-1),re=["onClick"],ie=e("i",{class:"icon-fork"},null,-1),ae=["onClick"],ue=e("i",{class:"icon-trash"},null,-1),de=e("i",{class:"icon-circled-plus"},null,-1);function ce(o,s,p,ge,l,u){return i(),r("section",null,[u.loading?(i(),r("div",R,[e("span",null,a(l.loadingMsg),1)])):d("",!0),l.deleteRole?(i(),r("div",A,[e("div",V,[e("h3",null,[n("Supprimer le role "),e("strong",null,a(l.deleteRole.label),1),n(" ?")]),e("nav",null,[e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=t=>u.performDelete())},"Supprimer"),e("button",{type:"button",onClick:s[1]||(s[1]=t=>l.deleteRole=null),class:"btn btn-default"},"Annuler")])])])):d("",!0),l.merged?(i(),r("div",U,[e("div",D,[e("h3",null,[n("Migration du rôle "),e("strong",null,a(l.merged.label),1),n(" ?")]),n(" Migration du rôle "),e("strong",null,a(l.merged.label),1),n(" vers le rôle "),m(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>l.merged_dest=t)},[(i(!0),r(h,null,f(l.roles,t=>(i(),r("option",{value:t},a(t.label),9,z))),256))],512),[[y,l.merged_dest]]),l.merged_dest?(i(),r("div",O,[n(" Les utilisation du rôle "),e("strong",null,a(l.merged.label),1),n(" vont être remplacées par le rôle "),e("strong",null,a(l.merged_dest.label),1),n(", cette modification sera appliquées sur toutes les activités de recherche / projets. ")])):d("",!0),e("nav",null,[e("button",{type:"button",class:"btn btn-danger",onClick:s[3]||(s[3]=t=>u.performMerge())},"Migrer"),e("button",{type:"button",onClick:s[4]||(s[4]=t=>l.merged=null),class:"btn btn-default"},"Annuler")])])])):d("",!0),k(x,{name:"popup"},{default:M(()=>[l.form?(i(),r("div",T,[e("form",{action:"",onSubmit:s[10]||(s[10]=S((...t)=>u.save&&u.save(...t),["prevent"])),class:"container oscar-form"},[e("header",null,[e("h1",null,[l.form.id?(i(),r("span",B,[n("Modification de "),e("strong",null,a(l.form.label),1)])):(i(),r("span",E,"Nouveau rôle"))]),e("a",{href:"#",onClick:s[5]||(s[5]=t=>l.form=null),class:"closer"},J)]),e("div",L,[P,m(e("input",{id:"role_roleid",type:"text",class:"form-control",placeholder:"Role","onUpdate:modelValue":s[6]||(s[6]=t=>l.form.label=t),name:"label"},null,512),[[b,l.form.label]])]),e("div",G,[e("label",null,[n("Principal ("),e("span",{style:C({"text-decoration":l.form.principal?"underline":"line-through"})},"Activation des privilèges",4),n(")")]),H,m(e("input",{type:"checkbox",class:"form-control","onUpdate:modelValue":s[7]||(s[7]=t=>l.form.principal=t)},null,512),[[N,l.form.principal]])]),e("div",I,[K,m(e("textarea",{class:"form-control","onUpdate:modelValue":s[8]||(s[8]=t=>l.form.description=t)},null,512),[[b,l.form.description]])]),e("footer",Q,[e("div",W,[X,e("button",{type:"button",class:"btn btn-default",onClick:s[9]||(s[9]=t=>l.form=null)},[Y,n(" Annuler ")])])])],32)])):d("",!0)]),_:1}),(i(!0),r(h,null,f(l.roles,t=>(i(),r("article",{class:_(["card xs",{active:t.principal}])},[e("h1",Z,[e("span",null,[t.principal?(i(),r("i",$)):d("",!0),n(" "+a(t.label)+" ",1),e("span",{class:_(["cartouche xs",{primary:t.in_activity||t.in_project}])},[e("strong",null,a(t.in_activity+t.in_project),1),n(" utilisation(s) ")],2)])]),t.principal?(i(),r("p",ee,[se,n(" Ce rôle "),te,n(" de ces membres lorsqu'il est utilisé pour qualifier le rôle d'une organisation sur une activité/un projet ")])):d("",!0),e("p",null,a(t.description),1),p.manage?(i(),r("nav",le,[e("button",{class:"btn btn-xs btn-default",onClick:g=>l.form=JSON.parse(JSON.stringify(t))},[oe,n(" Éditer ")],8,ne),e("button",{class:"btn btn-xs btn-info",onClick:g=>u.mergeUi(t)},[ie,n(" Migrer ")],8,re),e("button",{class:"btn btn-xs btn-danger",onClick:g=>u.remove(t)},[ue,n(" Supprimer ")],8,ae)])):d("",!0)],2))),256)),p.manage?(i(),r("button",{key:3,onClick:s[11]||(s[11]=(...t)=>u.formNew&&u.formNew(...t)),class:"btn btn-default"},[de,n(" Ajouter un nouveau rôle ")])):d("",!0)])}const me=w(q,[["render",ce]]);let v=document.querySelector("#adminroleorganization");const pe=j(me,{url:v.dataset.url,manage:v.dataset.manage});pe.mount("#adminroleorganization");
