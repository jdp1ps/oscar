import{a as c,c as i,b as e,t as a,e as d,d as l,w as h,v as y,F as g,f as m,g as k,u as M,T as C,o as r,i as f,x,j as D,k as j,n as b,q as S}from"../vendor.js";import{_ as w}from"../vendor4.js";const N={data(){return{roles:[],loadingMsg:null,form:null,manage:!1,deleteRole:null,merged:null,merged_dest:null,doublons:null}},props:{url:{required:!0},manage:{default:!1}},computed:{loading(){return this.loadingMsg!=null}},methods:{mergeUi(o){this.merged_dest=null,this.merged=o},perfomDoublons(){let o={action:"doublons"};this.loadingMsg="Suppression des doublons...",c.post(this.url,o).then(t=>{this.fetch()},t=>{flashMessage("error",t.response.data)}).then(()=>{this.loadingMsg=null,this.doublons=null,this.fetch()})},performMerge(){let o={action:"merge",from:this.merged,to:this.merged_dest};this.loadingMsg="Fusion des rôles...",c.post(this.url,o).then(t=>{console.log("ok"),this.fetch()},t=>{console.log(t),flashMessage("error",t.response.data)}).then(()=>{this.loadingMsg=null,this.merged=null})},formNew(){this.form={label:"",description:"",principal:!1}},save(){this.form.id?(this.loadingMsg="Mise à jour du rôle...",c.put(this.url+"/"+this.form.id,this.form).then(o=>{for(let t=0;t<this.roles.length;t++)if(this.roles[t].id===this.form.id){this.roles.splice(t,1,o.data),flashMessage("success","le rôle a bien été mis à jour.");return}},o=>{flashMessage("error",o.response.data)}).then(()=>{this.loadingMsg=null,this.form=null})):(this.loadingMsg="Ajout du nouveau rôle...",c.post(this.url+"",this.form).then(o=>{this.roles.push(o.data),flashMessage("success","le rôle a bien été ajouté.")},o=>{flashMessage("error",o.response.data)}).then(()=>{this.loadingMsg=null,this.form=null}))},performDelete(){this.loadingMsg="Suppression du rôle...";let o=this.deleteRole;c.delete(this.url+"/"+o.id,this.form).then(t=>{this.roles.splice(this.roles.indexOf(o),1),flashMessage("success","le rôle a bien été supprimé.")},t=>{flashMessage("error",t.response.data)}).then(()=>{this.loadingMsg=null,this.form=null,this.deleteRole=null})},remove(o){this.deleteRole=o},handlerDisplayDoublons(){this.loadingMsg="Chargement des doublons",c.get(this.url+"?a=doublon").then(o=>{this.doublons=o.data},o=>{flashMessage("error",o.body)}).then(()=>this.loadingMsg=null)},fetch(){this.loadingMsg="Chargement des rôles",c.get(this.url).then(o=>{this.roles=o.data},o=>{flashMessage("error",o.body)}).then(()=>this.loadingMsg=null)}},created(){this.fetch()}},q={key:0,class:"vue-loader"},z={key:1,class:"overlay"},A={class:"overlay-content container"},R={key:2,class:"overlay"},V={class:"overlay-content container"},U=["value"],O={key:0,class:"alert alert-danger"},T={key:3,class:"overlay"},B={class:"overlay-content container"},F=e("h3",null,"Dédoublonage des rôles",-1),L={class:"alert alert-info"},E={style:{"border-bottom":"solid thin #999"}},J=["title"],P=e("i",{class:"icon-building-filled"},null,-1),G={key:0},H=e("i",{class:"icon-tag"},null,-1),I=e("br",null,null,-1),K={key:0},Q=e("i",{class:"icon-cube"},null,-1),W={key:1},X=e("i",{class:"icon-cubes"},null,-1),Y={key:0,class:"form-wrapper"},Z={key:0},$={key:1},ee=e("i",{class:"glyphicon glyphicon-remove"},null,-1),se=[ee],te={class:"form-group"},le=e("label",null,"Nom du rôle",-1),ne={class:"form-group"},oe=e("p",{class:"alert alert-warning"},[e("i",{class:"icon-help-circled"}),l(" Un rôle définit comme principal débloque les droits des membres de l'organisation lorsqu'elle est affectée avec ce rôle à une activités ")],-1),ie={class:"form-group"},re=e("label",null,"Description",-1),ae={class:"buttons-bar"},ue={class:"btn-group"},de=e("button",{type:"submit",class:"btn btn-primary"},[e("i",{class:"icon-floppy"}),l(" Enregistrer ")],-1),ce=e("i",{class:"icon-block"},null,-1),he={class:"row"},ge={class:"col-md-8"},me={class:"card-title"},pe={key:0,class:"icon-asterisk"},_e={key:0,class:"alert alert-warning"},fe=e("i",{class:"icon-attention-1"},null,-1),be=e("strong",{style:{"text-decoration":"underline"}},"débloque les privilèges",-1),ve={key:1,class:"card-footer"},ye=["onClick"],ke=e("i",{class:"icon-pencil"},null,-1),Me=["onClick"],Ce=e("i",{class:"icon-fork"},null,-1),xe=["onClick"],De=e("i",{class:"icon-trash"},null,-1),je={class:"col-md-4"},Se=e("i",{class:"icon-circled-plus"},null,-1);function we(o,t,p,ze,n,u){return r(),i("section",null,[u.loading?(r(),i("div",q,[e("span",null,a(n.loadingMsg),1)])):d("",!0),n.deleteRole?(r(),i("div",z,[e("div",A,[e("h3",null,[l("Supprimer le role "),e("strong",null,a(n.deleteRole.label),1),l(" ?")]),e("nav",null,[e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=s=>u.performDelete())},"Supprimer"),e("button",{type:"button",onClick:t[1]||(t[1]=s=>n.deleteRole=null),class:"btn btn-default"},"Annuler")])])])):d("",!0),n.merged?(r(),i("div",R,[e("div",V,[e("h3",null,[l("Migration du rôle "),e("strong",null,a(n.merged.label),1),l(" ?")]),l(" Migration du rôle "),e("strong",null,a(n.merged.label),1),l(" vers le rôle "),h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.merged_dest=s)},[(r(!0),i(g,null,m(n.roles,s=>(r(),i("option",{value:s},a(s.label),9,U))),256))],512),[[y,n.merged_dest]]),n.merged_dest?(r(),i("div",O,[l(" Les utilisation du rôle "),e("strong",null,a(n.merged.label),1),l(" vont être remplacées par le rôle "),e("strong",null,a(n.merged_dest.label),1),l(", cette modification sera appliquées sur toutes les activités de recherche / projets. ")])):d("",!0),e("nav",null,[e("button",{type:"button",class:"btn btn-danger",onClick:t[3]||(t[3]=s=>u.performMerge())},"Migrer"),e("button",{type:"button",onClick:t[4]||(t[4]=s=>n.merged=null),class:"btn btn-default"},"Annuler")])])])):d("",!0),n.doublons?(r(),i("div",T,[e("div",B,[F,e("div",L,a(n.doublons.length)+" doublon(s) détécté dans les activités de recherche ",1),(r(!0),i(g,null,m(n.doublons,s=>(r(),i("article",E,[l(" L'organisation "),e("strong",{title:s.organization_fullname},[P,s.organization_code?(r(),i("code",G,"["+a(s.organization_code)+"]",1)):d("",!0),l(" "+a(s.organization_shortname||s.organization_fullname),1)],8,J),l(" est qualifiée "),e("strong",null,a(s.total)+" fois ",1),l(" avec le rôle "),e("strong",null,[H,l(a(s.label),1)]),l(),I,s.activity_id?(r(),i("span",K,[l(" sur l'activité "),e("strong",null,[Q,e("code",null,a(s.activity_oscarnum),1),e("span",null,a(s.activity_label),1)])])):(r(),i("span",W,[l(" sur le projet "),e("strong",null,[X,e("code",null,a(s.project_acronym),1),e("span",null,a(s.project_label),1)])]))]))),256)),e("nav",null,[e("button",{type:"button",class:"btn btn-danger",onClick:t[5]||(t[5]=s=>u.perfomDoublons())},"Dédoublonner"),e("button",{type:"button",onClick:t[6]||(t[6]=s=>n.doublons=null),class:"btn btn-default"},"Annuler")])])])):d("",!0),k(C,{name:"popup"},{default:M(()=>[n.form?(r(),i("div",Y,[e("form",{action:"",onSubmit:t[12]||(t[12]=j((...s)=>u.save&&u.save(...s),["prevent"])),class:"container oscar-form"},[e("header",null,[e("h1",null,[n.form.id?(r(),i("span",Z,[l("Modification de "),e("strong",null,a(n.form.label),1)])):(r(),i("span",$,"Nouveau rôle"))]),e("a",{href:"#",onClick:t[7]||(t[7]=s=>n.form=null),class:"closer"},se)]),e("div",te,[le,h(e("input",{id:"role_roleid",type:"text",class:"form-control",placeholder:"Role","onUpdate:modelValue":t[8]||(t[8]=s=>n.form.label=s),name:"label"},null,512),[[f,n.form.label]])]),e("div",ne,[e("label",null,[l("Principal ("),e("span",{style:x({"text-decoration":n.form.principal?"underline":"line-through"})},"Activation des privilèges",4),l(")")]),oe,h(e("input",{type:"checkbox",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=s=>n.form.principal=s)},null,512),[[D,n.form.principal]])]),e("div",ie,[re,h(e("textarea",{class:"form-control","onUpdate:modelValue":t[10]||(t[10]=s=>n.form.description=s)},null,512),[[f,n.form.description]])]),e("footer",ae,[e("div",ue,[de,e("button",{type:"button",class:"btn btn-default",onClick:t[11]||(t[11]=s=>n.form=null)},[ce,l(" Annuler ")])])])],32)])):d("",!0)]),_:1}),e("div",he,[e("div",ge,[l(" Rôles : "),(r(!0),i(g,null,m(n.roles,s=>(r(),i("article",{class:b(["card xs",{active:s.principal}])},[e("h1",me,[e("span",null,[s.principal?(r(),i("i",pe)):d("",!0),l(" "+a(s.label)+" ",1),e("span",{class:b(["cartouche xs",{primary:s.in_activity||s.in_project}])},[e("strong",null,a(s.in_activity+s.in_project),1),l(" utilisation(s) ")],2)])]),s.principal?(r(),i("p",_e,[fe,l(" Ce rôle "),be,l(" de ces membres lorsqu'il est utilisé pour qualifier le rôle d'une organisation sur une activité/un projet ")])):d("",!0),e("p",null,a(s.description),1),p.manage?(r(),i("nav",ve,[e("button",{class:"btn btn-xs btn-default",onClick:_=>n.form=JSON.parse(JSON.stringify(s))},[ke,l(" Éditer ")],8,ye),e("button",{class:"btn btn-xs btn-info",onClick:_=>u.mergeUi(s)},[Ce,l(" Migrer ")],8,Me),e("button",{class:"btn btn-xs btn-danger",onClick:_=>u.remove(s)},[De,l(" Supprimer ")],8,xe)])):d("",!0)],2))),256))]),e("div",je,[l(" Outils "),e("button",{class:"btn btn-primary",onClick:t[13]||(t[13]=(...s)=>u.handlerDisplayDoublons&&u.handlerDisplayDoublons(...s))}," Afficher les doublons ")])]),p.manage?(r(),i("button",{key:4,onClick:t[14]||(t[14]=(...s)=>u.formNew&&u.formNew(...s)),class:"btn btn-default"},[Se,l(" Ajouter un nouveau rôle ")])):d("",!0)])}const Ne=w(N,[["render",we]]);let v=document.querySelector("#adminroleorganization");const qe=S(Ne,{url:v.dataset.url,manage:v.dataset.manage});qe.mount("#adminroleorganization");
