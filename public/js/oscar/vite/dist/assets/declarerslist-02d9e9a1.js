import{a as D,c as r,g as v,u as b,T as g,b as e,w as C,v as N,F as h,f as _,t as a,e as p,o as n,d as f,k,n as m,q as M}from"../vendor.js";import{_ as O}from"../vendor3.js";const T={props:{urlRecallDeclarer:{required:!0}},data(){return{declarers:null,period:null,error:null,loading:!1,infosPerson:null,months:{1:"Janvier",2:"Février",3:"Mars",4:"Avril",5:"Mai",6:"Juin",7:"Juillet",8:"Aout",9:"Septembre",10:"Octobre",11:"Novembre",12:"Décembre"}}},computed:{years(){let t=[];for(let s=this.period.year-5;s<=this.period.year+5;s++)t.push(s);return t}},methods:{DurationFilter(){return DurationFilter},recall(t,s){console.log(t,s.periodCode,this.urlRecallDeclarer)},details(t){D.get(t.url_details).then(s=>{this.infosPerson=s.data})},organize(t){let s={activities:{},others:{}};return Object.keys(t.activities).forEach(i=>{var c=t.activities[i];s.activities[i]={acronym:c.acronym,id:c.id,label:c.label,total:c.total,workpackages:{},days:{}}}),Object.keys(t.workpackages).forEach(i=>{var c=t.workpackages[i];s.activities[c.activity_id].workpackages[i]={code:c.code,id:c.id,label:c.label,total:c.total,days:{}}}),Object.keys(t.otherWP).forEach(i=>{var c=t.otherWP[i];s.others[i]={label:c.label,code:c.code,total:c.total,days:{}}}),Object.keys(t.days).forEach(i=>{var c=t.days[i];c.declarations&&c.declarations.forEach(l=>{var d=l.wp_id,o=l.activity_id,u=l.duration;s.activities[o].days.hasOwnProperty(i)||(s.activities[o].days[i]=0),s.activities[o].days[i]+=u,s.activities[o].workpackages[d].days.hasOwnProperty(i)||(s.activities[o].workpackages[d].days[i]=0),s.activities[o].workpackages[d].days[i]+=u}),c.othersWP&&c.othersWP.forEach(l=>{var d=l.code,o=l.duration;s.others[d].days.hasOwnProperty(i)||(s.others[d].days[i]=0),s.others[d].days[i]+=o})}),s},fetch(t=null){this.loading="Chargement de la période";let s=this.urlRecallDeclarer+"?f=json"+(t?"&period="+t:"");D.get(s).then(i=>{i.data&&i.data.declarers?(this.declarers=i.data.declarers.sort((c,l)=>c.lastName.localeCompare(l.lastName)),this.period=i.data.period):this.error="Soucis lors du chargement des données"},i=>{this.error=i.body}).then(i=>{this.loading=!1})},nextPeriod(){let t,s;this.period.month==12?(t=1,s=this.period.year+1):(t=this.period.month+1,s=this.period.year),this.fetch(s+"-"+t)},previousPeriod(){let t,s;this.period.month==1?(t=12,s=this.period.year-1):(t=this.period.month-1,s=this.period.year),this.fetch(s+"-"+t)},changePeriod(){let t=this.period.year+"-"+this.period.month;this.fetch(t)}},mounted(){this.fetch()}},E={key:0,class:"overlay"},S={class:"overlay-content",style:{"flex-basis":"90%","max-height":"90%"}},j=e("br",null,null,-1),J=e("i",{class:"icon-cancel-outline"},null,-1),V=[J],A={class:"table bordered table table-condensed"},z=e("th",null," ~",-1),L={style:{"font-weight":"100"}},R=e("th",{class:"total"}," Total",-1),W=["colspan"],q=e("i",{class:"icon-cube"},null,-1),B={class:"row-label"},U=e("i",{class:"icon-archive"},null,-1),H={key:0},G={key:1},I={class:"total"},K={class:"row-total"},Q=e("th",null,"Total",-1),X=["colspan"],Y={class:"total"},Z=["colspan"],$=e("h4",null,[e("i",{class:"icon-tags"}),f("Hors-lot")],-1),ee=[$],te={class:"row-label"},se={key:0},oe={key:1},le={class:"total"},re={class:"row-total"},ne=e("th",{class:"row-label"},"Total",-1),ie={key:0,class:"overlay"},ae={class:"alert alert-danger"},ce=e("i",{class:"icon-cancel-outline"},null,-1),de=[ce],ue={key:0,class:"overlay"},he=e("div",{class:"overlay-content"},[e("p",null,[e("i",{class:"icon-spinner animate-spin"}),f(" Chargement de la période")])],-1),_e=[he],fe={class:"navbar navbar-default"},pe={key:0,class:"button-group"},ye=e("span",null,"Période : ",-1),me=["value"],ve=["value"],be={key:0,class:"list"},ge={class:"card",style:{display:"flex"}},ke={style:{width:"48px",flex:"0"}},Pe=["src"],we={style:{flex:"1","padding-left":".25em"}},De={class:"lastname"},Ce={class:"firstname"},Ne=["onClick"],xe=e("i",{class:"icon-calendar"},null,-1),Fe=e("br",null,null,-1),Me={class:"tags",style:{flex:"1"}},Oe={class:"tag cartouche xs"},Te=e("i",{class:"icon-cubes"},null,-1),Ee={style:{flex:"1"}},Se={class:"cartouche secondary1"},je=e("i",{class:"icon-calendar"},null,-1),Je=e("small",null,"Saisie : ",-1),Ve={class:"addon"},Ae=e("br",null,null,-1),ze=e("i",{class:"icon-paper-plane"},null,-1),Le={class:"actions",style:{width:"175px"}},Re=["href"],We=e("i",{class:"icon-user"},"Fiche personne",-1),qe=[We];function Be(t,s,i,c,l,d){return n(),r("section",null,[v(g,{name:"fade"},{default:b(()=>[l.infosPerson?(n(),r("div",E,[e("div",S,[e("h3",null,[f(" Détails pour "),e("strong",null,a(l.infosPerson.person),1),j,f(" pour "),e("strong",null,a(t.$filters.period(l.infosPerson.period)),1),e("a",{href:"#",onClick:s[0]||(s[0]=k(o=>l.infosPerson=null,["prevent"]))},V)]),e("table",A,[e("thead",null,[e("tr",null,[z,(n(!0),r(h,null,_(l.infosPerson.days,(o,u)=>(n(),r("th",null,[e("small",L,a(o.label),1),f(" "+a(o.i),1)]))),256)),R])]),(n(!0),r(h,null,_(d.organize(l.infosPerson).activities,o=>(n(),r("tbody",null,[e("tr",null,[e("th",{colspan:l.infosPerson.dayNbr+2},[e("h4",null,[q,f(a(o.acronym),1)])],8,W)]),(n(!0),r(h,null,_(o.workpackages,u=>(n(),r("tr",null,[e("th",B,[U,f(a(u.code),1)]),(n(!0),r(h,null,_(l.infosPerson.days,(y,w)=>(n(),r("td",{class:m(["day",{off:y.locked}])},[u.days[w]?(n(),r("strong",H,a(t.$filters.formatDuration(u.days[w])),1)):(n(),r("small",G,"0.0"))],2))),256)),e("th",I,a(t.$filters.formatDuration(u.total)),1)]))),256)),e("tr",K,[Q,e("td",{colspan:l.infosPerson.dayNbr}," ",8,X),e("th",Y,a(t.$filters.formatDuration(o.total)),1)])]))),256)),e("tbody",null,[e("tr",null,[e("th",{colspan:l.infosPerson.dayNbr+2},ee,8,Z)]),(n(!0),r(h,null,_(d.organize(l.infosPerson).others,o=>(n(),r("tr",null,[e("th",te,a(o.label),1),(n(!0),r(h,null,_(l.infosPerson.days,(u,y)=>(n(),r("td",{class:m(["day",{off:u.locked}])},[o.days[y]?(n(),r("strong",se,a(t.$filters.formatDuration(o.days[y])),1)):(n(),r("small",oe,"0.0"))],2))),256)),e("th",le,a(t.$filters.formatDuration(o.total)),1)]))),256))]),e("tfoot",null,[e("tr",re,[ne,(n(!0),r(h,null,_(l.infosPerson.days,(o,u)=>(n(),r("th",{class:m(["day",{off:o.locked}])},[e("small",null,a(t.$filters.formatDuration(o.total)),1)],2))),256)),e("th",null,a(t.$filters.formatDuration(l.infosPerson.total)),1)])])])])])):p("",!0)]),_:1}),v(g,{name:"fade"},{default:b(()=>[l.error?(n(),r("div",ie,[e("div",ae,[e("h3",null,[f("Erreur "),e("a",{href:"#",onClick:s[1]||(s[1]=k(o=>l.error=null,["prevent"])),class:"float-right"},de)]),e("p",null,a(l.error),1)])])):p("",!0)]),_:1}),v(g,{name:"fade"},{default:b(()=>[l.loading?(n(),r("div",ue,_e)):p("",!0)]),_:1}),e("nav",fe,[l.period?(n(),r("div",pe,[e("button",{class:"btn btn-default",onClick:s[2]||(s[2]=o=>d.previousPeriod())}," <"),ye,C(e("select",{name:"mois","onUpdate:modelValue":s[3]||(s[3]=o=>l.period.month=o),onChange:s[4]||(s[4]=o=>d.changePeriod())},[(n(!0),r(h,null,_(l.months,(o,u)=>(n(),r("option",{value:u},a(o),9,me))),256))],544),[[N,l.period.month]]),C(e("select",{name:"mois","onUpdate:modelValue":s[5]||(s[5]=o=>l.period.year=o),onChange:s[6]||(s[6]=o=>d.changePeriod())},[(n(!0),r(h,null,_(d.years,o=>(n(),r("option",{value:o},a(o),9,ve))),256))],544),[[N,l.period.year]]),e("strong",null,a(l.period.periodLabel),1),e("button",{class:"btn btn-default",onClick:s[7]||(s[7]=o=>d.nextPeriod())}," >")])):p("",!0)]),l.declarers?(n(),r("div",be,[(n(!0),r(h,null,_(l.declarers,o=>(n(),r("article",ge,[e("span",ke,[e("img",{class:"thumb32",src:"//www.gravatar.com/avatar/"+o.mailMd5+"?s=48",alt:""},null,8,Pe)]),e("span",we,[e("strong",De,a(o.lastName),1),e("em",Ce,a(o.firstName),1),e("a",{href:"#",class:"link",onClick:k(u=>d.details(o),["prevent"])},[xe,f("Détails")],8,Ne),Fe,e("small",null,a(o.affectation),1)]),e("span",Me,[(n(!0),r(h,null,_(o.projects,u=>(n(),r("span",Oe,[Te,f(a(u),1)]))),256))]),e("span",Ee,[e("strong",Se,[je,Je,e("strong",null,a(t.$filters.percent(100/o.details.waitingTotal*o.details.total))+" %",1),e("span",Ve,a(t.$filters.round1(o.details.total))+" / "+a(t.$filters.round1(o.details.waitingTotal)),1)]),Ae,e("strong",{class:m(["cartouche xs secondary1",o.details.state])},[ze,e("small",null,[f("État : "),e("strong",null,a(o.details.stateText),1)])],2)]),e("nav",Le,[o.url_person?(n(),r("a",{key:0,class:"btn btn-default btn-xs",href:o.url_person},qe,8,Re)):p("",!0)])]))),256))])):p("",!0)])}const Ue=O(T,[["render",Be]]),P={percent(t){return""+(Math.round(t*10)/10).toFixed(1)},round1(t){return t.toFixed(1)},formatDuration(t){var s=Math.floor(t),i=Math.round((t-s)*60);return s+":"+(i<10?"0"+i:i)}},He={"01":"Janvier","02":"Février","03":"Mars","04":"Avril","05":"Mai","06":"Juin","07":"Juillet","08":"Aout","09":"Septembre",10:"Octobre",11:"Novembre",12:"Décembre"},Ge={period(t){let s=t.split("-");return He[s[1]]+" "+s[0]}};let x="#declarers-list",Ie=document.querySelector(x);const F=M(Ue,{urlRecallDeclarer:Ie.dataset.entrypoint});F.config.globalProperties.$filters={round1(t){return P.round1(t)},percent(t){return P.percent(t)},formatDuration(t){return P.formatDuration(t)},period(t){return Ge.period(t)}};F.mount(x);
