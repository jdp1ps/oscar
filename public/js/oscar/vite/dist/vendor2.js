import{h as p,o,c as i,b as e,w as b,i as F,l as Y,k as g,t as r,F as f,f as v,e as _,n as D,d as a,a as M,s as N,r as T,g as C,v as S,j as V,p as L,m as O}from"./vendor.js";import{_ as R}from"./vendor3.js";p.locale("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(t){return t+(t===1?"er":"e")},meridiemParse:/PD|MD/,isPM:function(t){return t.charAt(0)==="M"},meridiem:function(t,n,m){return t<12?"PD":"MD"},week:{dow:1,doy:4}});const kn={timeAgo(t,n="Non définie"){return t?p(t).fromNow():n},date(t,n="Non définie"){return t?"le "+p(t).format("D MMMM YYYY"):n},dateFull(t,n="Non définie"){return t?this.date(t)+" ("+this.timeAgo(t)+")":n}},gn={filesize(t,n="Inconnue"){if(t){let m="o";return t>1e3&&(t=Math.round(t/1e3),m="Ko"),t>1e3&&(t=Math.round(t/1e3),m="Mo"),t+" "+m}else return n}};p.locale("fr");const A={model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:p().format(),pickerYearRef:p().format("YYYY"),pickerMonthRef:p().month(),realValue:this.modelValue,manualChange:""}},computed:{years(){let t=this.pickerYearRef-11,n=this.pickerYearRef+11,m=[];for(var k=t;k<n;k++)m.push(k);return m},mmValue(){return this.realValue?(p.locale("fr"),p(this.realValue)):p()},pickerData(){var t=this.daysShort,n=p(this.realValue).format(this.valueFormat);let m=p(this.pickerDayRef).startOf("month").startOf("isoWeek"),k=p(this.pickerDayRef).endOf("month").startOf("isoWeek"),l=[];for(;m.unix()<=k.unix();){let c={num:m.week(),days:[]};for(let d=1;d<=7;d++){let y=!this.limitFrom||this.limitFrom&&this.limitFrom<m.format();c.days.push({enabled:y,date:m.format(),active:m.format(this.valueFormat)==n,day:m.format("D")}),m.add(1,"day")}l.push(c)}return{dayslabels:t,weeks:l}},currentMonth(){return p(this.pickerDayRef).format("MMMM")},currentYear(){return p(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(p.locale("fr"),p(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(t){console.log("convert ",t);try{let n=p(t,this.displayFormat);n.isValid()&&this.changeDate(n.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(t){try{var n=p(t.target.value);this.changeDate(n.format(this.valueFormat))}catch(m){console.error("WTF DATE",m)}},handlerSelectMonth(t){let n=this.months.indexOf(t);this.pickerDayRef=p(this.pickerDayRef).month(n).format(),this.pickerMode="day"},handlerSelectYear(t){this.pickerDayRef=p(this.pickerDayRef).year(t).format(),this.pickerMode="day"},changeDate(t){console.log("Modification de la date",t),this.picker=!1,this.realValue=t?p(t).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=p(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=p(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(t){t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(t){this.picker=!1},initPickerVar(){var t=p(this.pickerDayRef?this.pickerDayRef:p());this.pickerYearRef=t.year(),this.pickerMonthRef=t.format("MMMM")}},created(){p.locale(this.i18n),this.pickerDayRef=this.value?this.value:p().format(),this.initPickerVar()}},E={class:"input-group"},U=e("div",{class:"input-group-addon"},[e("i",{class:"icon-calendar"})],-1),j={class:"datepicker-wrapper"},H=e("i",{class:"icon-angle-left"},null,-1),q=[H],I={class:"heading"},z=e("i",{class:"icon-angle-right"},null,-1),J=[z],W={key:0,class:"day-labels week"},X=e("span",{class:"week-label"}," ",-1),B={class:"day-label"},K={key:0},G={class:"weeks"},Q={class:"week"},Z={class:"week-label"},$=["onClick"],ee={key:1,class:"months"},te=["onClick"],se={key:2,class:"years"},ne=["onClick"],le=e("i",{class:"icon-cancel-alt"},null,-1);function oe(t,n,m,k,l,c){return o(),i("div",{onMouseenter:n[9]||(n[9]=(...d)=>c.handlerShow&&c.handlerShow(...d)),onMouseleave:n[10]||(n[10]=(...d)=>c.handlerHide&&c.handlerHide(...d))},[e("div",E,[b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[0]||(n[0]=d=>c.renderValue=d)},null,512),[[F,c.renderValue]]),U]),b(e("div",{class:"datepicker-selector",onMouseleave:n[8]||(n[8]=(...d)=>c.handlerHide&&c.handlerHide(...d))},[e("div",j,[e("header",null,[e("nav",null,[e("span",{href:"#",onClick:n[1]||(n[1]=g((...d)=>c.pickerPrevMonth&&c.pickerPrevMonth(...d),["stop","prevent"]))},q),e("strong",I,[e("span",{class:"currentMonth",onClick:n[2]||(n[2]=g((...d)=>c.handlerPickerMonth&&c.handlerPickerMonth(...d),["stop"]))},r(c.currentMonth),1),e("span",{class:"currentYear",onClick:n[3]||(n[3]=g((...d)=>c.handlerPickerYear&&c.handlerPickerYear(...d),["stop"]))},r(c.currentYear),1)]),e("span",{href:"#",onClick:n[4]||(n[4]=g((...d)=>c.pickerNextMonth&&c.pickerNextMonth(...d),["stop"]))},J)]),l.pickerMode=="day"?(o(),i("div",W,[X,(o(!0),i(f,null,v(c.pickerData.dayslabels,d=>(o(),i("span",B,r(d),1))),256))])):_("",!0)]),l.pickerMode=="day"?(o(),i("section",K,[(o(!0),i(f,null,v(c.pickerData.weeks,d=>(o(),i("div",G,[e("span",Q,[e("span",Z,r(d.num),1),(o(!0),i(f,null,v(d.days,y=>(o(),i("span",{class:D(["week-day",{active:y.active,disabled:!y.enabled}]),onClick:g(s=>c.changeDate(y.date),["prevent","stop"])},r(y.day),11,$))),256))])]))),256))])):_("",!0),l.pickerMode=="month"?(o(),i("section",ee,[(o(!0),i(f,null,v(m.months,d=>(o(),i("span",{class:D(["month",{active:l.pickerMonthRef==d}]),onClick:g(y=>c.handlerSelectMonth(d),["prevent","stop"])},r(d),11,te))),256))])):_("",!0),l.pickerMode=="year"?(o(),i("section",se,[e("span",{class:"year",onClick:n[5]||(n[5]=g(d=>l.pickerYearRef-=22,["prevent","stop"]))},"<<"),(o(!0),i(f,null,v(c.years,d=>(o(),i("span",{class:D(["year",{active:l.pickerYearRef==d}]),onClick:g(y=>c.handlerSelectYear(d),["prevent","stop"])},r(d),11,ne))),256)),e("span",{class:"year",onClick:n[6]||(n[6]=g(d=>l.pickerYearRef+=22,["prevent","stop"]))},">>")])):_("",!0)]),e("div",{style:{"text-align":"center",cursor:"pointer"},onClick:n[7]||(n[7]=(...d)=>c.handlerClear&&c.handlerClear(...d))},[le,a(" Supprimer la date ")])],544),[[Y,l.picker]])],32)}const ie=R(A,[["render",oe]]);let x;const re={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(t,n){t.length>=2&&(x&&clearTimeout(x),x=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,M.get(this.url+this.expression+"&f=json",{before(t){this.request&&this.request.abort(),this.request=t}}).then(t=>{console.log(t),this.persons=t.data.datas,this.showSelector=!0},t=>{console.log(t),t.status==403?this.error="403 Unauthorized":t.message?this.error="ERROR : "+t.message:t.body&&(this.error=t.body)}).then(t=>{this.loading=!1,this.request=null})},handlerSelectPerson(t){let n=this.persons.find(m=>m.id==t);console.log("handlerSelectPerson",n),this.selectedPerson=n,this.showSelector=!1,this.expression="",this.$emit("change",n)}}},ae={key:0,class:"alert alert-danger"},ce=e("i",{class:"icon-spinner animate-spin"},null,-1),de=[ce],ue={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},he=["onClick"],me={style:{display:"block",width:"50px",height:"50px"}},_e=["src","alt"],pe={class:"infos"},fe={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},ve=e("br",null,null,-1),ke={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},ge=e("i",{class:"icon-location"},null,-1),ye={key:0},De=e("br",null,null,-1),be={style:{"font-weight":"100","font-size":".8em"}},Me=e("i",{class:"icon-mail"},null,-1),we={key:1,class:"alert alert-danger"},Pe=e("i",{class:"icon-attention-1"},null,-1);function Ce(t,n,m,k,l,c){return o(),i("div",null,[l.error?(o(),i("div",ae,[a(r(l.error)+" ",1),e("button",{class:"btn btn-default",onClick:n[0]||(n[0]=d=>l.error="")},"Fermer")])):_("",!0),b(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=d=>l.expression=d),onKeyup:n[2]||(n[2]=N(g((...d)=>c.search&&c.search(...d),["prevent"]),["enter"]))},null,544),[[F,l.expression]]),b(e("span",null,de,512),[[Y,l.loading]]),b(e("div",ue,[(o(!0),i(f,null,v(l.persons,d=>(o(),i("div",{class:"choice",key:d.id,onClick:g(y=>c.handlerSelectPerson(d.id),["prevent","stop"])},[e("div",me,[e("img",{src:"https://www.gravatar.com/avatar/"+d.mailMd5+"?s=50",alt:d.displayname,style:{width:"100%"}},null,8,_e)]),e("div",pe,[e("strong",fe,r(d.displayname),1),ve,e("span",ke,[ge,a(" "+r(d.affectation)+" ",1),d.ucbnSiteLocalisation?(o(),i("span",ye," ~ "+r(d.ucbnSiteLocalisation),1)):_("",!0)]),De,e("em",be,[Me,a(r(d.email),1)])])],8,he))),128))],512),[[Y,l.persons.length>0&&l.showSelector]]),l.error?(o(),i("div",we,[Pe,a(" "+r(l.error),1)])):_("",!0)])}const Se=R(re,[["render",Ce]]),w={error(t){return t.request&&t.request.status===403?"Authorisation insuffisante (ou vous avez été déconnecté)":t.response?t.response.data?t.response.data:"Pas de message d'erreur":t.message?t.message:"Erreur inconnue"}};const Ve={components:{"date-picker":ie,"person-auto-completer":Se},props:{editable:{default:!1},displayActivity:{default:!1},documents:{default:[]},signProcess:{default:null},tabs:{default:[]},types:{default:[]}},data(){return{deleteDocument:null,signDocument:null,signProcessError:"",selectedSignProcess:null,processDetails:null,error:null,editedDocument:null,mode:null,fileToDownload:null}},methods:{urlShow(t=null){if(console.log(t),t)document.location=t;else return!1},handlerProcessInit(t){console.log("Affichage fenêtre de signature"),this.signDocument=t},handlerPerformSignDocumentDisabled(t,n){if(!n||n.missing_recipients)return!0;for(let m=0;m<n.steps.length;m++){let k=n.steps[m],l=k.editable,c=0;for(let d=0;d<k.recipients.length;d++){let y=k.recipients[d];l?y.selected==!0&&c++:c++}if(c==0)return this.signProcessError="L'étape "+k.order+' "'+k.label+`" n'a pas de destinataire.`,!0}return this.signProcessError="",!1},handlerSelectProcess(t){this.signProcessError="",this.selectedSignProcess=t},handlerPerformSignDocument(t,n){let m=new FormData,k=t.urlProcessCreate;return m.append("document_id",t.id),m.append("flow_datas",JSON.stringify(n)),M.post(k,m).then(l=>{this.signDocument=null,this.selectedSignProcess=null,this.$emit("fetch")},l=>{this.error=w.error(l)}),!1},handlerProcessDetailsOn(t){this.processDetails=t},handlerDeleteProcess(t){console.log("handlerDeleteProcess",t),M.post(t.urlProcessDelete).then(n=>{this.$emit("fetch")},n=>{this.error=w.error(n)})},handlerDeleteDocument(t){this.deleteDocument=t},handlerDeleteDocumentConfirm(){console.log(this.deleteDocument.urlDelete),M.post(this.deleteDocument.urlDelete).then(t=>{this.$emit("fetch")},t=>{this.error=w.error(t)}),this.deleteDocument=null},handlerEdit(t){this.mode="edit",this.editedDocument=t},handlerEditConfirm(){let t=new FormData,n="";if(t.append("data",JSON.stringify(this.editedDocument)),this.mode=="version"?(t.append("action","version"),n=this.editedDocument.urlReupload):this.mode=="new"?(t.append("action","new"),n=this.urlUploadNewDoc):this.mode=="edit"&&(t.append("action","edit"),n=this.editedDocument.urlEdit),this.mode!="edit")if(this.fileToDownload!==null)t.append("file",this.fileToDownload,this.fileToDownload.name);else{this.error="Aucun fichier sélectionner a téléverser !";return}M.post(n,t).then(m=>{this.editedDocument=null,this.$emit("fetch")},m=>{this.error=w.error(m)})},handlerChangeFile(t){event.target.files.length!==0&&(this.fileToDownload=event.target.files[0])},handlerNewVersion(t){console.log("handlerNewVersion"),this.fileToDownload=null,this.mode="version",this.editedDocument=t},handlerProcessDetailsOff(){this.processDetails=null},handlerProcessReload(t){let n=new FormData;M.post(t.urlProcessUpdate,n).then(m=>{this.$emit("fetch")},m=>{this.error=w.error(m)})}}},u=t=>(L("data-v-ea12cc20"),t=t(),O(),t),xe={key:0,class:"overlay",style:{"z-index":"10000"}},Ye={class:"overlay-content",style:{"max-width":"50%"}},Fe={key:1,class:"overlay"},Re={class:"overlay-content"},Te={class:"alert-danger alert"},Ne=u(()=>e("i",{class:"icon-attention-1"},null,-1)),Le=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Oe=u(()=>e("i",{class:"icon-valid"},null,-1)),Ae={key:2,class:"overlay"},Ee={class:"overlay-content"},Ue=u(()=>e("i",{class:"icon-doc"},null,-1)),je={key:0},He={key:1},qe={key:2},Ie=u(()=>e("br",null,null,-1)),ze={key:0},Je={key:1},We={class:"row"},Xe={class:"col-md-6"},Be={key:0},Ke=u(()=>e("label",{for:"file"},"Fichier",-1)),Ge=u(()=>e("label",{for:"dateDeposit"},"Date de dépôt",-1)),Qe=u(()=>e("label",{for:"dateSend"},"Date d'envoi",-1)),Ze={class:"col-md-6"},$e={key:0},et=u(()=>e("label",{for:"tabdocument"},"Onglet",-1)),tt=["value"],st={key:1},nt=u(()=>e("label",{for:"typedocument"},"Type de document",-1)),lt={key:0,class:"alert alert-warning"},ot={key:1},it=["value","disabled"],rt={class:"col-md-12"},at=u(()=>e("label",{for:"information"},"Informations",-1)),ct={key:0,class:"col-md-6"},dt={class:"row"},ut={key:0},ht=u(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),mt=["value"],_t=u(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),pt={class:"col-md-6"},ft={key:0},vt=u(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),kt=u(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),gt=u(()=>e("i",{class:"icon-cube"},null,-1)),yt={class:"addon"},Dt=["onClick"],bt={class:"row"},Mt={class:"col-md-12"},wt={class:"buttons-bar"},Pt=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Ct=u(()=>e("i",{class:"icon-valid"},null,-1)),St={key:3,class:"overlay"},Vt={class:"overlay-content"},xt={key:0,class:"alert alert-danger"},Yt={key:1},Ft=["onClick"],Rt=u(()=>e("br",null,null,-1)),Tt={key:0},Nt=u(()=>e("small",null,"Procédure de signature",-1)),Lt=u(()=>e("br",null,null,-1)),Ot={class:"metas"},At={class:"meta"},Et={class:"meta"},Ut={class:"meta"},jt={key:0,class:"alert alert-danger"},Ht={class:"row"},qt={class:"col-md-6"},It=u(()=>e("h5",null,"Destinataires",-1)),zt={class:"recipient"},Jt=["onUpdate:modelValue"],Wt={class:"email"},Xt={class:"fullname"},Bt={class:"col-md-6"},Kt=u(()=>e("h5",null,"Observateurs",-1)),Gt={class:"recipient"},Qt=["onUpdate:modelValue"],Zt={class:"email"},$t={class:"fullname"},es={key:1,class:"alert alert-info"},ts={key:2,class:"alert alert-danger"},ss={class:"buttons-bar"},ns=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),ls=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),os={key:4,class:"overlay"},is={class:"overlay-content",style:{"max-width":"50%"}},rs=u(()=>e("small",null,[e("i",{class:"icon-edit"}),a(" Procédure")],-1)),as=u(()=>e("br",null,null,-1)),cs=u(()=>e("br",null,null,-1)),ds={class:"signature-status-101"},us={class:"status"},hs={class:"metas"},ms={class:"meta"},_s={class:"meta"},ps={class:"meta"},fs={class:"fullname"},vs={class:"email"},ks={class:"status"},gs={class:"status-text"},ys=u(()=>e("strong",null,"Observateurs : ",-1)),Ds={class:"observer-inline"},bs={class:"buttons-bar"},Ms=u(()=>e("i",{class:"icon-cancel-outline"},null,-1)),ws={class:"card-title"},Ps={key:0,class:"picto icon-anchor-outline"},Cs={class:"text-light"},Ss=["title"],Vs=u(()=>e("i",{class:"icon-briefcase"},null,-1)),xs=u(()=>e("i",{class:"icon-calendar"},null,-1)),Ys=u(()=>e("i",{class:"icon-calendar"},null,-1)),Fs=u(()=>e("i",{class:"icon-calendar"},null,-1)),Rs=u(()=>e("i",{class:"icon-user"},null,-1)),Ts={key:0},Ns=u(()=>e("i",{class:"icon-lock"},null,-1)),Ls={class:"cartouche"},Os={class:"card-content"},As=u(()=>e("i",{class:"icon-hammer"},null,-1)),Es=["onClick"],Us=u(()=>e("i",{class:"icon-help-circled"},null,-1)),js=["onClick"],Hs=u(()=>e("i",{class:"icon-trash"},null,-1)),qs=["onClick"],Is=u(()=>e("i",{class:"icon-cw-outline"},null,-1)),zs={key:1},Js=["onClick"],Ws=u(()=>e("i",{class:"icon-cube"},null,-1)),Xs={key:0},Bs=u(()=>e("i",{class:"icon-cubes"},null,-1)),Ks={key:2},Gs=u(()=>e("div",{class:"exploder"}," Versions précédentes : ",-1)),Qs={class:"subdoc text-highlight"},Zs={key:0},$s=["href"],en=u(()=>e("i",{class:"icon-download-outline"},null,-1)),tn={class:"text-right show-over"},sn=["href"],nn=u(()=>e("i",{class:"icon-link-ext"},null,-1)),ln=["onClick"],on=u(()=>e("i",{class:"icon-bank"},null,-1)),rn=["href"],an=u(()=>e("i",{class:"icon-upload-outline"},null,-1)),cn=["onClick"],dn=u(()=>e("i",{class:"icon-download-outline"},null,-1)),un=["onClick"],hn=u(()=>e("i",{class:"icon-trash"},null,-1)),mn=["onClick"],_n=u(()=>e("i",{class:"icon-pencil"},null,-1));function pn(t,n,m,k,l,c){const d=T("date-picker"),y=T("person-auto-completer");return o(),i(f,null,[l.error?(o(),i("div",xe,[e("div",Ye,[e("h2",null,[a(" Erreur "),e("span",{class:"overlay-closer",onClick:n[0]||(n[0]=s=>l.error=null)},"X")]),e("p",null,r(l.error.response&&l.error.response.data?l.error.response.data:l.error),1)])])):_("",!0),l.deleteDocument?(o(),i("div",Fe,[e("div",Re,[e("h2",null,[a(" Supprimer le document ? "),e("span",{class:"overlay-closer",onClick:n[1]||(n[1]=s=>l.deleteDocument=null)},"X")]),e("p",Te,[Ne,a(" Souhaitez-vous supprimer le fichier "),e("strong",null,r(l.deleteDocument.fileName),1),a(" ? ")]),e("button",{class:"btn btn-danger",onClick:n[2]||(n[2]=s=>l.deleteDocument=null)},[Le,a(" Annuler ")]),e("a",{class:"btn btn-success",onClick:n[3]||(n[3]=g(s=>c.handlerDeleteDocumentConfirm(),["prevent"]))},[Oe,a(" Confirmer ")])])])):_("",!0),l.editedDocument?(o(),i("div",Ae,[e("div",Ee,[e("h2",null,[e("small",null,[Ue,l.mode=="new"?(o(),i("span",je,"Téléversement d'un document")):_("",!0),l.mode=="edit"?(o(),i("span",He,"Modification des informations")):_("",!0),l.mode=="version"?(o(),i("span",qe,"Nouvelle version")):_("",!0)]),Ie,l.editedDocument.id>0?(o(),i("span",ze,[e("strong",null,r(l.editedDocument.fileName),1)])):(o(),i("span",Je,[a(" Nouveau document dans "),e("strong",null,r(l.editedDocument.tabDocument.label),1)])),e("span",null," ("+r(l.mode)+") ",1),e("span",{class:"overlay-closer",onClick:n[4]||(n[4]=s=>l.editedDocument=null)},"X")]),e("div",We,[e("div",Xe,[l.mode!="edit"?(o(),i("div",Be,[Ke,e("input",{onChange:n[5]||(n[5]=(...s)=>c.handlerChangeFile&&c.handlerChangeFile(...s)),type:"file",class:"form-control",name:"file",id:"file"},null,32)])):_("",!0),e("div",null,[Ge,C(d,{modelValue:l.editedDocument.dateDeposit,"onUpdate:modelValue":n[6]||(n[6]=s=>l.editedDocument.dateDeposit=s),id:"dateDeposit"},null,8,["modelValue"])]),e("div",null,[Qe,C(d,{modelValue:l.editedDocument.dateSend,"onUpdate:modelValue":n[7]||(n[7]=s=>l.editedDocument.dateSend=s),id:"dateSend"},null,8,["modelValue"])])]),e("div",Ze,[l.mode!="version"?(o(),i("div",$e,[et,e("div",null,[b(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":n[8]||(n[8]=s=>l.editedDocument.tabDocument.id=s),class:"form-control"},[(o(!0),i(f,null,v(m.tabs,(s,h)=>(o(),i("option",{value:h,key:h},r(s.label),9,tt))),128))],512),[[S,l.editedDocument.tabDocument.id]])])])):_("",!0),l.mode!="version"?(o(),i("div",st,[nt,l.editedDocument.process?(o(),i("div",lt," Vous ne pouvez pas modifier le type d'un document engagé dans un processus de signature. ")):(o(),i("div",ot,[b(e("select",{class:"form-control",name:"type",id:"typedocument","onUpdate:modelValue":n[9]||(n[9]=s=>l.editedDocument.category.id=s)},[(o(!0),i(f,null,v(m.types,(s,h)=>(o(),i("option",{value:s.id,key:s.id,disabled:s.flow&&l.editedDocument.id>0},r(s.label)+" "+r(s.flow&&l.editedDocument.id?"(signature)":""),9,it))),128))],512),[[S,l.editedDocument.category.id]])]))])):_("",!0)]),e("div",rt,[at,b(e("textarea",{"onUpdate:modelValue":n[10]||(n[10]=s=>l.editedDocument.information=s),id:"information",class:"form-control"},null,512),[[F,l.editedDocument.information]])]),l.mode=="change"?(o(),i("div",ct,[e("div",dt,[l.editedDocument.private===!1?(o(),i("span",ut,[ht,e("div",null,[b(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":n[11]||(n[11]=s=>l.editedDocument.tabDocument.id=s),class:"form-control"},[(o(!0),i(f,null,v(m.tabs,(s,h)=>(o(),i("option",{value:h,key:h},r(s.label),9,mt))),128))],512),[[S,l.editedDocument.tabDocument.id]])])])):_("",!0),_t,e("div",pt,[b(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":n[12]||(n[12]=s=>l.editedDocument.private=s)},null,512),[[V,l.editedDocument.private]])])]),l.editedDocument.private===!0?(o(),i("span",ft,[vt,kt,C(y,{onChange:t.handlerSelectPersons},null,8,["onChange"]),(o(!0),i(f,null,v(l.editedDocument.persons,s=>(o(),i("span",{key:s.id,class:"cartouche"},[gt,e("span",null,r(s.personName),1),e("span",yt,r(s.affectation),1),s.personId!==t.idCurrentPerson?(o(),i("i",{key:0,onClick:h=>t.handlerDeletePerson(s),class:"icon-trash icon-clickable"},null,8,Dt)):_("",!0)]))),128))])):_("",!0)])):_("",!0)]),e("div",bt,[e("div",Mt,[e("nav",wt,[e("button",{class:"btn btn-danger",onClick:n[13]||(n[13]=s=>l.editedDocument=null)},[Pt,a(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:n[14]||(n[14]=g(s=>c.handlerEditConfirm(),["prevent"]))},[Ct,a(" Enregistrer ")])])])])])])):_("",!0),l.signDocument?(o(),i("div",St,[e("div",Vt,[e("h2",null,[a(" Signature de document numérique "),e("span",{class:"overlay-closer",onClick:n[15]||(n[15]=s=>l.signDocument=null)},"X")]),m.signProcess?(o(),i("div",Yt,[e("nav",null,[a(" Selectionnez un procédure de signature "),(o(!0),i(f,null,v(m.signProcess,s=>(o(),i("span",{class:D(["btn btn-lg btn-default",{"btn-success":l.selectedSignProcess&&l.selectedSignProcess.id==s.id}]),onClick:h=>c.handlerSelectProcess(s)},[e("strong",null,r(s.label),1),Rt,e("em",null,r(s.description)+" ",1)],10,Ft))),256))]),l.selectedSignProcess?(o(),i("section",Tt,[e("h3",null,[Nt,Lt,e("strong",null,r(l.selectedSignProcess.label),1)]),(o(!0),i(f,null,v(l.selectedSignProcess.steps,s=>(o(),i("article",{class:D(["step",s.missing_recipients?"error":"ok"])},[e("h4",null,[a("étape "+r(s.order)+" :",1),e("strong",null,r(s.label),1)]),e("ul",Ot,[e("li",At,[a("Parapheur: "),e("strong",null,r(s.letterfile_label),1)]),e("li",Et,[a("Type: "),e("strong",null,r(s.level_label),1)]),e("li",Ut,[a("Tous signent: "),e("strong",null,r(s.allSignToComplete?"Oui":"non"),1)])]),s.missing_recipients?(o(),i("div",jt," Il manque des destinataires pour cette procédure. ")):_("",!0),e("div",Ht,[e("div",qt,[It,(o(!0),i(f,null,v(s.recipients,h=>(o(),i("div",zt,[s.editable?b((o(),i("input",{key:0,type:"checkbox","onUpdate:modelValue":P=>h.selected=P},null,8,Jt)),[[V,h.selected]]):_("",!0),e("strong",Wt,r(h.email),1),e("span",Xt,r(h.firstname)+" "+r(h.lastname),1)]))),256))]),e("div",Bt,[Kt,s.observers.length?(o(!0),i(f,{key:0},v(s.observers,h=>(o(),i("div",Gt,[s.editable?b((o(),i("input",{key:0,type:"checkbox","onUpdate:modelValue":P=>h.selected=P},null,8,Qt)),[[V,h.selected]]):_("",!0),e("strong",Zt,r(h.email),1),e("span",$t,r(h.firstname)+" "+r(h.lastname),1)]))),256)):(o(),i("div",es," Pas d'observateur pour cette étape "))])])],2))),256))])):_("",!0)])):(o(),i("div",xt," Aucun processus de signature disponible ")),l.signProcessError?(o(),i("div",ts,[a(" Signature non-disponible : "),e("strong",null,r(l.signProcessError),1)])):_("",!0),e("nav",ss,[e("button",{class:"btn btn-default",onClick:n[16]||(n[16]=s=>l.signDocument=null)},[ns,a(" Annuler ")]),e("button",{class:D(["btn btn-success",{disabled:c.handlerPerformSignDocumentDisabled(l.signDocument,l.selectedSignProcess)}]),onClick:n[17]||(n[17]=s=>c.handlerPerformSignDocument(l.signDocument,l.selectedSignProcess))},[ls,a(" Valider ")],2)])])])):_("",!0),l.processDetails?(o(),i("div",os,[e("div",is,[e("h2",null,[rs,a(),as,e("strong",null,r(l.processDetails.label),1),a(),cs,e("span",ds,[a(r(l.processDetails.status_text)+" - ",1),e("em",null,"étape "+r(l.processDetails.current_step)+" / "+r(l.processDetails.total_steps),1)]),e("span",{class:"overlay-closer",onClick:n[18]||(n[18]=(...s)=>c.handlerProcessDetailsOff&&c.handlerProcessDetailsOff(...s))},"X")]),(o(!0),i(f,null,v(l.processDetails.steps,s=>(o(),i("section",{class:D(["signature","signature-status-"+s.status])},[e("h4",null,[e("small",null,"étape "+r(s.order)+" : ",1),e("strong",null,r(s.label),1),e("span",us," ("+r(s.status_text)+")",1)]),e("ul",hs,[e("li",ms,[a("Parapheur "),e("strong",null,r(s.letterfile),1)]),e("li",_s,[a("Niveau "),e("strong",null,r(s.level),1)]),e("li",ps,[a("Tous les destinataires signent "),e("strong",null,r(s.allSignToComplete?"Oui":"Non"),1)])]),(o(!0),i(f,null,v(s.recipients,h=>(o(),i("article",{class:D(["recipient","signature-status-"+h.status])},[e("strong",fs,r(h.fullname),1),e("em",vs,r(h.email),1),e("small",null,r(t.$filters.dateFull(h.dateFinished)),1),e("span",ks,[e("span",gs,r(h.status_text),1)])],2))),256)),ys,(o(!0),i(f,null,v(s.observers,h=>(o(),i("span",Ds,[e("small",null,r(h.firstname),1),a(),e("span",null,r(h.lastname),1)]))),256))],2))),256)),e("div",bs,[e("button",{class:"btn btn-default",onClick:n[19]||(n[19]=(...s)=>c.handlerProcessDetailsOff&&c.handlerProcessDetailsOff(...s))},[Ms,a(" Fermer ")])])])])):_("",!0),(o(!0),i(f,null,v(m.documents,s=>(o(),i("article",{class:D(["card xs",{"private-document":s.private}]),key:s.id},[e("div",ws,[s.location=="link"?(o(),i("i",Ps)):(o(),i("i",{key:1,class:D(["picto icon-doc","doc"+s.extension])},null,2)),e("small",Cs,r(s.category.label)+" ~ ",1),e("strong",null,r(s.fileName),1),s.location!="url"?(o(),i("small",{key:2,class:"text-light",title:s.fileSize+" octet(s)"},"  Version "+r(s.version),9,Ss)):_("",!0)]),e("small",null,[Vs,a(" Taille "),e("strong",null,r(t.$filters.filesize(s.fileSize)),1),xs,a(" Envoyé "),e("strong",null,r(t.$filters.timeAgo(s.dateSend)),1),Ys,a(" Déposé "),e("strong",null,r(t.$filters.dateFull(s.dateDeposit)),1),Fs,a(" Uploadé "),e("strong",null,r(t.$filters.dateFull(s.dateUpload)),1),Rs,a(" par "),e("strong",null,r(s.uploader.displayname),1)]),e("p",null,r(s.information),1),s.private?(o(),i("section",Ts,[Ns,a(" Ce document est privé, accessible par : "),(o(!0),i(f,null,v(s.persons,h=>(o(),i("span",Ls,r(h.personName),1))),256))])):_("",!0),e("div",Os,[s.process?(o(),i("section",{key:0,class:D(["alert",{"alert-success":s.process.status==201,"alert-danger":s.process.status>=400,"alert-info":s.process.status<200}])},[As,a(" Procédure de signature "),e("strong",null,r(s.process.label),1),a(" ("),e("em",null,r(s.process.status_text),1),e("span",null," - étape "+r(s.process.current_step)+" / "+r(s.process.total_steps),1),a(") "),e("button",{class:"btn btn-xs btn-info",onClick:h=>c.handlerProcessDetailsOn(s.process)},[Us,a(" Détails ")],8,Es),s.urlProcessDelete?(o(),i("button",{key:0,class:"btn btn-xs btn-danger",onClick:h=>c.handlerDeleteProcess(s)},[Hs,a(" Annuler la procédure ")],8,js)):_("",!0),s.urlProcessUpdate?(o(),i("button",{key:1,class:"btn btn-default btn-xs",onClick:h=>c.handlerProcessReload(s)},[Is,a(" Actualiser ")],8,qs)):_("",!0)],2)):_("",!0),m.displayActivity?(o(),i("section",zs,[a(" Activité : "),e("span",{class:D({link:s.activity.url_show}),onClick:h=>c.urlShow(s.activity.url_show)},[e("strong",null,[Ws,a(" / "+r(s.activity.num),1)]),a("  "),e("em",null,r(s.activity.label),1),s.activity.project_id?(o(),i("small",Xs,[a(" ("),Bs,a(r(s.activity.project_acronym)+") ",1)])):_("",!0)],10,Js)])):_("",!0),s.versions&&s.versions.length?(o(),i("div",Ks,[Gs,(o(!0),i(f,null,v(s.versions,h=>(o(),i("article",Qs,[e("i",{class:D(["picto icon-doc","doc"+h.extension])},null,2),e("strong",null,r(h.fileName),1),a(" version "),e("em",null,r(h.version),1),a(", téléchargé le "),e("time",null,r(h.dateUpload|t.dateFullSort),1),h.uploader?(o(),i("span",Zs,[a(" par "),e("strong",null,r(h.uploader.displayname),1)])):_("",!0),e("a",{href:h.urlDownload},[en,a(" Télécharger cette version ")],8,$s)]))),256))])):_("",!0),e("nav",tn,[s.location=="url"?(o(),i("a",{key:0,class:"btn btn-default btn-xs",href:s.basename,target:"_blank"},[nn,a(" Accéder au lien ")],8,sn)):_("",!0),s.process_triggerable?(o(),i("a",{key:1,class:"btn btn-default btn-xs",href:"#",onClick:g(h=>c.handlerProcessInit(s),["prevent"])},[on,a(" Signer ce document ")],8,ln)):_("",!0),s.urlDownload&&s.location!="url"?(o(),i("a",{key:2,class:"btn btn-default btn-xs",href:s.urlDownload},[an,a(" Télécharger ")],8,rn)):_("",!0),s.urlReupload?(o(),i("button",{key:3,onClick:h=>c.handlerNewVersion(s),class:"btn btn-default btn-xs"},[dn,a(" Nouvelle Version ")],8,cn)):_("",!0),s.urlDelete?(o(),i("a",{key:4,class:"btn btn-default btn-xs",onClick:g(h=>c.handlerDeleteDocument(s),["prevent"])},[hn,a(" Supprimer ")],8,un)):_("",!0),s.urlEdit?(o(),i("a",{key:5,class:"btn btn-xs btn-default",href:"#",onClick:g(h=>c.handlerEdit(s),["prevent"])},[_n,a(" Modifier ")],8,mn)):_("",!0)])])],2))),128))],64)}const yn=R(Ve,[["render",pn],["__scopeId","data-v-ea12cc20"]]);export{yn as D,Se as P,ie as a,gn as f,kn as m};
