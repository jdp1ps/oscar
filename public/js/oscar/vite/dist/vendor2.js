import{h as p,o as l,c as o,b as e,w as b,i as F,l as Y,k as g,t as r,F as f,f as v,e as _,n as D,d as a,a as M,s as N,r as T,g as C,v as S,j as V,p as L,m as O}from"./vendor.js";import{_ as R}from"./vendor3.js";p.locale("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(s){return s+(s===1?"er":"e")},meridiemParse:/PD|MD/,isPM:function(s){return s.charAt(0)==="M"},meridiem:function(s,n,m){return s<12?"PD":"MD"},week:{dow:1,doy:4}});const yn={timeAgo(s,n="Non définie"){return s?p(s).fromNow():n},date(s,n="Non définie"){return s?"le "+p(s).format("D MMMM YYYY"):n},dateFull(s,n="Non définie"){return s?this.date(s)+" ("+this.timeAgo(s)+")":n}},Dn={filesize(s,n="Inconnue"){if(s){let m="o";return s>1e3&&(s=Math.round(s/1e3),m="Ko"),s>1e3&&(s=Math.round(s/1e3),m="Mo"),s+" "+m}else return n}};p.locale("fr");const A={model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:p().format(),pickerYearRef:p().format("YYYY"),pickerMonthRef:p().month(),realValue:this.modelValue,manualChange:""}},computed:{years(){let s=this.pickerYearRef-11,n=this.pickerYearRef+11,m=[];for(var k=s;k<n;k++)m.push(k);return m},mmValue(){return this.realValue?(p.locale("fr"),p(this.realValue)):p()},pickerData(){var s=this.daysShort,n=p(this.realValue).format(this.valueFormat);let m=p(this.pickerDayRef).startOf("month").startOf("isoWeek"),k=p(this.pickerDayRef).endOf("month").startOf("isoWeek"),i=[];for(;m.unix()<=k.unix();){let c={num:m.week(),days:[]};for(let d=1;d<=7;d++){let y=!this.limitFrom||this.limitFrom&&this.limitFrom<m.format();c.days.push({enabled:y,date:m.format(),active:m.format(this.valueFormat)==n,day:m.format("D")}),m.add(1,"day")}i.push(c)}return{dayslabels:s,weeks:i}},currentMonth(){return p(this.pickerDayRef).format("MMMM")},currentYear(){return p(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(p.locale("fr"),p(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(s){console.log("convert ",s);try{let n=p(s,this.displayFormat);n.isValid()&&this.changeDate(n.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(s){try{var n=p(s.target.value);this.changeDate(n.format(this.valueFormat))}catch(m){console.error("WTF DATE",m)}},handlerSelectMonth(s){let n=this.months.indexOf(s);this.pickerDayRef=p(this.pickerDayRef).month(n).format(),this.pickerMode="day"},handlerSelectYear(s){this.pickerDayRef=p(this.pickerDayRef).year(s).format(),this.pickerMode="day"},changeDate(s){console.log("Modification de la date",s),this.picker=!1,this.realValue=s?p(s).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=p(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=p(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(s){s.preventDefault(),s.stopImmediatePropagation(),s.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(s){this.picker=!1},initPickerVar(){var s=p(this.pickerDayRef?this.pickerDayRef:p());this.pickerYearRef=s.year(),this.pickerMonthRef=s.format("MMMM")}},created(){p.locale(this.i18n),this.pickerDayRef=this.value?this.value:p().format(),this.initPickerVar()}},E={class:"input-group"},U=e("div",{class:"input-group-addon"},[e("i",{class:"icon-calendar"})],-1),j={class:"datepicker-wrapper"},H=e("i",{class:"icon-angle-left"},null,-1),I=[H],q={class:"heading"},z=e("i",{class:"icon-angle-right"},null,-1),J=[z],B={key:0,class:"day-labels week"},W=e("span",{class:"week-label"}," ",-1),X={class:"day-label"},K={key:0},G={class:"weeks"},Q={class:"week"},Z={class:"week-label"},$=["onClick"],ee={key:1,class:"months"},te=["onClick"],se={key:2,class:"years"},ne=["onClick"],le=e("i",{class:"icon-cancel-alt"},null,-1);function oe(s,n,m,k,i,c){return l(),o("div",{onMouseenter:n[9]||(n[9]=(...d)=>c.handlerShow&&c.handlerShow(...d)),onMouseleave:n[10]||(n[10]=(...d)=>c.handlerHide&&c.handlerHide(...d))},[e("div",E,[b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[0]||(n[0]=d=>c.renderValue=d)},null,512),[[F,c.renderValue]]),U]),b(e("div",{class:"datepicker-selector",onMouseleave:n[8]||(n[8]=(...d)=>c.handlerHide&&c.handlerHide(...d))},[e("div",j,[e("header",null,[e("nav",null,[e("span",{href:"#",onClick:n[1]||(n[1]=g((...d)=>c.pickerPrevMonth&&c.pickerPrevMonth(...d),["stop","prevent"]))},I),e("strong",q,[e("span",{class:"currentMonth",onClick:n[2]||(n[2]=g((...d)=>c.handlerPickerMonth&&c.handlerPickerMonth(...d),["stop"]))},r(c.currentMonth),1),e("span",{class:"currentYear",onClick:n[3]||(n[3]=g((...d)=>c.handlerPickerYear&&c.handlerPickerYear(...d),["stop"]))},r(c.currentYear),1)]),e("span",{href:"#",onClick:n[4]||(n[4]=g((...d)=>c.pickerNextMonth&&c.pickerNextMonth(...d),["stop"]))},J)]),i.pickerMode=="day"?(l(),o("div",B,[W,(l(!0),o(f,null,v(c.pickerData.dayslabels,d=>(l(),o("span",X,r(d),1))),256))])):_("",!0)]),i.pickerMode=="day"?(l(),o("section",K,[(l(!0),o(f,null,v(c.pickerData.weeks,d=>(l(),o("div",G,[e("span",Q,[e("span",Z,r(d.num),1),(l(!0),o(f,null,v(d.days,y=>(l(),o("span",{class:D(["week-day",{active:y.active,disabled:!y.enabled}]),onClick:g(t=>c.changeDate(y.date),["prevent","stop"])},r(y.day),11,$))),256))])]))),256))])):_("",!0),i.pickerMode=="month"?(l(),o("section",ee,[(l(!0),o(f,null,v(m.months,d=>(l(),o("span",{class:D(["month",{active:i.pickerMonthRef==d}]),onClick:g(y=>c.handlerSelectMonth(d),["prevent","stop"])},r(d),11,te))),256))])):_("",!0),i.pickerMode=="year"?(l(),o("section",se,[e("span",{class:"year",onClick:n[5]||(n[5]=g(d=>i.pickerYearRef-=22,["prevent","stop"]))},"<<"),(l(!0),o(f,null,v(c.years,d=>(l(),o("span",{class:D(["year",{active:i.pickerYearRef==d}]),onClick:g(y=>c.handlerSelectYear(d),["prevent","stop"])},r(d),11,ne))),256)),e("span",{class:"year",onClick:n[6]||(n[6]=g(d=>i.pickerYearRef+=22,["prevent","stop"]))},">>")])):_("",!0)]),e("div",{style:{"text-align":"center",cursor:"pointer"},onClick:n[7]||(n[7]=(...d)=>c.handlerClear&&c.handlerClear(...d))},[le,a(" Supprimer la date ")])],544),[[Y,i.picker]])],32)}const ie=R(A,[["render",oe]]);let x;const re={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(s,n){s.length>=2&&(x&&clearTimeout(x),x=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,M.get(this.url+this.expression+"&f=json",{before(s){this.request&&this.request.abort(),this.request=s}}).then(s=>{console.log(s),this.persons=s.data.datas,this.showSelector=!0},s=>{console.log(s),s.status==403?this.error="403 Unauthorized":s.message?this.error="ERROR : "+s.message:s.body&&(this.error=s.body)}).then(s=>{this.loading=!1,this.request=null})},handlerSelectPerson(s){let n=this.persons.find(m=>m.id==s);console.log("handlerSelectPerson",n),this.selectedPerson=n,this.showSelector=!1,this.expression="",this.$emit("change",n)}}},ae={key:0,class:"alert alert-danger"},ce=e("i",{class:"icon-spinner animate-spin"},null,-1),de=[ce],ue={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},he=["onClick"],me={style:{display:"block",width:"50px",height:"50px"}},_e=["src","alt"],pe={class:"infos"},fe={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},ve=e("br",null,null,-1),ke={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},ge=e("i",{class:"icon-location"},null,-1),ye={key:0},De=e("br",null,null,-1),be={style:{"font-weight":"100","font-size":".8em"}},Me=e("i",{class:"icon-mail"},null,-1),we={key:1,class:"alert alert-danger"},Pe=e("i",{class:"icon-attention-1"},null,-1);function Ce(s,n,m,k,i,c){return l(),o("div",null,[i.error?(l(),o("div",ae,[a(r(i.error)+" ",1),e("button",{class:"btn btn-default",onClick:n[0]||(n[0]=d=>i.error="")},"Fermer")])):_("",!0),b(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=d=>i.expression=d),onKeyup:n[2]||(n[2]=N(g((...d)=>c.search&&c.search(...d),["prevent"]),["enter"]))},null,544),[[F,i.expression]]),b(e("span",null,de,512),[[Y,i.loading]]),b(e("div",ue,[(l(!0),o(f,null,v(i.persons,d=>(l(),o("div",{class:"choice",key:d.id,onClick:g(y=>c.handlerSelectPerson(d.id),["prevent","stop"])},[e("div",me,[e("img",{src:"https://www.gravatar.com/avatar/"+d.mailMd5+"?s=50",alt:d.displayname,style:{width:"100%"}},null,8,_e)]),e("div",pe,[e("strong",fe,r(d.displayname),1),ve,e("span",ke,[ge,a(" "+r(d.affectation)+" ",1),d.ucbnSiteLocalisation?(l(),o("span",ye," ~ "+r(d.ucbnSiteLocalisation),1)):_("",!0)]),De,e("em",be,[Me,a(r(d.email),1)])])],8,he))),128))],512),[[Y,i.persons.length>0&&i.showSelector]]),i.error?(l(),o("div",we,[Pe,a(" "+r(i.error),1)])):_("",!0)])}const Se=R(re,[["render",Ce]]),w={error(s){return s.request&&s.request.status===403?"Authorisation insuffisante (ou vous avez été déconnecté)":s.response?s.response.data?s.response.data:"Pas de message d'erreur":s.message?s.message:"Erreur inconnue"}};const Ve={components:{"date-picker":ie,"person-auto-completer":Se},props:{editable:{default:!1},displayActivity:{default:!1},documents:{default:[]},signProcess:{default:null},tabs:{default:[]},types:{default:[]},displayButtonSign:{default:!0}},data(){return{deleteDocument:null,signDocument:null,signProcessError:"",selectedSignProcess:null,processDetails:null,error:null,editedDocument:null,mode:null,fileToDownload:null}},methods:{urlShow(s=null){if(console.log(s),s)document.location=s;else return!1},handlerProcessInit(s){console.log("Affichage fenêtre de signature"),this.signDocument=s},handlerPerformSignDocumentDisabled(s,n){if(!n||n.missing_recipients)return!0;for(let m=0;m<n.steps.length;m++){let k=n.steps[m],i=k.editable,c=0;for(let d=0;d<k.recipients.length;d++){let y=k.recipients[d];i?y.selected==!0&&c++:c++}if(c==0)return this.signProcessError="L'étape "+k.order+' "'+k.label+`" n'a pas de destinataire.`,!0}return this.signProcessError="",!1},handlerSelectProcess(s){this.signProcessError="",this.selectedSignProcess=s},handlerPerformSignDocument(s,n){let m=new FormData,k=s.urlProcessCreate;return m.append("document_id",s.id),m.append("flow_datas",JSON.stringify(n)),M.post(k,m).then(i=>{this.signDocument=null,this.selectedSignProcess=null,this.$emit("fetch")},i=>{this.error=w.error(i)}),!1},handlerProcessDetailsOn(s){this.processDetails=s},handlerDeleteProcess(s){console.log("handlerDeleteProcess",s),M.post(s.urlProcessDelete).then(n=>{this.$emit("fetch")},n=>{this.error=w.error(n)})},handlerDeleteDocument(s){this.deleteDocument=s},handlerDeleteDocumentConfirm(){console.log(this.deleteDocument.urlDelete),M.post(this.deleteDocument.urlDelete).then(s=>{this.$emit("fetch")},s=>{this.error=w.error(s)}),this.deleteDocument=null},handlerEdit(s){this.mode="edit",this.editedDocument=s},handlerEditConfirm(){let s=new FormData,n="";if(s.append("data",JSON.stringify(this.editedDocument)),this.mode=="version"?(s.append("action","version"),n=this.editedDocument.urlReupload):this.mode=="new"?(s.append("action","new"),n=this.urlUploadNewDoc):this.mode=="edit"&&(s.append("action","edit"),n=this.editedDocument.urlEdit),this.mode!="edit")if(this.fileToDownload!==null)s.append("file",this.fileToDownload,this.fileToDownload.name);else{this.error="Aucun fichier sélectionner a téléverser !";return}M.post(n,s).then(m=>{this.editedDocument=null,this.$emit("fetch")},m=>{this.error=w.error(m)})},handlerChangeFile(s){event.target.files.length!==0&&(this.fileToDownload=event.target.files[0])},handlerNewVersion(s){console.log("handlerNewVersion"),this.fileToDownload=null,this.mode="version",this.editedDocument=s},handlerProcessDetailsOff(){this.processDetails=null},handlerProcessReload(s){let n=new FormData;M.post(s.urlProcessUpdate,n).then(m=>{this.$emit("fetch")},m=>{this.error=w.error(m)})}}},u=s=>(L("data-v-76cf9512"),s=s(),O(),s),xe={key:0,class:"overlay",style:{"z-index":"10000"}},Ye={class:"overlay-content",style:{"max-width":"50%"}},Fe={key:1,class:"overlay"},Re={class:"overlay-content"},Te={class:"alert-danger alert"},Ne=u(()=>e("i",{class:"icon-attention-1"},null,-1)),Le=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Oe=u(()=>e("i",{class:"icon-valid"},null,-1)),Ae={key:2,class:"overlay"},Ee={class:"overlay-content"},Ue=u(()=>e("i",{class:"icon-doc"},null,-1)),je={key:0},He={key:1},Ie={key:2},qe=u(()=>e("br",null,null,-1)),ze={key:0},Je={key:1},Be={class:"row"},We={class:"col-md-6"},Xe={key:0},Ke=u(()=>e("label",{for:"file"},"Fichier",-1)),Ge=u(()=>e("label",{for:"dateDeposit"},"Date de dépôt",-1)),Qe=u(()=>e("label",{for:"dateSend"},"Date d'envoi",-1)),Ze={class:"col-md-6"},$e={key:0},et=u(()=>e("label",{for:"tabdocument"},"Onglet",-1)),tt=["value"],st={key:1},nt=u(()=>e("label",{for:"typedocument"},"Type de document",-1)),lt={key:0,class:"alert alert-warning"},ot={key:1},it=["value","disabled"],rt={class:"col-md-12"},at=u(()=>e("label",{for:"information"},"Informations",-1)),ct={key:0,class:"col-md-6"},dt={class:"row"},ut={key:0},ht=u(()=>e("label",{for:"tabdocument"},"Onglet document",-1)),mt=["value"],_t=u(()=>e("div",{class:"col-md-6"},[e("label",{for:"private"},"Document privé")],-1)),pt={class:"col-md-6"},ft={key:0},vt=u(()=>e("label",null,"Choix des personnes ayant accès à ce document",-1)),kt=u(()=>e("h3",null,"Ce document sera classé automatiquement dans l'onglet privé",-1)),gt=u(()=>e("i",{class:"icon-cube"},null,-1)),yt={class:"addon"},Dt=["onClick"],bt={class:"row"},Mt={class:"col-md-12"},wt={class:"buttons-bar"},Pt=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),Ct=u(()=>e("i",{class:"icon-valid"},null,-1)),St={key:3,class:"overlay"},Vt={class:"overlay-content"},xt={key:0,class:"alert alert-danger"},Yt={key:1},Ft=["onClick"],Rt=u(()=>e("br",null,null,-1)),Tt={key:0},Nt=u(()=>e("small",null,"Procédure de signature",-1)),Lt=u(()=>e("br",null,null,-1)),Ot={class:"metas"},At={class:"meta"},Et={class:"meta"},Ut={class:"meta"},jt={key:0,class:"alert alert-danger"},Ht={class:"row"},It={class:"col-md-6"},qt=u(()=>e("h5",null,"Destinataires",-1)),zt={class:"recipient"},Jt=["onUpdate:modelValue"],Bt={class:"email"},Wt={class:"fullname"},Xt={class:"col-md-6"},Kt=u(()=>e("h5",null,"Observateurs",-1)),Gt={class:"recipient"},Qt=["onUpdate:modelValue"],Zt={class:"email"},$t={class:"fullname"},es={key:1,class:"alert alert-info"},ts={key:2,class:"alert alert-danger"},ss={class:"buttons-bar"},ns=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),ls=u(()=>e("i",{class:"icon-cancel-alt"},null,-1)),os={key:4,class:"overlay"},is={class:"overlay-content",style:{"max-width":"50%"}},rs=u(()=>e("small",null,[e("i",{class:"icon-edit"}),a(" Procédure")],-1)),as=u(()=>e("br",null,null,-1)),cs=u(()=>e("br",null,null,-1)),ds={class:"signature-status-101"},us={class:"status"},hs={class:"metas"},ms={class:"meta"},_s={class:"meta"},ps={class:"meta"},fs={class:"fullname"},vs={class:"email"},ks={class:"status"},gs={class:"status-text"},ys=u(()=>e("strong",null,"Observateurs : ",-1)),Ds={class:"observer-inline"},bs={class:"buttons-bar"},Ms=u(()=>e("i",{class:"icon-cancel-outline"},null,-1)),ws={class:"card-title"},Ps={key:0,class:"picto icon-anchor-outline"},Cs={class:"text-light"},Ss=["title"],Vs=u(()=>e("i",{class:"icon-briefcase"},null,-1)),xs=u(()=>e("i",{class:"icon-calendar"},null,-1)),Ys=u(()=>e("i",{class:"icon-calendar"},null,-1)),Fs=u(()=>e("i",{class:"icon-calendar"},null,-1)),Rs=u(()=>e("i",{class:"icon-user"},null,-1)),Ts={key:0},Ns={key:1},Ls={key:0},Os=u(()=>e("i",{class:"icon-lock"},null,-1)),As={class:"cartouche"},Es={class:"card-content"},Us=u(()=>e("i",{class:"icon-hammer"},null,-1)),js=["onClick"],Hs=u(()=>e("i",{class:"icon-help-circled"},null,-1)),Is=["onClick"],qs=u(()=>e("i",{class:"icon-trash"},null,-1)),zs=["onClick"],Js=u(()=>e("i",{class:"icon-cw-outline"},null,-1)),Bs={key:1},Ws=["onClick"],Xs=u(()=>e("i",{class:"icon-cube"},null,-1)),Ks={key:0},Gs=u(()=>e("i",{class:"icon-cubes"},null,-1)),Qs={key:2},Zs=u(()=>e("div",{class:"exploder"}," Versions précédentes : ",-1)),$s={class:"subdoc text-highlight"},en={key:0},tn=["href"],sn=u(()=>e("i",{class:"icon-download-outline"},null,-1)),nn={class:"text-right show-over"},ln=["href"],on=u(()=>e("i",{class:"icon-link-ext"},null,-1)),rn=["onClick"],an=u(()=>e("i",{class:"icon-bank"},null,-1)),cn=["href"],dn=u(()=>e("i",{class:"icon-upload-outline"},null,-1)),un=["onClick"],hn=u(()=>e("i",{class:"icon-download-outline"},null,-1)),mn=["onClick"],_n=u(()=>e("i",{class:"icon-trash"},null,-1)),pn=["onClick"],fn=u(()=>e("i",{class:"icon-pencil"},null,-1));function vn(s,n,m,k,i,c){const d=T("date-picker"),y=T("person-auto-completer");return l(),o(f,null,[i.error?(l(),o("div",xe,[e("div",Ye,[e("h2",null,[a(" Erreur "),e("span",{class:"overlay-closer",onClick:n[0]||(n[0]=t=>i.error=null)},"X")]),e("p",null,r(i.error.response&&i.error.response.data?i.error.response.data:i.error),1)])])):_("",!0),i.deleteDocument?(l(),o("div",Fe,[e("div",Re,[e("h2",null,[a(" Supprimer le document ? "),e("span",{class:"overlay-closer",onClick:n[1]||(n[1]=t=>i.deleteDocument=null)},"X")]),e("p",Te,[Ne,a(" Souhaitez-vous supprimer le fichier "),e("strong",null,r(i.deleteDocument.fileName),1),a(" ? ")]),e("button",{class:"btn btn-danger",onClick:n[2]||(n[2]=t=>i.deleteDocument=null)},[Le,a(" Annuler ")]),e("a",{class:"btn btn-success",onClick:n[3]||(n[3]=g(t=>c.handlerDeleteDocumentConfirm(),["prevent"]))},[Oe,a(" Confirmer ")])])])):_("",!0),i.editedDocument?(l(),o("div",Ae,[e("div",Ee,[e("h2",null,[e("small",null,[Ue,i.mode=="new"?(l(),o("span",je,"Téléversement d'un document")):_("",!0),i.mode=="edit"?(l(),o("span",He,"Modification des informations")):_("",!0),i.mode=="version"?(l(),o("span",Ie,"Nouvelle version")):_("",!0)]),qe,i.editedDocument.id>0?(l(),o("span",ze,[e("strong",null,r(i.editedDocument.fileName),1)])):(l(),o("span",Je,[a(" Nouveau document dans "),e("strong",null,r(i.editedDocument.tabDocument.label),1)])),e("span",null," ("+r(i.mode)+") ",1),e("span",{class:"overlay-closer",onClick:n[4]||(n[4]=t=>i.editedDocument=null)},"X")]),e("div",Be,[e("div",We,[i.mode!="edit"?(l(),o("div",Xe,[Ke,e("input",{onChange:n[5]||(n[5]=(...t)=>c.handlerChangeFile&&c.handlerChangeFile(...t)),type:"file",class:"form-control",name:"file",id:"file"},null,32)])):_("",!0),e("div",null,[Ge,C(d,{modelValue:i.editedDocument.dateDeposit,"onUpdate:modelValue":n[6]||(n[6]=t=>i.editedDocument.dateDeposit=t),id:"dateDeposit"},null,8,["modelValue"])]),e("div",null,[Qe,C(d,{modelValue:i.editedDocument.dateSend,"onUpdate:modelValue":n[7]||(n[7]=t=>i.editedDocument.dateSend=t),id:"dateSend"},null,8,["modelValue"])])]),e("div",Ze,[i.mode!="version"?(l(),o("div",$e,[et,e("div",null,[b(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":n[8]||(n[8]=t=>i.editedDocument.tabDocument.id=t),class:"form-control"},[(l(!0),o(f,null,v(m.tabs,(t,h)=>(l(),o("option",{value:h,key:h},r(t.label),9,tt))),128))],512),[[S,i.editedDocument.tabDocument.id]])])])):_("",!0),i.mode!="version"?(l(),o("div",st,[nt,i.editedDocument.process?(l(),o("div",lt," Vous ne pouvez pas modifier le type d'un document engagé dans un processus de signature. ")):(l(),o("div",ot,[b(e("select",{class:"form-control",name:"type",id:"typedocument","onUpdate:modelValue":n[9]||(n[9]=t=>i.editedDocument.category.id=t)},[(l(!0),o(f,null,v(m.types,(t,h)=>(l(),o("option",{value:t.id,key:t.id,disabled:t.flow&&i.editedDocument.id>0},r(t.label)+" "+r(t.flow&&i.editedDocument.id?"(signature)":""),9,it))),128))],512),[[S,i.editedDocument.category.id]])]))])):_("",!0)]),e("div",rt,[at,b(e("textarea",{"onUpdate:modelValue":n[10]||(n[10]=t=>i.editedDocument.information=t),id:"information",class:"form-control"},null,512),[[F,i.editedDocument.information]])]),i.mode=="change"?(l(),o("div",ct,[e("div",dt,[i.editedDocument.private===!1?(l(),o("span",ut,[ht,e("div",null,[b(e("select",{name:"tabdocument",id:"tabdocument","onUpdate:modelValue":n[11]||(n[11]=t=>i.editedDocument.tabDocument.id=t),class:"form-control"},[(l(!0),o(f,null,v(m.tabs,(t,h)=>(l(),o("option",{value:h,key:h},r(t.label),9,mt))),128))],512),[[S,i.editedDocument.tabDocument.id]])])])):_("",!0),_t,e("div",pt,[b(e("input",{type:"checkbox",name:"private",id:"privateModifDoc",class:"form-control","onUpdate:modelValue":n[12]||(n[12]=t=>i.editedDocument.private=t)},null,512),[[V,i.editedDocument.private]])])]),i.editedDocument.private===!0?(l(),o("span",ft,[vt,kt,C(y,{onChange:s.handlerSelectPersons},null,8,["onChange"]),(l(!0),o(f,null,v(i.editedDocument.persons,t=>(l(),o("span",{key:t.id,class:"cartouche"},[gt,e("span",null,r(t.personName),1),e("span",yt,r(t.affectation),1),t.personId!==s.idCurrentPerson?(l(),o("i",{key:0,onClick:h=>s.handlerDeletePerson(t),class:"icon-trash icon-clickable"},null,8,Dt)):_("",!0)]))),128))])):_("",!0)])):_("",!0)]),e("div",bt,[e("div",Mt,[e("nav",wt,[e("button",{class:"btn btn-danger",onClick:n[13]||(n[13]=t=>i.editedDocument=null)},[Pt,a(" Annuler ")]),e("a",{class:"btn btn-success",href:"#",onClick:n[14]||(n[14]=g(t=>c.handlerEditConfirm(),["prevent"]))},[Ct,a(" Enregistrer ")])])])])])])):_("",!0),i.signDocument?(l(),o("div",St,[e("div",Vt,[e("h2",null,[a(" Signature de document numérique "),e("span",{class:"overlay-closer",onClick:n[15]||(n[15]=t=>i.signDocument=null)},"X")]),m.signProcess?(l(),o("div",Yt,[e("nav",null,[a(" Selectionnez un procédure de signature "),(l(!0),o(f,null,v(m.signProcess,t=>(l(),o("span",{class:D(["btn btn-lg btn-default",{"btn-success":i.selectedSignProcess&&i.selectedSignProcess.id==t.id}]),onClick:h=>c.handlerSelectProcess(t)},[e("strong",null,r(t.label),1),Rt,e("em",null,r(t.description)+" ",1)],10,Ft))),256))]),i.selectedSignProcess?(l(),o("section",Tt,[e("h3",null,[Nt,Lt,e("strong",null,r(i.selectedSignProcess.label),1)]),(l(!0),o(f,null,v(i.selectedSignProcess.steps,t=>(l(),o("article",{class:D(["step",t.missing_recipients?"error":"ok"])},[e("h4",null,[a("étape "+r(t.order)+" :",1),e("strong",null,r(t.label),1)]),e("ul",Ot,[e("li",At,[a("Parapheur: "),e("strong",null,r(t.letterfile_label),1)]),e("li",Et,[a("Type: "),e("strong",null,r(t.level_label),1)]),e("li",Ut,[a("Tous signent: "),e("strong",null,r(t.allSignToComplete?"Oui":"non"),1)])]),t.missing_recipients?(l(),o("div",jt," Il manque des destinataires pour cette procédure. ")):_("",!0),e("div",Ht,[e("div",It,[qt,(l(!0),o(f,null,v(t.recipients,h=>(l(),o("div",zt,[t.editable?b((l(),o("input",{key:0,type:"checkbox","onUpdate:modelValue":P=>h.selected=P},null,8,Jt)),[[V,h.selected]]):_("",!0),e("strong",Bt,r(h.email),1),e("span",Wt,r(h.firstname)+" "+r(h.lastname),1)]))),256))]),e("div",Xt,[Kt,t.observers.length?(l(!0),o(f,{key:0},v(t.observers,h=>(l(),o("div",Gt,[t.editable?b((l(),o("input",{key:0,type:"checkbox","onUpdate:modelValue":P=>h.selected=P},null,8,Qt)),[[V,h.selected]]):_("",!0),e("strong",Zt,r(h.email),1),e("span",$t,r(h.firstname)+" "+r(h.lastname),1)]))),256)):(l(),o("div",es," Pas d'observateur pour cette étape "))])])],2))),256))])):_("",!0)])):(l(),o("div",xt," Aucun processus de signature disponible ")),i.signProcessError?(l(),o("div",ts,[a(" Signature non-disponible : "),e("strong",null,r(i.signProcessError),1)])):_("",!0),e("nav",ss,[e("button",{class:"btn btn-default",onClick:n[16]||(n[16]=t=>i.signDocument=null)},[ns,a(" Annuler ")]),e("button",{class:D(["btn btn-success",{disabled:c.handlerPerformSignDocumentDisabled(i.signDocument,i.selectedSignProcess)}]),onClick:n[17]||(n[17]=t=>c.handlerPerformSignDocument(i.signDocument,i.selectedSignProcess))},[ls,a(" Valider ")],2)])])])):_("",!0),i.processDetails?(l(),o("div",os,[e("div",is,[e("h2",null,[rs,a(),as,e("strong",null,r(i.processDetails.label),1),a(),cs,e("span",ds,[a(r(i.processDetails.status_text)+" - ",1),e("em",null,"étape "+r(i.processDetails.current_step)+" / "+r(i.processDetails.total_steps),1)]),e("span",{class:"overlay-closer",onClick:n[18]||(n[18]=(...t)=>c.handlerProcessDetailsOff&&c.handlerProcessDetailsOff(...t))},"X")]),(l(!0),o(f,null,v(i.processDetails.steps,t=>(l(),o("section",{class:D(["signature","signature-status-"+t.status])},[e("h4",null,[e("small",null,"étape "+r(t.order)+" : ",1),e("strong",null,r(t.label),1),e("span",us," ("+r(t.status_text)+")",1)]),e("ul",hs,[e("li",ms,[a("Parapheur "),e("strong",null,r(t.letterfile),1)]),e("li",_s,[a("Niveau "),e("strong",null,r(t.level),1)]),e("li",ps,[a("Tous les destinataires signent "),e("strong",null,r(t.allSignToComplete?"Oui":"Non"),1)])]),(l(!0),o(f,null,v(t.recipients,h=>(l(),o("article",{class:D(["recipient","signature-status-"+h.status])},[e("strong",fs,r(h.fullname),1),e("em",vs,r(h.email),1),e("small",null,r(s.$filters.dateFull(h.dateFinished)),1),e("span",ks,[e("span",gs,r(h.status_text),1)])],2))),256)),ys,(l(!0),o(f,null,v(t.observers,h=>(l(),o("span",Ds,[e("small",null,r(h.firstname),1),a(),e("span",null,r(h.lastname),1)]))),256))],2))),256)),e("div",bs,[e("button",{class:"btn btn-default",onClick:n[19]||(n[19]=(...t)=>c.handlerProcessDetailsOff&&c.handlerProcessDetailsOff(...t))},[Ms,a(" Fermer ")])])])])):_("",!0),(l(!0),o(f,null,v(m.documents,t=>(l(),o("article",{class:D(["card xs",{"private-document":t.private}]),key:t.id},[e("div",ws,[t.location=="link"?(l(),o("i",Ps)):(l(),o("i",{key:1,class:D(["picto icon-doc","doc"+t.extension])},null,2)),e("small",Cs,r(t.category.label)+" ~ ",1),e("strong",null,r(t.fileName),1),t.location!="url"?(l(),o("small",{key:2,class:"text-light",title:t.fileSize+" octet(s)"},"  Version "+r(t.version),9,Ss)):_("",!0)]),e("small",null,[Vs,a(" Taille "),e("strong",null,r(s.$filters.filesize(t.fileSize)),1),xs,a(" Envoyé "),e("strong",null,r(s.$filters.timeAgo(t.dateSend)),1),Ys,a(" Déposé "),e("strong",null,r(s.$filters.dateFull(t.dateDeposit)),1),Fs,a(" Uploadé "),e("strong",null,r(s.$filters.dateFull(t.dateUpload)),1),Rs,a(" par "),t.uploader?(l(),o("strong",Ts,r(t.uploader.displayname),1)):(l(),o("em",Ns,"Inconnu"))]),e("p",null,r(t.information),1),t.private?(l(),o("section",Ls,[Os,a(" Ce document est privé, accessible par : "),(l(!0),o(f,null,v(t.persons,h=>(l(),o("span",As,r(h.personName),1))),256))])):_("",!0),e("div",Es,[t.process?(l(),o("section",{key:0,class:D(["alert",{"alert-success":t.process.status==201,"alert-danger":t.process.status>=400,"alert-info":t.process.status<200}])},[Us,a(" Procédure de signature "),e("strong",null,r(t.process.label),1),a(" ("),e("em",null,r(t.process.status_text),1),e("span",null," - étape "+r(t.process.current_step)+" / "+r(t.process.total_steps),1),a(") "),e("button",{class:"btn btn-xs btn-info",onClick:h=>c.handlerProcessDetailsOn(t.process)},[Hs,a(" Détails ")],8,js),t.urlProcessDelete?(l(),o("button",{key:0,class:"btn btn-xs btn-danger",onClick:h=>c.handlerDeleteProcess(t)},[qs,a(" Annuler la procédure ")],8,Is)):_("",!0),t.urlProcessUpdate?(l(),o("button",{key:1,class:"btn btn-default btn-xs",onClick:h=>c.handlerProcessReload(t)},[Js,a(" Actualiser ")],8,zs)):_("",!0)],2)):_("",!0),m.displayActivity?(l(),o("section",Bs,[a(" Activité : "),e("span",{class:D({link:t.activity.url_show}),onClick:h=>c.urlShow(t.activity.url_show)},[e("strong",null,[Xs,a(" / "+r(t.activity.num),1)]),a("  "),e("em",null,r(t.activity.label),1),t.activity.project_id?(l(),o("small",Ks,[a(" ("),Gs,a(r(t.activity.project_acronym)+") ",1)])):_("",!0)],10,Ws)])):_("",!0),t.versions&&t.versions.length?(l(),o("div",Qs,[Zs,(l(!0),o(f,null,v(t.versions,h=>(l(),o("article",$s,[e("i",{class:D(["picto icon-doc","doc"+h.extension])},null,2),e("strong",null,r(h.fileName),1),a(" version "),e("em",null,r(h.version),1),a(", téléchargé le "),e("time",null,r(h.dateUpload|s.dateFullSort),1),h.uploader?(l(),o("span",en,[a(" par "),e("strong",null,r(h.uploader.displayname),1)])):_("",!0),e("a",{href:h.urlDownload},[sn,a(" Télécharger cette version ")],8,tn)]))),256))])):_("",!0),e("nav",nn,[t.location=="url"?(l(),o("a",{key:0,class:"btn btn-default btn-xs",href:t.basename,target:"_blank"},[on,a(" Accéder au lien ")],8,ln)):_("",!0),t.process_triggerable&&m.displayButtonSign?(l(),o("a",{key:1,class:"btn btn-default btn-xs",href:"#",onClick:g(h=>c.handlerProcessInit(t),["prevent"])},[an,a(" Signer ce document ")],8,rn)):_("",!0),t.urlDownload&&t.location!="url"?(l(),o("a",{key:2,class:"btn btn-default btn-xs",href:t.urlDownload},[dn,a(" Télécharger ")],8,cn)):_("",!0),t.urlReupload?(l(),o("button",{key:3,onClick:h=>c.handlerNewVersion(t),class:"btn btn-default btn-xs"},[hn,a(" Nouvelle Version ")],8,un)):_("",!0),t.urlDelete?(l(),o("a",{key:4,class:"btn btn-default btn-xs",onClick:g(h=>c.handlerDeleteDocument(t),["prevent"])},[_n,a(" Supprimer ")],8,mn)):_("",!0),t.urlEdit?(l(),o("a",{key:5,class:"btn btn-xs btn-default",href:"#",onClick:g(h=>c.handlerEdit(t),["prevent"])},[fn,a(" Modifier ")],8,pn)):_("",!0)])])],2))),128))],64)}const bn=R(Ve,[["render",vn],["__scopeId","data-v-76cf9512"]]);export{bn as D,Se as P,ie as a,Dn as f,yn as m};
