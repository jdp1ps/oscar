import{h as l,o as n,c as o,b as s,w as v,i as D,l as g,k as d,t as c,F as m,f as k,e as f,n as _,d as y,a as Y,s as V}from"./vendor.js";import{_ as w}from"./vendor4.js";l.locale("fr");const R={model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:l().format(),pickerYearRef:l().format("YYYY"),pickerMonthRef:l().month(),realValue:this.modelValue,manualChange:""}},computed:{years(){let r=this.pickerYearRef-11,t=this.pickerYearRef+11,h=[];for(var p=r;p<t;p++)h.push(p);return h},mmValue(){return this.realValue?(l.locale("fr"),l(this.realValue)):l()},pickerData(){var r=this.daysShort,t=l(this.realValue).format(this.valueFormat);let h=l(this.pickerDayRef).startOf("month").startOf("isoWeek"),p=l(this.pickerDayRef).endOf("month").startOf("isoWeek"),i=[];for(;h.unix()<=p.unix();){let a={num:h.week(),days:[]};for(let e=1;e<=7;e++){let u=!this.limitFrom||this.limitFrom&&this.limitFrom<h.format();a.days.push({enabled:u,date:h.format(),active:h.format(this.valueFormat)==t,day:h.format("D")}),h.add(1,"day")}i.push(a)}return{dayslabels:r,weeks:i}},currentMonth(){return l(this.pickerDayRef).format("MMMM")},currentYear(){return l(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(l.locale("fr"),l(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(r){console.log("convert ",r);try{let t=l(r,this.displayFormat);t.isValid()&&this.changeDate(t.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(r){try{var t=l(r.target.value);this.changeDate(t.format(this.valueFormat))}catch(h){console.error("WTF DATE",h)}},handlerSelectMonth(r){let t=this.months.indexOf(r);this.pickerDayRef=l(this.pickerDayRef).month(t).format(),this.pickerMode="day"},handlerSelectYear(r){this.pickerDayRef=l(this.pickerDayRef).year(r).format(),this.pickerMode="day"},changeDate(r){console.log("Modification de la date",r),this.picker=!1,this.realValue=r?l(r).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=l(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=l(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(r){r.preventDefault(),r.stopImmediatePropagation(),r.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(r){this.picker=!1},initPickerVar(){var r=l(this.pickerDayRef?this.pickerDayRef:l());this.pickerYearRef=r.year(),this.pickerMonthRef=r.format("MMMM")}},created(){l.locale(this.i18n),this.pickerDayRef=this.value?this.value:l().format(),this.initPickerVar()}},b={class:"input-group"},x=s("div",{class:"input-group-addon"},[s("i",{class:"icon-calendar"})],-1),C={class:"datepicker-wrapper"},S=s("i",{class:"icon-angle-left"},null,-1),P=[S],F={class:"heading"},O=s("i",{class:"icon-angle-right"},null,-1),N=[O],q={key:0,class:"day-labels week"},z=s("span",{class:"week-label"}," ",-1),H={class:"day-label"},T={key:0},A={class:"weeks"},E={class:"week"},J={class:"week-label"},L=["onClick"],U={key:1,class:"months"},B=["onClick"],I={key:2,class:"years"},W=["onClick"],K=s("i",{class:"icon-cancel-alt"},null,-1);function j(r,t,h,p,i,a){return n(),o("div",{onMouseenter:t[9]||(t[9]=(...e)=>a.handlerShow&&a.handlerShow(...e)),onMouseleave:t[10]||(t[10]=(...e)=>a.handlerHide&&a.handlerHide(...e))},[s("div",b,[v(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>a.renderValue=e)},null,512),[[D,a.renderValue]]),x]),v(s("div",{class:"datepicker-selector",onMouseleave:t[8]||(t[8]=(...e)=>a.handlerHide&&a.handlerHide(...e))},[s("div",C,[s("header",null,[s("nav",null,[s("span",{href:"#",onClick:t[1]||(t[1]=d((...e)=>a.pickerPrevMonth&&a.pickerPrevMonth(...e),["stop","prevent"]))},P),s("strong",F,[s("span",{class:"currentMonth",onClick:t[2]||(t[2]=d((...e)=>a.handlerPickerMonth&&a.handlerPickerMonth(...e),["stop"]))},c(a.currentMonth),1),s("span",{class:"currentYear",onClick:t[3]||(t[3]=d((...e)=>a.handlerPickerYear&&a.handlerPickerYear(...e),["stop"]))},c(a.currentYear),1)]),s("span",{href:"#",onClick:t[4]||(t[4]=d((...e)=>a.pickerNextMonth&&a.pickerNextMonth(...e),["stop"]))},N)]),i.pickerMode=="day"?(n(),o("div",q,[z,(n(!0),o(m,null,k(a.pickerData.dayslabels,e=>(n(),o("span",H,c(e),1))),256))])):f("",!0)]),i.pickerMode=="day"?(n(),o("section",T,[(n(!0),o(m,null,k(a.pickerData.weeks,e=>(n(),o("div",A,[s("span",E,[s("span",J,c(e.num),1),(n(!0),o(m,null,k(e.days,u=>(n(),o("span",{class:_(["week-day",{active:u.active,disabled:!u.enabled}]),onClick:d(me=>a.changeDate(u.date),["prevent","stop"])},c(u.day),11,L))),256))])]))),256))])):f("",!0),i.pickerMode=="month"?(n(),o("section",U,[(n(!0),o(m,null,k(h.months,e=>(n(),o("span",{class:_(["month",{active:i.pickerMonthRef==e}]),onClick:d(u=>a.handlerSelectMonth(e),["prevent","stop"])},c(e),11,B))),256))])):f("",!0),i.pickerMode=="year"?(n(),o("section",I,[s("span",{class:"year",onClick:t[5]||(t[5]=d(e=>i.pickerYearRef-=22,["prevent","stop"]))},"<<"),(n(!0),o(m,null,k(a.years,e=>(n(),o("span",{class:_(["year",{active:i.pickerYearRef==e}]),onClick:d(u=>a.handlerSelectYear(e),["prevent","stop"])},c(e),11,W))),256)),s("span",{class:"year",onClick:t[6]||(t[6]=d(e=>i.pickerYearRef+=22,["prevent","stop"]))},">>")])):f("",!0)]),s("div",{style:{"text-align":"center",cursor:"pointer"},onClick:t[7]||(t[7]=(...e)=>a.handlerClear&&a.handlerClear(...e))},[K,y(" Supprimer la date ")])],544),[[g,i.picker]])],32)}const ve=w(R,[["render",j]]);let M;const G={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(r,t){r.length>=2&&(M&&clearTimeout(M),M=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,Y.get(this.url+this.expression+"&f=json",{before(r){this.request&&this.request.abort(),this.request=r}}).then(r=>{console.log(r),this.persons=r.data.datas,this.showSelector=!0},r=>{console.log(r),r.status==403?this.error="403 Unauthorized":r.message?this.error="ERROR : "+r.message:r.body&&(this.error=r.body)}).then(r=>{this.loading=!1,this.request=null})},handlerSelectPerson(r){let t=this.persons.find(h=>h.id==r);console.log("handlerSelectPerson",t),this.selectedPerson=t,this.showSelector=!1,this.expression="",this.$emit("change",t)}}},Q={key:0,class:"alert alert-danger"},X=s("i",{class:"icon-spinner animate-spin"},null,-1),Z=[X],$={class:"choose",style:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},ee=["onClick"],te={style:{display:"block",width:"50px",height:"50px"}},re=["src","alt"],se={class:"infos"},ae={style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},le=s("br",null,null,-1),ie={style:{"font-weight":"100","font-size":".8em","padding-left":"0"}},ne=s("i",{class:"icon-location"},null,-1),oe={key:0},he=s("br",null,null,-1),ce={style:{"font-weight":"100","font-size":".8em"}},de=s("i",{class:"icon-mail"},null,-1),ue={key:1,class:"alert alert-danger"},pe=s("i",{class:"icon-attention-1"},null,-1);function fe(r,t,h,p,i,a){return n(),o("div",null,[i.error?(n(),o("div",Q,[y(c(i.error)+" ",1),s("button",{class:"btn btn-default",onClick:t[0]||(t[0]=e=>i.error="")},"Fermer")])):f("",!0),v(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i.expression=e),onKeyup:t[2]||(t[2]=V(d((...e)=>a.search&&a.search(...e),["prevent"]),["enter"]))},null,544),[[D,i.expression]]),v(s("span",null,Z,512),[[g,i.loading]]),v(s("div",$,[(n(!0),o(m,null,k(i.persons,e=>(n(),o("div",{class:"choice",key:e.id,onClick:d(u=>a.handlerSelectPerson(e.id),["prevent","stop"])},[s("div",te,[s("img",{src:"https://www.gravatar.com/avatar/"+e.mailMd5+"?s=50",alt:e.displayname,style:{width:"100%"}},null,8,re)]),s("div",se,[s("strong",ae,c(e.displayname),1),le,s("span",ie,[ne,y(" "+c(e.affectation)+" ",1),e.ucbnSiteLocalisation?(n(),o("span",oe," ~ "+c(e.ucbnSiteLocalisation),1)):f("",!0)]),he,s("em",ce,[de,y(c(e.email),1)])])],8,ee))),128))],512),[[g,i.persons.length>0&&i.showSelector]]),i.error?(n(),o("div",ue,[pe,y(" "+c(i.error),1)])):f("",!0)])}const _e=w(G,[["render",fe]]);export{ve as D,_e as P};
