import{h as a,o as n,c as o,b as r,w as f,i as V,l as _,k as u,t as c,F as y,f as v,e as p,n as M,d as k,a as w,j as R}from"./vendor.js";import{_ as Y}from"./vendor4.js";a.locale("fr");const C={model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{default:null},i18n:{default:"fr"},limitFrom:{default:null},daysShort:{default:()=>["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]},months:{default:()=>["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"]},valueFormat:{default:"YYYY-MM-DD"},displayFormat:{default:"D MMMM YYYY"},format:{default:"dddd D MMMM YYYY"}},data(){return{picker:!1,pickerMode:"day",pickerDayRef:a().format(),pickerYearRef:a().format("YYYY"),pickerMonthRef:a().month(),realValue:this.modelValue,manualChange:""}},computed:{years(){let s=this.pickerYearRef-11,t=this.pickerYearRef+11,d=[];for(var m=s;m<t;m++)d.push(m);return d},mmValue(){return this.realValue?(a.locale("fr"),a(this.realValue)):a()},pickerData(){var s=this.daysShort,t=a(this.realValue).format(this.valueFormat);let d=a(this.pickerDayRef).startOf("month").startOf("isoWeek"),m=a(this.pickerDayRef).endOf("month").startOf("isoWeek"),i=[];for(;d.unix()<=m.unix();){let l={num:d.week(),days:[]};for(let e=1;e<=7;e++){let h=!this.limitFrom||this.limitFrom&&this.limitFrom<d.format();l.days.push({enabled:h,date:d.format(),active:d.format(this.valueFormat)==t,day:d.format("D")}),d.add(1,"day")}i.push(l)}return{dayslabels:s,weeks:i}},currentMonth(){return a(this.pickerDayRef).format("MMMM")},currentYear(){return a(this.pickerDayRef).format("YYYY")},renderDate(){return console.log("renderDate"),this.realValue==null?"":(a.locale("fr"),a(this.realValue).format(this.format))},renderValue:{get(){return this.realValue?this.mmValue.format(this.displayFormat):""},set(s){console.log("convert ",s);try{let t=a(s,this.displayFormat);t.isValid()&&this.changeDate(t.format(this.valueFormat))}catch{return}}}},methods:{handlerClear(){console.log(this.realValue),this.changeDate(null)},handlerInputChange(s){try{var t=a(s.target.value);this.changeDate(t.format(this.valueFormat))}catch(d){console.error("WTF DATE",d)}},handlerSelectMonth(s){let t=this.months.indexOf(s);this.pickerDayRef=a(this.pickerDayRef).month(t).format(),this.pickerMode="day"},handlerSelectYear(s){this.pickerDayRef=a(this.pickerDayRef).year(s).format(),this.pickerMode="day"},changeDate(s){console.log("Modification de la date",s),this.picker=!1,this.realValue=s?a(s).format(this.valueFormat):"",console.log("Update",this.realValue),this.$emit("update:modelValue",this.realValue),this.$emit("input",this.realValue),this.$emit("change",this.realValue),this.handlerHide()},pickerNextMonth(){this.pickerDayRef=a(this.pickerDayRef).add(1,"month").format()},pickerPrevMonth(){this.pickerDayRef=a(this.pickerDayRef).subtract(1,"month").format()},handlerPickerMonth(s){s.preventDefault(),s.stopImmediatePropagation(),s.stopPropagation(),this.pickerMode="month"},handlerPickerYear(){this.pickerMode="year"},handlerShow(){this.initPickerVar(),this.picker=!0,this.watchOut()},watchOut(){},handlerHide(s){this.picker=!1},initPickerVar(){var s=a(this.pickerDayRef?this.pickerDayRef:a());this.pickerYearRef=s.year(),this.pickerMonthRef=s.format("MMMM")}},created(){a.locale(this.i18n),this.pickerDayRef=this.value?this.value:a().format(),this.initPickerVar()}},b={class:"input-group"},x=r("div",{class:"input-group-addon"},[r("i",{class:"icon-calendar"})],-1),S={class:"datepicker-wrapper"},P=r("i",{class:"icon-angle-left"},null,-1),F=[P],O={class:"heading"},N=r("i",{class:"icon-angle-right"},null,-1),T=[N],U={key:0,class:"day-labels week"},q=r("span",{class:"week-label"}," ",-1),E={class:"day-label"},H={key:0},I={class:"weeks"},A={class:"week"},L={class:"week-label"},z=["onClick"],J={key:1,class:"months"},B=["onClick"],W={key:2,class:"years"},j=["onClick"],G=r("i",{class:"icon-cancel-alt"},null,-1);function K(s,t,d,m,i,l){return n(),o("div",{onMouseenter:t[9]||(t[9]=(...e)=>l.handlerShow&&l.handlerShow(...e)),onMouseleave:t[10]||(t[10]=(...e)=>l.handlerHide&&l.handlerHide(...e))},[r("div",b,[f(r("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>l.renderValue=e)},null,512),[[V,l.renderValue]]),x]),f(r("div",{class:"datepicker-selector",onMouseleave:t[8]||(t[8]=(...e)=>l.handlerHide&&l.handlerHide(...e))},[r("div",S,[r("header",null,[r("nav",null,[r("span",{href:"#",onClick:t[1]||(t[1]=u((...e)=>l.pickerPrevMonth&&l.pickerPrevMonth(...e),["stop","prevent"]))},F),r("strong",O,[r("span",{class:"currentMonth",onClick:t[2]||(t[2]=u((...e)=>l.handlerPickerMonth&&l.handlerPickerMonth(...e),["stop"]))},c(l.currentMonth),1),r("span",{class:"currentYear",onClick:t[3]||(t[3]=u((...e)=>l.handlerPickerYear&&l.handlerPickerYear(...e),["stop"]))},c(l.currentYear),1)]),r("span",{href:"#",onClick:t[4]||(t[4]=u((...e)=>l.pickerNextMonth&&l.pickerNextMonth(...e),["stop"]))},T)]),i.pickerMode=="day"?(n(),o("div",U,[q,(n(!0),o(y,null,v(l.pickerData.dayslabels,e=>(n(),o("span",E,c(e),1))),256))])):p("",!0)]),i.pickerMode=="day"?(n(),o("section",H,[(n(!0),o(y,null,v(l.pickerData.weeks,e=>(n(),o("div",I,[r("span",A,[r("span",L,c(e.num),1),(n(!0),o(y,null,v(e.days,h=>(n(),o("span",{class:M(["week-day",{active:h.active,disabled:!h.enabled}]),onClick:u(D=>l.changeDate(h.date),["prevent","stop"])},c(h.day),11,z))),256))])]))),256))])):p("",!0),i.pickerMode=="month"?(n(),o("section",J,[(n(!0),o(y,null,v(d.months,e=>(n(),o("span",{class:M(["month",{active:i.pickerMonthRef==e}]),onClick:u(h=>l.handlerSelectMonth(e),["prevent","stop"])},c(e),11,B))),256))])):p("",!0),i.pickerMode=="year"?(n(),o("section",W,[r("span",{class:"year",onClick:t[5]||(t[5]=u(e=>i.pickerYearRef-=22,["prevent","stop"]))},"<<"),(n(!0),o(y,null,v(l.years,e=>(n(),o("span",{class:M(["year",{active:i.pickerYearRef==e}]),onClick:u(h=>l.handlerSelectYear(e),["prevent","stop"])},c(e),11,j))),256)),r("span",{class:"year",onClick:t[6]||(t[6]=u(e=>i.pickerYearRef+=22,["prevent","stop"]))},">>")])):p("",!0)]),r("div",{style:{"text-align":"center",cursor:"pointer"},onClick:t[7]||(t[7]=(...e)=>l.handlerClear&&l.handlerClear(...e))},[G,k(" Supprimer la date ")])],544),[[_,i.picker]])],32)}const ge=Y(C,[["render",K]]);let g;const Q={props:{url:{default:"/person?l=m&q="}},data(){return{persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,displayClosed:!1,highlightedIndex:null,noresult:!1,error:""}},computed:{optionsFiltered(){let s=[];return this.displayClosed?this.persons:(this.persons.forEach(t=>{t.closed||s.push(t)}),s)}},watch:{expression(s,t){console.log("Expression changed"),s.length>=2&&(g&&(console.log("Reset de la recherche"),clearTimeout(g)),g=setTimeout(()=>{console.log("Déclenchement de la recherche"),this.search(),clearTimeout(g)},500))}},methods:{search(){this.loading=!0,this.noresult=!1,w.get(this.url+this.expression+"&f=json",{before(s){this.request&&this.request.abort(),this.request=s}}).then(s=>{this.persons=s.data.datas,this.showSelector=!0,this.noresult=!this.persons||this.persons.length===0,this.error=this.persons.length+" résultat(s)"},s=>{this.persons=[],this.noresult=!1,s.status===403?this.error="403 Unauthorized":s.response.data?this.error="ERROR : "+s.response.data:s.body&&(this.error=s.body)}).then(s=>{this.loading=!1,this.request=null})},handlerSelectPerson(s){let t=this.persons.find(d=>d.id==s);console.log("handlerSelectPerson",t),this.selectedPerson=t,this.showSelector=!1,this.expression="",this.$emit("change",t)}}},X={class:"oscar-selector"},Z={class:"input-group",style:{position:"relative"}},$={key:0,class:"displayed-value text-danger",style:{}},ee=r("i",{class:"icon-attention-1"},null,-1),te={key:1,class:"displayed-value",style:{}},se={class:"input-group-addon"},re={class:"icon-spinner animate-spin"},le={class:"icon-user"},ie={class:"icon-user-times"},ae={class:"options"},ne={for:"hidder"},oe=["onMouseover","onClick","id"],de={class:"option-title"},ce={style:{display:"inline-block",width:"50px",height:"50px"}},he=["src","alt"],ue={class:"displayname",style:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},pe={key:0,style:{"font-weight":"100","font-size":".9em"}},fe={class:"option-infos"},me=r("i",{class:"icon-location"},null,-1),ke={key:0};function ye(s,t,d,m,i,l){return n(),o("div",X,[r("div",Z,[i.error?(n(),o("div",$,[ee,k(" "+c(i.error)+" ",1),r("i",{onClick:t[0]||(t[0]=e=>i.error=""),class:"icon-cancel-circled-outline button-cancel-value"})])):p("",!0),s.displayValue?(n(),o("div",te,[k(c(s.selectedLabel)+" ",1),s.selectedValue?(n(),o("i",{key:0,onClick:t[1]||(t[1]=(...e)=>s.handlerUnselect&&s.handlerUnselect(...e)),class:"icon-cancel-circled-outline button-cancel-value"})):p("",!0)])):p("",!0),r("span",se,[f(r("i",re,null,512),[[_,i.loading]]),f(r("i",le,null,512),[[_,!i.loading&&i.noresult==!1]]),f(r("i",ie,null,512),[[_,i.noresult]])]),f(r("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>i.expression=e),placeholder:"Rechercher une personne...",class:"form-control"},null,512),[[V,i.expression]])]),f(r("div",ae,[r("header",null,[k(" Résultat(s) : "+c(i.persons.length)+" / ",1),r("label",ne,[k(" Afficher les comptes expirés "),f(r("input",{type:"checkbox",id:"hidder",value:"on","onUpdate:modelValue":t[3]||(t[3]=e=>i.displayClosed=e)},null,512),[[R,i.displayClosed]])])]),(n(!0),o(y,null,v(l.optionsFiltered,(e,h)=>(n(),o("div",{class:M(["option",{active:h==i.highlightedIndex,selected:e.id==s.selectedValue,closed:e.closed}]),onMouseover:D=>i.highlightedIndex=h,onClick:u(D=>l.handlerSelectPerson(e.id),["prevent","stop"]),id:"item_"+h},[r("div",de,[r("span",ce,[r("img",{src:"https://www.gravatar.com/avatar/"+e.mailMd5+"?s=50",alt:e.displayname,style:{width:"100%"}},null,8,he)]),r("strong",ue,[k(c(e.displayname)+" ",1),e.email?(n(),o("em",pe," ("+c(e.email)+")",1)):p("",!0)])]),r("div",fe,[r("span",null,[me,k(" "+c(e.affectation)+" ",1),e.ucbnSiteLocalisation?(n(),o("span",ke," ~ "+c(e.ucbnSiteLocalisation),1)):p("",!0)])])],42,oe))),256))],512),[[_,i.showSelector&&i.persons.length]])])}const Me=Y(Q,[["render",ye]]);export{ge as D,Me as P};
