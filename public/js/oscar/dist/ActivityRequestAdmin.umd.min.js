(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["ActivityRequestAdmin"]=t():e["ActivityRequestAdmin"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="fb15")}({8875:function(e,t,s){var n,i,r;(function(s,a){i=[],n=a,r="function"===typeof n?n.apply(t,i):n,void 0===r||(e.exports=r)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(p){var s,n,i,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,a=/@([^@]*):(\d+):(\d+)\s*$/gi,o=r.exec(p.stack)||a.exec(p.stack),l=o&&o[1]||!1,c=o&&o[2]||!1,d=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");l===d&&(s=document.documentElement.outerHTML,n=new RegExp("(?:[^\\n]+?\\n){0,"+(c-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),i=s.replace(n,"$1").trim());for(var f=0;f<u.length;f++){if("interactive"===u[f].readyState)return u[f];if(u[f].src===l)return u[f];if(l===d&&u[f].innerHTML&&u[f].innerHTML.trim()===i)return u[f]}return null}}return e}))},fb15:function(e,t,s){"use strict";if(s.r(t),"undefined"!==typeof window){var n=window.document.currentScript,i=s("8875");n=i(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:i});var r=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(s.p=r[1])}var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("transition",{attrs:{name:"fade"}},[e.error?s("div",{staticClass:"overlay"},[s("div",{staticClass:"alert alert-danger overlay-content"},[s("h3",[e._v("Erreur "),s("a",{staticClass:"float-right",attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.error=null}}},[s("i",{staticClass:"icon-cancel-outline"})])]),s("pre",[e._v(e._s(e.error))])])]):e._e()]),s("transition",{attrs:{name:"fade"}},[e.confirmProccess?s("div",{staticClass:"overlay"},[s("div",{staticClass:"alert alert-danger overlay-content"},[s("h3",[e._v(e._s(e.confirmProccess.message))]),s("transition",{attrs:{name:"slide"}},[2==e.confirmProccess.step?s("div",[s("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(t){t.preventDefault(),e.confirmProccess=null}}},[s("i",{staticClass:"icon-cancel-outline"}),e._v(" Annuler ")]),s("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(t){return t.preventDefault(),e.confirmProccess.process()}}},[s("i",{staticClass:"icon-ok-circled"}),e._v(" Confirmer ")])]):s("div",[e.confirmProccess.person?s("section",{staticClass:"row"},[s("label",{staticClass:"col-md-8",attrs:{for:"roleDelarer"}},[e._v(" Rôle de "+e._s(e.confirmProccess.person)),s("br"),s("small",[e._v("Selectionnez un rôle pour "),s("strong",[e._v(e._s(e.confirmProccess.person))]),e._v(" dans l'activité de recherche. Vous pourrez modfifier cette information en éditant directement l'activité par le suite ")])]),s("div",{staticClass:"col-md-4"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.confirmProccess.personRole,expression:"confirmProccess.personRole"}],staticClass:"form-control",attrs:{id:"roleDeclarer"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.confirmProccess,"personRole",t.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"0"}},[e._v("Ne pas affecter à l'activité")]),e._l(e.rolesPerson,(function(t,n){return s("option",{domProps:{value:n}},[e._v(e._s(t))])}))],2)])]):e._e(),e.confirmProccess.organization?s("section",{staticClass:"row"},[s("label",{staticClass:"col-md-8",attrs:{for:"roleOrg"}},[e._v("Rôle de "+e._s(e.confirmProccess.organization))]),s("div",{staticClass:"col-md-4"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.confirmProccess.organisationRole,expression:"confirmProccess.organisationRole"}],staticClass:"form-control",attrs:{id:"roleOrg"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.confirmProccess,"organisationRole",t.target.multiple?s:s[0])}}},e._l(e.rolesOrganisation,(function(t,n){return s("option",{domProps:{value:n}},[e._v(e._s(t))])})),0)])]):e._e(),s("hr",{staticClass:"separator"}),s("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(t){t.preventDefault(),e.confirmProccess=null}}},[s("i",{staticClass:"icon-cancel-outline"}),e._v(" Annuler ")]),s("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:function(t){e.confirmProccess.step=2}}},[e._v(" Suivant "),s("i",{staticClass:"icon-right-outline"})])])])],1)]):e._e()]),s("header",{staticClass:"row"},[s("h1",{staticClass:"col-md-9"},[e._v(e._s(e.title))]),s("nav",{staticClass:"col-md-3"},[e._v("   "),s("jckselector",{attrs:{choose:e.listStatus,selected:e.selectedStatus},on:{change:function(t){e.selectedStatus=t}}})],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"alert alert-info"},[e._v(e._s(e.loading))]),e.activityRequests.length?s("section",e._l(e.activityRequests,(function(t){return s("article",{staticClass:"card"},[s("h3",{staticClass:"card-title"},[s("strong",[s("i",{class:"icon-"+t.statutText}),e._v(" "+e._s(t.label))]),s("strong",[s("i",{staticClass:"icon-bank"}),e._v(" "+e._s(t.amount)+" ")]),s("small",{staticClass:"right"},[e._v("par "),s("strong",[e._v(e._s(t.requester))])])]),s("div",{staticClass:"content row"},[s("div",{staticClass:"col-md-6"},[s("i",{staticClass:"icon-user"}),e._v(" Statut : "),s("strong",[e._v(e._s(e._f("renderStatus")(t.statut)))]),s("br"),s("i",{staticClass:"icon-user"}),e._v(" Demandeur : "),s("strong",[e._v(e._s(t.requester))]),s("br"),s("i",{staticClass:"icon-building-filled"}),e._v("Organisme : "),t.organisation?s("strong",[e._v(" "+e._s(t.organisation))]):s("em",[e._v("Aucun organisme identifié")]),s("br"),s("i",{staticClass:"icon-bank"}),e._v(" Budget : "),s("strong",[e._v(e._s(e._f("montant")(t.amount)))]),s("br"),s("i",{staticClass:"icon-calendar"}),e._v(" du "),t.dateStart?s("strong",[e._v(e._s(e._f("date")(t.dateStart)))]):s("em",[e._v("non précisé")]),e._v(" au "),t.dateEnd?s("strong",[e._v(e._s(e._f("date")(t.dateEnd)))]):s("em",[e._v("non précisé")]),s("br"),e._m(0,!0),e._v(" "+e._s(t.description)+" ")]),s("div",{staticClass:"col-md-6"},[s("h3",[e._v("Suivi")]),e._l(t.suivi,(function(t){return s("article",{staticClass:"follow"},[s("figure",{staticClass:"avatar"},[s("img",{attrs:{src:"//www.gravatar.com/avatar/"+t.by.gravatar+"?s=64",alt:""}})]),s("div",{staticClass:"content"},[s("small",{staticClass:"infos"},[s("i",{staticClass:"icon-clock"}),e._v(" "+e._s(e._f("date")(t.datecreated))+" par "),s("strong",[s("i",{staticClass:"icon-user"}),e._v(" "+e._s(t.by.username))])]),s("br"),s("p",[e._v(e._s(t.description))])])])}))],2)]),t.files.length?s("section",{staticClass:"liste-fichiers"},[e._m(1,!0),s("ul",e._l(t.files,(function(n){return s("li",[s("strong",[e._v(e._s(n.name))]),s("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"?dl="+n.file+"&id="+t.id}},[s("i",{staticClass:"icon-download"}),e._v(" Télécharger")])])})),0)]):e._e(),2==t.statut?s("nav",[s("button",{staticClass:"btn btn-success",on:{click:function(s){return e.handlerValid(t)}}},[s("i",{staticClass:"icon-valid"}),e._v(" Valider la demande ")]),s("button",{staticClass:"btn btn-danger",on:{click:function(s){return e.handlerReject(t)}}},[s("i",{staticClass:"icon-cancel-alt"}),e._v(" Rejeter la demande ")])]):e._e()])})),0):s("div",[s("p",{staticClass:"alert alert-info"},[e._v(" Aucune demande ")])])],1)},o=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("strong",[s("i",{staticClass:"icon-comment"}),e._v("Description : ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-file-excel"}),e._v(" Fichiers")])}],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"jck-selector"},[s("div",{staticClass:"selected"},[s("i",{staticClass:"icon-cog"}),s("strong",[e._v(e._s(e.selectedLabel))])]),s("div",{staticClass:"list"},e._l(e.choose,(function(t){return s("div",{staticClass:"item",class:{selected:e.selected.indexOf(t.id)>-1},on:{click:function(s){return e.toggleSelection(t.id)}}},[s("i",{staticClass:"icon-check"}),s("i",{staticClass:"icon-check-empty"}),e._v(" "+e._s(t.label)+" "),s("small",[e._v(" ("+e._s(t.description)+")")])])})),0)])},c=[],d={props:{choose:{default:null},selected:{default:null}},computed:{selectedLabel(){if(this.selected.length){let e=[];return this.choose.forEach(t=>{this.selected.indexOf(t.id)>-1&&e.push(t.label)}),e.join(", ")}return"Aucune selection"}},methods:{toggleSelection(e){let t=[];this.selected&&(t=this.selected);let s=t.indexOf(e);s>-1?t.splice(s,1):t.push(e),console.log(t),this.$emit("change",t)}}},u=d;function f(e,t,s,n,i,r,a,o){var l,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),n&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),a?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=l):i&&(l=o?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(e,t){return l.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:c}}var p=f(u,l,c,!1,null,null,null),m=p.exports,h={data(){return{formData:null,addFile:!1,addableFiles:null,file:null,loading:"",activityRequests:[],error:null,deleteData:null,allowNew:!1,demandeur:"",demandeur_id:null,organisations:[],lockMessages:[],confirmProccess:null,history:!1,selectedStatus:[2],roles:{person:null,organisation:null}}},components:{jckselector:m},props:{moment:{required:!0},rolesPerson:{required:!0},rolesOrganisation:{required:!0},asAdmin:{default:!1},title:{required:!0}},computed:{listStatus(){let e=[{id:2,label:"Envoyée",description:"Demandes envoyées"},{id:5,label:"Validée",description:"Demandes validées"},{id:7,label:"Refusée",description:"Demandes refusées"}];return this.asAdmin&&e.push({id:1,label:"Brouillon",description:"Demandes en cours de rédaction"}),e}},watch:{history:function(){this.fetch()},selectedStatus:function(){this.fetch()}},methods:{handlerValid(e){this.confirmProccess={step:1,message:"Confirmer la transformation de la demande en activité : "+e.label+" par "+e.requester+" ?",person:e.requester,personRole:0,organization:e.organisation,organizationRole:0,process:()=>this.performValid(e)}},handlerReject(e){this.confirmProccess={step:2,message:"Confirmer le rejet de la demande : "+e.label+" par "+e.requester+" ?",process:()=>this.performReject(e)}},performValid(e){this.loading="Transformation de la demande en activité...";let t=new FormData;t.append("id",e.id),t.append("action","valid"),this.confirmProccess.person&&t.append("personRoleId",this.confirmProccess.personRole),this.confirmProccess.organization&&t.append("organisationRoleId",this.confirmProccess.organisationRole),this.$http.post("?",t).then(e=>{this.fetch()},e=>{this.error="Impossible de valider la demande : "+e.body}).then(e=>{this.loading="",this.confirmProccess=null})},performReject(e){this.loading="Rejet de la demande en activité...";let t=new FormData;t.append("id",e.id),t.append("action","reject"),this.$http.post("?",t).then(e=>{this.fetch()},e=>{this.error="Impossible de rejeter la demande : "+e.body}).then(e=>{this.loading="",this.confirmProccess=null})},fetch(){this.loading="Chargement des Demandes",this.$http.get("?"+(this.history?"&history=1":"")+"&status="+this.selectedStatus.join(",")).then(e=>{this.activityRequests=e.body.activityRequests,this.allowNew=e.body.allowNew,this.demandeur=e.body.demandeur,this.demandeur_id=e.body.demandeur_id,this.organisations=e.body.organisations,this.lockMessages=e.body.lockMessages},e=>{this.error="Impossible de charger les demandes : "+e.body}).then(e=>{this.loading=null})},sendFile(e,t){let s=new FormData(t.target);this.$http.post("?",s).then(e=>{}).catch(e=>{})},handlerSend(e){let t=new FormData;t.append("action","send"),t.append("id",e.id),this.$http.post("?",t).then(e=>{this.fetch()}).catch(e=>{this.error=e.body})},handlerNew(){this.formData={id:null,label:"",description:"",dateStart:null,dateEnd:null,amount:0,organization:this.organisations[0],files:[]}},handlerEdit(e){this.formData={id:e.id,label:e.label,description:e.description,dateStart:e.dateStart,dateEnd:e.dateEnd,amount:e.amount,organization:e.organization,files:e.files}},handlerDeleteFile(e,t){this.loading="Suppression du fichier "+e.name,this.$http.get("?rdl="+e.file+"&id="+t.id).then(e=>{this.fetch()}).catch(e=>{this.error=e.body}).finally(e=>{this.loading=""})},handlerSave(e){let t=new FormData(e.target);t.append("dateStart",this.formData.dateStart),t.append("dateEnd",this.formData.dateEnd),this.$http.post("?",t).then(e=>{this.fetch(),this.formData=null}).catch(e=>{this.error=e.body,this.formData=null,console.log(e)})},handlerCancelForm(){this.formData=null},handlerDelete(e){this.deleteData=e},performDelete(){this.loading="Suppression de la demande "+this.deleteData.label;let e=this.deleteData;this.$http.delete("?id="+e.id).then(e=>{this.fetch()},e=>{this.error=e.body}).then(e=>this.deleteData=null)}},mounted(){this.fetch()}},v=h,_=f(v,a,o,!1,null,null,null),g=_.exports;t["default"]=g}})["default"]}));
//# sourceMappingURL=ActivityRequestAdmin.umd.min.js.map