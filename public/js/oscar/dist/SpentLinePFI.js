(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SpentLinePFI=e():t.SpentLinePFI=e()})("undefined"!=typeof self?self:this,function(){return function(t){function e(n){if(s[n])return s[n].exports;var a=s[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var s={};return e.m=t,e.c=s,e.d=function(t,s,n){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=3)}([function(t,e){t.exports=function(t,e,s,n,a,i){var r,l=t=t||{},o=typeof t.default;"object"!==o&&"function"!==o||(r=t,l=t.default);var c="function"==typeof l?l.options:l;e&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId=a);var d;if(i?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},c._ssrRegister=d):n&&(d=n),d){var _=c.functional,v=_?c.render:c.beforeCreate;_?(c._injectStyles=d,c.render=function(t,e){return d.call(e),v(t,e)}):c.beforeCreate=v?[].concat(v,d):[d]}return{esModule:r,exports:l,options:c}}},function(t,e,s){"use strict";var n=s(5);e.a={props:["moment","url","masses","urlSpentAffectation","informations","urlActivity","urlSync","urlDownload","manageRecettes","manageIgnored"],components:{SpentLinePFIGrouped:n.a},data:function(){return{state:"masse",error:null,pendingMsg:"",spentlines:null,details:null,displayIgnored:!1,editCompte:null}},computed:{totalDepenses:function(){var t=0;for(var e in this.spentlines.synthesis)"0"!=e&&"1"!=e&&(t+=this.spentlines.synthesis[e].total);return t},byMasse:function(){var t={datas:{"N.B":{},recettes:{},"ignorés":{}},totaux:{"N.B":0,recettes:0,"ignorés":0}};for(var e in this.masses)t.datas[e]={},t.totaux[e]=0;if(this.spentlines)for(var s in this.spentlines.spents){var n=this.spentlines.spents[s],a=n.masse;"1"==a&&(a="recettes"),"0"==a&&(a="ignorés");var i=n.numPiece;t.datas.hasOwnProperty(a)||(console.log(a,"non trouvée"),a="N.B"),t.datas[a].hasOwnProperty(i)||(t.datas[a][i]={ids:[],numpiece:i,text:[],types:[],montant:0,compteBudgetaires:[],comptes:[],masse:[],dateComptable:n.dateComptable,datePaiement:n.datePaiement,annee:n.dateAnneeExercice,refPiece:n.refPiece,details:[]}),t.datas[a][i].details.push(n);var r=n.texteFacture,l=n.designation,o=n.type,c=n.compteGeneral,d=n.compteBudgetaire;t.datas[a][i].montant+=n.montant,r&&t.datas[a][i].text.indexOf(r)<0&&t.datas[a][i].text.push(r),l&&t.datas[a][i].text.indexOf(l)<0&&t.datas[a][i].text.push(l),o&&t.datas[a][i].types.indexOf(o)<0&&t.datas[a][i].types.push(o),c&&t.datas[a][i].comptes.indexOf(c)<0&&t.datas[a][i].comptes.push(c),d&&t.datas[a][i].compteBudgetaires.indexOf(d)<0&&t.datas[a][i].compteBudgetaires.push(d)}return t}},methods:{handlerEditCompte:function(t){this.editCompte=JSON.parse(JSON.stringify(this.spentlines.comptes[t]))},handlerDetailsLine:function(t){this.details=t},handlerAffectationCompte:function(t){var e=this,s={};s[t.codeFull]=t.annexe,this.editCompte=null,this.pendingMsg="Modification de la masse pour "+t.codeFull,console.log(this.pendingMsg),this.$http.post(this.urlSpentAffectation,{affectation:s}).then(function(t){e.editCompte=null,e.fetch()},function(t){403==t.status?e.error="Vous n'avez pas l'autorisation d'accès à ces informations.":e.error=t.data,e.pendingMsg=""})},fetch:function(){var t=this;this.pendingMsg="Chargement des dépense",this.$http.get(this.url).then(function(e){t.spentlines=e.data.spents},function(e){403==e.status?t.error="Vous n'avez pas l'autorisation d'accès à ces informations.":t.error="Impossible de charger les dépenses pour ce PFI : "+e.data}).then(function(e){t.pendingMsg=""})}},mounted:function(){this.fetch()}}},function(t,e,s){"use strict";e.a={props:{lines:{required:!0},total:{required:!0}},methods:{handlerEditCompte:function(t){this.$emit("editcompte",t)}}}},function(t,e,s){t.exports=s(4)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s(1),a=s(7),i=s(0),r=i(n.a,a.a,!1,null,null,null);e.default=r.exports},function(t,e,s){"use strict";var n=s(2),a=s(6),i=s(0),r=i(n.a,a.a,!1,null,null,null);e.a=r.exports},function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[Object.keys(t.lines).length?s("table",{staticClass:"list table table-condensed table-bordered table-condensed card"},[t._m(0),t._v(" "),s("tbody",t._l(t.lines,function(e){return s("tr",[s("td",[t._v(t._s(e.numpiece))]),t._v(" "),s("td",[s("button",{staticClass:"btn btn-default xs",on:{click:function(s){return t.$emit("detailsline",e)}}},[t._v(t._s(e.details.length)+"\n                ")])]),t._v(" "),s("td",[s("small",[t._v(t._s(e.types?e.types.join(","):""))])]),t._v(" "),s("td",[s("small",[t._v(t._s(e.text.join(", ")))])]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[s("strong",[t._v(t._s(t._f("money")(e.montant)))])]),t._v(" "),s("td",[t._v(t._s(e.compteBudgetaires.join(", ")))]),t._v(" "),s("td",t._l(e.comptes,function(e){return s("span",{staticClass:"cartouche default xs",staticStyle:{"white-space":"nowrap"},on:{click:function(s){return t.handlerEditCompte(e)}}},[t._v("\n                    "+t._s(e)+"\n                    "),s("i",{staticClass:"icon-edit"})])}),0),t._v(" "),s("td",[t._v(t._s(e.dateComptable))]),t._v(" "),s("td",[t._v(t._s(e.datePaiement))]),t._v(" "),s("td",[t._v(t._s(e.annee))])])}),0),t._v(" "),s("tfoot",[s("tr",{staticStyle:{"font-weight":"bold","font-size":"1.2em"}},[s("td",{staticStyle:{"text-align":"right"},attrs:{colspan:"4"}},[t._v("Total :")]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("money")(t.total)))]),t._v(" "),s("td",{attrs:{colspan:"2"}},[t._v(" ")])])])]):s("div",{staticClass:"alert alert-info"},[t._v("\n        Aucune entrée\n    ")])])},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",[t._v("N°")]),t._v(" "),s("th",[t._v("Ligne(s)")]),t._v(" "),s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("Description")]),t._v(" "),s("th",{staticStyle:{width:"8%"}},[t._v("Montant")]),t._v(" "),s("th",{staticStyle:{width:"8%"}},[t._v("Compte Budgetaire")]),t._v(" "),s("th",{staticStyle:{width:"8%"}},[t._v("Compte")]),t._v(" "),s("th",{staticStyle:{width:"8%"}},[t._v("Date Comptable")]),t._v(" "),s("th",{staticStyle:{width:"8%"}},[t._v("Date paiement")]),t._v(" "),s("th",{staticStyle:{width:"8%"}},[t._v("Année")])])])}],i={render:n,staticRenderFns:a};e.a=i},function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"spentlines"},[s("transition",{attrs:{name:"fade"}},[t.error?s("div",{staticClass:"error overlay"},[s("div",{staticClass:"overlay-content"},[s("i",{staticClass:"icon-warning-empty"}),t._v("\n                "+t._s(t.error)+"\n                "),s("br"),t._v(" "),s("a",{staticClass:"btn btn-sm btn-default btn-xs",attrs:{href:"#"},on:{click:function(e){t.error=null}}},[s("i",{staticClass:"icon-cancel-circled"}),t._v("\n                    Fermer")])])]):t._e()]),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.pendingMsg?s("div",{staticClass:"pending overlay"},[s("div",{staticClass:"overlay-content"},[s("i",{staticClass:"icon-spinner animate-spin"}),t._v("\n                "+t._s(t.pendingMsg)+"\n            ")])]):t._e()]),t._v(" "),t.editCompte?s("div",{staticClass:"overlay"},[s("div",{staticClass:"overlay-content"},[s("h3",[s("i",{staticClass:"icon-zoom-in-outline"}),t._v("Modification de la masse : "+t._s(t.editCompte.code)+" - "+t._s(t.editCompte.label))]),t._v(" "),s("hr"),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.editCompte.annexe,expression:"editCompte.annexe"}],attrs:{name:""},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.editCompte,"annexe",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"0"}},[t._v("Ignoré")]),t._v(" "),s("option",{attrs:{value:"1"}},[t._v("Recette")]),t._v(" "),t._l(t.spentlines.masses,function(e,n){return s("option",{domProps:{value:n}},[t._v(t._s(e))])})],2),t._v(" "),s("button",{staticClass:"btn btn-danger",on:{click:function(e){t.editCompte=null}}},[s("i",{staticClass:"icon-cancel-circled-outline"}),t._v("Annuler")]),t._v(" "),s("button",{staticClass:"btn btn-success",on:{click:function(e){return t.handlerAffectationCompte(t.editCompte)}}},[s("i",{staticClass:"icon-valid"}),t._v("Valider")])])]):t._e(),t._v(" "),t.details?s("div",{staticClass:"overlay"},[s("div",{staticClass:"overlay-content"},[t._m(0),t._v(" "),s("button",{staticClass:"btn btn-default",on:{click:function(e){t.details=null}}},[t._v("Fermer")]),t._v(" "),s("table",{staticClass:"list table table-condensed table-bordered table-condensed card"},[t._m(1),t._v(" "),s("tbody",t._l(t.details.details,function(e){return s("tr",{staticClass:"text-small"},[s("td",[t._v(t._s(e.syncid))]),t._v(" "),s("td",[t._v(t._s(t._f("d.designation")(e.texteFacture)))]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("money")(e.montant)))]),t._v(" "),s("td",[t._v(t._s(e.compteBudgetaire))]),t._v(" "),s("td",[t._v(t._s(e.centreFinancier))]),t._v(" "),s("td",[s("strong",[t._v(t._s(e.compteGeneral))]),t._v(" : "+t._s(e.type))]),t._v(" "),s("td",[s("strong",[t._v(t._s(e.masse))])]),t._v(" "),s("td",[t._v(t._s(e.dateComptable))]),t._v(" "),s("td",[t._v(t._s(e.datePaiement))]),t._v(" "),s("td",[t._v(t._s(e.dateAnneeExercice))])])}),0)])])]):t._e(),t._v(" "),s("div",{staticClass:"container-fluid"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-2"},[t._m(2),t._v(" "),s("div",{staticClass:"card"},[t.spentlines?s("table",{staticClass:"table table-condensed card synthesis"},[s("tbody",[s("tr",[t._m(3),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v("\n                                    "+t._s(t.informations.PFI)+"\n                                ")])]),t._v(" "),s("tr",[t._m(4),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v("\n                                    "+t._s(t.informations.numOscar)+"\n                                ")])]),t._v(" "),s("tr",[t._m(5),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v("\n                                    "+t._s(t._f("money")(t.informations.amount))+"\n                                ")])]),t._v(" "),s("tr",[t._m(6),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[s("strong",[t._v(t._s(t.informations.projectacronym))]),s("br"),t._v(" "),s("small",[t._v(t._s(t.informations.project))])])]),t._v(" "),s("tr",[t._m(7),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[s("small",[t._v(t._s(t.informations.label))])])])])]):t._e(),t._v(" "),t.urlActivity?s("a",{staticClass:"btn btn-default btn-xs",attrs:{href:t.urlActivity}},[s("i",{staticClass:"icon-cube"}),t._v(" Revenir à l'activité")]):t._e(),t._v(" "),t.urlSync?s("form",{staticClass:"form-inline",attrs:{action:t.urlSync,method:"post"}},[s("input",{attrs:{type:"hidden",name:"action",value:"update"}}),t._v(" "),t._m(8)]):t._e(),t._v(" "),t.urlDownload?s("a",{staticClass:"btn btn-default btn-xs",attrs:{href:t.urlDownload}},[s("i",{staticClass:"icon-download"}),t._v("\n                        Télécharger les données (Excel)")]):t._e()]),t._v(" "),t._m(9),t._v(" "),t.spentlines?s("table",{staticClass:"table table-condensed card synthesis"},[s("tbody",[t._l(t.spentlines.masses,function(e,n){return s("tr",[s("th",[s("small",[t._v(t._s(e))]),t._v(" "),s("a",{staticClass:"label label-info xs",attrs:{href:"#repport-"+n}},[t._v(t._s(t.spentlines.synthesis[n].nbr))])]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("money")(t.spentlines.synthesis[n].total)))])])}),t._v(" "),0!=t.spentlines.synthesis["N.B"].total?s("tr",[s("th",[t._m(10),s("a",{staticClass:"label label-info",attrs:{href:"repport-nb"}},[t._v(t._s(t.spentlines.synthesis["N.B"].nbr))])]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("money")(t.spentlines.synthesis["N.B"].total)))])]):t._e()],2),t._v(" "),s("tfoot",[s("tr",{staticClass:"total"},[s("th",[t._v("Total")]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("money")(t.totalDepenses)))])])])]):t._e(),t._v(" "),t.manageRecettes?s("div",[t._m(11),t._v(" "),t.spentlines?s("table",{staticClass:"table table-condensed card synthesis"},[s("tbody",[s("tr",[s("th",[t._v("Recette "),s("a",{staticClass:"label label-info xs",attrs:{href:"#repport-1"}},[t._v(t._s(t.spentlines.synthesis[1].nbr))])]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("money")(t.spentlines.synthesis[1].total)))])])])]):t._e()]):t._e(),t._v(" "),t.manageIgnored&&0!=t.spentlines.synthesis[0].total?s("div",[s("a",{attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.displayIgnored=!t.displayIgnored}}},[t.displayIgnored?s("span",[s("i",{staticClass:"icon-eye-off"}),t._v(" Cacher")]):s("span",[s("i",{staticClass:"icon-eye"}),t._v(" Montrer")]),t._v("\n                        les données ignorées\n                    ")]),t._v(" "),t.spentlines&&t.displayIgnored?s("table",{staticClass:"table table-condensed card synthesis"},[s("tbody",[s("tr",[s("th",[t._v("\n                                Ignorées\n                                "),s("a",{staticClass:"label label-info",attrs:{href:"#repport-0"}},[t._v(t._s(t.spentlines.synthesis[0].nbr))])]),t._v(" "),s("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("money")(t.spentlines.synthesis[0].total)))])])])]):t._e()]):t._e()]),t._v(" "),s("div",{staticClass:"col-md-10",staticStyle:{height:"80vh","overflow-y":"scroll"}},[null!=t.spentlines?s("div",[t._l(t.masses,function(e,n){return s("div",[s("h3",{attrs:{id:"repport-"+n}},[t._v(t._s(e))]),t._v(" "),s("spent-line-p-f-i-grouped",{attrs:{lines:t.byMasse.datas[n],total:t.spentlines.synthesis[n].total},on:{editcompte:t.handlerEditCompte,detailsline:t.handlerDetailsLine}})],1)}),t._v(" "),Object.keys(t.byMasse.datas["N.B"]).length>0?s("div",[s("h3",{attrs:{id:"repport-nb"}},[t._v("Hors-masse")]),t._v(" "),t._m(12),t._v(" "),s("spent-line-p-f-i-grouped",{attrs:{lines:t.byMasse.datas["N.B"],total:t.spentlines.synthesis["N.B"].total},on:{editcompte:t.handlerEditCompte,detailsline:t.handlerDetailsLine}})],1):t._e(),t._v(" "),t.manageRecettes&&Object.keys(t.byMasse.datas.recettes).length>0?s("div",[s("h3",{attrs:{id:"repport-1"}},[t._v("Recettes")]),t._v(" "),s("spent-line-p-f-i-grouped",{attrs:{lines:t.byMasse.datas.recettes,total:t.spentlines.synthesis[1].total},on:{editcompte:t.handlerEditCompte,detailsline:t.handlerDetailsLine}})],1):t._e(),t._v(" "),t.manageIgnored&&Object.keys(t.byMasse.datas["ignorés"]).length>0?s("div",[s("h3",{attrs:{id:"repport-0"}},[t._v("Ignorés")]),t._v(" "),s("spent-line-p-f-i-grouped",{attrs:{lines:t.byMasse.datas["ignorés"],total:t.spentlines.synthesis[0].total},on:{editcompte:t.handlerEditCompte,detailsline:t.handlerDetailsLine}})],1):t._e()],2):t._e()])])])],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h3",[s("i",{staticClass:"icon-zoom-in-outline"}),t._v("Détails des entrées comptables")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",[t._v("ID")]),t._v(" "),s("th",[t._v("Description")]),t._v(" "),s("th",[t._v("Montant")]),t._v(" "),s("th",[t._v("Compte Budgetaire")]),t._v(" "),s("th",[t._v("Centre de profit")]),t._v(" "),s("th",[t._v("Compte général")]),t._v(" "),s("th",[t._v("Masse")]),t._v(" "),s("th",[t._v("Date comptable")]),t._v(" "),s("th",[t._v("Date paiement")]),t._v(" "),s("th",[t._v("Année")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h3",[s("i",{staticClass:"icon-help-circled"}),t._v("\n                    Informations\n                ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("PFI")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("N°OSCAR")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("Montant")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("Projet")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("Activité")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"btn btn-primary btn-xs",attrs:{type:"submit"}},[s("i",{staticClass:"icon-signal"}),t._v("\n                            Mettre à jour les données depuis SIFAC\n                        ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h3",[s("i",{staticClass:"icon-calculator"}),t._v("Dépenses")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("small",[s("i",{staticClass:"icon-attention"}),t._v(" Hors-masse")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h3",[s("i",{staticClass:"icon-calculator"}),t._v("Recettes")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"alert alert-warning"},[s("i",{staticClass:"icon-attention"}),t._v(" Les comptes des entrées suivantes ne sont pas qualifié.\n                        ")])}],i={render:n,staticRenderFns:a};e.a=i}])});
//# sourceMappingURL=SpentLinePFI.js.map