(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.timesheetleader=t():e.timesheetleader=t()})("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=4)}([function(e,t){e.exports=function(e,t,i,n,s,a){var r,c=e=e||{},o=typeof e.default;"object"!==o&&"function"!==o||(r=e,c=e.default);var l="function"==typeof c?c.options:c;t&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns,l._compiled=!0),i&&(l.functional=!0),s&&(l._scopeId=s);var d;if(a?(d=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},l._ssrRegister=d):n&&(d=n),d){var u=l.functional,m=u?l.render:l.beforeCreate;u?(l._injectStyles=d,l.render=function(e,t){return d.call(t),m(e,t)}):l.beforeCreate=m?[].concat(m,d):[d]}return{esModule:r,exports:c,options:l}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6),s=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default={name:"timesheetleader",props:{moment:{required:!0},validsci:{default:!1},validadm:{default:!1}},data:function(){return{error:null,group:"organization",subgroup:"activity_label",pending:!1,pendingMsg:"Chargement des données",timesheets:[],rejectModal:!1,rejectType:null,rejectTimesheet:null,rejectMsg:"",filtreDeclarant:"",groups:{organization:"Par organization",owner:"Par déclarant"}}},components:{timesheetorganization:s.default},computed:{structuredTimesheets:function(){var e=this;return this.filtreDeclarant?this.timesheets.filter(function(t){return console.log(JSON.parse(JSON.stringify(t))),t.owner.indexOf(e.filtreDeclarant)>-1}):this.timesheets}},methods:{fetch:function(){var e=this;this.pending=!0,this.$http.get().then(function(t){e.timesheets=t.data},function(e){console.error("error",e)}).then(function(t){e.pending=!1})},refreshTimesheet:function(e){console.log("Refresh timesheet",e);for(var t=0;t<this.timesheets.length;t++)for(var i=0;i<this.timesheets[t].timesheets.length;i++)if(console.log("Refresh timesheet",this.timesheets[t].timesheets[i].id," < ",e.id),this.timesheets[t].timesheets[i].id==e.id)return void("reject"==e.status?this.timesheets[t].timesheets.splice(i,1):this.timesheets[t].timesheets.splice(i,1,e))},send:function(e,t){var i=this;this.pending=!0,this.$http.post("",{action:e,timesheet_id:t.id}).then(function(e){var t=e.data[0];i.refreshTimesheet(t)},function(e){i.error=e.body?e.body:"Erreur : "+e.statusText}).then(function(){return i.pending=!1})},handlerValidSci:function(e){this.send("validatesci",e)},handlerValidAdm:function(e){this.send("validateadm",e)},handlerRejectSci:function(e){this.rejectModal=!0,this.rejectType="rejectsci",this.rejectTimesheet=e},handlerRejectAdm:function(e){this.rejectModal=!0,this.rejectType="rejectadm",this.rejectTimesheet=e},handlerCancelReject:function(){this.rejectType="",this.rejectTimesheet=null,this.rejectModal=!1},handlerSubmitReject:function(){var e=this;this.pending=!0,this.$http.post("",{action:this.rejectType,timesheet_id:this.rejectTimesheet.id,rejectComment:this.rejectMsg}).then(function(t){e.fetch()},function(t){e.error=t.body?t.body:"Erreur : "+t.statusText}).then(function(){e.pending=!1,e.rejectModal=!1})}},mounted:function(){this.fetch()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(7),s=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default={props:["timesheets","label","role","moment"],components:{timesheet:s.default},computed:{filteredTimesheets:function(){var e=this;if(this.filtreDeclarant||this.filtreActivite){var t=[];return this.timesheets.forEach(function(i){e.filtreDeclarant&&i.owner.toLowerCase().indexOf(e.filtreDeclarant.toLowerCase())<0||(!e.filtreActivite||i.activity_label.toLowerCase().indexOf(e.filtreActivite.toLowerCase())>-1||i.project_acronym.toLowerCase().indexOf(e.filtreActivite.toLowerCase())>-1)&&t.push(i)}),t}return this.timesheets}},data:function(){return{filtreDeclarant:"",filtreActivite:""}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"timesheet",props:["timesheet","moment"],computed:{start:function(){return this.moment(this.timesheet.start).format("HH:mm")},end:function(){return this.moment(this.timesheet.end).format("HH:mm")},jour:function(){return this.moment(this.timesheet.start).format("dddd D MMMM YYYY")},duree:function(){var e=this.moment(this.timesheet.end),t=this.moment(this.timesheet.start);return this.moment(e.diff(t)).format("HH:mm")}}}},function(e,t,i){e.exports=i(5)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),s=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);var r=i(10),c=i(0),o=c(s.a,r.a,!1,null,null,null);t.default=o.exports},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),s=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);var r=i(9),c=i(0),o=c(s.a,r.a,!1,null,null,null);t.default=o.exports},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),s=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);var r=i(8),c=i(0),o=c(s.a,r.a,!1,null,null,null);t.default=o.exports},function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"timesheet"},[i("div",{staticClass:"activity"},[e.timesheet.url_project?i("a",{staticStyle:{"font-weight":"600"},attrs:{href:e.timesheet.url_project}},[i("i",{staticClass:"icon-cubes"}),e._v("\n            "+e._s(e.timesheet.project_acronym)+"\n        ")]):i("strong",[i("i",{staticClass:"icon-cubes"}),e._v("\n            "+e._s(e.timesheet.project_acronym)+"\n        ")]),e._v(" "),e.timesheet.url_activity?i("a",{attrs:{href:e.timesheet.url_activity}},[i("small",[i("i",{staticClass:"icon-cube"}),e._v("\n                "+e._s(e.timesheet.activity_label)+"\n            ")])]):i("small",[i("i",{staticClass:"icon-cube"}),e._v("\n            "+e._s(e.timesheet.activity_label)+"\n        ")])]),e._v(" "),i("div",{staticClass:"wp",attrs:{title:e.timesheet.workpackage_label}},[i("i",{staticClass:"icon-archive"}),e._v("\n        "+e._s(e.timesheet.workpackage_code)+"\n    ")]),e._v(" "),i("div",{staticClass:"date"},[i("div",{staticClass:"jour"},[e._v(e._s(e.jour))]),e._v(" "),i("div",{staticClass:"horaire"},[e._v(e._s(e.start)+" à "+e._s(e.end))]),e._v(" "),i("div",{staticClass:"duree"},[i("i",{staticClass:"icon-stopwatch"}),e._v(e._s(e.duree)+" heures\n        ")])]),e._v(" "),i("div",{staticClass:"declarant"},[i("i",{staticClass:"icon-user"}),e._v("\n        "+e._s(e.timesheet.owner)+"\n    ")]),e._v(" "),i("div",[e.timesheet.validatedSciBy?i("span",{staticClass:"small-note"},[i("i",{staticClass:"icon-beaker"}),e._v("\n            Validée par "),i("strong",[e._v(e._s(e.timesheet.validatedSciBy))])]):i("span",[e.timesheet.validableSci?i("nav",{staticClass:"btn-group btn-group-xs"},[i("button",{staticClass:"btn btn-xs btn-success",attrs:{title:"Valider scientifiquement ce créneau"},on:{click:function(t){e.$emit("validsci",e.timesheet)}}},[i("i",{staticClass:"icon-beaker"}),e._v("\n                    Valider\n                    ")]),e._v(" "),i("button",{staticClass:"btn btn-xs btn-danger",attrs:{title:"Refuser scientifiquement ce créneau"},on:{click:function(t){e.$emit("rejectsci",e.timesheet)}}},[i("i",{staticClass:"icon-minus-circled"}),e._v("\n                    Refuser\n                ")])]):i("span",{staticClass:"small-note"},[i("i",{staticClass:"icon-beaker"}),e._v("\n                En attente de la validation scientifique\n            ")])])]),e._v(" "),i("div",[e.timesheet.validatedAdminBy?i("span",{attrs:{title:"Ce créneau a été validé administrativement par "+e.timesheet.validatedAdminBy}},[i("span",{staticClass:"small-note"},[i("i",{staticClass:"icon-archive"}),e._v("\n                Validée par "),i("strong",[e._v(e._s(e.timesheet.validatedAdminBy))])])]):i("span",[e.timesheet.validableAdm?i("nav",{staticClass:"btn-group btn-group-xs"},[i("button",{staticClass:"btn btn-xs btn-danger",attrs:{title:"Refuser administrativement ce créneau"},on:{click:function(t){e.$emit("rejectadm",e.timesheet)}}},[i("i",{staticClass:"icon-minus-circled"}),e._v("\n                    Refuser\n                ")]),e._v(" "),i("button",{staticClass:"btn btn-xs btn-success",attrs:{title:"Valider administrativement ce créneau"},on:{click:function(t){e.$emit("validadm",e.timesheet)}}},[i("i",{staticClass:"icon-ok-circled"}),e._v("\n                    Valider\n                ")])]):i("span",{staticClass:"small-note"},[i("i",{staticClass:"icon-beaker"}),e._v("\n                En attente de la validation administrative\n            ")])])])])},s=[],a={render:n,staticRenderFns:s};t.a=a},function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"timesheet-organization"},[i("h2",[i("i",{staticClass:"icon-building-filled"}),e._v(e._s(e.label)+" ("+e._s(e.role)+")")]),e._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:e.filtreDeclarant||e.filtreActivite,expression:"filtreDeclarant || filtreActivite"}]},[e._v("\n        Déclaration pour les déclarants correspondant à la recherche\n        "),i("span",{directives:[{name:"show",rawName:"v-show",value:e.filtreDeclarant,expression:"filtreDeclarant"}],staticClass:"cartouche"},[i("i",{staticClass:"icon-user"}),e._v(e._s(e.filtreDeclarant)+"\n            "),i("i",{staticClass:"icon-cancel-circled-outline",on:{click:function(t){e.filtreDeclarant=""}}})]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:e.filtreActivite,expression:"filtreActivite"}],staticClass:"cartouche"},[i("i",{staticClass:"icon-cube"}),e._v(e._s(e.filtreActivite)+"\n            "),i("i",{staticClass:"icon-cancel-circled-outline",on:{click:function(t){e.filtreActivite=""}}})])]),e._v(" "),e.timesheets.length?i("div",[i("div",{staticClass:"timesheet timesheet-header"},[i("div",{staticClass:"activity"},[i("i",{staticClass:"icon-cube"}),e._v("\n                Activité\n                "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.filtreActivite,expression:"filtreActivite"}],staticClass:"form-control input-sm",attrs:{placeholder:"Filtrer sur les activités"},domProps:{value:e.filtreActivite},on:{input:function(t){t.target.composing||(e.filtreActivite=t.target.value)}}})]),e._v(" "),e._m(0),e._v(" "),e._m(1),e._v(" "),i("div",{staticClass:"declarant"},[i("i",{staticClass:"icon-user"}),e._v("\n                Déclarant\n                "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.filtreDeclarant,expression:"filtreDeclarant"}],staticClass:"form-control input-sm",attrs:{placeholder:"Filtrer sur les déclarants"},domProps:{value:e.filtreDeclarant},on:{input:function(t){t.target.composing||(e.filtreDeclarant=t.target.value)}}})]),e._v(" "),i("div",[e._v("\n                Validation scientifique\n            ")]),e._v(" "),i("div",[e._v("\n                Validation administrative\n            ")])]),e._v(" "),i("section",{staticClass:"timesheets"},[i("transition-group",{attrs:{name:"list",tag:"article"}},e._l(e.filteredTimesheets,function(t){return i("timesheet",{key:t.id,attrs:{timesheet:t,moment:e.moment},on:{validsci:function(t){e.$emit("validsci",t)},validadm:function(t){e.$emit("validadm",t)},rejectsci:function(t){e.$emit("rejectsci",t)},rejectadm:function(t){e.$emit("rejectadm",t)}}})}))],1)]):i("div",{staticClass:"alert alert-info"},[e._v("\n        Il n'y a pas de déclaration en attente pour "),i("strong",[e._v(e._s(e.label))])])])},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wp"},[i("i",{staticClass:"icon-archive"}),e._v("\n                Lot de travail\n            ")])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"date"},[i("i",{staticClass:"icon-calendar"}),e._v("\n                Créneau\n            ")])}],a={render:n,staticRenderFns:s};t.a=a},function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"timesheetleaderarea"},[i("transition",{attrs:{name:"fade"}},[e.pending?i("div",{staticClass:"pending overlay"},[i("div",{staticClass:"overlay-content"},[i("i",{staticClass:"icon-spinner animate-spin"}),e._v("\n                "+e._s(e.pendingMsg)+"\n            ")])]):e._e()]),e._v(" "),e._m(0),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"alert-danger alert"},[i("i",{staticClass:"icon-warning-empty"}),e._v("\n        "+e._s(e.error)+"\n    ")]),e._v(" "),e.rejectModal?i("div",{staticClass:"overlay"},[i("div",{staticClass:"overlay-content"},[i("p",[e._v("Indiquez la raison du rejet")]),e._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.rejectMsg,expression:"rejectMsg"}],staticClass:"form-control",domProps:{value:e.rejectMsg},on:{input:function(t){t.target.composing||(e.rejectMsg=t.target.value)}}}),e._v(" "),i("nav",[i("button",{on:{click:e.handlerCancelReject}},[e._v("\n                    Annuler\n                ")]),e._v(" "),i("button",{on:{click:e.handlerSubmitReject}},[e._v("\n                    Envoyer\n                ")])])])]):e._e(),e._v(" "),0==e.timesheets.length?i("div",[e._m(1)]):i("div",e._l(e.structuredTimesheets,function(t){return i("section",{staticClass:"organization-timesheets"},[i("timesheetorganization",{attrs:{timesheets:t.timesheets,label:t.label,role:t.role,moment:e.moment},on:{validsci:e.handlerValidSci,validadm:e.handlerValidAdm,rejectsci:e.handlerRejectSci,rejectadm:e.handlerRejectAdm}})],1)}))],1)},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h1",[i("i",{staticClass:"icon-calendar"}),e._v("\n        Déclarations en attente de validation")])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"alert alert-warning"},[i("i",{staticClass:"icon-attention-1"}),e._v("\n            Vous n'êtes pas associé à une organisation\n        ")])}],a={render:n,staticRenderFns:s};t.a=a}])});
//# sourceMappingURL=TimesheetLeader.js.map