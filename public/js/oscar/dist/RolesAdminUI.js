(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.RolesAdminUI=e():t.RolesAdminUI=e()})("undefined"!=typeof self?self:this,function(){return function(t){function e(i){if(o[i])return o[i].exports;var r=o[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=1)}([function(t,e,o){"use strict";e.a={props:{privilegesDatas:{},url:null,Bootbox:null},data:function(){return{activeSpots:7,form:null}},computed:{common:function(){return this.privilegesDatas},roles:function(){var t=this,e=[];return this.common.roles.forEach(function(o){((o.spot&t.activeSpots)>0||0==o.spot)&&e.push(o)}),e}},methods:{handleHover:function(t){this.common.roleHighLight=t},handlerClick:function(t){this.common.roleSelected=t==this.common.roleSelected?null:t,this.common.roleHighLight=t},handleOut:function(){this.common.roleHighLight=null},toggleFilter:function(t){(this.activeSpots&t)>0?this.activeSpots-=t:this.activeSpots+=t},formEdit:function(t){this.form=JSON.parse(JSON.stringify(t))},remove:function(t){var e=this;this.Bootbox.confirm({title:"Supprimer définitivement le rôle ?",message:"Si vous souhaitez désactiver le rôle, décochez la portée dans le formulaire.",callback:function(o){o&&(e.loading=!0,e.$http.delete(e.url+"/"+t.id).then(function(o){console.log(o,e.common.roles);for(var i=0;i<e.common.roles.length;i++)if(e.common.roles[i].id==t.id)return e.common.roles.splice(i,1),void flashMessage("success","Le rôle a été supprimé")},function(t){flashMessage("error",t.body)}).then(function(){e.loading=!1}))}})},save:function(t){var e=this;this.loading=!0,this.form.id?this.$http.put(this.url+"/"+this.form.id,this.form).then(function(t){for(var o=0;o<e.common.roles.length;o++)if(e.common.roles[o].id==e.form.id)return e.common.roles.splice(o,1,t.body),void flashMessage("success","Le rôle a été mis à jour")},function(t){flashMessage("error",t.body)}).then(function(){e.loading=!1,e.form=null}):this.$http.post(this.url,this.form).then(function(t){var o=t.body;o.principal="true"==o.principal,e.common.roles.push(o),flashMessage("success","Le rôle a été ajouté")},function(t){flashMessage("error",t.body)}).then(function(){e.loading=!1,e.form=null})},newRoleForm:function(){this.form={roleId:"",spot:0,ldapFilter:null,description:"",principal:!1}},cssSpot:function(t){return"spot"+t.spot},updateRoleSpotForm:function(t){(this.form.spot&t)>0?this.form.spot-=t:this.form.spot+=t,console.log(this.form.spot)},updateRoleSpot:function(t,e){var o=this;this.loading=!0;var i=t.spot;(t.spot&e)>0?i-=e:i+=e;var r=JSON.parse(JSON.stringify(t));r.spot=i,this.$http.put(this.url+"/"+t.id,r).then(function(e){flashMessage("success","Le rôle a bien été modifié"),t.spot=i},function(t){flashMessage("error","Impossible de modifier le rôle : "+t.body)}).then(function(){o.loading=!1})}}}},function(t,e,o){t.exports=o(2)},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(0),r=o(4),s=o(3),n=s(i.a,r.a,!1,null,null,null);e.default=n.exports},function(t,e){t.exports=function(t,e,o,i,r,s){var n,a=t=t||{},l=typeof t.default;"object"!==l&&"function"!==l||(n=t,a=t.default);var c="function"==typeof a?a.options:a;e&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0),o&&(c.functional=!0),r&&(c._scopeId=r);var p;if(s?(p=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=p):i&&(p=i),p){var u=c.functional,f=u?c.render:c.beforeCreate;u?(c._injectStyles=p,c.render=function(t,e){return p.call(e),f(t,e)}):c.beforeCreate=f?[].concat(f,p):[p]}return{esModule:n,exports:a,options:c}}},function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("section",[o("h1",[t._v("Rôles")]),t._v(" "),o("transition",{attrs:{name:"popup"}},[t.form?o("div",{staticClass:"form-wrapper",class:{loading:t.loading}},[o("form",{staticClass:"container oscar-form",on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[o("div",{staticClass:"loadingMsg"},[o("span",[t._v("Chargement")])]),t._v(" "),o("header",[o("h1",[t.form.id?o("span",[t._v("Modification de "),o("strong",[t._v(t._s(t.form.roleId))])]):o("span",[t._v("Nouveau rôle")])]),t._v(" "),o("a",{staticClass:"closer",attrs:{href:"#"},on:{click:function(e){t.form=null}}},[o("i",{staticClass:"glyphicon glyphicon-remove"})])]),t._v(" "),o("div",{staticClass:"form-group"},[o("label",[t._v("Nom du rôle (RoleId)")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.form.roleId,expression:"form.roleId"}],staticClass:"form-control",attrs:{id:"role_roleid",type:"text",placeholder:"Role",name:"roleid"},domProps:{value:t.form.roleId},on:{input:function(e){e.target.composing||t.$set(t.form,"roleId",e.target.value)}}})]),t._v(" "),o("div",{staticClass:"form-group"},[o("label",[t._v("Principal")]),t._v(" "),o("p",{staticClass:"help"},[t._v("\n                        Un rôle définit comme principal sera traité spécifiquement dans l'interface\n                    ")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.form.principal,expression:"form.principal"}],staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.form.principal)?t._i(t.form.principal,null)>-1:t.form.principal},on:{change:function(e){var o=t.form.principal,i=e.target,r=!!i.checked;if(Array.isArray(o)){var s=t._i(o,null);i.checked?s<0&&t.$set(t.form,"principal",o.concat([null])):s>-1&&t.$set(t.form,"principal",o.slice(0,s).concat(o.slice(s+1)))}else t.$set(t.form,"principal",r)}}})]),t._v(" "),o("div",{staticClass:"form-group"},[o("label",[t._v("Portée (spot)")]),t._v(" "),o("p",{staticClass:"help"},[t._v("\n                        La portée permet de définir le périmètre d'affectation d'un rôle.\n                        Un rôle fixé au "),o("strong",[t._v("niveau application")]),t._v(" donne les droits de ce rôle sur l'application entière.\n                        Un rôle définit au "),o("strong",[t._v("niveau organisation")]),t._v(" donne les droits de ce rôle sur les activités de cette organisation.\n                        Un rôle définit au "),o("strong",[t._v("niveau activité")]),t._v(" ne donnera que les droits du rôle sur les projets/activités.\n                    ")]),t._v(" "),o("div",{staticClass:"spots"},[o("span",{class:{active:(4&t.form.spot)>0},attrs:{"data-spot":"4"},on:{click:function(e){return t.updateRoleSpotForm(4)}}},[o("i",{staticClass:"icon-ok-circled"}),o("i",{staticClass:"icon-minus-circled"}),t._v("Application\n                        ")]),t._v(" "),o("span",{class:{active:(2&t.form.spot)>0},attrs:{"data-spot":"2"},on:{click:function(e){return t.updateRoleSpotForm(2)}}},[o("i",{staticClass:"icon-ok-circled"}),o("i",{staticClass:"icon-minus-circled"}),t._v("Organisation\n                        ")]),t._v(" "),o("span",{class:{active:(1&t.form.spot)>0},attrs:{"data-spot":"1"},on:{click:function(e){return t.updateRoleSpotForm(1)}}},[o("i",{staticClass:"icon-ok-circled"}),o("i",{staticClass:"icon-minus-circled"}),t._v("Activité\n                        ")])]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.form.spot,expression:"form.spot"}],attrs:{id:"role_spot",type:"hidden",name:"spot"},domProps:{value:t.form.spot},on:{input:function(e){e.target.composing||t.$set(t.form,"spot",e.target.value)}}})]),t._v(" "),o("div",{staticClass:"form-group"},[o("label",[t._v("Description")]),t._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.description,expression:"form.description"}],staticClass:"form-control",domProps:{value:t.form.description},on:{input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value)}}})]),t._v(" "),o("div",{staticClass:"form-group"},[o("label",[t._v("Filtre LDAP")]),t._v(" "),o("p",{staticClass:"help"},[t._v("\n                        L'utilisation d'un filtre LDap affectera le rôle automatiquement sur l'application entière, peut importe le réglage de la portée.\n                    ")]),t._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.ldapFilter,expression:"form.ldapFilter"}],staticClass:"form-control",staticStyle:{whitespace:"wrap"},domProps:{value:t.form.ldapFilter},on:{input:function(e){e.target.composing||t.$set(t.form,"ldapFilter",e.target.value)}}})]),t._v(" "),o("footer",{staticClass:"buttons-bar"},[o("div",{staticClass:"btn-group"},[o("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[o("i",{staticClass:"icon-floppy"}),t._v("\n                            Enregistrer\n                        ")]),t._v(" "),o("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:function(e){t.form=null}}},[o("i",{staticClass:"icon-block"}),t._v("\n                            Annuler\n                        ")])])])])]):t._e()]),t._v(" "),o("nav",{staticClass:"oscar-sorter"},[o("i",{staticClass:"icon-sort"}),t._v("\n        Filtres :\n        "),o("a",{staticClass:"oscar-sorter-item",class:{active:(4&t.activeSpots)>0},attrs:{href:"#"},on:{click:function(e){return t.toggleFilter(4)}}},[t._v("Application")]),t._v(" "),o("a",{staticClass:"oscar-sorter-item",class:{active:(2&t.activeSpots)>0},attrs:{href:"#"},on:{click:function(e){return t.toggleFilter(2)}}},[t._v("Organization")]),t._v(" "),o("a",{staticClass:"oscar-sorter-item",class:{active:(1&t.activeSpots)>0},attrs:{href:"#"},on:{click:function(e){return t.toggleFilter(1)}}},[t._v("Projet/Activité")])]),t._v(" "),t._l(t.roles,function(e){return o("article",{staticClass:"card role-list-item",class:{selected:t.common.roleSelected==e},on:{mouseenter:function(o){return t.handleHover(e)},mouseleave:function(e){return t.handleOut()},click:function(o){return t.handlerClick(e)}}},[o("div",{staticClass:"header role-header"},[o("strong",[e.principal?o("i",{staticClass:"icon-certificate"}):t._e(),t._v("\n                "+t._s(e.roleId)+"\n            ")]),t._v(" "),o("nav",{staticClass:"nav-icons"},[e.deletable?o("a",{attrs:{href:"#"},on:{click:function(o){return o.preventDefault(),t.remove(e)}}},[o("i",{staticClass:"icon-trash"})]):t._e(),t._v(" "),e.editable?o("a",{attrs:{href:"#"},on:{click:function(o){return o.preventDefault(),t.formEdit(e)}}},[o("i",{staticClass:"icon-pencil"})]):t._e()])]),t._v(" "),e.description?o("p",{staticClass:"oscar-help"},[t._v(t._s(e.description))]):t._e(),t._v(" "),e.ldapFilter?[o("p",{staticClass:"oscar-help"},[t._v("Les filtres LDAP s'appliquent sur l'application entière")]),t._v(" "),o("pre",{staticClass:"filtreLdap"},[o("strong",[t._v("Filtre LDAP")]),t._v(":"+t._s(e.ldapFilter))])]:t._e()],2)}),t._v(" "),o("nav",{staticClass:"buttons-bar"},[o("a",{staticClass:"handler-add btn btn-primary",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.newRoleForm(e)}}},[o("i",{staticClass:"icon-plus-circled"}),t._v(" Ajouter un rôle\n        ")])])],2)},r=[],s={render:i,staticRenderFns:r};e.a=s}])});
//# sourceMappingURL=RolesAdminUI.js.map