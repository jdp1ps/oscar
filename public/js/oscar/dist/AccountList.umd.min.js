(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["AccountList"]=t():e["AccountList"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="fb15")}({fb15:function(e,t,n){"use strict";if(n.r(t),"undefined"!==typeof window){var s=window.document.currentScript,a=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(n.p=a[1])}var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"account-list admin"},[n("transition",{attrs:{name:"fade"}},[e.editedAccount?n("div",{staticClass:"overlay"},[n("div",{staticClass:"overlay-content"},[n("h3",[e._v(" Modification de la masse budgétaire pour le compte "),n("strong",[e._v(e._s(e.editedAccount.label))]),n("span",{staticClass:"overlay-closer",on:{click:function(t){e.editedAccount=null}}},[e._v("X")])]),n("p",[e._v(" Code OSCAR : "),n("strong",[e._v(e._s(e.editedAccount.code))]),e._v(" Code Comptable (SIFAC) : "),n("strong",[e._v(e._s(e.editedAccount.codeFull))])]),n("p",[e._v(" Choisissez une annexe budgétaire : "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.editedAccount.annexe,expression:"editedAccount.annexe"}],staticClass:"form-control",attrs:{name:"",id:""},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.editedAccount,"annexe",t.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"0"}},[e._v("Ignorer")]),n("option",{attrs:{value:"1"}},[e._v("Traiter comme une recette")]),e._l(e.masses,(function(t,s){return n("option",{domProps:{value:s}},[e._v(e._s(t))])}))],2)]),n("hr"),n("button",{staticClass:"btn btn-danger",on:{click:function(t){e.editedAccount=null}}},[n("i",{staticClass:"icon-cancel-circled"}),e._v("Annuler")]),n("button",{staticClass:"btn btn-success",on:{click:e.handlerPerformEdit}},[n("i",{staticClass:"icon-floppy"}),e._v("Enregistrer")])])]):e._e()]),n("transition",{attrs:{name:"fade"}},[e.error?n("div",{staticClass:"overlay"},[n("div",{staticClass:"overlay-content"},[n("h3",[n("i",{staticClass:"icon-bug"}),e._v(" ERREUR")]),n("pre",{staticClass:"alert-danger alert"},[e._v(e._s(e.error))]),n("nav",{staticClass:"buttons text-center"},[n("button",{staticClass:"btn btn-default",on:{click:function(t){e.error=null}}},[e._v(" Fermer ")])])])]):e._e()]),n("transition",{attrs:{name:"fade"}},[e.pending?n("div",{staticClass:"overlay"},[n("div",{staticClass:"overlay-content"},[n("p",{staticClass:"text-center"},[n("i",{staticClass:"animate-spin icon-spinner"}),e._v(" "+e._s(e.Pending)+" ")])])]):e._e()]),e._m(0),e._l(e.accounts,(function(t){return n("article",{staticClass:"card account-infos",class:{missing:null==t.annexe,ignored:0==t.annexe,input:1==t.annexe}},[n("h3",[n("code",{attrs:{title:"Code utilisé dans SIFAC"}},[n("a",{staticStyle:{color:"white"},attrs:{href:"/activites-de-recherche/advancedsearch?q=&criteria[]=cb2%3B"+t.codeFull}},[e._v(" "+e._s(t.codeFull)+" ")])]),n("strong",[e._v(" "+e._s(t.label)+" "),n("small",{attrs:{title:"Numéro dans OSCAR"}},[e._v("("+e._s(t.code)+")")]),n("a",{staticClass:"btn btn-xs",class:{"btn-primary":null==t.annexe,"btn-default":null!=t.annexe},attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),e.handlerEdit(t)}}},[n("i",{staticClass:"icon-edit"}),e._v(" Modifier l'annexe budgétaire")])]),"0"==t.annexe?n("em",{staticClass:"off"},[e._v("Ignorée")]):"1"==t.annexe?n("em",{staticClass:"plus"},[e._v("Recette")]):t.annexe?n("em",{staticClass:"minus"},[e._v(e._s(e.masses[t.annexe]))]):n("em",{staticClass:"value-missing"},[e._v("AUCUNE")])])])}))],2)},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"alert alert-info"},[n("i",{staticClass:"icon-info-outline"}),e._v(" Vous trouverez ci-dessous la liste des comptes utilisés dans la remontée des dépenses. Ceux apparaissant en rouge dans cette liste n'ont pas de masse attribués et seront affichés en rouge dans une catégorie "),n("strong",[e._v("Hors-Masse")]),e._v(" dans la zone de synthèse des dépenses de la fiche activité. ")])}],o={props:{url:{default:""},manage:{default:""}},data(){return{accounts:[],masses:[],editedAccount:null,error:"",pending:""}},methods:{fetch(){this.pending="Chargement des comptes utilisés",this.$http.get(this.url).then(e=>{this.accounts=e.data.accounts,this.masses=e.data.masses},e=>{let t="Erreur inconnue";try{t=e.body}catch(n){t="Erreur JS : "+n}this.error="Impossible de charger des comptes utilisés "+t}).then(this.pending=null)},handlerEdit(e){this.editedAccount=JSON.parse(JSON.stringify(e))},handlerPerformEdit(){this.pending="Enregistrement en cours";let e=this.editedAccount.id,t=this.editedAccount.annexe,n=new FormData;n.append("id",e),n.append("annexe",t),n.append("action","annexe"),this.$http.post(this.manage,n).then(e=>{this.editedAccount=null,this.fetch()},e=>{let t="";console.log(e.body);try{t=e.body}catch(n){t="Erreur JS : "+n}console.log(t),this.error="Impossible de modifier l'annexe budgétaire : "+t})}},mounted(){this.fetch()}},c=o;function l(e,t,n,s,a,r,i,o){var c,l="function"===typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=n,l._compiled=!0),s&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),i?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(i)},l._ssrRegister=c):a&&(c=o?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(e,t){return c.call(t),d(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return{exports:e,options:l}}var d=l(c,r,i,!1,null,null,null),u=d.exports;t["default"]=u}})["default"]}));
//# sourceMappingURL=AccountList.umd.min.js.map