(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ActivityRequestAdmin=e():t.ActivityRequestAdmin=e()})("undefined"!=typeof self?self:this,function(){return function(t){function e(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,s){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=3)}([function(t,e){t.exports=function(t,e,n,s,i,a){var o,r=t=t||{},c=typeof t.default;"object"!==c&&"function"!==c||(o=t,r=t.default);var l="function"==typeof r?r.options:r;e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0),n&&(l.functional=!0),i&&(l._scopeId=i);var d;if(a?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},l._ssrRegister=d):s&&(d=s),d){var u=l.functional,f=u?l.render:l.beforeCreate;u?(l._injectStyles=d,l.render=function(t,e){return d.call(e),f(t,e)}):l.beforeCreate=f?[].concat(f,d):[d]}return{esModule:o,exports:r,options:l}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{formData:null,addFile:!1,addableFiles:null,file:null,loading:"",activityRequests:[],error:null,deleteData:null,allowNew:!1,demandeur:"",demandeur_id:null,organisations:[],lockMessages:[],confirmProccess:null,history:!1,selectedStatus:[2],roles:{person:null,organisation:null}}},components:{jckselector:n(5).default},props:{moment:{required:!0},rolesPerson:{required:!0},rolesOrganisation:{required:!0},asAdmin:{default:!1},title:{required:!0}},computed:{listStatus:function(){var t=[{id:2,label:"Envoyée",description:"Demandes envoyées"},{id:5,label:"Validée",description:"Demandes validées"},{id:7,label:"Refusée",description:"Demandes refusées"}];return this.asAdmin&&t.push({id:1,label:"Brouillon",description:"Demandes en cours de rédaction"}),t}},watch:{history:function(){this.fetch()},selectedStatus:function(){this.fetch()}},methods:{handlerValid:function(t){var e=this;this.confirmProccess={step:1,message:"Confirmer la transformation de la demande en activité : "+t.label+" par "+t.requester+" ?",person:t.requester,personRole:0,organization:t.organisation,organizationRole:0,process:function(){return e.performValid(t)}}},handlerReject:function(t){var e=this;this.confirmProccess={step:2,message:"Confirmer le rejet de la demande : "+t.label+" par "+t.requester+" ?",process:function(){return e.performReject(t)}}},performValid:function(t){var e=this;this.loading="Transformation de la demande en activité...";var n=new FormData;n.append("id",t.id),n.append("action","valid"),this.confirmProccess.person&&n.append("personRoleId",this.confirmProccess.personRole),this.confirmProccess.organization&&n.append("organisationRoleId",this.confirmProccess.organisationRole),this.$http.post("?",n).then(function(t){e.fetch()},function(t){e.error="Impossible de valider la demande : "+t.body}).then(function(t){e.loading="",e.confirmProccess=null})},performReject:function(t){var e=this;this.loading="Rejet de la demande en activité...";var n=new FormData;n.append("id",t.id),n.append("action","reject"),this.$http.post("?",n).then(function(t){e.fetch()},function(t){e.error="Impossible de rejeter la demande : "+t.body}).then(function(t){e.loading="",e.confirmProccess=null})},fetch:function(){var t=this;this.loading="Chargement des Demandes",this.$http.get("?"+(this.history?"&history=1":"")+"&status="+this.selectedStatus.join(",")).then(function(e){t.activityRequests=e.body.activityRequests,t.allowNew=e.body.allowNew,t.demandeur=e.body.demandeur,t.demandeur_id=e.body.demandeur_id,t.organisations=e.body.organisations,t.lockMessages=e.body.lockMessages},function(e){t.error="Impossible de charger les demandes : "+e.body}).then(function(e){t.loading=null})},sendFile:function(t,e){var n=new FormData(e.target);this.$http.post("?",n).then(function(t){}).catch(function(t){})},handlerSend:function(t){var e=this,n=new FormData;n.append("action","send"),n.append("id",t.id),this.$http.post("?",n).then(function(t){e.fetch()}).catch(function(t){e.error=t.body})},handlerNew:function(){this.formData={id:null,label:"",description:"",dateStart:null,dateEnd:null,amount:0,organization:this.organisations[0],files:[]}},handlerEdit:function(t){this.formData={id:t.id,label:t.label,description:t.description,dateStart:t.dateStart,dateEnd:t.dateEnd,amount:t.amount,organization:t.organization,files:t.files}},handlerDeleteFile:function(t,e){var n=this;this.loading="Suppression du fichier "+t.name,this.$http.get("?rdl="+t.file+"&id="+e.id).then(function(t){n.fetch()}).catch(function(t){n.error=t.body}).finally(function(t){n.loading=""})},handlerSave:function(t){var e=this,n=new FormData(t.target);n.append("dateStart",this.formData.dateStart),n.append("dateEnd",this.formData.dateEnd),this.$http.post("?",n).then(function(t){e.fetch(),e.formData=null}).catch(function(t){e.error=t.body,e.formData=null,console.log(t)})},handlerCancelForm:function(){this.formData=null},handlerDelete:function(t){this.deleteData=t},performDelete:function(){var t=this;this.loading="Suppression de la demande "+this.deleteData.label;var e=this.deleteData;this.$http.delete("?id="+e.id).then(function(e){t.fetch()},function(e){t.error=e.body}).then(function(e){return t.deleteData=null})}},mounted:function(){this.fetch()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{choose:{default:null},selected:{default:null}},computed:{selectedLabel:function(){var t=this;if(this.selected.length){var e=[];return this.choose.forEach(function(n){t.selected.indexOf(n.id)>-1&&e.push(n.label)}),e.join(", ")}return"Aucune selection"}},methods:{toggleSelection:function(t){var e=[];this.selected&&(e=this.selected);var n=e.indexOf(t);n>-1?e.splice(n,1):e.push(t),console.log(e),this.$emit("change",e)}}}},function(t,e,n){t.exports=n(4)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),i=n.n(s);for(var a in s)"default"!==a&&function(t){n.d(e,t,function(){return s[t]})}(a);var o=n(8),r=n(0),c=r(i.a,o.a,!1,null,null,null);e.default=c.exports},function(t,e,n){"use strict";function s(t){n(6)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),a=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);var r=n(7),c=n(0),l=s,d=c(a.a,r.a,!1,l,"data-v-afe32542",null);e.default=d.exports},function(t,e){},function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"jck-selector"},[n("div",{staticClass:"selected"},[n("i",{staticClass:"icon-cog"}),t._v(" "),n("strong",[t._v(t._s(t.selectedLabel))])]),t._v(" "),n("div",{staticClass:"list"},t._l(t.choose,function(e){return n("div",{staticClass:"item",class:{selected:t.selected.indexOf(e.id)>-1},on:{click:function(n){t.toggleSelection(e.id)}}},[n("i",{staticClass:"icon-check"}),t._v(" "),n("i",{staticClass:"icon-check-empty"}),t._v("\n            "+t._s(e.label)+"\n            "),n("small",[t._v(" ("+t._s(e.description)+")")])])}))])},i=[],a={render:s,staticRenderFns:i};e.a=a},function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("transition",{attrs:{name:"fade"}},[t.error?n("div",{staticClass:"overlay"},[n("div",{staticClass:"alert alert-danger overlay-content"},[n("h3",[t._v("Erreur\n                    "),n("a",{staticClass:"float-right",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.error=null}}},[n("i",{staticClass:"icon-cancel-outline"})])]),t._v(" "),n("pre",[t._v(t._s(t.error))])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.confirmProccess?n("div",{staticClass:"overlay"},[n("div",{staticClass:"alert alert-danger overlay-content"},[n("h3",[t._v(t._s(t.confirmProccess.message))]),t._v(" "),n("transition",{attrs:{name:"slide"}},[2==t.confirmProccess.step?n("div",[n("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(e){e.preventDefault(),t.confirmProccess=null}}},[n("i",{staticClass:"icon-cancel-outline"}),t._v("\n                            Annuler\n                        ")]),t._v(" "),n("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(e){e.preventDefault(),t.confirmProccess.process()}}},[n("i",{staticClass:"icon-ok-circled"}),t._v("\n                            Confirmer\n                        ")])]):n("div",[t.confirmProccess.person?n("section",{staticClass:"row"},[n("label",{staticClass:"col-md-8",attrs:{for:"roleDelarer"}},[t._v("\n                                Rôle de "+t._s(t.confirmProccess.person)),n("br"),t._v(" "),n("small",[t._v("Selectionnez un rôle pour "),n("strong",[t._v(t._s(t.confirmProccess.person))]),t._v(" dans l'activité de recherche. Vous pourrez modfifier cette information en éditant directement l'activité par le suite\n                                ")])]),t._v(" "),n("div",{staticClass:"col-md-4"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.confirmProccess.personRole,expression:"confirmProccess.personRole"}],staticClass:"form-control",attrs:{id:"roleDeclarer"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.confirmProccess,"personRole",e.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"0"}},[t._v("Ne pas affecter à l'activité")]),t._v(" "),t._l(t.rolesPerson,function(e,s){return n("option",{domProps:{value:s}},[t._v(t._s(e))])})],2)])]):t._e(),t._v(" "),t.confirmProccess.organization?n("section",{staticClass:"row"},[n("label",{staticClass:"col-md-8",attrs:{for:"roleOrg"}},[t._v("Rôle de "+t._s(t.confirmProccess.organization))]),t._v(" "),n("div",{staticClass:"col-md-4"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.confirmProccess.organisationRole,expression:"confirmProccess.organisationRole"}],staticClass:"form-control",attrs:{id:"roleOrg"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.confirmProccess,"organisationRole",e.target.multiple?n:n[0])}}},t._l(t.rolesOrganisation,function(e){return n("option",{domProps:{value:e.id}},[t._v(t._s(e.label))])}))])]):t._e(),t._v(" "),n("hr",{staticClass:"separator"}),t._v(" "),n("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:function(e){t.confirmProccess.step=2}}},[t._v("\n                            Suivant\n                            "),n("i",{staticClass:"icon-right-outline"})])])])],1)]):t._e()]),t._v(" "),n("header",{staticClass:"row"},[n("h1",{staticClass:"col-md-9"},[t._v(t._s(t.title))]),t._v(" "),n("nav",{staticClass:"col-md-3"},[t._v("\n             \n            "),n("jckselector",{attrs:{choose:t.listStatus,selected:t.selectedStatus},on:{change:function(e){t.selectedStatus=e}}})],1)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"alert alert-info"},[t._v(t._s(t.loading))]),t._v(" "),t.activityRequests.length?n("section",t._l(t.activityRequests,function(e){return n("article",{staticClass:"card"},[n("h3",{staticClass:"card-title"},[n("strong",[n("i",{class:"icon-"+e.statutText}),t._v("\n                "+t._s(e.label))]),t._v(" "),n("strong",[n("i",{staticClass:"icon-bank"}),t._v("\n                "+t._s(e.amount)+"\n            ")]),t._v(" "),n("small",{staticClass:"right"},[t._v("par "),n("strong",[t._v(t._s(e.requester))])])]),t._v(" "),n("div",{staticClass:"content row"},[n("div",{staticClass:"col-md-6"},[n("i",{staticClass:"icon-user"}),t._v(" Statut : "),n("strong",[t._v(t._s(t._f("renderStatus")(e.statut)))]),n("br"),t._v(" "),n("i",{staticClass:"icon-user"}),t._v(" Demandeur : "),n("strong",[t._v(t._s(e.requester))]),n("br"),t._v(" "),n("i",{staticClass:"icon-building-filled"}),t._v("Organisme : "),e.organisation?n("strong",[t._v(" "+t._s(e.organisation))]):n("em",[t._v("Aucun organisme identifié")]),n("br"),t._v(" "),n("i",{staticClass:"icon-bank"}),t._v(" Budget : "),n("strong",[t._v(t._s(t._f("montant")(e.amount)))]),n("br"),t._v(" "),n("i",{staticClass:"icon-calendar"}),t._v(" du "),e.dateStart?n("strong",[t._v(t._s(t._f("date")(e.dateStart)))]):n("em",[t._v("non précisé")]),t._v(" au\n                "),e.dateEnd?n("strong",[t._v(t._s(t._f("date")(e.dateEnd)))]):n("em",[t._v("non précisé")]),n("br"),t._v(" "),t._m(0,!0),t._v("\n                "+t._s(e.description)+"\n            ")]),t._v(" "),n("div",{staticClass:"col-md-6"},[n("h3",[t._v("Suivi")]),t._v(" "),t._l(e.suivi,function(e){return n("article",{staticClass:"follow"},[n("figure",{staticClass:"avatar"},[n("img",{attrs:{src:"//www.gravatar.com/avatar/"+e.by.gravatar+"?s=64",alt:""}})]),t._v(" "),n("div",{staticClass:"content"},[n("small",{staticClass:"infos"},[n("i",{staticClass:"icon-clock"}),t._v(" "+t._s(t._f("date")(e.datecreated))+"\n                            par "),n("strong",[n("i",{staticClass:"icon-user"}),t._v(" "+t._s(e.by.username))])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v(t._s(e.description))])])])})],2)]),t._v(" "),e.files.length?n("section",{staticClass:"liste-fichiers"},[t._m(1,!0),t._v(" "),n("ul",t._l(e.files,function(s){return n("li",[n("strong",[t._v(t._s(s.name))]),t._v(" "),n("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"?dl="+s.file+"&id="+e.id}},[n("i",{staticClass:"icon-download"}),t._v("\n                        Télécharger")])])}))]):t._e(),t._v(" "),2==e.statut?n("nav",[n("button",{staticClass:"btn btn-success",on:{click:function(n){t.handlerValid(e)}}},[n("i",{staticClass:"icon-valid"}),t._v(" Valider la demande\n            ")]),t._v(" "),n("button",{staticClass:"btn btn-danger",on:{click:function(n){t.handlerReject(e)}}},[n("i",{staticClass:"icon-cancel-alt"}),t._v(" Rejeter la demande\n            ")])]):t._e()])})):n("div",[n("p",{staticClass:"alert alert-info"},[t._v("\n            Aucune demande\n        ")])])],1)},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("strong",[n("i",{staticClass:"icon-comment"}),t._v("Description : ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("h4",[n("i",{staticClass:"icon-file-excel"}),t._v(" Fichiers")])}],a={render:s,staticRenderFns:i};e.a=a}])});
//# sourceMappingURL=ActivityRequestAdmin.js.map