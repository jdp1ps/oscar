(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ActivityRequest=e():t.ActivityRequest=e()})("undefined"!=typeof self?self:this,function(){return function(t){function e(n){if(a[n])return a[n].exports;var s=a[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var a={};return e.m=t,e.c=a,e.d=function(t,a,n){e.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=3)}([function(t,e){t.exports=function(t,e,a,n,s,i){var r,o=t=t||{},l=typeof t.default;"object"!==l&&"function"!==l||(r=t,o=t.default);var c="function"==typeof o?o.options:o;e&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0),a&&(c.functional=!0),s&&(c._scopeId=s);var d;if(i?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},c._ssrRegister=d):n&&(d=n),d){var u=c.functional,v=u?c.render:c.beforeCreate;u?(c._injectStyles=d,c.render=function(t,e){return d.call(e),v(t,e)}):c.beforeCreate=v?[].concat(v,d):[d]}return{esModule:r,exports:o,options:c}}},function(t,e,a){"use strict";e.a={data:function(){return{formData:null,addFile:!1,sendData:null,addableFiles:null,file:null,loading:"",activityRequests:[],error:null,deleteData:null,allowNew:!1,demandeur:"",demandeur_id:null,organisations:[],lockMessages:[],selectedStatus:[1,2]}},props:{moment:{required:!0},title:{required:!0}},watch:{selectedStatus:function(){this.fetch()}},computed:{listStatus:function(){return[{id:1,label:"Brouillon",description:"Demandes en cours de rédaction (non envoyées)"},{id:2,label:"Envoyée",description:"Demandes envoyées mais pas encore traitées"},{id:5,label:"Validée",description:"Demandes validées"},{id:7,label:"Refusée",description:"Demandes refusées"}]}},components:{jckselector:a(5).default},methods:{processFile:function(t){this.addableFiles=t.target.files[0].name},handlerAddFile:function(){this.addFile=!0},fetch:function(){var t=this;this.loading="Chargement des Demandes",this.$http.get("?&status="+this.selectedStatus.join(",")).then(function(e){t.activityRequests=e.body.activityRequests,t.allowNew=e.body.allowNew,t.demandeur=e.body.demandeur,t.demandeur_id=e.body.demandeur_id,t.organisations=e.body.organisations,t.lockMessages=e.body.lockMessages},function(e){t.error="Impossible de charger les demandes : "+e.body}).then(function(e){t.loading=null})},sendFile:function(t,e){var a=new FormData(e.target);this.$http.post("?",a).then(function(t){}).catch(function(t){})},handlerSend:function(t){this.sendData=t},performSend:function(){var t=this,e=this.sendData,a=new FormData;a.append("action","send"),a.append("id",e.id),this.$http.post("?",a).then(function(e){t.fetch()}).catch(function(e){t.error=e.body}).then(function(e){t.sendData=null})},handlerNew:function(){this.formData={id:null,label:"",description:"",dateStart:null,dateEnd:null,amount:0,organization:this.organisations[0],files:[]}},handlerEdit:function(t){this.formData={id:t.id,label:t.label,description:t.description,dateStart:t.dateStart,dateEnd:t.dateEnd,amount:t.amount,organization:t.organization,files:t.files}},handlerDeleteFile:function(t,e){var a=this;this.loading="Suppression du fichier "+t.name,this.$http.get("?rdl="+t.file+"&id="+e.id).then(function(t){a.fetch()}).catch(function(t){a.error=t.body}).finally(function(t){a.loading=""})},handlerSave:function(t){var e=this,a=new FormData(t.target);a.append("dateStart",this.formData.dateStart),a.append("dateEnd",this.formData.dateEnd),this.$http.post("?",a).then(function(t){e.fetch(),e.formData=null}).catch(function(t){e.error=t.body,e.formData=null,console.log(t)})},handlerCancelForm:function(){this.formData=null},handlerDelete:function(t){this.deleteData=t},performDelete:function(){var t=this;this.loading="Suppression de la demande "+this.deleteData.label;var e=this.deleteData;this.$http.delete("?id="+e.id).then(function(e){t.fetch()},function(e){t.error=e.body}).then(function(e){return t.deleteData=null})}},mounted:function(){this.fetch()}}},function(t,e,a){"use strict";e.a={props:{choose:{default:null},selected:{default:null}},computed:{selectedLabel:function(){var t=this;if(this.selected.length){var e=[];return this.choose.forEach(function(a){t.selected.indexOf(a.id)>-1&&e.push(a.label)}),e.join(", ")}return"Aucune selection"}},methods:{toggleSelection:function(t){var e=[];this.selected&&(e=this.selected);var a=e.indexOf(t);a>-1?e.splice(a,1):e.push(t),console.log(e),this.$emit("change",e)}}}},function(t,e,a){t.exports=a(4)},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(1),s=a(8),i=a(0),r=i(n.a,s.a,!1,null,null,null);e.default=r.exports},function(t,e,a){"use strict";function n(t){a(6)}Object.defineProperty(e,"__esModule",{value:!0});var s=a(2),i=a(7),r=a(0),o=n,l=r(s.a,i.a,!1,o,"data-v-afe32542",null);e.default=l.exports},function(t,e){},function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"jck-selector"},[a("div",{staticClass:"selected"},[a("i",{staticClass:"icon-cog"}),t._v(" "),a("strong",[t._v(t._s(t.selectedLabel))])]),t._v(" "),a("div",{staticClass:"list"},t._l(t.choose,function(e){return a("div",{staticClass:"item",class:{selected:t.selected.indexOf(e.id)>-1},on:{click:function(a){return t.toggleSelection(e.id)}}},[a("i",{staticClass:"icon-check"}),t._v(" "),a("i",{staticClass:"icon-check-empty"}),t._v("\n            "+t._s(e.label)+"\n            "),a("small",[t._v(" ("+t._s(e.description)+")")])])}),0)])},s=[],i={render:n,staticRenderFns:s};e.a=i},function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"alert alert-info"},[t._v(t._s(t.loading))]),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.formData?a("div",{staticClass:"overlay",staticStyle:{"overflow-y":"scroll",padding:"1em"}},[a("form",{staticStyle:{"min-width":"75vw","max-width":"80%","padding-top":"2em"},attrs:{action:"?",enctype:"multipart/form-data",method:"post",name:"save"},on:{submit:function(e){return e.preventDefault(),t.handlerSave(e)}}},[t.formData.id?a("h1",[t._v("Modification de la demande")]):a("h1",[t._v("Nouvelle demande")]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-6"},[a("strong",[t._v("Demandeur : ")]),a("br"),t._v(" "),a("span",{staticClass:"cartouche"},[t._v("\n                            "+t._s(t.demandeur)+"\n                            "),a("span",{staticClass:"addon"},[t._v("Demandeur")])])]),t._v(" "),a("div",{staticClass:"col-md-6"},[a("strong",[t._v("Organisme référent : ")]),a("br"),t._v(" "),0==t.organisations.length?a("p",{staticClass:"alert alert-info"},[t._v("\n                            Vous n'êtes associé à aucun organisme.\n                        ")]):a("select",{staticClass:"form-control",attrs:{name:"organisation_id"}},t._l(t.organisations,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])}),0)])]),t._v(" "),a("hr",{staticClass:"separator"}),t._v(" "),a("div",[a("label",{attrs:{for:"form_label"}},[t._v("Intitulé")]),t._v(" "),t.formData.id?a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.id,expression:"formData.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:t.formData.id},on:{input:function(e){e.target.composing||t.$set(t.formData,"id",e.target.value)}}}):t._e(),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.label,expression:"formData.label"}],staticClass:"form-control input-lg",attrs:{type:"text",id:"form_label",name:"label"},domProps:{value:t.formData.label},on:{input:function(e){e.target.composing||t.$set(t.formData,"label",e.target.value)}}})]),t._v(" "),a("hr",{staticClass:"separator"}),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-4"},[a("strong",[t._v("Début prévu")]),t._v(" "),a("p",{staticClass:"help"},[t._v("Vous pouvez laisser ce champ vide.")]),t._v(" "),a("datepicker",{attrs:{moment:t.moment,value:t.formData.dateStart},on:{change:function(e){t.formData.dateStart=e}}})],1),t._v(" "),a("div",{staticClass:"col-md-4"},[a("strong",[t._v("Fin prévue")]),t._v(" "),a("p",{staticClass:"help"},[t._v("Vous pouvez laisser ce champ vide.")]),t._v(" "),a("datepicker",{attrs:{moment:t.moment,value:t.formData.dateEnd},on:{change:function(e){t.formData.dateEnd=e}}})],1),t._v(" "),a("div",{staticClass:"col-md-4"},[a("label",{attrs:{for:"form_amount"}},[t._v("Montant souhaité")]),t._v(" "),a("p",{staticClass:"help"},[t._v("Vous pouvez laisser ce champ vide.")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.amount,expression:"formData.amount"}],staticClass:"form-control",attrs:{type:"text",name:"amount",id:"form_amount"},domProps:{value:t.formData.amount},on:{input:function(e){e.target.composing||t.$set(t.formData,"amount",e.target.value)}}})])]),t._v(" "),a("hr",{staticClass:"separator"}),t._v(" "),a("div",[a("label",{attrs:{for:"form_description"}},[t._v("Description")]),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.description,expression:"formData.description"}],staticClass:"form-control",attrs:{type:"text",id:"form_description",name:"description"},domProps:{value:t.formData.description},on:{input:function(e){e.target.composing||t.$set(t.formData,"description",e.target.value)}}})]),t._v(" "),a("hr",{staticClass:"separator"}),t._v(" "),a("div",[a("label",{attrs:{for:"form_files"}},[t._v("Fichiers à ajouter")]),t._v(" "),a("p",{staticClass:"help"},[t._v("Vous pouvez sélectionner plusieurs fichiers en maintenant la touche CTRL enfoncé lors de la sélection d'un fichier")]),t._v(" "),a("input",{attrs:{type:"file",name:"files[]",id:"form_files"}})]),t._v(" "),a("div",{staticClass:"alert alert-info"},[t._v("\n                    Vous pourrez modifier votre saisie, et finaliser la demande en cliquant sur l'action "),a("strong",[t._v("Envoyer la demande")])]),t._v(" "),a("hr"),t._v(" "),a("nav",{staticClass:"text-center"},[a("button",{staticClass:"btn btn-default",attrs:{type:"reset"},on:{click:function(e){return e.preventDefault(),t.handlerCancelForm(e)}}},[a("i",{staticClass:"icon-cancel-outline"}),t._v("\n                        Annuler\n                    ")]),t._v(" "),a("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[a("i",{staticClass:"icon-floppy"}),t._v("\n                        Enregistrer\n                    ")])])])]):t._e()]),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.error?a("div",{staticClass:"overlay"},[a("div",{staticClass:"alert alert-danger"},[a("h3",[t._v("Erreur\n                    "),a("a",{staticClass:"float-right",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.error=null}}},[a("i",{staticClass:"icon-cancel-outline"})])]),t._v(" "),a("p",[t._v(t._s(t.error))])])]):t._e()]),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.deleteData?a("div",{staticClass:"overlay"},[a("div",{staticClass:"alert alert-danger"},[a("h3",[t._v("Supprimer la demande "),a("strong",[t._v(t._s(t.deleteData.label))]),t._v(" ?")]),t._v(" "),a("nav",[a("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(e){e.preventDefault(),t.deleteData=null}}},[a("i",{staticClass:"icon-cancel-outline"}),t._v("\n                        Annuler\n                    ")]),t._v(" "),a("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.performDelete(e)}}},[a("i",{staticClass:"icon-ok-circled"}),t._v("\n                        Confirmer\n                    ")])])])]):t._e()]),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.sendData?a("div",{staticClass:"overlay"},[a("div",{staticClass:"alert"},[a("h3",[t._v("Envoyer la demande "),a("strong",[t._v(t._s(t.sendData.label))]),t._v(" ?")]),t._v(" "),a("nav",[a("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(e){e.preventDefault(),t.sendData=null}}},[a("i",{staticClass:"icon-cancel-outline"}),t._v("\n                        Annuler\n                    ")]),t._v(" "),a("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.performSend(e)}}},[a("i",{staticClass:"icon-ok-circled"}),t._v("\n                        Confirmer\n                    ")])])])]):t._e()]),t._v(" "),a("header",{staticClass:"row"},[a("h1",{staticClass:"col-md-9"},[t._v(t._s(t.title))]),t._v(" "),a("nav",{staticClass:"col-md-3"},[t._v("\n             \n            État des demandes affichées :\n            "),a("jckselector",{attrs:{choose:t.listStatus,selected:t.selectedStatus},on:{change:function(e){t.selectedStatus=e}}})],1)]),t._v(" "),t.activityRequests.length?a("section",t._l(t.activityRequests,function(e){return a("article",{staticClass:"demande card",class:"status-"+e.statut},[a("h3",{staticClass:"card-title"},[a("strong",[a("i",{class:"icon-"+e.statutText}),t._v("\n                "+t._s(e.label)+"\n            ")]),t._v(" "),a("strong",[a("i",{staticClass:"icon-bank"}),t._v("\n                "+t._s(e.amount)+"\n            ")])]),t._v(" "),a("div",{staticClass:"card-metas text-highlight"},[a("strong",[a("i",{class:"icon-"+e.statut}),t._v(t._s(t._f("renderStatus")(e.statut)))]),t._v("\n            Créé le : "),a("time",[a("i",{staticClass:"icon-calendar"}),t._v(t._s(t._f("date")(e.dateCreated)))]),t._v(" ~\n            "),e.worker?a("span",[t._v("\n                Demande géré par  "),a("strong",[t._v(t._s(e.worker))])]):a("em",[t._v("\n                Non prise en charge pour le moment\n            ")]),t._v("\n            ~\n            "),a("strong",[a("i",{staticClass:"icon-building-filled"}),t._v(" "),e.organisation?a("span",[t._v(t._s(e.organisation))]):a("em",[t._v("Aucune organisation")])])]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-6"},[t._m(0,!0),t._v(" "),a("ul",[a("li",[a("i",{staticClass:"icon-bank"}),t._v(" Somme demandée : "),a("strong",[t._v(t._s(t._f("montant")(e.amount)))])]),t._v(" "),a("li",[a("i",{staticClass:"icon-calendar"}),t._v(" Début (prévu) :\n                        "),e.dateStart?a("strong",[t._v(t._s(t._f("date")(e.dateStart)))]):a("em",[t._v("pas de date de début prévue")])]),t._v(" "),a("li",[a("i",{staticClass:"icon-calendar"}),t._v(" Fin (prévue) :\n                        "),e.dateEnd?a("strong",[t._v(t._s(t._f("date")(e.dateEnd)))]):a("em",[t._v("pas de date de fin prévue")])])]),t._v(" "),a("div",{staticClass:"alert alert-help"},[a("strong",[t._v("Description")]),t._v(" :\n                "+t._s(e.description)+"\n                ")]),t._v(" "),a("section",{staticClass:"fichiers"},[t._m(1,!0),t._v(" "),0==e.files.length?a("div",{staticClass:"alert alert-info"},[t._v("\n                        Vous n'avez fourni aucun document pour cette demande\n                    ")]):a("ul",t._l(e.files,function(n){return a("li",[a("strong",[t._v(t._s(n.name))]),t._v(" "),a("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"?dl="+n.file+"&id="+e.id}},[a("i",{staticClass:"icon-download"}),t._v("\n                                Télécharger")]),t._v(" "),e.sendable?a("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerDeleteFile(n,e)}}},[a("i",{staticClass:"icon-trash"}),t._v("\n                                Supprimer ce fichier")]):t._e()])}),0)])]),t._v(" "),a("div",{staticClass:"col-md-6"},[a("section",[t._m(2,!0),t._v(" "),t._l(e.suivi,function(e){return a("article",{staticClass:"follow"},[a("figure",{staticClass:"avatar"},[a("img",{attrs:{src:"//www.gravatar.com/avatar/"+e.by.gravatar+"?s=64",alt:""}})]),t._v(" "),a("div",{staticClass:"content"},[a("small",{staticClass:"infos"},[a("i",{staticClass:"icon-clock"}),t._v(" "+t._s(t._f("date")(e.datecreated))+"\n                                par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(" "+t._s(e.by.username))])]),t._v(" "),a("br"),t._v(" "),a("p",[t._v(t._s(e.description))])])])})],2)])]),t._v(" "),e.sendable?a("nav",[a("a",{staticClass:"btn btn-default",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerEdit(e)}}},[a("i",{staticClass:"icon-edit"}),t._v("\n                Modifier")]),t._v(" "),a("a",{staticClass:"btn btn-danger",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerDelete(e)}}},[a("i",{staticClass:"icon-trash"}),t._v("\n                Supprimer")]),t._v(" "),a("a",{staticClass:"btn btn-success",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerSend(e)}}},[a("i",{staticClass:"icon-paper-plane"}),t._v("\n                Envoyer")])]):t._e()])}),0):a("div",[a("p",{staticClass:"alert alert-info"},[t._v("\n            Aucune demande\n        ")])]),t._v(" "),a("hr"),t._v(" "),t.allowNew?a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.handlerNew(e)}}},[a("i",{staticClass:"icon-plus-circled"}),t._v("\n        Nouvelle Demande\n    ")]):t._e(),t._v(" "),t.lockMessages.length?a("div",{staticClass:"alert alert-danger"},[a("ul",t._l(t.lockMessages,function(e){return a("li",[t._v(t._s(e))])}),0)]):t._e()],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:" icon-edit"}),t._v(" Informations")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:"icon-attach-outline"}),t._v(" Fichiers")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:"icon-signal"}),t._v(" Suivi")])}],i={render:n,staticRenderFns:s};e.a=i}])});
//# sourceMappingURL=ActivityRequest.js.map