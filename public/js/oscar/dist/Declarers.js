(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Declarers=e():t.Declarers=e()})("undefined"!=typeof self?self:this,function(){return function(t){function e(s){if(a[s])return a[s].exports;var r=a[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var a={};return e.m=t,e.c=a,e.d=function(t,a,s){e.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=1)}([function(t,e,a){"use strict";e.a={props:{urlRecallDeclarer:{required:!0}},data:function(){return{declarers:null,period:null,error:null,loading:!1,infosPerson:null,months:{1:"Janvier",2:"Février",3:"Mars",4:"Avril",5:"Mai",6:"Juin",7:"Juillet",8:"Aout",9:"Septembre",10:"Octobre",11:"Novembre",12:"Décembre"}}},computed:{years:function(){for(var t=[],e=this.period.year-5;e<=this.period.year+5;e++)t.push(e);return t}},filters:{percent:function(t){return""+(Math.round(10*t)/10).toFixed(1)},round1:function(t){return t.toFixed(1)},formatDuration:function(t){var e=Math.floor(t),a=Math.round(60*(t-e));return e+":"+(a<10?"0"+a:a)}},methods:{recall:function(t,e){console.log(t,e.periodCode,this.urlurlRecallDeclarer)},details:function(t){var e=this;this.$http.get(t.url_details).then(function(t){e.infosPerson=t.data})},organize:function(t){var e={activities:{},others:{}};return Object.keys(t.activities).forEach(function(a){var s=t.activities[a];e.activities[a]={acronym:s.acronym,id:s.id,label:s.label,total:s.total,workpackages:{},days:{}}}),Object.keys(t.workpackages).forEach(function(a){var s=t.workpackages[a];e.activities[s.activity_id].workpackages[a]={code:s.code,id:s.id,label:s.label,total:s.total,days:{}}}),Object.keys(t.otherWP).forEach(function(a){var s=t.otherWP[a];e.others[a]={label:s.label,code:s.code,total:s.total,days:{}}}),Object.keys(t.days).forEach(function(a){var s=t.days[a];s.declarations&&s.declarations.forEach(function(t){var s=t.wp_id,r=t.activity_id,n=t.duration;e.activities[r].days.hasOwnProperty(a)||(e.activities[r].days[a]=0),e.activities[r].days[a]+=n,e.activities[r].workpackages[s].days.hasOwnProperty(a)||(e.activities[r].workpackages[s].days[a]=0),e.activities[r].workpackages[s].days[a]+=n}),s.othersWP&&s.othersWP.forEach(function(t){var s=t.code,r=t.duration;e.others[s].days.hasOwnProperty(a)||(e.others[s].days[a]=0),e.others[s].days[a]+=r})}),e},fetch:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.loading="Chargement de la période",this.$http.get(e?"?period="+e:"").then(function(e){t.declarers=e.body.declarers.sort(function(t,e){return t.lastName.localeCompare(e.lastName)}),t.period=e.body.period},function(e){t.error=e.body}).then(function(e){t.loading=!1})},nextPeriod:function(){var t=void 0,e=void 0;12==this.period.month?(t=1,e=this.period.year+1):(t=this.period.month+1,e=this.period.year),this.fetch(e+"-"+t)},previousPeriod:function(){var t=void 0,e=void 0;1==this.period.month?(t=12,e=this.period.year-1):(t=this.period.month-1,e=this.period.year),this.fetch(e+"-"+t)},changePeriod:function(){var t=this.period.year+"-"+this.period.month;this.fetch(t)}},mounted:function(){this.fetch()}}},function(t,e,a){t.exports=a(2)},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(0),r=a(4),n=a(3),o=n(s.a,r.a,!1,null,null,null);e.default=o.exports},function(t,e){t.exports=function(t,e,a,s,r,n){var o,i=t=t||{},l=typeof t.default;"object"!==l&&"function"!==l||(o=t,i=t.default);var c="function"==typeof i?i.options:i;e&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0),a&&(c.functional=!0),r&&(c._scopeId=r);var d;if(n?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},c._ssrRegister=d):s&&(d=s),d){var u=c.functional,f=u?c.render:c.beforeCreate;u?(c._injectStyles=d,c.render=function(t,e){return d.call(e),f(t,e)}):c.beforeCreate=f?[].concat(f,d):[d]}return{esModule:o,exports:i,options:c}}},function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("transition",{attrs:{name:"fade"}},[t.infosPerson?a("div",{staticClass:"overlay"},[a("div",{staticClass:"overlay-content",staticStyle:{"flex-basis":"90%","max-height":"90%"}},[a("h3",[t._v("\n                    Détails pour\n                    "),a("strong",[t._v(t._s(t.infosPerson.person))]),t._v("\n                    pour "),a("em",[t._v(t._s(t.infosPerson.period||t.formatPeriod))]),t._v(" "),a("a",{attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.infosPerson=null}}},[a("i",{staticClass:"icon-cancel-outline"})])]),t._v(" "),a("table",{staticClass:"table bordered table table-condensed"},[a("thead",[a("tr",[a("th",[t._v(" ~")]),t._v(" "),t._l(t.infosPerson.days,function(e,s){return a("th",[a("small",{staticStyle:{"font-weight":"100"}},[t._v(t._s(e.label))]),t._v("\n                            "+t._s(e.i)+"\n                        ")])}),t._v(" "),a("th",[t._v(" Total")])],2)]),t._v(" "),t._l(t.organize(t.infosPerson).activities,function(e){return a("tbody",[a("tr",[a("th",{attrs:{colspan:t.infosPerson.dayNbr+2}},[a("h4",[a("i",{staticClass:"icon-cube"}),t._v(t._s(e.acronym))])])]),t._v(" "),t._l(e.workpackages,function(e){return a("tr",[a("th",[a("i",{staticClass:"icon-archive"}),t._v(t._s(e.code))]),t._v(" "),t._l(t.infosPerson.days,function(s,r){return a("td",{staticClass:"day",class:{off:s.locked}},[e.days[r]?a("strong",[t._v("\n                                "+t._s(t._f("formatDuration")(e.days[r]))+"\n                            ")]):a("small",[t._v("0.0")])])}),t._v(" "),a("th",{staticClass:"total"},[t._v(t._s(t._f("formatDuration")(e.total)))])],2)}),t._v(" "),a("tr",[a("th",[t._v("Total")]),t._v(" "),a("td",{attrs:{colspan:t.infosPerson.dayNbr}},[t._v(" ")]),t._v(" "),a("th",[t._v(t._s(t._f("formatDuration")(e.total)))])])],2)}),t._v(" "),a("tbody",[a("tr",[a("th",{attrs:{colspan:t.infosPerson.dayNbr+2}},[a("h4",[a("i",{staticClass:"icon-tags"}),t._v("Hors-lot")])])]),t._v(" "),t._l(t.organize(t.infosPerson).others,function(e){return a("tr",[a("th",[t._v(t._s(e.label))]),t._v(" "),t._l(t.infosPerson.days,function(s,r){return a("td",{staticClass:"day",class:{off:s.locked}},[e.days[r]?a("strong",[t._v("\n                                "+t._s(t._f("formatDuration")(e.days[r]))+"\n                            ")]):a("small",[t._v("0.0")])])}),t._v(" "),a("th",{staticClass:"total"},[t._v(t._s(t._f("formatDuration")(e.total)))])],2)})],2),t._v(" "),a("tfoot",[a("tr",[a("th",[t._v("Total")]),t._v(" "),t._l(t.infosPerson.days,function(e,s){return a("th",{staticClass:"day",class:{off:e.locked}},[a("small",[t._v(t._s(t._f("formatDuration")(e.total)))])])}),t._v(" "),a("th",[t._v(t._s(t._f("formatDuration")(t.infosPerson.total)))])],2)])],2)])]):t._e()]),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.error?a("div",{staticClass:"overlay"},[a("div",{staticClass:"alert alert-danger"},[a("h3",[t._v("Erreur\n                    "),a("a",{staticClass:"float-right",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.error=null}}},[a("i",{staticClass:"icon-cancel-outline"})])]),t._v(" "),a("p",[t._v(t._s(t.error))])])]):t._e()]),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.loading?a("div",{staticClass:"overlay"},[a("div",{staticClass:"overlay-content"},[a("p",[t._v("Chargement de la période")])])]):t._e()]),t._v(" "),a("nav",{staticClass:"navbar navbar-default"},[t.period?a("div",{staticClass:"button-group"},[a("button",{staticClass:"btn btn-default",on:{click:function(e){return t.previousPeriod()}}},[t._v(" < ")]),t._v(" "),a("span",[t._v("Période : ")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:t.period.month,expression:"period.month"}],attrs:{name:"mois"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.period,"month",e.target.multiple?a:a[0])},function(e){return t.changePeriod()}]}},t._l(t.months,function(e,s){return a("option",{domProps:{value:s}},[t._v(t._s(e))])}),0),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:t.period.year,expression:"period.year"}],attrs:{name:"mois"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.period,"year",e.target.multiple?a:a[0])},function(e){return t.changePeriod()}]}},t._l(t.years,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])}),0),t._v(" "),a("strong",[t._v(t._s(t.period.periodLabel))]),t._v(" "),a("button",{staticClass:"btn btn-default",on:{click:function(e){return t.nextPeriod()}}},[t._v(" > ")])]):t._e()]),t._v(" "),t.declarers?a("div",{staticClass:"list"},t._l(t.declarers,function(e){return a("article",{staticClass:"card",staticStyle:{display:"flex"}},[a("span",{staticStyle:{width:"48px",flex:"0"}},[a("img",{staticClass:"thumb32",attrs:{src:"//www.gravatar.com/avatar/"+e.mailMd5+"?s=48",alt:""}})]),t._v(" "),a("span",{staticStyle:{flex:"1","padding-left":".25em"}},[a("strong",{staticClass:"lastname"},[t._v(t._s(e.lastName))]),t._v(" "),a("em",{staticClass:"firstname"},[t._v(t._s(e.firstName))]),t._v(" "),a("a",{staticClass:"link",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),t.details(e)}}},[a("i",{staticClass:"icon-calendar"}),t._v("Détails")]),t._v(" "),a("br"),t._v(" "),a("small",[t._v(t._s(e.affectation))])]),t._v(" "),a("span",{staticClass:"tags",staticStyle:{flex:"1"}},t._l(e.projects,function(e){return a("span",{staticClass:"tag cartouche xs"},[a("i",{staticClass:"icon-cubes"}),t._v(t._s(e))])}),0),t._v(" "),a("span",{staticStyle:{flex:"1"}},[a("strong",{staticClass:"cartouche secondary1"},[a("i",{staticClass:"icon-calendar"}),t._v(" "),a("small",[t._v("Saisie : ")]),a("strong",[t._v(t._s(t._f("percent")(100/e.details.waitingTotal*e.details.total))+" %")]),t._v(" "),a("span",{staticClass:"addon"},[t._v("\n                            "+t._s(t._f("round1")(e.details.total))+" / "+t._s(t._f("round1")(e.details.waitingTotal))+"\n                        ")])]),a("br"),t._v(" "),a("strong",{staticClass:"cartouche xs secondary1",class:e.details.state},[a("i",{staticClass:"icon-paper-plane"}),t._v(" "),a("small",[t._v("État : "),a("strong",[t._v(t._s(e.details.stateText))])])])]),t._v(" "),a("nav",{staticClass:"actions",staticStyle:{width:"175px"}},["PERIOD_NODECLARATION"==e.details.state?a("button",{staticClass:"btn btn-primary btn-xs",on:{click:function(a){return t.recall(e.id,t.period)}}},[a("i",{staticClass:"icon-mail"},[t._v("Relancer le déclarant")])]):t._e(),a("br"),t._v(" "),e.url_person?a("a",{staticClass:"btn btn-default btn-xs",attrs:{href:e.url_person}},[a("i",{staticClass:"icon-user"},[t._v("Fiche personne")])]):t._e()])])}),0):t._e()],1)},r=[],n={render:s,staticRenderFns:r};e.a=n}])});
//# sourceMappingURL=Declarers.js.map