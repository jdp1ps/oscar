(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.authentification=t():e.authentification=t()})("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(s[n])return s[n].exports;var r=s[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var s={};return t.m=e,t.c=s,t.d=function(e,s,n){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=1)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:{users:{required:!0},roles:{required:!0},urlLogs:{required:!0},urlRoles:{required:!0},moment:{required:!0}},data:function(){return{orderby:"lastLogin",orderbyDirection:-1,search:"",logs:null,selectedUser:null,loading:!1,error:null,addRoleUser:null,addRoleId:1,addRoleError:null,deleteDatas:null,deleteError:null}},methods:{getRoleId:function(e){return this.roles.find(function(t){return t.roleId==e})},handlerDeleteRole:function(e,t){this.deleteError=null,this.deleteDatas={user:e,role:t}},performDeleteRole:function(){var e=this,t=this.deleteDatas.user.id,s=this.getRoleId(this.deleteDatas.role).id;this.loading=!0,this.addRoleError=null,this.$http.delete(this.urlRoles,{body:{authentification_id:t,role_id:s}}).then(function(t){e.deleteDatas.user.roles=t.data.roles,e.deleteDatas=null,e.deleteError=null},function(t){e.deleteError=t.body}).then(function(t){e.loading=!1})},performAddRole:function(){var e=this;this.loading=!0,this.addRoleError=null,this.addRoleUser.id&&this.addRoleId&&this.$http.post(this.urlRoles,{authentification_id:this.addRoleUser.id,role_id:this.addRoleId}).then(function(t){e.addRoleUser.roles=t.data.roles,e.addRoleUser=null,e.addRoleError=null},function(t){e.addRoleError=t.body}).then(function(t){e.loading=!1})},updateOrderBy:function(e){e==this.orderby?this.orderbyDirection*=-1:(this.orderbyDirection=-1,this.orderby=e)},handlerClick:function(e){var t=this;this.selectedUser=e,this.loading=!0,this.$http.get(this.urlLogs+e.id).then(function(e){t.logs=e.body},function(e){console.log(e)}).then(function(){t.loading=!1})}},computed:{usersFiltered:function(){var e=this,t=[];return""!=this.search?this.users.forEach(function(s){(s.displayName+s.email+s.username).indexOf(e.search)>-1&&t.push(s)}):t=this.users,t.sort(function(t,s){return t[e.orderby]==s[e.orderby]?0:t[e.orderby]<s[e.orderby]?-e.orderbyDirection:e.orderbyDirection}),t},logsFiltered:function(){var e=this,t=[];if(this.logs){var s=null;this.logs.forEach(function(n){var r=e.moment(n.dateCreated.date),o=r.format("dddd D MMMM YYYY")+", "+r.fromNow();null!=s&&s.day==o||(s={day:o,logs:[]},t.push(s)),s.logs.push(n)})}return t}}}},function(e,t,s){e.exports=s(2)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(0),r=s.n(n);for(var o in n)"default"!==o&&function(e){s.d(t,e,function(){return n[e]})}(o);var i=s(4),a=s(3),l=a(r.a,i.a,!1,null,null,null);t.default=l.exports},function(e,t){e.exports=function(e,t,s,n,r,o){var i,a=e=e||{},l=typeof e.default;"object"!==l&&"function"!==l||(i=e,a=e.default);var c="function"==typeof a?a.options:a;t&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0),s&&(c.functional=!0),r&&(c._scopeId=r);var d;if(o?(d=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=d):n&&(d=n),d){var u=c.functional,v=u?c.render:c.beforeCreate;u?(c._injectStyles=d,c.render=function(e,t){return d.call(t),v(e,t)}):c.beforeCreate=v?[].concat(v,d):[d]}return{esModule:i,exports:a,options:c}}},function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{attrs:{id:"authentifications"}},[e.loading?s("div",{staticClass:"vue-loader"},[s("span",[e._v("Chargement")])]):e._e(),e._v(" "),e._m(0),e._v(" "),s("p",{staticClass:"oscar-help"},[e._v("\n        Seules les personnes qui se sont authentifiées au moins une fois et les comptes spéciaux sont affichés.\n    ")]),e._v(" "),e.error?s("div",{staticClass:"alert alert-danger"},[s("p",{staticClass:"text-right"},[s("i",{staticClass:" icon-cancel-outline",staticStyle:{float:"right",cursor:"pointer"},on:{click:function(t){e.error=null}}})]),e._v("\n        "+e._s(e.error)+"\n    ")]):e._e(),e._v(" "),e.deleteDatas?s("div",{staticClass:"overlay"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-6 col-md-offset-3"},[s("h3",[s("i",{staticClass:"icon-attention-1"}),e._v("\n                        Supprimer le rôle "),s("strong",[e._v(e._s(e.deleteDatas.role))]),e._v(" "),s("br"),e._v("\n                        pour le compte "),s("strong",[e._v(e._s(e.deleteDatas.user.displayName))]),e._v(" ?\n                    ")]),e._v(" "),e._m(1),e._v(" "),s("hr"),e._v(" "),s("nav",[s("button",{staticClass:"btn btn-danger",on:{click:function(t){e.performDeleteRole()}}},[e._v("Supprimer définitivement")]),e._v(" "),s("button",{staticClass:"btn btn-default",on:{click:function(t){e.deleteDatas=null}}},[e._v("Annuler")])])])])]):e._e(),e._v(" "),e.addRoleUser?s("div",{staticClass:"overlay"},[s("form",{staticClass:"overlay-content container",attrs:{action:""},on:{submit:function(t){t.preventDefault(),e.performAddRole()}}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-6 col-md-offset-3"},[s("h3",[e._v("Ajouter un rôle au compte : "),s("strong",[e._v(e._s(e.addRoleUser.displayName))])]),e._v(" "),e.addRoleError?s("div",{staticClass:"alert alert-danger"},[e._v(e._s(e.addRoleError))]):e._e(),e._v("\n                    Rôle :\n\n                    "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.addRoleId,expression:"addRoleId"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.addRoleId=t.target.multiple?s:s[0]}}},e._l(e.roles,function(t){return s("option",{domProps:{value:t.id}},[e._v(e._s(t.roleId))])})),e._v(" "),s("hr"),e._v(" "),s("nav",[s("button",{staticClass:"btn btn-default",attrs:{type:"submit"}},[e._v("Ajouter")]),e._v(" "),s("button",{staticClass:"btn btn-primary",attrs:{type:"reset"},on:{click:function(t){e.addRoleUser=null}}},[e._v("Annuler")])])])])])]):e._e(),e._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-4"},[s("nav",{staticClass:"oscar-sorter row"},[s("i",{staticClass:"icon-sort"}),e._v("\n                Trie :\n                "),s("a",{staticClass:"oscar-sorter-item",class:{active:"lastLogin"==e.orderby},attrs:{href:"#"},on:{click:function(t){e.updateOrderBy("lastLogin")}}},[e._v("Dernière connexion")]),e._v(" "),s("a",{staticClass:"oscar-sorter-item",class:{active:"email"==e.orderby},attrs:{href:"#"},on:{click:function(t){e.updateOrderBy("email")}}},[e._v("Email")]),e._v(" "),s("a",{staticClass:"oscar-sorter-item",class:{active:"displayName"==e.orderby},attrs:{href:"#"},on:{click:function(t){e.updateOrderBy("displayName")}}},[e._v("Nom")])]),e._v(" "),s("div",{staticClass:"input-group"},[e._m(2),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"form-control",attrs:{type:"search",placeholder:"Recherche dans les authentification"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})])]),e._v(" "),s("div",{staticClass:"col-md-8"},[e._v("\n             \n        ")])]),e._v(" "),s("div",{staticClass:"ui-user"},[s("section",{staticClass:"users"},[s("hr"),e._v(" "),e._l(e.usersFiltered,function(t,n){return s("article",{staticClass:"card xs",class:{selected:e.selectedUser==t},on:{click:function(s){e.handlerClick(t)}}},[s("h3",{staticClass:"card-title"},[e._v("\n                    "+e._s(t.displayName)+" ("+e._s(t.username)+")\n                ")]),e._v(" "),s("div",{staticClass:"card-content"},[s("small",{staticClass:"text-highlight"},[s("i",{staticClass:"icon-mail"}),e._v(" "),s("small",[e._v(e._s(t.email))]),e._v(" "),s("br"),e._v("\n                        Dernière connexion :\n                        "),t.lastLogin?s("span",[e._v("\n                            "+e._s(e._f("sinceFull")(t.lastLogin))+"\n                        ")]):s("span",[e._v("\n                            Jamais\n                        ")]),e._v(" "),s("br"),e._v(" "),t.person?[e._v("\n                            Dans les activités oscar : "),s("strong",[e._v(e._s(t.person.displayname))])]:e._e()],2),e._v(" "),s("div",{staticClass:"roles"},[e._v("\n                        Rôles (implicites) :\n                        "),e._l(t.roles,function(n){return s("span",{staticClass:"cartouche"},[e._v("\n                            "+e._s(n)+"\n                            "),s("span",{staticClass:"addon"},[s("i",{staticClass:"icon-trash",on:{click:function(s){s.preventDefault(),s.stopPropagation(),e.handlerDeleteRole(t,n)}}})])])}),e._v(" "),s("div",{staticClass:"btn btn-default btn-xs",on:{click:function(s){e.addRoleUser=t}}},[s("i",{staticClass:"icon-user"}),e._v("\n                            Ajouter un rôle\n                        ")])],2)])])})],2),e._v(" "),e.logs?s("section",{staticClass:"logs"},[e._m(3),e._v(" "),e.logsFiltered.length?e._l(e.logsFiltered,function(t){return s("section",[s("h3",[e._v(e._s(t.day))]),e._v(" "),e._l(t.logs,function(t){return s("article",{staticClass:"card"},[s("div",{staticClass:"text-highlight"},[s("small",[e._v(e._s(e._f("sinceFull")(t.dateCreated.date)))]),e._v("\n                            - depuis l'IP "),s("strong",[e._v(e._s(t.ip))])]),e._v(" "),s("p",[e._v(e._s(e._f("logMessage")(t.message)))])])})],2)}):s("section",[s("p",{staticClass:"alert alert-info"},[e._v("Aucune donnée")])])],2):e._e()])])},r=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h1",[s("i",{staticClass:"icon-group"}),e._v(" Comptes")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",{staticClass:"alert alert-danger"},[e._v("\n                        Cette suppression "),s("strong",[e._v("est définitive")]),e._v(", ce compte, si c'est le votre, pourrez ne plus pouvoir accéder à l'application.\n                        Êtes-vous sûr ?\n                    ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"input-group-addon",attrs:{id:"basic-addon1"}},[s("i",{staticClass:"icon-zoom-in-outline"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h2",[s("i",{staticClass:"icon-signal"}),e._v("\n                Activités du compte\n            ")])}],o={render:n,staticRenderFns:r};t.a=o}])});
//# sourceMappingURL=Authentification.js.map