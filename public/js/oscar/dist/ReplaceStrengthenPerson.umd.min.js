(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["ReplaceStrengthenPerson"]=t():e["ReplaceStrengthenPerson"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="fb15")}({8875:function(e,t,s){var n,r,i;(function(s,a){r=[],n=a,i="function"===typeof n?n.apply(t,r):n,void 0===i||(e.exports=i)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(f){var s,n,r,i=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,a=/@([^@]*):(\d+):(\d+)\s*$/gi,o=i.exec(f.stack)||a.exec(f.stack),c=o&&o[1]||!1,l=o&&o[2]||!1,p=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");c===p&&(s=document.documentElement.outerHTML,n=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(n,"$1").trim());for(var d=0;d<u.length;d++){if("interactive"===u[d].readyState)return u[d];if(u[d].src===c)return u[d];if(c===p&&u[d].innerHTML&&u[d].innerHTML.trim()===r)return u[d]}return null}}return e}))},fb15:function(e,t,s){"use strict";if(s.r(t),"undefined"!==typeof window){var n=window.document.currentScript,r=s("8875");n=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var i=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(s.p=i[1])}var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[""!=e.mode?s("div",{staticClass:"overlay"},[s("div",{staticClass:"overlay-content",style:1==e.step?"overflow: visible;":"overflow: scroll;"},[s("a",{staticClass:"overlay-closer",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.handlerCancel()}}},[e._v("X")]),s("h1",[e._v(" "+e._s(e.mode)+" "),s("strong",[e._v(e._s(e.person.displayname))])]),s("div",{staticClass:"alert"},[e._v(" Cette écran va vous permettre de remplacer "),s("strong",[e._v(e._s(e.person.displayname))]),e._v(" par une autre personne. Choisissez un remplaçant, un récapitulatif sera affiché avant confirmation. ")]),s("div",{staticClass:"steps-bar"},[s("div",{staticClass:"step",class:{current:1==e.step,done:e.step>1}},[e._v(" Choisir une personne ")]),s("div",{staticClass:"step",class:{current:2==e.step,done:e.step>2,futur:e.step<2}},[e._v(" Vérifier les affectations ")])]),s("div",{staticClass:"step-content"},[e.pendingMessage?s("div",{staticClass:"alert-info alert"},[s("i",{staticClass:"animate-spin icon-spinner"}),e._v(" "+e._s(e.pendingMessage)+" ")]):e._e(),e.errorMessage?s("div",{staticClass:"alert-danger alert"},[s("i",{staticClass:"icon-attention-1"}),s("strong",[e._v("Erreur")]),e._v(" : "+e._s(e.errorMessage)+" ")]):e._e(),1==e.step?s("div",[e.replacer_id?e._e():s("div",[s("p",[e._v("Choisissez une personne :")]),s("person-auto-completer",{staticStyle:{"z-index":"10"},on:{change:e.handlerSelectPerson}})],1)]):e._e(),e.step1info?s("div",{staticClass:"alert alert-info"},[e._v(" "+e._s(e.step1info)+" ")]):e._e(),1==e.step?s("nav",{staticClass:"buttons text-center"},[s("button",{staticClass:"btn btn-success",class:{disabled:!e.replacer_id},on:{click:function(t){return e.handlerConfirmStep1()}}},[e.pendingMessage?s("i",{staticClass:"icon-spinner animate-spin"}):s("i",{staticClass:"icon-angle-right"}),e._v(" Vérifier les affectations ")])]):e._e(),s("section",{},[2==e.step?s("section",{staticClass:"affectations"},[s("section",[e._m(0),s("section",{staticClass:"projects"},[e._m(1),e.replacer_id?s("p",[s("strong",[e._v(e._s(e.replacer))]),e._v(" va être ajouté dans le(s) "),s("strong",[e._v(e._s(e.projects.length))]),e._v(" projet(s) suivant : ")]):e._e(),s("div",{staticClass:"columns-3"},e._l(e.projects,(function(t){return s("div",{staticClass:"card xs applyable",class:{apply:t.apply,active:t.active},on:{click:function(s){return e.handlerSwitchApply(t)}}},[s("div",{},[s("strong",[s("i",{staticClass:"icon-cubes"}),e._v(" "+e._s(t.label)+" ")])]),e._l(t.roles,(function(n){return s("span",{staticClass:"cartouche xs",class:{"past obsolete":!n.active,success:t.apply}},[e._v(" "+e._s(n.roleId)+" ")])}))],2)})),0)]),e._m(2),s("div",{staticClass:"columns-3"},e._l(e.activities,(function(t){return s("div",{staticClass:"card xs applyable",class:{apply:t.apply,active:t.active},on:{click:function(s){return e.handlerSwitchApply(t)}}},[s("div",{},[s("strong",[s("i",{staticClass:"icon-cube"}),e._v(" "+e._s(t.label)+" ")])]),e._l(t.roles,(function(n){return s("span",{staticClass:"cartouche xs",class:{"past obsolete":!n.active,success:t.apply}},[e._v(" "+e._s(n.roleId)+" ")])}))],2)})),0)]),s("section",[e._m(3),e._l(e.structures,(function(t){return s("div",{staticClass:"card xs applyable",class:{apply:t.apply},on:{click:function(s){return e.handlerSwitchApply(t)}}},[s("strong",[e._v(e._s(t.label))]),e._l(t.roles,(function(n){return s("span",{staticClass:"cartouche xs",class:{"past obsolete":!n.active,success:t.apply}},[e._v(" "+e._s(n.roleId)+" ")])}))],2)}))],2),s("section",[e._m(4),e.validations.prj?s("div",[e._m(5),e._l(e.validations.prj,(function(t){return s("div",{staticClass:"card xs applyable",class:{apply:t.apply},on:{click:function(s){t.apply=!t.apply,e.console.log("OK")}}},[s("strong",[e._v(e._s(t.acronym))]),s("em",[e._v(e._s(t.label))])])}))],2):e._e(),e.validations.sci?s("div",[e._m(6),e._l(e.validations.sci,(function(t){return s("div",{staticClass:"card xs applyable",class:{apply:t.apply},on:{click:function(e){t.apply=!t.apply}}},[s("strong",[e._v(e._s(t.acronym))]),s("em",[e._v(e._s(t.label))])])}))],2):e._e(),e.validations.adm?s("div",[e._m(7),e._l(e.validations.adm,(function(t){return s("div",{staticClass:"card xs applyable",class:{apply:t.apply},on:{click:function(e){t.apply=!t.apply}}},[s("strong",[e._v(e._s(t.acronym))]),s("em",[e._v(e._s(t.label))])])}))],2):e._e()]),s("section",[e._m(8),s("div",[e._m(9),s("p",[s("i",{staticClass:"icon-info-circled"}),e._v(" Personnes qui seront chargées de valider les déclaration "),s("strong",[e._v("Hors-lot")]),e._v(" de "+e._s(e.person.displayname)+". ")]),e._l(e.subordinates,(function(t){return s("div",{staticClass:"card xs person-card",class:{apply:t.apply}},[s("div",{staticClass:"card-title"},[s("img",{staticClass:"gravatar",attrs:{src:"//www.gravatar.com/avatar/"+t.mailmd5+"&s=20",alt:"",width:"20"}}),s("strong",[s("i",{staticClass:"icon-user"}),e._v(" "+e._s(t.label)+" ")])]),s("small",[s("i",{staticClass:"icon-mail"}),e._v(" "+e._s(t.mail)+" ")])])}))],2),s("div",[e._m(10),s("p",[s("i",{staticClass:"icon-info-circled"}),e._v(" Personnes pour qui "),s("strong",[e._v(e._s(e.person.displayname))]),e._v(" devra valider les déclarations "),s("strong",[e._v("Hors-lot")])]),e._l(e.referents,(function(t){return s("div",{staticClass:"card xs person-card",class:{apply:t.apply}},[s("div",{staticClass:"card-title"},[s("img",{staticClass:"gravatar",attrs:{src:"//www.gravatar.com/avatar/"+t.mailmd5+"&s=20",alt:"",width:"20"}}),s("strong",[s("i",{staticClass:"icon-user"}),e._v(" "+e._s(t.label)+" ")])]),s("small",[s("i",{staticClass:"icon-mail"}),e._v(" "+e._s(t.mail)+" ")])])}))],2)]),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-success",on:{click:e.handlerConfirmReplace}},[e._v(" Terminé ")])])]):e._e()])])])]):e._e(),s("div",{staticClass:"replace-strengthen-person actions text-center"},[s("button",{staticClass:"btn btn-lg btn-info",on:{click:e.handlerReplace}},[s("i",{staticClass:"icon-rewind-outline"}),e._v(" Remplacer ")])])])},o=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h2",[s("i",{staticClass:"icon-beaker"}),e._v(" Activité/projet de recherche ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-cubes"}),e._v(" Projets")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-cube"}),e._v(" Activités")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h2",[s("i",{staticClass:"icon-building-filled"}),e._v(" Structure ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h2",[s("i",{staticClass:"icon-calendar"}),e._v(" Validation ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-cube"}),e._v("Validation projet")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-beaker"}),e._v("Validation scientifique")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-book"}),e._v("Validation administratif")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h2",[s("i",{staticClass:"icon-calendar"}),e._v(" Hiérarchie ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-book"}),e._v("Reférent(s)")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h4",[s("i",{staticClass:"icon-beaker"}),e._v("Subordonné(s)")])}],c=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.expression,expression:"expression"}],attrs:{type:"text"},domProps:{value:e.expression},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.search.apply(null,arguments))},input:function(t){t.target.composing||(e.expression=t.target.value)}}}),s("span",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}]},[s("i",{staticClass:"icon-spinner animate-spin"})]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.persons.length>0&&e.showSelector,expression:"persons.length > 0 && showSelector"}],staticClass:"choose",staticStyle:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},e._l(e.persons,(function(t){return s("div",{key:t.id,staticClass:"choice",on:{click:function(s){return s.preventDefault(),s.stopPropagation(),e.handlerSelectPerson(t)}}},[s("div",{staticStyle:{display:"block",width:"50px",height:"50px"}},[s("img",{staticStyle:{width:"100%"},attrs:{src:"https://www.gravatar.com/avatar/"+t.mailMd5+"?s=50",alt:t.displayname}})]),s("div",{staticClass:"infos"},[s("strong",{staticStyle:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},[e._v(e._s(t.displayname))]),s("br"),s("span",{staticStyle:{"font-weight":"100","font-size":".8em","padding-left":"0"}},[s("i",{staticClass:"icon-location"}),e._v(" "+e._s(t.affectation)+" "),t.ucbnSiteLocalisation?s("span",[e._v(" ~ "+e._s(t.ucbnSiteLocalisation))]):e._e()]),s("br"),s("em",{staticStyle:{"font-weight":"100","font-size":".8em"}},[s("i",{staticClass:"icon-mail"}),e._v(e._s(t.email))])])])})),0),e.error?s("div",{staticClass:"alert alert-danger"},[s("i",{staticClass:"icon-attention-1"}),e._v(" "+e._s(e.error)+" ")]):e._e()])},l=[];let p;var u={data(){return{url:"/person?l=m&q=",persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(e,t){e.length>=2&&(p&&clearTimeout(p),p=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,this.$http.get(this.url+this.expression,{before(e){this.request&&this.request.abort(),this.request=e}}).then(e=>{console.log(e),this.persons=e.body.datas,this.showSelector=!0},e=>{console.log(e),403==e.status?this.error="403 Unauthorized":e.body&&(this.error=e.body)}).then(e=>{this.loading=!1,this.request=null})},handlerSelectPerson(e){this.selectedPerson=e,this.showSelector=!1,this.expression="",this.$emit("change",e)}}},d=u;function f(e,t,s,n,r,i,a,o){var c,l="function"===typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=s,l._compiled=!0),n&&(l.functional=!0),i&&(l._scopeId="data-v-"+i),a?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},l._ssrRegister=c):r&&(c=o?function(){r.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:r),c)if(l.functional){l._injectStyles=c;var p=l.render;l.render=function(e,t){return c.call(t),p(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return{exports:e,options:l}}var v=f(d,c,l,!1,null,null,null),h=v.exports,_={name:"ReplaceStrengthenPerson",components:{PersonAutoCompleter:h},props:{person:{required:!0},urlReplace:{required:!0},urlAffectation:{required:!0},urlStrengthen:{required:!0}},data(){return{mode:"",recap:null,recapPending:"",errorRecap:"",error:"",step:1,pendingMessage:"",errorMessage:"",replacer:"",replacer_id:null,step1info:"",projects:{},activities:{},structures:{},validations:{},referents:{},subordinates:{}}},methods:{handlerReplace(){this.mode="Remplacer",this.loadingMessage="Chargement de l'aperçu"},handlerSwitchApply(e){console.log("handlerSwitchApply",e),e.apply=!e.apply},handlerSelectPerson(e){this.replacer=e.displayname,this.replacer_id=e.id,this.step1info="Remplacer "+this.person.displayname+" par "+this.replacer},handlerConfirmStep1(){this.pendingMessage="Chargement des affectations...",this.$http.get(this.urlAffectation+"?person="+this.replacer_id).then(e=>{this.step=2,this.projects=e.body.affectations.projects,this.activities=e.body.affectations.activities,this.structures=e.body.affectations.structures,this.validations=e.body.affectations.validations,this.referents=e.body.affectations.referents,this.subordinates=e.body.affectations.subordinates},e=>{this.errorMessage=e.body}).then(()=>{this.pendingMessage=""})},handlerConfirmReplace(){let e=new FormData,t={projects:this.projects,activities:this.activities,structures:this.structures,validations:this.validations,subordinates:this.subordinates,referents:this.referents,replacer_id:this.replacer_id};this.pendingMessage="Remplacement...",this.step=3,e.append("out",JSON.stringify(t)),this.$http.post(this.urlAffectation,e).then(e=>{document.location.reload()},e=>{403==e.status?this.errorMessage="Non-autorisé":e.body.error?this.errorMessage="Erreur : "+e.body.error:this.errorMessage=e.body}).then(e=>{this.pendingMessage=""})},handlerCancel(){this.step=1,this.errorMessage="",this.mode="",this.replacer_id=null,this.replacer="",this.step1info=""}},mounted(){}},m=_,g=f(m,a,o,!1,null,null,null),y=g.exports;t["default"]=y}})["default"]}));
//# sourceMappingURL=ReplaceStrengthenPerson.umd.min.js.map