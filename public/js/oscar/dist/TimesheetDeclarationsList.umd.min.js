(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["TimesheetDeclarationsList"]=e():t["TimesheetDeclarationsList"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function a(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s="fb15")}({8875:function(t,e,a){var i,s,n;(function(a,r){s=[],i=r,n="function"===typeof i?i.apply(e,s):i,void 0===n||(t.exports=n)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(p){var a,i,s,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,r=/@([^@]*):(\d+):(\d+)\s*$/gi,l=n.exec(p.stack)||r.exec(p.stack),o=l&&l[1]||!1,d=l&&l[2]||!1,c=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");o===c&&(a=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(d-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),s=a.replace(i,"$1").trim());for(var v=0;v<u.length;v++){if("interactive"===u[v].readyState)return u[v];if(u[v].src===o)return u[v];if(o===c&&u[v].innerHTML&&u[v].innerHTML.trim()===s)return u[v]}return null}}return t}))},fb15:function(t,e,a){"use strict";if(a.r(e),"undefined"!==typeof window){var i=window.document.currentScript,s=a("8875");i=s(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:s});var n=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(a.p=n[1])}var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"validations-admin"},[a("transition",{attrs:{name:"fade"}},[t.loading?a("div",{staticClass:"pending overlay"},[a("div",{staticClass:"overlay-content"},[a("i",{staticClass:"icon-spinner animate-spin"}),t._v(" "+t._s(t.loading)+" ")])]):t._e()]),a("transition",{attrs:{name:"fade"}},[t.error?a("div",{staticClass:"pending overlay"},[a("div",{staticClass:"overlay-content"},[a("i",{staticClass:"icon-attention-1"}),t._v(" "+t._s(t.error)+" ")])]):t._e()]),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.create,expression:"create"}],staticClass:"overlay"},[a("div",{staticClass:"overlay-content",staticStyle:{"overflow-y":"visible"}},[a("span",{staticClass:"overlay-closer",on:{click:function(e){t.create=null}}},[t._v("X")]),t._v(" Choisissez une personne à ajouter : "),a("personautocompleter",{on:{change:t.handlerAddPerson}}),a("button",{staticClass:"btn btn-primary",class:{disabled:null==t.addedPerson},on:{click:function(e){return t.handlerConfirmAdd(t.create,t.addedPerson.id)}}},[null!=t.addedPerson?a("span",[t._v("Ajouter "),a("strong",[t._v(t._s(t.addedPerson.displayname))]),t._v(" comme validateur")]):a("span",[t._v("Selectionner une personne")])])],1)])]),a("transition",{attrs:{name:"fade"}},[t.addvalidatorperson?a("div",{staticClass:"overlay"},[a("div",{staticClass:"overlay-content",staticStyle:{"overflow-y":"visible"}},[a("span",{staticClass:"overlay-closer",on:{click:function(e){t.addvalidatorperson=null}}},[t._v("X")]),a("h3",[t._v("Assigner un validateur Hors-lot")]),a("p",{staticClass:"alert alert-info"},[t._v("Selectionnez un validateur pour les "),a("strong",[t._v("créneaux Hors-Lot")]),t._v(" de "),a("strong",[t._v(t._s(t.filterPerson))]),t._v(". Cet opération affectera également le validateur pour les déclarations en cours non-validée. ")]),a("personautocompleter",{on:{change:t.handlerSelectValidateur}}),a("form",{attrs:{action:"",method:"post"}},[a("input",{attrs:{type:"hidden",name:"action",value:"addvalidator"}}),a("input",{attrs:{type:"hidden",name:"person"},domProps:{value:t.selectedPerson.id}}),a("input",{attrs:{type:"hidden",name:"validatorId"},domProps:{value:t.validatorId}}),a("button",{staticClass:"btn btn-primary",class:{disabled:!t.validatorId},attrs:{type:"submit"}},[t._v("Ajouter "),a("strong",[t._v(t._s(t.validatorLabel))]),t._v(" comme validateur hors-lot")])]),a("button",{on:{click:function(e){t.addvalidatorperson=null}}},[t._v("Annuler")])],1)]):t._e()]),a("transition",{attrs:{name:"fade"}},[t.schedule?a("div",{staticClass:"overlay"},[a("div",{staticClass:"overlay-content",staticStyle:{"overflow-y":"visible"}},[a("personschedule",{attrs:{schedule:t.schedule.schedule,editable:!0},on:{cancel:function(e){t.schedule=null},changeschedule:t.handlerSaveSchedule}})],1)]):t._e()]),a("h1",[t._v("Liste des déclarations")]),a("div",{staticClass:"declarations-ui cols"},[a("div",{staticClass:"persons-list col-1 onglets"},[t._m(0),a("div",[t._m(1),a("div",{staticClass:"tab-content"},[a("div",{staticClass:"tab-pane active",attrs:{role:"tabpanel",id:"declarants"}},t._l(t.declarers,(function(e){return a("article",{staticClass:"list-item",class:{selected:e.displayname==t.filterPerson},on:{click:function(a){return a.preventDefault(),t.handlerFilterPerson(e)}}},[a("i",{staticClass:"icon-user"}),t._v(" "+t._s(e.displayname)+" "),0==e.referents.length?a("i",{staticClass:"icon-attention-1"}):t._e()])})),0),a("div",{staticClass:"tab-pane",attrs:{role:"tabpanel",id:"activities"}},t._l(t.activities,(function(e){return a("article",{staticClass:"list-item",class:{selected:e==t.filterActivity},on:{click:function(a){return a.preventDefault(),t.handlerFilterActivity(e)}}},[a("i",{staticClass:"icon-cube"}),t._v(" "+t._s(e)+" ")])})),0)])])]),a("div",{staticClass:"declarations-list col-4"},[t._m(2),t._l(t.filteredDeclarations,(function(e,i){return a("section",{staticClass:"card declaration reactive",on:{click:function(t){e.open=!e.open}}},[a("span",{staticClass:"opener"},[e.open?a("i",{staticClass:"icon-angle-down"}):a("i",{staticClass:"icon-angle-right"})]),a("strong",[t._v(t._s(e.person))]),t._v(" "),a("time",[t._v(t._s(t._f("period")(e.period)))]),a("span",{staticClass:"validations-icon"},[e.warnings.length>0?a("i",{staticClass:"icon-attention-1 bg-danger rounded",staticStyle:{"border-radius":"8px"}}):t._e(),t._l(e.declarations,(function(t){return a("i",{staticClass:"icon",class:"icon-"+t.status,attrs:{title:t.label}})}))],2),a("nav",[a("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"/feuille-de-temps/excel?action=export2&period="+e.period+"&personid="+e.person_id}},[a("i",{staticClass:"icon-file-pdf"}),t._v("Voir")]),a("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerChangeSchedule(e)}}},[a("i",{staticClass:"icon-clock"}),t._v("Horaires")]),a("a",{staticClass:"btn btn-danger btn-xs",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerCancelDeclaration(e)}}},[a("i",{staticClass:"icon-trash"}),t._v("Annuler")])]),a("transition",{attrs:{name:"slide"}},[e.open?a("section",{staticClass:"validations text-small"},[e.warnings.length>0?a("ul",{staticClass:"alert-danger alert"},t._l(e.warnings,(function(e){return a("li",[t._v(t._s(e))])})),0):t._e(),t._l(e.declarations,(function(e){return a("article",{staticClass:"validation",class:{selected:t.selectedValidation==e},on:{click:function(a){a.preventDefault(),a.stopPropagation(),t.selectedValidation=e}}},[a("span",[a("i",{class:"activity"==e.object?"icon-cube":"icon-"+e.object}),a("strong",[t._v(t._s(e.label))])]),"activity"==e.object?a("span",[e.validation.validationactivity_by?a("span",{staticClass:"cartouche green",attrs:{title:"Validation projet"}},[a("i",{staticClass:"icon-cube"}),t._v(t._s(e.validation.validationactivity_by)+" ")]):a("span",{directives:[{name:"else",rawName:"v-else"}],staticClass:"validators"},[a("i",{staticClass:"icon-cube"}),t._l(e.validateursPrj,(function(e){return a("span",[t._v(t._s(e.person))])}))],2)]):a("span",[t._v("~")]),"activity"==e.object?a("span",[e.validation.validationsci_by?a("span",{staticClass:"cartouche green",attrs:{title:"Validation scientifique"}},[a("i",{staticClass:"icon-beaker"}),t._v(t._s(e.validation.validationsci_by)+" ")]):a("span",{staticClass:"validators"},[a("i",{staticClass:"icon-beaker"}),t._l(e.validateursSci,(function(e){return a("span",[t._v(t._s(e.person))])}))],2)]):a("span",[t._v("~")]),a("span",[e.validation.validationadm_by?a("span",{staticClass:"cartouche green",attrs:{title:"Validation administrative"}},[a("i",{staticClass:"icon-book"}),t._v(t._s(e.validation.validationadm_by)+" ")]):a("span",{staticClass:"validators"},[a("i",{staticClass:"icon-book"}),t._l(e.validateursAdm,(function(e){return a("span",[t._v(t._s(e.person))])}))],2)]),a("em",[a("i",{class:"icon-"+e.status})])])}))],2):t._e()])],1)}))],2),a("div",{staticClass:"declaration-details col-2"},[t.filterPerson?a("div",[a("h3",[a("i",{staticClass:"icon-cog"}),t._v(" "+t._s(t.filterPerson))]),0==t.selectedPerson.referents.length?a("div",{staticClass:"alert alert-danger"},[t._v(" Aucun référent pour "),a("strong",[t._v("valider les déclarations Hors-lot")])]):a("div",[a("h4",[t._v("Validateur :")]),a("ul",t._l(t.selectedPerson.referents,(function(e){return a("li",{staticClass:"cartouche cartouche-default"},[t._v(t._s(e.displayname))])})),0)]),a("button",{staticClass:"btn-primary btn",on:{click:function(e){t.addvalidatorperson=!0}}},[t._v(" Ajouter un validateur pour les créneaux "),a("strong",[t._v("Hors-Lot")])]),a("a",{staticClass:"btn-primary btn",attrs:{href:"/person/show/"+t.selectedPerson.id}},[t._v(" Voir la fiche de "),a("strong",[t._v(t._s(t.filterPerson))])])]):t._e(),t._m(3),t.selectedValidation?t._e():a("p",{staticClass:"alert alert-info"},[t._v(" Selectionnez une ligne d'une déclaration pour afficher les détails et "),a("strong",[t._v("gérer les validateurs")])]),a("transition",{attrs:{name:"fade"}},[t.selectedValidation?a("div",{staticClass:"validation-details"},[a("h3",[a("small",[t._v("Validation pour les créneaux")]),a("br"),"activity"==t.selectedValidation.object?a("strong",[a("i",{staticClass:"icon-cube"}),t._v(" "+t._s(t.selectedValidation.label)+" ")]):a("strong",[a("i",{class:"icon-"+t.selectedValidation.object}),t._v(" "+t._s(t.selectedValidation.label)+" ")]),a("br"),a("small",[t._v(" de "),a("strong",[t._v(t._s(t.selectedValidation.person))]),t._v(" en "),a("strong",[t._v(t._s(t._f("period")(t.selectedValidation.period)))])])]),"activity"==t.selectedValidation.object?a("div",[t.selectedValidation.validation.validationactivity_by?a("div",{staticClass:"card valid"},[a("i",{staticClass:"icon-ok-circled"}),t._v(" Validation projet par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(t._s(t.selectedValidation.validation.validationactivity_by))]),t._v(" le "),a("time",[t._v(t._s(t._f("humandate")(t.selectedValidation.validation.validationactivity_at)))])]):t.selectedValidation.validation.rejectactivity_by?a("div",{staticClass:"card reject"},[a("i",{staticClass:"icon-attention-circled"}),t._v(" Rejet des créneaux par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(t._s(t.selectedValidation.validation.rejectactivity_by))]),t._v(" le "),a("time",[t._v(t._s(t._f("humandate")(t.selectedValidation.validation.rejectactivity_at)))]),t._v(" : "),a("pre",[t._v(t._s(t.selectedValidation.validation.rejectactivity_message))])]):a("div",{staticClass:"card waiting"},[a("strong",[t._v("Validation projet en attente")]),t._v(" par l'un des validateurs suivant : "),a("ul",t._l(t.selectedValidation.validatorsPrj,(function(e){return a("li",[a("i",{staticClass:"icon-user"}),t._v(t._s(e.person)+" "),a("a",{staticClass:"link",on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerDelete("prj",e)}}},[a("i",{staticClass:"icon-trash"}),t._v(" Supprimer")])])})),0),a("a",{staticClass:"btn btn-xs btn-primary",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.handlerAdd("prj")}}},[t._v("Ajouter un validateur")])]),t.selectedValidation.validation.validationsci_by?a("div",{staticClass:"card valid"},[t._v(" Validation scientifique par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(t._s(t.selectedValidation.validation.validationsci_by))]),t._v(" le "),a("time",[t._v(t._s(t._f("humandate")(t.selectedValidation.validation.validationsci_at)))])]):t.selectedValidation.validation.rejectsci_by?a("div",{staticClass:"card reject"},[a("i",{staticClass:"icon-attention-circled"}),t._v(" Rejet scientifique des créneaux par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(t._s(t.selectedValidation.validation.rejectsci_by))]),t._v(" le "),a("time",[t._v(t._s(t._f("humandate")(t.selectedValidation.validation.rejectsci_at)))]),a("pre",[t._v(t._s(t.selectedValidation.validation.rejectsci_message))])]):a("div",{staticClass:"card waiting"},[a("strong",[t._v("Validation scientifique en attente")]),t._v(" par l'un des validateurs suivant : "),a("ul",t._l(t.selectedValidation.validatorsSci,(function(e){return a("li",[a("i",{staticClass:"icon-user"}),t._v(t._s(e.person)+" "),a("a",{staticClass:"link",on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerDelete("sci",e)}}},[a("i",{staticClass:"icon-trash"}),t._v(" Supprimer")])])})),0),a("a",{staticClass:"btn btn-xs btn-primary",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.handlerAdd("sci")}}},[t._v("Ajouter un validateur")])])]):t._e(),t.selectedValidation.validation.validationadm_by?a("div",{staticClass:"card valid"},[t._v(" Validation administrative par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(t._s(t.selectedValidation.validation.validationadm_by))]),t._v(" le "),a("time",[t._v(t._s(t._f("humandate")(t.selectedValidation.validation.validationadm_at)))])]):t.selectedValidation.validation.rejectadm_by?a("div",{staticClass:"card reject"},[a("i",{staticClass:"icon-attention-circled"}),t._v(" Rejet administrative des créneaux par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(t._s(t.selectedValidation.validation.rejectadm_by))]),t._v(" le "),a("time",[t._v(t._s(t._f("humandate")(t.selectedValidation.validation.rejectadm_at)))]),a("pre",[t._v(t._s(t.selectedValidation.validation.validationadm_message))])]):a("div",{staticClass:"card waiting"},[a("strong",[t._v("Validation administrative en attente")]),t._v(" par l'un des validateurs suivant : "),a("ul",t._l(t.selectedValidation.validatorsAdm,(function(e){return a("li",[a("i",{staticClass:"icon-user"}),t._v(t._s(e.person)+" "),a("a",{staticClass:"link",on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerDelete("adm",e)}}},[a("i",{staticClass:"icon-trash"}),t._v(" Supprimer")])])})),0),a("a",{staticClass:"btn btn-xs btn-primary",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.handlerAdd("adm")}}},[t._v("Ajouter un validateur")])])]):t._e()])],1)])],1)},l=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:"icon-sort"}),t._v(" Filtres")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"nav nav-tabs",attrs:{role:"tablist"}},[a("li",{staticClass:"active",attrs:{role:"presentation"}},[a("a",{attrs:{href:"#declarants","aria-controls":"home",role:"tab","data-toggle":"tab"}},[a("i",{staticClass:"icon-group"}),t._v(" Déclarants")])]),a("li",{attrs:{role:"presentation"}},[a("a",{attrs:{href:"#activities","aria-controls":"profile",role:"tab","data-toggle":"tab"}},[a("i",{staticClass:"icon-cubes"}),t._v(" Activités")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h2",[a("i",{staticClass:"icon-calendar"}),t._v(" Déclaration")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:"icon-zoom-in-outline"}),t._v(" Détails")])}],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.expression,expression:"expression"}],attrs:{type:"text"},domProps:{value:t.expression},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.search.apply(null,arguments))},input:function(e){e.target.composing||(t.expression=e.target.value)}}}),a("span",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]},[a("i",{staticClass:"icon-spinner animate-spin"})]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.persons.length>0&&t.showSelector,expression:"persons.length > 0 && showSelector"}],staticClass:"choose",staticStyle:{position:"absolute","z-index":"3000","max-height":"400px",overflow:"hidden","overflow-y":"scroll"}},t._l(t.persons,(function(e){return a("div",{key:e.id,staticClass:"choice",on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerSelectPerson(e)}}},[a("div",{staticStyle:{display:"block",width:"50px",height:"50px"}},[a("img",{staticStyle:{width:"100%"},attrs:{src:"https://www.gravatar.com/avatar/"+e.mailMd5+"?s=50",alt:e.displayname}})]),a("div",{staticClass:"infos"},[a("strong",{staticStyle:{"font-weight":"700","font-size":"1.1em","padding-left":"0"}},[t._v(t._s(e.displayname))]),a("br"),a("span",{staticStyle:{"font-weight":"100","font-size":".8em","padding-left":"0"}},[a("i",{staticClass:"icon-location"}),t._v(" "+t._s(e.affectation)+" "),e.ucbnSiteLocalisation?a("span",[t._v(" ~ "+t._s(e.ucbnSiteLocalisation))]):t._e()]),a("br"),a("em",{staticStyle:{"font-weight":"100","font-size":".8em"}},[a("i",{staticClass:"icon-mail"}),t._v(t._s(e.email))])])])})),0),t.error?a("div",{staticClass:"alert alert-danger"},[a("i",{staticClass:"icon-attention-1"}),t._v(" "+t._s(t.error)+" ")]):t._e()])},d=[];let c;var u={data(){return{url:"/person?l=m&q=",persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0,request:null,error:""}},watch:{expression(t,e){t.length>=2&&(c&&clearTimeout(c),c=setTimeout(()=>{this.search()},500))}},methods:{search(){this.loading=!0,this.$http.get(this.url+this.expression,{before(t){this.request&&this.request.abort(),this.request=t}}).then(t=>{console.log(t),this.persons=t.body.datas,this.showSelector=!0},t=>{console.log(t),403==t.status?this.error="403 Unauthorized":t.body&&(this.error=t.body)}).then(t=>{this.loading=!1,this.request=null})},handlerSelectPerson(t){this.selectedPerson=t,this.showSelector=!1,this.expression="",this.$emit("change",t)}}},v=u;function p(t,e,a,i,s,n,r,l){var o,d="function"===typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=a,d._compiled=!0),i&&(d.functional=!0),n&&(d._scopeId="data-v-"+n),r?(o=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},d._ssrRegister=o):s&&(o=l?function(){s.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(d.functional){d._injectStyles=o;var c=d.render;d.render=function(t,e){return o.call(e),c(t,e)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,o):[o]}return{exports:t,options:d}}var h=p(v,o,d,!1,null,null,null),_=h.exports,f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"schedule"},[a("transition",{attrs:{name:"fade"}},[t.loading?a("div",{staticClass:"pending overlay"},[a("div",{staticClass:"overlay-content"},[a("i",{staticClass:"icon-spinner animate-spin"}),t._v(" "+t._s(t.loading)+" ")])]):t._e()]),a("transition",{attrs:{name:"fade"}},[t.error?a("div",{staticClass:"pending overlay"},[a("div",{staticClass:"overlay-content"},[a("i",{staticClass:"icon-attention-1"}),t._v(" "+t._s(t.error)+" ")])]):t._e()]),a("p",[t._v("La répartition horaire est issue de "+t._s(t.from)+" "),"application"==t.from?a("strong",[t._v("la configuration Oscar par défaut")]):t._e(),"sync"==t.from?a("strong",[t._v("la synchronisation (Connector)")]):t._e(),"custom"==t.from?a("strong",[t._v("la configuration prédéfinie")]):t._e(),"free"==t.from?a("strong",[t._v("la configuration manuelle")]):t._e()]),t._l(t.days,(function(e,i){return a("article",{staticClass:"card xs"},[a("h3",{staticClass:"card-title"},[a("strong",[t._v(t._s(t.daysLabels[i]))]),t.editDay?a("input",{directives:[{name:"model",rawName:"v-model",value:t.days[i],expression:"days[day]"}],attrs:{type:"text"},domProps:{value:t.days[i]},on:{input:function(e){e.target.composing||t.$set(t.days,i,e.target.value)}}}):a("em",{staticClass:"big right",on:{click:function(e){return t.handlerEditDays()}}},[t._v(t._s(t._f("heures")(e)))])])])})),a("article",{staticClass:"card"},[a("h3",{staticClass:"card-title"},[a("strong",[t._v("Total / semaine")]),a("em",{staticClass:"big right"},[t._v(t._s(t._f("heures")(t.totalWeek)))])])]),t.editable?a("nav",[t.editDay?t._e():a("button",{staticClass:"btn btn-default",on:{click:function(e){return e.preventDefault(),t.handlerEditDays()}}},[a("i",{staticClass:"icon-pencil"}),t._v(" modifier")]),t.editDay?a("button",{staticClass:"btn btn-primary",on:{click:function(e){return e.preventDefault(),t.handlerSaveDays()}}},[a("i",{staticClass:"icon-floppy"}),t._v(" enregistrer")]):t._e(),t.models&&t.editDay?a("select",{directives:[{name:"model",rawName:"v-model",value:t.model,expression:"model"}],staticClass:"form-inline",on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.model=e.target.multiple?a:a[0]},function(e){return t.handlerSaveDays(t.model)}]}},[a("option",{attrs:{value:"default"}},[t._v("Aucun")]),t._l(t.models,(function(e,i){return a("option",{domProps:{value:i,selected:t.model==i}},[t._v(t._s(e.label))])}))],2):t._e(),t.editDay&&"default"!=t.from?a("button",{staticClass:"btn btn-primary",on:{click:function(e){return e.preventDefault(),t.handlerSaveDays("default")}}},[a("i",{staticClass:"icon-floppy"}),t._v(" Horaires par défaut")]):t._e(),t.editDay?a("button",{staticClass:"btn btn-primary",on:{click:function(e){return e.preventDefault(),t.handlerCancel()}}},[a("i",{staticClass:"icon-cancel-circled"}),t._v(" annuler")]):t._e()]):t._e()],2)},m=[],y={resolve(t,e){let a="Erreur inconnue";return e&&(a=e.body,403==e.status&&(a="Vous avez été déconnectez de l'application")),t+" (Réponse : "+a+")"}},g={name:"PersonSchedule",props:{urlapi:{default:""},editable:{default:!1},schedule:null},data(){return{daysLabels:{1:"Lundi",2:"Mardi",3:"Mercredi",4:"Jeudi",5:"Vendredi",6:"Samedi",7:"Dimanche"},loading:null,error:null,dayLength:0,from:null,days:{},editDay:null,newValue:0,models:[],model:null}},computed:{totalWeek(){let t=0;return Object.keys(this.days).forEach(e=>{t+=parseFloat(this.days[e])}),t}},methods:{day(t){return this.days.hasOwnProperty(t)?this.days[t]:this.dayLength},handlerEditDays(){this.editDay=!0},handlerCancel(){this.urlapi?this.fetch():this.$emit("cancel")},handlerSaveDays(t="input"){if(this.urlapi){this.loading="Enregistrement des horaires";let e=new FormData;"input"==t?e.append("days",JSON.stringify(this.days)):e.append("model",t),this.$http.post(this.urlapi,e).then(t=>{this.fetch()},t=>{this.error=y.resolve("Impossible de modifier les horaires",t)}).then(t=>{this.loading=!1})}else this.$emit("changeschedule",this.days)},fetch(t=!0){null==this.schedule?(this.loading="Chargement des données",this.$http.get(this.urlapi).then(t=>{console.log(t.body),this.days=t.body.days,this.dayLength=t.body.dayLength,this.from=t.body.from,this.models=t.body.models,this.model=t.body.model},t=>{this.error=y.resolve("Impossible de charger les données",t)}).then(t=>{this.loading=!1,this.editDay=null})):(console.log(this.schedule),this.days=this.schedule.days,this.dayLength=this.schedule.dayLength,this.editDay=!0)}},mounted(){this.fetch(!0)}},b=g,C=p(b,f,m,!1,null,null,null),S=C.exports,V={name:"TimesheetDeclarationsList",props:{moment:{required:!0},bootbox:{required:!0},urlapi:{default:null},editable:{default:!1}},components:{personautocompleter:_,personschedule:S},data(){return{loading:null,schedule:null,declarations:{},declarers:{},error:null,selectedValidation:null,create:!1,addedPerson:null,filterPerson:"",filterActivity:"",selectedPerson:null,validatorId:null,validatorLabel:null,addvalidatorperson:null}},computed:{declarants(){let t={};return this.declarations&&Object.keys(this.declarations).forEach(e=>{let a=this.declarations[e].person,i=this.declarations[e].person_id;t.hasOwnProperty(a)||(t[a]={person:a,person_id:i})}),t},activities(){let t=[];return this.declarations&&Object.keys(this.declarations).forEach(e=>{for(let a=0;a<this.declarations[e].declarations.length;a++)t.indexOf(this.declarations[e].declarations[a].label)<0&&t.push(this.declarations[e].declarations[a].label)}),t},filteredDeclarations(){let t=[],e=Object.keys(this.declarations);for(let a=0;a<e.length;a++){let i=e[a],s=this.declarations[i];if(""==this.filterPerson||s.person==this.filterPerson){if(""!=this.filterActivity){let t=!1;if(s.declarations.forEach(e=>{e.label==this.filterActivity&&(t=!0)}),0==t)continue}t.push(s)}}return t}},methods:{handlerSaveSchedule(t){let e=new FormData;e.append("person_id",this.schedule.person_id),e.append("period",this.schedule.period),e.append("action","changeschedule"),e.append("days",JSON.stringify(t)),this.$http.post("",e).then(t=>{this.fetch()},t=>{}).then(t=>{this.addedPerson=null,this.schedule=null,this.create=null,this.loading=!1})},handlerChangeSchedule(t){console.log(t.settings),this.schedule={schedule:JSON.parse(t.settings),person_id:t.person_id,period:t.period}},handlerSelectValidateur(t){this.validatorLabel=t.displayname,this.validatorId=t.id},handlerAdd(t){this.create=t},handlerAddPerson(t){this.addedPerson=t},handlerDelete(t,e){this.loading="Suppression du validateur";let a=new FormData;a.append("person_id",e.id),a.append("declaration_id",this.selectedValidation.id),a.append("action","delete"),a.append("type",t),this.$http.post("",a).then(a=>{switch(t){case"prj":this.selectedValidation.validatorsPrj.splice(this.selectedValidation.validatorsPrj.indexOf(e,1));break;case"sci":this.selectedValidation.validatorsSci.splice(this.selectedValidation.validatorsSci.indexOf(e,1));break;case"adm":this.selectedValidation.validatorsAdm.splice(this.selectedValidation.validatorsAdm.indexOf(e,1));break}},t=>{this.error=y.resolve("Impossible de supprimer ce validateur",t)}).then(t=>{this.addedPerson=null,this.create=null,this.loading=!1})},handlerConfirmAdd(t,e){this.loading="Ajout du validateur";let a=new FormData;a.append("person_id",e),a.append("declaration_id",this.selectedValidation.id),a.append("type",t),this.$http.post("",a).then(e=>{switch(t){case"prj":this.selectedValidation.validatorsPrj.push(e.body);break;case"sci":this.selectedValidation.validatorsSci.push(e.body);break;case"adm":this.selectedValidation.validatorsAdm.push(e.body);break}},t=>{this.error=y.resolve("Impossible d'ajouter le validateur",t)}).then(t=>{this.addedPerson=null,this.create=null,this.loading=!1})},fetch(t=!0){this.loading="Chargement des données",this.$http.get("").then(t=>{for(let e in t.body.periods)t.body.periods[e].open=!1;this.declarations=t.body.periods,this.declarers=t.body.declarants},t=>{this.error=y.resolve("Impossible de charger les données",t)}).then(t=>{this.loading=!1})},handlerCancelDeclaration(t){console.log(t),this.bootbox.confirm("Supprimer la déclaration (le déclarant devra réenvoyer la déclaration) ?",e=>{e&&(this.loading="Suppression de la déclaration",this.$http.delete("?person_id="+t.person_id+"&period="+t.period).then(t=>{this.fetch()},t=>{this.error=y.resolve("Impossible de charger les données",t)}).then(t=>{this.loading=!1}))})},handlerFilterPerson(t){this.selectedValidation=null,this.filterPerson=this.filterPerson==t.displayname?"":t.displayname,this.selectedPerson=t},handlerFilterActivity(t){this.selectedValidation=null,this.filterActivity=this.filterActivity==t?"":t}},mounted(){this.fetch(!0)}},x=V,j=p(x,r,l,!1,null,null,null),P=j.exports;e["default"]=P}})["default"]}));
//# sourceMappingURL=TimesheetDeclarationsList.umd.min.js.map