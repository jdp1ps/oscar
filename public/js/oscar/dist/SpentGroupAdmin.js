(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SpentGroupAdmin=e():t.SpentGroupAdmin=e()})("undefined"!=typeof self?self:this,function(){return function(t){function e(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,a){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=1)}([function(t,e,n){"use strict";e.a={props:{},data:function(){return{mode:"default",selection:!1,destination:null,formData:null,error:null,deleteData:null,spenttypegroups:[],confirm:"",confirmHandler:null,waitdrop:!1,masses:{}}},computed:{tree:function(){var t={lft:0,rgt:2*this.spenttypegroups.length+1,children:[]},e=[t];try{for(this.spenttypegroups.forEach(function(t){for(var n=t.lft,a=t.rgt,r=e[e.length-1];a>r.rgt;)e[e.length-2].children.push(r),e.pop(),r=e[e.length-1];a>n+1?(t.children=[],e.push(t)):r.children.push(t)});e.length>1;)e[e.length-2].children.push(e.pop())}catch(t){this.error="Liste des types de dépenses corrompu"}return e[0].children}},methods:{handlerAnnexe:function(t){var e=this,n=new FormData;n.append("id",t.spenttype.id),n.append("annexe",t.annexe),n.append("action","annexe"),this.$http.post("?",n).then(function(t){e.fetch(),e.formData=null,e.confirm=""}).catch(function(t){e.error=t.body,e.confirm=""})},handlerConfirm:function(){var t=this,e=new FormData;e.append("admin","reset"),this.$http.post("?",e).then(function(e){t.fetch(),t.formData=null,t.confirm=""}).catch(function(e){t.error=e.body,t.confirm=""})},handlerConfirmSort:function(){var t=this,e=new FormData;e.append("admin","sort"),this.$http.post("?",e).then(function(e){t.fetch(),t.formData=null,t.confirm=""}).catch(function(e){t.error=e.body,t.confirm=""})},loadPCG:function(){this.confirm="Remettre le plan comptable par défaut (plan comptable général) ? ",this.confirmHandler=this.handlerConfirm},sortTree:function(){this.confirm="Réorganiser l'arbre par code",this.confirmHandler=this.handlerConfirmSort},handlerModeSelection:function(){this.mode="selection"},handlerSelection:function(t){this.selection=t,this.mode="destination"},handlerDestination:function(t){this.move(this.selection,t),this.selection=!1,this.mode="default"},handlerModeMove:function(){this.mode="move"},resetTree:function(){var t=this,e=new FormData;e.append("admin","reset"),this.$http.post("?",e).then(function(e){t.fetch(),t.formData=null})},move:function(t,e){var n=this,a=new FormData;a.append("moved",t.id),a.append("to",e.id),this.$http.post("?",a).then(function(t){n.fetch(),n.formData=null},function(t){n.error=t.body})},performDelete:function(){var t=this,e=this.deleteData;this.$http.delete("?id="+e.id).then(function(e){t.spenttypegroups=e.data.spenttypegroups},function(e){t.error=e.body}).then(function(e){return t.deleteData=null})},fetch:function(){var t=this;this.$http.get().then(function(e){console.log(e.data),t.spenttypegroups=e.data.spenttypegroups,t.masses=e.data.masses},function(e){t.error=e.body})},handlerSubmit:function(){var t=this,e=new FormData,n=void 0;e.append("label",this.formData.label),e.append("description",this.formData.description),e.append("code",this.formData.code),e.append("annexe",this.formData.annexe),e.append("inside",this.formData.inside),this.formData.id?(e.append("id",this.formData.id),n=this.$http.post("?",e),n.then(function(e){t.fetch(),t.formData=null})):(n=this.$http.put("?",e),n.then(function(e){t.fetch(),t.formData=null})),n.catch(function(e){t.error=e.body})},handlerBlind:function(t){var e=this,n=new FormData;n.append("action","blind"),n.append("id",t.id),this.$http.post("?",n).then(function(t){e.fetch(),e.formData=null})},handlerNew:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"root";this.formData={id:"",label:"",code:"",annexe:"",inside:e,description:""}},handlerDragItem:function(t){this.moved=t},handlerDropItem:function(t){this.move(this.moved,t.id)},handlerDrop:function(t){this.move(this.moved,"root")},handlerDragEnter:function(t){this.inside=!0},handlerDragLeave:function(t){this.inside=!1},handlerEdit:function(t){this.formData={id:t.id,label:t.label,annexe:t.annexe,code:t.code,description:t.description}},handlerCancelForm:function(){this.formData=null},handlerDelete:function(t){this.deleteData=t}},mounted:function(){this.fetch()}}},function(t,e,n){t.exports=n(2)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),r=n(4),o=n(3),i=o(a.a,r.a,!1,null,null,null);e.default=i.exports},function(t,e){t.exports=function(t,e,n,a,r,o){var i,s=t=t||{},l=typeof t.default;"object"!==l&&"function"!==l||(i=t,s=t.default);var c="function"==typeof s?s.options:s;e&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0),n&&(c.functional=!0),r&&(c._scopeId=r);var d;if(o?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=d):a&&(d=a),d){var u=c.functional,f=u?c.render:c.beforeCreate;u?(c._injectStyles=d,c.render=function(t,e){return d.call(e),f(t,e)}):c.beforeCreate=f?[].concat(f,d):[d]}return{esModule:i,exports:s,options:c}}},function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticStyle:{position:"relative"}},[n("h1",[t._v("Type de dépense")]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.formData?n("div",{staticClass:"overlay"},[n("form",{attrs:{action:""},on:{submit:function(e){return e.preventDefault(),t.handlerSubmit(e)}}},[t.formData.original?n("h1",[t._v("Modifier "+t._s(t.formData.original))]):n("h1",[t._v("Nouveau type de dépense")]),t._v(" "),n("label",{attrs:{for:"form_label"}},[t._v("Intitulé")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.label,expression:"formData.label"}],staticClass:"form-control lg",attrs:{type:"text",id:"form_label"},domProps:{value:t.formData.label},on:{input:function(e){e.target.composing||t.$set(t.formData,"label",e.target.value)}}}),t._v(" "),n("label",{attrs:{for:"form_code"}},[t._v("Code")]),t._v(" "),n("small",[t._v("Ce code est celui utilisé par les services financiers pour qualifier ce type de dépense")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.code,expression:"formData.code"}],staticClass:"form-control",attrs:{type:"text",id:"form_code"},domProps:{value:t.formData.code},on:{input:function(e){e.target.composing||t.$set(t.formData,"code",e.target.value)}}}),t._v(" "),n("label",{attrs:{for:"annexe"}},[t._v("Annexe")]),t._v(" "),n("small",[t._v("Ce code est celui utilisé par les services financiers pour qualifier ce type de dépense")]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.formData.annexe,expression:"formData.annexe"}],staticClass:"form-control",attrs:{name:"annexe",id:"annexe"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.formData,"annexe",e.target.multiple?n:n[0])}}},[n("option",{attrs:{value:""}},[t._v("Ne pas utiliser")]),t._v(" "),t._l(t.masses,function(e,a){return n("option",{domProps:{value:a}},[t._v(t._s(e))])})],2),t._v(" "),n("label",{attrs:{for:"form_description"}},[t._v("Description")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.description,expression:"formData.description"}],staticClass:"form-control",attrs:{type:"text",id:"form_description"},domProps:{value:t.formData.description},on:{input:function(e){e.target.composing||t.$set(t.formData,"description",e.target.value)}}}),t._v(" "),n("hr"),t._v(" "),n("nav",[n("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[n("i",{staticClass:"icon-floppy"}),t._v("\n                        Enregistrer\n                    ")]),t._v(" "),n("button",{staticClass:"btn btn-default",attrs:{type:"reset"},on:{click:function(e){return e.preventDefault(),t.handlerCancelForm(e)}}},[n("i",{staticClass:"icon-cancel-outline"}),t._v("\n                        Annuler\n                    ")])])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.confirm?n("div",{staticClass:"overlay"},[n("div",{staticClass:"alert alert-danger"},[n("h3",[t._v("\n                    "+t._s(t.confirm)+"\n                    "),n("a",{staticClass:"float-right",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.error=null}}},[n("i",{staticClass:"icon-cancel-outline"})])]),t._v(" "),n("hr"),t._v(" "),n("nav",[n("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.confirmHandler()}}},[n("i",{staticClass:"icon-ok-circled"}),t._v("\n                        Valider\n                    ")]),t._v(" "),n("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(e){e.preventDefault(),t.confirm=null}}},[n("i",{staticClass:"icon-cancel-outline"}),t._v("\n                        Annuler\n                    ")])])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.error?n("div",{staticClass:"overlay"},[n("div",{staticClass:"alert alert-danger"},[n("h3",[t._v("Erreur\n                    "),n("a",{staticClass:"float-right",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.error=null}}},[n("i",{staticClass:"icon-cancel-outline"})])]),t._v(" "),n("p",[t._v(t._s(t.error))])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.deleteData?n("div",{staticClass:"overlay"},[n("div",{staticClass:"alert alert-danger"},[n("h3",[t._v("Supprimer le type "),n("strong",[t._v(t._s(t.deleteData.label))]),t._v(" ?")]),t._v(" "),n("nav",[n("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(e){e.preventDefault(),t.deleteData=null}}},[n("i",{staticClass:"icon-cancel-outline"}),t._v("\n                        Annuler\n                    ")]),t._v(" "),n("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.performDelete(e)}}},[n("i",{staticClass:"icon-ok-circled"}),t._v("\n                        Confirmer\n                    ")])])])]):t._e()]),t._v(" "),n("transition",{attrs:{name:"fade"}},["selection"==t.mode?n("div",{staticClass:"alert alert-info"},[n("p",[t._v("Choisissez un élément à déplacer...")])]):"destination"==t.mode?n("div",{staticClass:"alert alert-info"},[n("p",[t._v("... choisissez l'emplacement où le déplacer.")])]):t._e()]),t._v(" "),n("div",{staticClass:"card-content spentarea"},[t._l(t.tree,function(e){return n("spenttypeitem",{key:e.id,attrs:{spenttypegroup:e,annexes:t.masses,selection:t.selection,mode:t.mode},on:{annexe:t.handlerAnnexe,selection:function(e){return t.handlerSelection(e)},destination:function(e){return t.handlerDestination(e)},edit:function(e){return t.handlerEdit(e)},blind:function(e){return t.handlerBlind(e)},new:function(e){return t.handlerNew(t.e,e.id)},delete:function(e){return t.handlerDelete(e)}}})}),t._v(" "),n("hr"),t._v(" "),n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.loadPCG(e)}}},[n("i",{staticClass:"icon-database"}),t._v("\n            Charger le "),n("strong",[t._v("Plan Comptable Général")])]),t._v(" "),n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.sortTree(e)}}},[n("i",{staticClass:"icon-sitemap"}),t._v("\n            Réorganiser par code\n        ")])],2)],1)},r=[],o={render:a,staticRenderFns:r};e.a=o}])});
//# sourceMappingURL=SpentGroupAdmin.js.map