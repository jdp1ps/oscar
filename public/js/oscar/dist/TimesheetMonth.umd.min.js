(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["TimesheetMonth"]=e():t["TimesheetMonth"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fb15")}({2877:function(t,e,s){"use strict";function a(t,e,s,a,i,n,o,l){var r,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=s,c._compiled=!0),a&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),o?(r=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=r):i&&(r=l?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),r)if(c.functional){c._injectStyles=r;var d=c.render;c.render=function(t,e){return r.call(e),d(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,r):[r]}return{exports:t,options:c}}s.d(e,"a",(function(){return a}))},6600:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ui-timechooser"},[s("div",{staticClass:"percents"},[t.fill>0?s("span",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.applyDuration(t.fill)}}},[t._v("Remplir")]):t._e(),s("span",{class:"100"==t.displayPercent?"selected":"",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.applyPercent(100)}}},[t._v("100%")]),s("span",{class:"75"==t.displayPercent?"selected":"",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.applyPercent(75)}}},[t._v("75%")]),s("span",{class:"50"==t.displayPercent?"selected":"",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.applyPercent(50)}}},[t._v("50%")]),s("span",{class:"25"==t.displayPercent?"selected":"",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.applyPercent(25)}}},[t._v("25%")])]),t.declarationInHours?s("div",{staticClass:"hours"},[s("span",{staticClass:"hour sel"},[s("span",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.moreHours()}}},[s("i",{staticClass:"icon-angle-up"})]),t._v(" "+t._s(t.displayHours)+" "),s("span",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.lessHours()}}},[s("i",{staticClass:"icon-angle-down"})])]),s("span",{staticClass:"separator"},[t._v(":")]),s("span",{staticClass:"minutes sel"},[s("span",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.moreMinutes()}}},[s("i",{staticClass:"icon-angle-up"})]),t._v(" "+t._s(t.displayMinutes)+" "),s("span",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.lessMinutes()}}},[s("i",{staticClass:"icon-angle-down"})])])]):t._e()])},i=[],n={props:{duration:{default:0},baseTime:{default:7.5},declarationInHours:{required:!0},pas:{default:10},fill:{default:0}},data(){return{hours:0,minutes:0}},computed:{displayHours(){return Math.floor(this.duration)},displayMinutes(){return Math.round(60*(this.duration-this.displayHours))},displayPercent(){return Math.round(100/this.baseTime*this.duration)}},methods:{standardizeDuration(t){let e=Math.round(t/this.pas)*this.pas/60;return e},moreMinutes(){this.duration=this.standardizeDuration(60*this.duration+this.pas),this.emitUpdate()},lessMinutes(){this.duration=this.standardizeDuration(60*this.duration-this.pas),this.emitUpdate()},moreHours(){this.duration+=1,this.emitUpdate()},lessHours(){this.duration-=1,this.duration<0&&(this.duration=0),this.emitUpdate()},applyDuration(t){this.duration=t,this.emitUpdate()},roundMinutes(t){return Math.round(t/this.pas)*this.pas},applyPercent(t){this.duration=this.baseTime*t/100,this.emitUpdate()},emitUpdate(){let t=Math.floor(this.duration),e=this.duration-t;console.log(this.duration,t,e),this.$emit("timeupdate",{h:t,m:e})}}},o=n,l=s("2877"),r=Object(l["a"])(o,a,i,!1,null,null,null);e["default"]=r.exports},a76e:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.showSelector?s("div",{staticClass:"overlay"},[s("div",{staticClass:"overlay-content"},[s("p",[t._v("Choississez un type de créneau : ")]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-6"},[t._m(0),t._l(t.workpackages,(function(e){return s("article",{staticClass:"timesheet-item",class:{selected:t.selection&&t.selection.id==e.id,disabled:!e.validation_up},on:{click:function(s){return s.preventDefault(),t.handlerSelectWP(e)}}},[s("abbr",{staticClass:"project-acronym",attrs:{title:t.project}},[s("i",{staticClass:"icon-cube"}),t._v(" "+t._s(e.acronym))]),s("span",{staticClass:"activity-label",attrs:{title:e.activity}},[t._v(t._s(e.activity.substring(1,13)))]),s("strong",{staticClass:"workpackage-infos"},[s("span",{staticClass:"code",attrs:{title:e.label}},[t._v(t._s(e.code))]),s("small",{staticClass:"workpackage-label"},[t._v(t._s(e.label))])])])}))],2),s("div",{staticClass:"col-md-6"},[s("h3",[t._v("Hors activité (Hors-lot)")]),t._l(t.others,(function(e){return s("article",{staticClass:"timesheet-item horslots-item",class:{selected:t.selection==e,disabled:!e.validation_up},on:{click:function(s){return s.preventDefault(),t.handlerSelectOther(e)}}},[s("span",{staticClass:"project-acronym"},[s("i",{class:"icon-"+e.code}),t._v(" "+t._s(e.label))]),s("small",{staticClass:"workpackage-infos"},[t._v(t._s(e.description))])])}))],2)]),s("nav",[s("button",{staticClass:"btn btn-default",on:{click:function(e){t.showSelector=!1}}},[t._v("Annuler")]),t.usevalidation?s("button",{staticClass:"btn btn-primary",class:t.selection?"":"disabled",on:{click:function(e){return t.handlerValidSelection()}}},[t._v("Valider")]):t._e()])])]):t._e(),s("div",{staticClass:"dropdown"},[s("button",{staticClass:"btn-lg btn btn-default dropdown-toggle",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.showSelector=!0}}},[t.hasSelected?s("span",{staticClass:"info"},[s("i",{class:t.selectedIcon?"icon-"+t.selectedIcon:"icon-archive"}),s("strong",[t._v(t._s(t.selectedCode))]),t._v(" "),s("em",[t._v(t._s(t.selectedLabel))]),s("br"),s("small",{staticClass:"text-light"},[t._v(t._s(t.selectedDescription))])]):s("em",{staticClass:"info"},[t._v("Lot de travail/Activité...")]),s("span",{staticClass:"caret"})])])])},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h3",[s("i",{staticClass:"icon-cube"}),t._v(" Activités")])}],n={props:{workpackages:{default:[]},selection:{required:!0},others:{required:!0},usevalidation:{default:!1}},data(){return{showSelector:!1}},computed:{hasSelected(){return null!=this.selection},selectedCode(){return this.selection?this.selection.code:""},selectedLabel(){return this.selection?this.selection.label:""},selectedIcon(){return this.selection&&this.selection.icon?this.selection.code:""},selectedDescription(){return this.selection?this.selection.description:""}},methods:{handlerSelectWP(t){console.log(t),this.selection=t,this.usevalidation||this.handlerValidSelection()},handlerValidSelection(){this.selection&&(this.showSelector=!1,this.$emit("select",this.selection))},handlerSelectOther(t){this.selection=t,this.usevalidation||this.handlerValidSelection()}}},o=n,l=s("2877"),r=Object(l["a"])(o,a,i,!1,null,null,null);e["default"]=r.exports},c8e1:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"day",class:{locked:t.day.locked,error:t.day.total>t.day.maxLength},on:{click:t.handlerClick}},[s("span",{staticClass:"label"},[t._v(" "+t._s(t.day.i)+" ")]),t.day.total>t.day.maxLength?s("span",{staticClass:"text-danger"},[s("i",{staticClass:"icon-attention"}),t._v(" Erreur ")]):t._e(),t._l(t.groupProject,(function(e){return s("span",{staticClass:"cartouche wp xs",style:{"background-color":e.color},attrs:{title:e.label}},[null==e.status_id?s("i",{staticClass:"icon-draft"}):s("i",{class:"icon-"+e.status_id}),t._v(" "+t._s(e.acronym)+" "),s("span",{staticClass:"addon"},[t._v(" "+t._s(t._f("duration2")(e.duration,t.day.dayLength))+" ")])])})),s("span",t._l(t.day.othersWP,(function(e){return s("span",{staticClass:"cartouche xs",class:e.code},[null==e.validations?s("i",{staticClass:"icon-draft"}):s("i",{class:"icon-"+e.status_id}),t._v(" "+t._s(e.label)+" "),s("span",{staticClass:"addon"},[t._v(" "+t._s(t._f("duration2")(e.duration,t.day.dayLength))+" ")])])})),0),t.day.closed?s("span",{staticStyle:{"font-size":".7em"},attrs:{title:t.day.lockedReason}},[s("i",{staticClass:"icon-minus-circled"}),t._v(" Fermé ")]):t.day.locked?s("span",{staticStyle:{"font-size":".7em"},attrs:{title:t.day.lockedReason}},[s("i",{staticClass:"icon-lock"}),t._v(" Verrouillé ")]):t._e(),t._v("   ")],2)},i=[],n={name:"TimesheetMonthDay",props:{others:{required:!0},day:{required:!0},projectscolors:{required:!0,default:null}},data(){return{colors:["#093b8c","#098c29","#8c2109","#4c098c","#8c0971","#8c6f09"]}},filters:{duration(t){let e=Math.floor(t),s=Math.round(60*(t-e));return s<10&&(s="0"+s),e+":"+s}},computed:{groupProject(){let t={};return this.day.declarations&&this.day.declarations.forEach(e=>{t.hasOwnProperty(e.acronym)||(t[e.acronym]={label:e.label,acronym:e.acronym,duration:0,status_id:e.status_id,color:this.getProjectColor(e.acronym)}),t[e.acronym].duration+=e.duration}),t}},methods:{getProjectColor(t){return this.projectscolors&&this.projectscolors.hasOwnProperty(t)?this.projectscolors[t]:"#8c0971"},totalOther(t){let e=0;return this.day[t].forEach(t=>{e+=t.duration}),e},handlerClick(){this.$emit("selectDay",this.day)},handlerRightClick(t){this.$emit("daymenu",t,this.day)}}},o=n,l=s("2877"),r=Object(l["a"])(o,a,i,!1,null,null,null);e["default"]=r.exports},ea58:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"day-details",class:{locked:t.day.locked}},[s("h3",{staticClass:"title-with-menu",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),e.shiftKey?t.$emit("debug",t.day):null}}},[s("div",{staticClass:"text"},[s("i",{staticClass:"icon-calendar"}),t._v(" "),s("strong",[t._v(t._s(t.label))])]),s("nav",{staticClass:"right-menu"},[s("a",{directives:[{name:"show",rawName:"v-show",value:t.day.othersWP||t.day.declarations.length,expression:"day.othersWP || day.declarations.length"}],attrs:{href:"#",title:"Copier les créneaux"},on:{click:function(e){return e.preventDefault(),t.$emit("copy",t.day)}}},[s("i",{staticClass:"icon-docs"})]),s("a",{directives:[{name:"show",rawName:"v-show",value:t.copiable,expression:"copiable"}],attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("paste",t.day)}}},[s("i",{staticClass:"icon-paste"})])])]),s("a",{staticClass:"btn btn-xs btn-default",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("cancel")}}},[s("i",{staticClass:"icon-angle-left"}),t._v(" Retour ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.day.locked,expression:"day.locked"}],staticClass:"alert alert-danger"},[s("i",{staticClass:"icon-attention"}),t._v(" Cette journée est verrouillé "),s("strong",[t._v(t._s(t.day.lockedReason))])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.day.total>t.day.maxLength,expression:"day.total > day.maxLength"}],staticClass:"alert alert-danger"},[s("i",{staticClass:"icon-attention"}),t._v(" Le temps déclaré "),s("strong",[t._v("excède la durée autorisée")]),t._v(". Vous ne pourrez pas soumettre votre feuille de temps. ")]),t.editable?s("div",[t._v(" Compléter avec : "),s("wpselector",{attrs:{others:t.others,workpackages:t.workPackages,selection:t.selection},on:{select:t.addToWorkpackage}})],1):t._e(),s("section",[t.day.declarations.length?[t._m(0),t._l(t.day.declarations,(function(e){return s("day",{key:e.id,attrs:{d:e,"day-length":t.day.dayLength},on:{debug:function(e){return t.$emit("debug",e)},removetimesheet:function(e){return t.$emit("removetimesheet",e)},edittimesheet:function(e){return t.$emit("edittimesheet",e,t.day)}}})})),s("article",{staticClass:"wp-duration card xs"},[t._m(1),s("div",{staticClass:"total"},[s("span",{staticClass:"text-large text-xl"},[t._v(t._s(t._f("duration2")(t.totalWP,t.day.dayLength)))])]),s("div",{staticClass:"left"})]),s("hr")]:t._e(),t.day.othersWP?s("section",{staticClass:"othersWP"},[t._m(2),t._l(t.day.othersWP,(function(e){return s("article",{staticClass:"wp-duration card xs"},[s("strong",[s("i",{class:"icon-"+e.code}),t._v(" "+t._s(t.others[e.label]?t.others[e.label].label:e.label)),s("br"),s("small",[t._v(t._s(e.description))])]),s("div",{staticClass:"total"},[t._v(t._s(t._f("duration2")(e.duration,t.day.dayLength)))]),s("div",{staticClass:"left buttons-icon"},[s("i",{staticClass:"icon-trash",class:1!=t.day.editable?"disabled":"",on:{click:function(s){return t.$emit("removetimesheet",e)}}}),s("i",{staticClass:"icon-edit",class:1!=t.day.editable?"disabled":"",on:{click:function(s){return t.$emit("edittimesheet",e,t.day)}}})])])})),s("hr")],2):t._e(),s("article",{staticClass:"wp-duration card xl"},[t._m(3),s("div",{staticClass:"total"},[t._v(t._s(t._f("duration2")(t.totalJour,t.day.dayLength)))])])],2)])},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h3",[s("i",{staticClass:"icon-archive"}),t._v(" Heures identifiées sur des lots")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[s("strong",[s("i",{staticClass:"icon-archive"}),t._v(" Total"),s("br"),s("small",[t._v("sur les lot de travail")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h3",[s("i",{staticClass:"icon-tags"}),t._v(" Heures Hors-Lots")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("strong",[t._v(" Total de la journée"),s("br")])}],n=s("a76e"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("article",{staticClass:"card card-xs xs wp-duration",class:"status-"+t.d.status_id},[s("span",{staticClass:"infos"},[s("strong",[s("i",{staticClass:"icon-archive"}),s("abbr",{attrs:{title:t.d.project}},[t._v(t._s(t.d.acronym))]),s("i",{staticClass:"icon-angle-right"}),t._v(" "+t._s(t.d.wpCode)+" "),s("i",{staticClass:"icon-comment",class:t.d.comment?"with-comment":"",attrs:{title:t.d.comment}})]),s("br"),s("small",[s("i",{staticClass:"icon-cubes"}),t._v(" "+t._s(t.d.label))]),s("div",{staticClass:"status"},[s("i",{class:"icon-"+t.d.status_id}),t._v(" "+t._s(t._f("status")(t.d.status_id))+" "),t.d.validations.conflict?s("span",{staticClass:"text-danger"},[t._v(" "+t._s(t.d.validations.conflict)+" ")]):t._e()])]),s("div",{staticClass:"total"},[t._v(" "+t._s(t._f("duration2")(t.d.duration,t.dayLength))+" ")]),s("div",{staticClass:"left buttons-icon"},[s("i",{staticClass:"icon-trash",class:1!=t.d.credentials.deletable?"disabled":"",on:{click:function(e){return t.$emit("removetimesheet",t.d)}}}),s("i",{staticClass:"icon-edit",class:1!=t.d.credentials.editable?"disabled":"",on:{click:function(e){return t.$emit("edittimesheet",t.d)}}})])])},l=[],r={name:"TimesheetMonthDeclarationItem",props:{d:{required:!0},dayLength:{required:!0}},filters:{heures(t){let e=Math.floor(t),s=Math.round(60*(t-e));return s<10&&(s="0"+s),console.log(t," => ",e,"h",s),e+":"+s}}},c=r,d=s("2877"),u=Object(d["a"])(c,o,l,!1,null,null,null),h=u.exports,m={name:"TimesheetMonthDayDetails",components:{wpselector:n["default"],day:h},props:{workPackages:{require:!0},others:{require:!0},editable:{required:!0},day:{require:!0},selection:{require:!0},label:{require:!0},dayExcess:{require:!0},copiable:{default:null}},data(){return{formAdd:!1,debug:!1}},filters:{heures(t){let e=Math.floor(t),s=Math.round(60*(t-e));return s<10&&(s="0"+s),console.log(t," => ",e,"h",s),e+":"+s}},computed:{isExceed(){return this.total>this.day.dayLength},totalWP(){let t=0;return this.day.declarations.forEach(e=>{t+=e.duration}),t},totalHWP(){let t=0;return this.day.othersWP&&this.day.othersWP.forEach(e=>{t+=e.duration}),t},totalJour(){return this.totalWP+this.totalHWP},enseignements(){let t=0;return this.day.teaching.forEach(e=>{t+=e.duration}),t},abs(){let t=0;return this.day.vacations.forEach(e=>{t+=e.duration}),t},learn(){let t=0;return this.day.training.forEach(e=>{t+=e.duration}),t},other(){let t=0;return this.day.infos.forEach(e=>{t+=e.duration}),t},sickleave(){let t=0;return this.day.sickleave.forEach(e=>{t+=e.sickleave}),t},research(){let t=0;return this.day.research.forEach(e=>{t+=e.research}),t}},methods:{addToWorkpackage(t){this.$emit("addtowp",t)},hasDeclarationHWP(t){return this.day[t]&&this.day[t].length}}},p=m,v=Object(d["a"])(p,a,i,!1,null,null,null);e["default"]=v.exports},fb15:function(t,e,s){"use strict";if(s.r(e),"undefined"!==typeof window){var a=window.document.currentScript,i=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(s.p=i[1])}var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{on:{click:t.handlerClick,keyup:t.handlerKeyDown}},[s("transition",{attrs:{name:"fade"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"loading-message"},[s("i",{staticClass:"icon-spinner animate-spin"}),t._v(" "+t._s(t.loading)+" ")])]),s("transition",{attrs:{name:"fade"}},[t.commentEdited?s("div",{staticClass:"overlay"},[s("div",{staticClass:"overlay-content"},[s("h2",[s("i",{staticClass:"icon-comment"}),t._v(" Commentaire pour "),s("strong",[t._v(t._s(t.commentEditedLabel))]),t._v(" pour "),s("em",[t._v(t._s(t.mois))])]),s("div",{staticClass:"alert alert-info"},[t._v(" Le commentaire saisi sera repris dans le feuille de temps ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentEditedContent,expression:"commentEditedContent"}],staticClass:"form-control",class:{disabled:!t.ts.editable},attrs:{name:"comment",id:"",cols:"30",rows:"10"},domProps:{value:t.commentEditedContent},on:{input:function(e){e.target.composing||(t.commentEditedContent=e.target.value)}}}),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",class:{disabled:!t.ts.editable},on:{click:t.handlerSendComment}},[s("i",{staticClass:"icon-floppy"}),t._v(" Enregistrer le commentaire")]),s("button",{staticClass:"btn btn-default",on:{click:function(e){t.commentEdited=null}}},[s("i",{staticClass:"icon-cancel-outline"}),t._v("Annuler")])])])]):t._e()]),s("transition",{attrs:{name:"fade"}},[t.screensend?s("div",{staticClass:"overlay"},[s("div",{staticClass:"overlay-content"},[s("h2",[s("i",{staticClass:"icon-paper-plane"}),t._v(" Soumettre la déclaration pour "),s("strong",[t._v(t._s(t.mois))])]),s("table",{staticClass:"table table-bordered table-recap"},[s("thead",[s("th",{attrs:{colspan:"2"}},[t._v(" ")]),t._l(t.ts.days,(function(e){return s("th",[s("small",[t._v(t._s(e.label))]),s("br"),s("strong",[t._v(t._s(e.i))])])})),s("th",[t._v(" Total ")])],2),t._l(t.recapsend.lot,(function(e){return s("tbody",[t._l(e.activities,(function(e){return[s("tr",{staticClass:"activity-line"},[s("th",{attrs:{colspan:t.ts.dayNbr+3}},[s("h3",[s("strong",[s("i",{staticClass:"icon-cube"}),t._v(" ["+t._s(e.acronym)+"] "+t._s(e.label))])])])]),s("tr",[s("th",{attrs:{colspan:"2"}},[t._v(" ")]),s("td",{attrs:{colspan:t.ts.dayNbr}},[t._v("   ")]),s("td",[t._v(" ")])]),t._l(e.workpackages,(function(e){return s("tr",{staticClass:"workpackage-line"},[s("th",{attrs:{colspan:"2"}},[s("i",{staticClass:"icon-archive"}),t._v(" "+t._s(e.label)+" ")]),t._l(t.ts.days,(function(a){return s("td",[e.days[a.i]?s("strong",[t._v(t._s(t._f("duration2")(e.days[a.i],a.dayLength)))]):s("small",[t._v("-")])])})),s("th",{staticClass:"total"},[t._v(" "+t._s(t._f("duration2")(e.total,t.monthLength))+" ")])],2)})),s("tr",{staticClass:"activity-line-total"},[s("th",{attrs:{colspan:"2"}},[t._v("Total")]),t._l(t.ts.days,(function(a){return s("td",[e.days[a.i]?s("strong",[t._v(t._s(t._f("duration2")(e.days[a.i],a.dayLength)))]):s("small",[t._v("-")])])})),s("th",{staticClass:"total"},[t._v(t._s(t._f("duration2")(e.total,t.monthLength)))])],2)]}))],2)})),s("tbody",[s("tr",[s("th",{attrs:{colspan:t.ts.dayNbr+3}},[s("h3",[s("i",{staticClass:"icon-tags"}),s("strong",[t._v("Hors-Lot")])])])]),t._l(t.recapsend.hl,(function(e){return s("tr",{staticClass:"workpackage-line"},[s("th",[s("i",{class:"icon-"+e.code}),t._v(" "+t._s(e.label)+" ")]),s("td",[t._v("   ")]),t._l(t.ts.days,(function(a){return s("td",[e.days[a.i]?s("strong",[t._v(t._s(t._f("duration2")(e.days[a.i],a.dayLength)))]):s("small",[t._v("-")])])})),s("th",{staticClass:"total"},[t._v(" "+t._s(t._f("duration2")(e.total,t.monthLength))+" ")])],2)}))],2),s("tbody",[s("tr",[s("th",{attrs:{colspan:t.ts.dayNbr+3}},[s("h3",[s("strong",[t._v("Total")])])])]),s("tr",{staticClass:"total-line"},[s("th",{attrs:{colspan:"2"}},[t._v(" = ")]),t._l(t.ts.days,(function(e){return s("td",[e.total?s("strong",[t._v(t._s(t._f("duration2")(e.total,e.dayLength)))]):s("small",[t._v("-")])])})),s("th",{staticClass:"total"},[t._v(" "+t._s(t._f("duration2")(t.ts.total,t.monthLength))+" ")])],2)])],2),t._l(t.recapsend.lot,(function(e){return s("div",t._l(e.activities,(function(e){return s("div",[s("h5",[s("strong",[s("i",{staticClass:"icon-cube"}),t._v(" ["+t._s(e.acronym)+"] "+t._s(e.label))])]),s("strong",[t._v("Commentaires : ")]),s("br"),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.screensend[e.id],expression:"screensend[activity.id]"}],staticClass:"form-control",staticStyle:{"max-width":"100%"},domProps:{value:t.screensend[e.id]},on:{input:function(s){s.target.composing||t.$set(t.screensend,e.id,s.target.value)}}})])})),0)})),t._l(t.recapsend.hl,(function(e){return s("div",[s("h5",[s("strong",[s("i",{staticClass:"icon",class:"icon-"+e.code}),t._v(" "+t._s(e.label))])]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.screensend[e.code],expression:"screensend[hl.code]"}],staticClass:"form-control",staticStyle:{"max-width":"100%"},domProps:{value:t.screensend[e.code]},on:{input:function(s){s.target.composing||t.$set(t.screensend,e.code,s.target.value)}}})])})),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",on:{click:t.sendMonthProceed}},[t._v("Envoyer la déclaration")]),s("button",{staticClass:"btn btn-default",on:{click:function(e){t.screensend=null}}},[t._v("Annuler")])])],2)]):t._e()]),s("transition",{attrs:{name:"fade"}},[t.configureColor?s("div",{staticClass:"overlay"},[s("div",{staticClass:"overlay-content"},[s("h2",[s("i",{staticClass:"icon-tags"}),t._v(" Couleurs des activités ")]),s("p",[t._v("Les options ajustables ici pemettent uniquement")]),t._l(t.ts.activities,(function(e){return s("article",[s("strong",{staticClass:"cartouche ",style:{"background-color":t.getAcronymColor(e.acronym)}},[t._v(t._s(e.acronym)+" "),s("em",{staticClass:"addon"},[t._v(t._s(e.label))])]),s("input",{directives:[{name:"model",rawName:"v-model",value:t._colorsProjects[e.acronym],expression:"_colorsProjects[a.acronym]"}],attrs:{type:"color"},domProps:{value:t._colorsProjects[e.acronym]},on:{change:function(s){return t.handlerChangeColor(e.acronym,s)},input:function(s){s.target.composing||t.$set(t._colorsProjects,e.acronym,s.target.value)}}})])})),s("hr"),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.configureColor=!1}}},[s("i",{staticClass:"icon-cancel-alt"}),t._v(" Terminé")])])],2)]):t._e()]),t.error?s("div",{staticClass:"overlay",staticStyle:{"z-index":"2002"}},[s("div",{staticClass:"content container overlay-content"},[t._m(0),s("pre",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]),s("p",{staticClass:"text-danger"},[t._v(" Si ce message ne vous aide pas, transmettez le à l'administrateur Oscar. ")]),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.error=""}}},[t._v("Fermer")])])])]):t._e(),t.rejectPeriod?s("div",{staticClass:"overlay",staticStyle:{"z-index":"2002"}},[s("div",{staticClass:"content container overlay-content"},[t._m(1),t.rejectPeriod.rejectadmin_at?s("div",[s("p",[t._v("Déclaration rejetée administrativement par "),s("strong",[t._v(t._s(t.rejectPeriod.rejectadmin_by))]),t._v(" le "),s("time",[t._v(t._s(t.rejectPeriod.rejectadmin_at))])]),s("pre",[s("strong",[t._v("Motif : ")]),t._v(t._s(t.rejectPeriod.rejectadmin_message))])]):t.rejectPeriod.rejectsci_at?s("div",[s("p",[t._v("Déclaration rejetée scientifiquement par "),s("strong",[t._v(t._s(t.rejectPeriod.rejectsci_by))]),t._v(" le "),s("time",[t._v(t._s(t.rejectPeriod.rejectsci_at))])]),s("pre",[s("strong",[t._v("Motif : ")]),t._v(t._s(t.rejectPeriod.rejectsci_message))])]):t.rejectPeriod.rejectactivity_at?s("div",[s("p",[t._v("Déclaration rejetée par "),s("strong",[t._v(t._s(t.rejectPeriod.rejectactivity_by))]),t._v(" le "),s("time",[t._v(t._s(t.rejectPeriod.rejectactivity_at))])]),s("pre",[s("strong",[t._v("Motif : ")]),t._v(t._s(t.rejectPeriod.rejectactivity_message))])]):t._e(),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.rejectPeriod=null}}},[t._v("Fermer")])])])]):t._e(),t.popup?s("div",{staticClass:"overlay",staticStyle:{"z-index":"2001"}},[s("div",{staticClass:"content container overlay-content"},[s("h2",[t._v("Historique")]),s("pre",{staticClass:"alert alert-info"},[t._v(t._s(t.popup))]),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.popup=""}}},[t._v("Fermer")])])])]):t._e(),t.help?s("div",{staticClass:"overlay",staticStyle:{"z-index":"2002"}},[s("div",{staticClass:"content container overlay-content"},[t._m(2),t._m(3),t.ts?s("ul",[s("li",[t._v("Durée "),s("em",[t._v("normal")]),t._v(" d'une journée : "),s("strong",[t._v(t._s(t._f("duration")(t.ts.daylength)))])]),s("li",[t._v("Durée "),s("strong",[t._v("maximum légale")]),t._v(" d'une journée : "),s("strong",[t._v(t._s(t._f("duration")(t.ts.dayExcess)))])]),s("li",[t._v("Durée "),s("strong",[t._v("maximum légale")]),t._v(" d'une semaine : "),s("strong",[t._v(t._s(t._f("duration")(t.ts.weekExcess)))])]),s("li",[t._v("Durée "),s("strong",[t._v("maximum légale")]),t._v(" d'un mois : "),s("strong",[t._v(t._s(t._f("duration")(t.ts.monthExcess)))])])]):t._e(),t._m(4),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.help=""}}},[t._v("Fermer")])])])]):t._e(),t.debug?s("div",{staticClass:"overlay",staticStyle:{"z-index":"2002"}},[s("div",{staticClass:"content container overlay-content"},[t._m(5),s("pre",{staticClass:"alert alert-info",staticStyle:{"white-space":"pre","font-size":"12px"}},[t._v(t._s(t.debug))]),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.debug=""}}},[t._v("Fermer")])])])]):t._e(),t.selectedDay&&t.selectionWP&&t.selectionWP.code?s("div",{staticClass:"overlay",staticStyle:{"z-index":"2001"}},[s("div",{staticClass:"content container overlay-content"},[s("section",[t.selectionWP.id?s("h3",[s("small",[t._v("Déclaration pour le lot")]),s("strong",[s("i",{staticClass:"icon-archive"}),s("abbr",[t._v(t._s(t.selectionWP.code))]),t._v(" "+t._s(t.selectionWP.label)+" ")])]):s("h3",[s("small",[t._v("Déclaration hors-lot pour")]),s("strong",[s("i",{class:"icon-"+t.selectionWP.code}),t._v(" "+t._s(t.selectionWP.label)+" ")])])]),1!=t.selectionWP.validation_up?s("div",{staticClass:"alert alert-danger"},[t._v(" Vous ne pouvez plus ajouter de créneaux pour ce lot sur cette période ")]):s("div",[s("p",[s("i",{staticClass:"icon-calendar"}),t._v(" Journée : "),s("strong",[t._v(t._s(t._f("datefull")(t.selectedDay.date)))]),s("br")]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-6"},[s("h4",[t._v("Temps")]),s("pre",[t._v(t._s(t.selection))]),s("timechooser",{attrs:{declarationInHours:t.declarationInHours,baseTime:t.selectedDay.dayLength,fill:t.fillDayValue,duration:t.editedTimesheet?t.editedTimesheet.duration:0},on:{timeupdate:t.handlerDayUpdated}})],1),s("div",{staticClass:"col-md-6"},[s("h4",[t._v("Commentaire")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentaire,expression:"commentaire"}],staticClass:"form-control textarea",domProps:{value:t.commentaire},on:{input:function(e){e.target.composing||(t.commentaire=e.target.value)}}})])])]),s("nav",{staticClass:"buttons"},[s("button",{staticClass:"btn btn-default",on:{click:function(e){t.selectionWP=null}}},[s("i",{staticClass:"icon-block"}),t._v(" Annuler ")]),1==t.selectionWP.validation_up?s("button",{staticClass:"btn btn-primary",on:{click:t.handlerSaveMenuTime}},[s("i",{staticClass:"icon-floppy"}),t._v(" Valider ")]):t._e()])])]):t._e(),t.ts?s("section",{staticClass:"container-fluid",staticStyle:{"margin-bottom":"5em"}},[s("div",{staticClass:"month col-lg-8"},[s("h2",[t._v(" Déclarations de temps pour "),s("strong",[t._v(t._s(t.ts.person))]),s("small",{staticStyle:{position:"absolute",right:"0","font-size":"14px",cursor:"pointer"},on:{click:function(e){t.configureColor=!0}}},[t._v(" Options "),s("i",{staticClass:"icon-cog"})])]),s("h3",{staticClass:"periode"},[t._v("Période "),s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.prevMonth.apply(null,arguments)}}},[s("i",{staticClass:"icon-angle-left"})]),s("strong",{on:{click:function(e){if(!e.shiftKey)return null;t.debug=t.ts}}},[t._v(t._s(t.mois))]),s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.nextMonth.apply(null,arguments)}}},[s("i",{staticClass:"icon-angle-right"})]),t.urlimport?s("a",{staticClass:"btn btn-default",class:{disabled:!t.ts.submitable},attrs:{href:t.urlimport+"&period="+t.periodCode,title:t.ts.submitable?"":"Vous ne pouvez pas importer pour cette période"}},[s("i",{staticClass:"icon-calendar"}),t._v(" Importer un calendrier"),s("br"),t.ts.submitable?t._e():s("small",[t._v(" Vous ne pouvez pas importer pour une période en cours/déjà envoyée ")])]):t._e()]),s("div",{staticClass:"month"},[t._m(6),s("div",{staticClass:"weeks"},t._l(t.weeks,(function(e){return t.ts?s("section",{staticClass:"week",class:t.selectedWeek==e?"selected":""},[s("header",{staticClass:"week-header",on:{click:function(s){return t.selectWeek(e)}}},[s("span",[t._v("Semaine "+t._s(e.label))]),s("small",[s("em",[t._v("Cumul des heures : ")]),s("strong",{class:e.total>e.weekExcess?"has-titled-error":"",attrs:{title:e.total>e.weekExcess?"Les heures excédentaires risques d'être ignorées lors d'une justification financière dans le cadre des projets soumis aux feuilles de temps":""}},[e.total>e.weekExcess?s("i",{staticClass:"icon-attention-1"}):t._e(),t._v(t._s(t._f("duration2")(e.total,e.weekLength)))])])]),s("div",{staticClass:"days"},t._l(e.days,(function(e){return s("timesheetmonthday",{key:e.date,class:t.selectedDay==e?"selected":"",attrs:{others:t.ts.otherWP,projectscolors:t._colorsProjects,day:e},on:{selectDay:function(s){return t.handlerSelectData(e)},daymenu:t.handlerDayMenu,debug:function(e){t.debug=e}}})})),1)]):t._e()})),0)])]),s("section",{staticClass:"col-lg-4"},[t.selectedDay?s("timesheetmonthdaydetails",{attrs:{day:t.selectedDay,workPackages:t.ts.workpackages,others:t.ts.otherWP,selection:t.selectionWP,editable:t.ts.editable,label:t.dayLabel,"day-excess":t.ts.dayExcess,copiable:t.clipboardDataDay},on:{debug:function(e){t.debug=e},copy:t.handlerCopyDay,paste:t.handlerPasteDay,cancel:function(e){t.selectedDay=null},removetimesheet:t.deleteTimesheet,edittimesheet:t.editTimesheet,addtowp:function(e){return t.handlerWpFromDetails(e)}}}):t.selectedWeek?s("div",[s("h3",{staticClass:"title-with-menu",on:{click:function(e){if(!e.shiftKey)return null;t.debug=t.selectedWeek}}},[s("div",{staticClass:"text"},[s("i",{staticClass:"icon-calendar"}),s("strong",[t._v("Semaine "+t._s(t.selectedWeek.label))])]),t.ts.editable?s("nav",{staticClass:"right-menu"},[s("a",{attrs:{href:"#",title:"Copier les créneaux de la semaine"},on:{click:function(e){return t.handlerCopyWeek(t.selectedWeek)}}},[s("i",{staticClass:"icon-docs"})]),s("a",{directives:[{name:"show",rawName:"v-show",value:t.clipboardData,expression:"clipboardData"}],attrs:{href:"#",title:"Coller les créneaux"},on:{click:function(e){return t.handlerPasteWeek(t.selectedWeek)}}},[s("i",{staticClass:"icon-paste"})])]):t._e()]),s("a",{staticClass:"btn btn-default",on:{click:function(e){t.selectedWeek=null}}},[s("i",{staticClass:"icon-angle-left"}),t._v(" Revenir au mois ")]),s("h4",[t._v("Jours : ")]),t._l(t.selectedWeek.days,(function(e){return s("article",{staticClass:"card xs total repport-item",class:{locked:e.locked,closed:e.closed,excess:e.duration>t.ts.dayExcess},on:{click:function(s){return t.handlerSelectData(e)}}},[s("div",{staticClass:"week-header",class:{"text-thin":e.closed||e.locked}},[s("span",{},[s("i",{staticClass:"icon-calendar"}),e.closed?s("i",{staticClass:"icon-minus-circled"}):e.locked?s("i",{staticClass:"icon-lock"}):e.total>e.amplitudemin&&e.total<e.amplitudemax?s("i",{staticClass:"icon-ok-circled",staticStyle:{color:"#2d7800"}}):s("i",{staticClass:"icon-help-circled",staticStyle:{color:"#777777"}}),t._v(" "+t._s(t._f("datefull")(e.data))+" "),s("i",{staticClass:"icon-attention-circled",staticStyle:{color:"red"},attrs:{title:"Les heures déclarées dépassent la limite légales"}})]),s("small",[s("strong",{staticClass:"text-large"},[t._v(t._s(t._f("duration2")(e.duration,e.dayLength)))])])])])})),s("article",{staticClass:"card xs total"},[s("div",{staticClass:"week-header"},[s("span",{},[s("i",{staticClass:"icon-clock"}),t._v(" Heures déclarées "),s("br"),t.selectedWeek.totalOpen<t.selectedWeek.weekLength?s("small",{staticClass:"text-thin"},[s("i",{staticClass:"icon-attention-1"}),t._v(" Cette semaine n'est pas encore terminée ")]):t._e()]),s("small",{staticClass:"text-big"},[s("strong",[t._v(t._s(t._f("duration2")(t.selectedWeek.total,t.selectedWeek.weekLength)))])])])]),t.selectedWeek.total>t.ts.weekExcess?s("div",{staticClass:"alert alert-danger"},[s("i",{staticClass:"icon-attention-1"}),t._v(" Vos déclarations pour cette semaine dépasse la limite légale fixée à "),s("strong",[t._v(t._s(t._f("duration")(t.ts.weekExcess)))]),t._v(" heures. ")]):t._e(),t.selectedWeek.total>0?s("nav",{staticClass:"buttons-bar"},[t.ts.editable?s("button",{staticClass:"btn btn-danger btn-xs",on:{click:function(e){return t.deleteWeek(t.selectedWeek)}}},[s("i",{staticClass:"icon-trash"}),t._v(" Supprimer les déclarations non-envoyées ")]):t._e()]):t._e(),t.selectedWeek.total<t.selectedWeek.totalOpen&&t.ts.editable?s("section",[s("p",[s("i",{staticClass:"icon-help-circled"}),t._v(" Vous pouvez compléter automatiquement cette semaine en affectant les "),s("strong",[t._v(t._s(t._f("duration")(t.selectedWeek.totalOpen-t.selectedWeek.total))+" heure(s)")]),t._v(" avec une des activités ci-dessous : ")]),s("wpselector",{attrs:{others:t.ts.otherWP,workpackages:t.ts.workpackages,selection:t.fillSelectedWP,usevalidation:!0},on:{select:function(e){t.fillSelectedWP=e,t.fillWeek(t.selectedWeek,t.fillSelectedWP)}}})],1):t._e()],2):s("div",[s("h3",{on:{click:function(e){if(e.preventDefault(),!e.shiftKey)return null;e.stopPropagation(),t.debug=t.ts}}},[s("i",{staticClass:"icon-calendar"}),t._v(" Mois de "),s("strong",[t._v(t._s(t.mois))])]),t.monthRest>0&&t.ts.periodFinished?s("section",[s("p",[s("i",{staticClass:"icon-help-circled"}),t._v(" Vous pouvez compléter automatiquement ce mois avec : ")]),s("wpselector",{attrs:{others:t.ts.otherWP,workpackages:t.ts.workpackages,selection:t.fillMonthWP,usevalidation:!0},on:{select:function(e){t.fillMonthWP=e,t.handlerFillMonth(t.fillMonthWP)}}})],1):t._e(),s("hr"),t._l(t.weeks,(function(e){return t.ts?s("section",{staticClass:"card xs"},[s("header",{staticClass:"week-header",on:{click:function(s){return t.selectWeek(e)}}},[s("span",[t._v(" Semaine "+t._s(e.label)+" "),e.total<e.weekLength?s("i",{staticClass:"icon-ok-circled",staticStyle:{color:"#999"}}):e.total>e.weekExcess?s("i",{staticClass:"icon-attention-circled",staticStyle:{color:"#993d00"},attrs:{title:"La déclaration est incomplète pour cette période"}}):s("i",{staticClass:"icon-ok-circled",staticStyle:{color:"#2d7800"}})]),s("small",[s("strong",{class:e.total>e.weekExcess?"has-titled-error":"",attrs:{title:e.total>e.weekExcess?"Les décalarations dépassent la limite légales et risques d'être ignorées lors d'une justification financière dans le cadre des projets soumis aux feuilles de temps":""}},[e.total>e.weekExcess?s("i",{staticClass:"icon-attention-1"}):t._e(),t._v(t._s(t._f("duration2")(e.total,e.weekLength)))])])])]):t._e()})),s("section",{staticClass:"card xs total interaction-off"},[s("div",{staticClass:"week-header"},[s("span",{staticClass:"text-big text-xxl"},[t._v("Total")]),s("small",[s("strong",{staticClass:"text-large"},[t._v(t._s(t._f("duration2")(t.ts.total,t.monthLength)))])])])]),t.ts.total>t.ts.monthExcess?s("div",{staticClass:"alert alert-danger"},[s("i",{staticClass:"icon-attention-circled"}),t._v(" Les heures mensuelles dépassent le cadre légale fixé à "),s("strong",[t._v(t._s(t._f("duration")(t.ts.monthExcess)))]),t._v(" heures. ")]):t._e(),s("hr"),s("h4",[s("i",{staticClass:"icon-tags"}),t._v(" Hors-lot")]),t._l(t.ts.otherWP,(function(e){return e.total>0?s("section",{staticClass:"card xs"},[s("div",{staticClass:"week-header"},[s("span",[s("i",{class:"icon-"+e.code}),t._v(" "+t._s(e.label)+" "),null==e.validation_state?s("i"):"send-prj"==e.validation_state.status?s("i",{staticClass:"icon-cube",attrs:{title:"Validation projet en attente"}}):"send-sci"==e.validation_state.status?s("i",{staticClass:"icon-beaker",attrs:{title:"Validation scientifique en attente"}}):"send-adm"==e.validation_state.status?s("i",{staticClass:"icon-hammer",attrs:{title:"Validation administrative en attente"}}):"conflict"==e.validation_state.status?s("i",{staticClass:"icon-minus-circled",attrs:{title:"Il y'a un problème dans la déclaration"}}):"valid"==e.validation_state.status?s("i",{staticClass:"icon-ok-circled",attrs:{title:"Cette déclaration est valide"}}):t._e(),s("br"),s("em",{staticClass:"text-thin"},[t._v(t._s(e.description))]),s("button",{staticClass:"btn btn-default btn-xs",on:{click:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"default",void 0,s.key,void 0)?null:(s.preventDefault(),t.handledEditComment("hl",e))}}},[s("i",{staticClass:"icon-chat-alt"}),t._v(" Commentaire ")])]),s("small",[s("strong",{staticClass:"text-large"},[t._v(t._s(t._f("duration2")(e.total,t.monthLength)))])])])]):t._e()})),s("section",{staticClass:"card xs total interaction-off"},[s("div",{staticClass:"week-header"},[s("span",{staticClass:"text-big text-xxl"},[t._v("Total")]),s("small",[s("strong",{staticClass:"text-large"},[t._v(t._s(t._f("duration2")(t.totalWP,t.monthLength)))])])])]),s("h4",[s("i",{staticClass:"icon-cubes"}),t._v(" Activités pour cette période")]),0==t.ts.activities.length?s("p",{staticClass:"alert alert-info"},[t._v(" Vous n'être identifié comme déclarant sur aucune activité pour cette période. Si cette situation vous semble anormale, prenez contact avec votre responsable scientifique. ")]):t._l(t.ts.activities,(function(e){return s("section",{staticClass:"card xs"},[s("div",{staticClass:"week-header"},[s("span",[s("strong",[t._v(t._s(e.acronym))]),s("span",{staticClass:"icon-tag",style:{color:t._colorsProjects[e.acronym]},on:{click:function(e){t.configureColor=!0}}},[t._v(" ")]),null==e.validation_state?s("i"):"send-prj"==e.validation_state.status?s("i",{staticClass:"icon-cube",attrs:{title:"Validation projet en attente"}}):"send-sci"==e.validation_state.status?s("i",{staticClass:"icon-beaker",attrs:{title:"Validation scientifique en attente"}}):"send-adm"==e.validation_state.status?s("i",{staticClass:"icon-hammer",attrs:{title:"Validation administrative en attente"}}):"conflict"==e.validation_state.status?s("i",{staticClass:"icon-minus-circled",attrs:{title:"Il y'a un problème dans la déclaration"}}):"valid"==e.validation_state.status?s("i",{staticClass:"icon-ok-circled",attrs:{title:"Cette déclaration est valide"}}):t._e(),s("br"),s("em",{staticClass:"text-thin"},[t._v(t._s(e.label))]),s("button",{staticClass:"btn btn-default btn-xs",on:{click:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"default",void 0,s.key,void 0)?null:(s.preventDefault(),t.handledEditComment("prj",e))}}},[s("i",{staticClass:"icon-chat-alt"}),t._v(" Commentaire ")])]),s("small",{staticClass:"subtotal"},[s("strong",{staticClass:"text-large"},[t._v(t._s(t._f("duration2")(e.total,t.monthLength)))])])])])})),s("section",{staticClass:"card xs total interaction-off"},[s("div",{staticClass:"week-header"},[s("span",[s("strong",{staticClass:"text-big text-xxl"},[t._v("Total")]),s("br"),s("small",[t._v("Pour les activités soumises aux déclarations")])]),s("small",[s("strong",{staticClass:"text-large"},[t._v(t._s(t._f("duration2")(t.ts.periodDeclarations,t.monthLength)))])])])]),t.ts.periodsValidations.length?s("div",[s("h3",[t._v("Procédures de validation pour cette période")]),t._l(t.ts.periodsValidations,(function(e){return s("section",{staticClass:"card card-xs"},["valid"==e.status?s("i",{staticClass:"icon-ok-circled"}):"conflict"==e.status?s("i",{staticClass:"icon-minus-circled"}):s("i",{staticClass:"icon-history"}),t._v(" "+t._s(e.label)+" "),s("a",{attrs:{href:"#"},on:{click:function(s){t.popup=e.log}}},[t._v("Historique")]),"conflict"==e.status&&(e.rejectadmin_message||e.rejectsci_message||e.rejectactivity_message)?s("a",{attrs:{href:"#"},on:{click:function(s){t.rejectPeriod=e}}},[t._v("Détails sur le rejet")]):t._e()])}))],2):t._e()],2),s("nav",{staticClass:"buttons-bar"},[t.ts.submitable?s("button",{staticClass:"btn btn-primary",class:{disabled:!t.ts.submitable,enabled:t.ts.submitable&&!t.loading},staticStyle:{"margin-left":"auto"},on:{click:function(e){return t.validateMonth()}}},[t.loading?s("i",{staticClass:"icon-spinner animate-spin"}):s("i",{staticClass:"icon-upload"}),t.ts.hasConflict?s("span",[t._v("Réenvoyer")]):s("span",[t._v("Soumettre mes déclarations")])]):s("span",{staticClass:"alert",class:"alert-"+t.ts.submitableClass},[t._v(" Vous ne pouvez pas soumettre cette période"),s("br"),s("small",[t._v(t._s(t.ts.submitableInfos))])])])],1)]):t._e()],1)},o=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h2",[s("i",{staticClass:"icon-attention-1"}),t._v(" Oups !")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h2",[s("i",{staticClass:"icon-attention-1"}),t._v(" Déclaration rejetée !")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h2",[s("i",{staticClass:"icon-help-circled"}),t._v(" Informations légales")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v(" Dans le cadre des projets soumis aux feuilles de temps, l'organisme financeur impose la justification des heures, "),s("strong",[t._v("incluant les activités hors-projets")]),t._v(". Le culum des heures déclarées doit respecter le cadre légale : "),s("br")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v(" Selon les modalités de financement, les dépacements (même en éxcédent) peuvent être considérés comme des "),s("em",[t._v("irrégularité")]),t._v(" pouvant déclencher la suspension ou le remboursement des financements engagés ou à venir. ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h2",[s("i",{staticClass:"icon-bug"}),t._v(" Debug")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("header",{staticClass:"month-header"},[s("strong",[t._v("Lundi")]),s("strong",[t._v("Mardi")]),s("strong",[t._v("Mercredi")]),s("strong",[t._v("Jeudi")]),s("strong",[t._v("Vendredi")]),s("strong",[t._v("Samedi")]),s("strong",[t._v("Dimanche")])])}],l={resolve(t,e){let s="Erreur inconnue";return e&&(s=e.body,403==e.status&&(s="Vous avez été déconnectez de l'application")),t+" (Réponse : "+s+")"}};let r=new Date,c=function(){};var d={name:"TimesheetMonth",props:{moment:{required:!0},bootbox:{required:!0},declarationInHours:{required:!0},defaultMonth:{default:r.getMonth()+1},defaultYear:{default:r.getFullYear()},defaultDayLength:{default:8},urlimport:{default:null},urlValidation:{required:!0},url:{required:!0}},components:{timesheetmonthday:s("c8e1").default,timesheetmonthdaydetails:s("ea58").default,timechooser:s("6600").default,wpselector:s("a76e").default},data(){return{editWindow:{display:!1,wp:null,type:"infos"},commentEdited:null,commentEditedLabel:"",commentEditedContent:"",configureColor:!1,_colorsProjects:null,colors:["#0b098c","#09518c","#09858c","#098c66","#098c27","#818c09","#8c6d09","#8c4e09","#8c1109","#8c0971","#8c6f09"],copyClipboard:null,clipboardDataDay:null,showHours:!0,loading:!1,debug:null,help:!1,popup:"",screensend:null,sendaction:null,error:"",commentaire:"",fillSelectedWP:null,ts:null,month:null,year:null,dayLength:null,selectedWeek:null,rejectPeriod:null,selectedDay:null,dayMenuLeft:50,dayMenuTop:50,dayMenu:"none",selectedWP:null,selectionWP:null,selectedTime:null,dayMenuSelected:null,dayMenuTime:0,editedTimesheet:null,fillMonthWP:null}},filters:{date(t,e="ddd DD MMMM  YYYY"){var s=c(t);return s.format(e)},datefull(t,e="ddd DD MMMM  YYYY"){var s=c(t);return s.format(e)},day(t,e="ddd DD"){var s=c(t);return s.format(e)}},computed:{projectsColors(){return this._colorsProjects},recapsend(){let t={},e={},s={};return Object.keys(this.ts.otherWP).forEach(t=>{let a=this.ts.otherWP[t];e[a.code]={id:a.code,code:a.code,label:a.label,days:{},total:a.total,comment:a.comment},s[a.code]=a.comment}),Object.keys(this.ts.activities).forEach(e=>{let a=this.ts.activities[e],i=a.project_id,n=a.project,o=a.comment;s[a.id]=o,this.screensend&&this.screensend.hasOwnProperty(e)&&(o=this.screensend[e]),t.hasOwnProperty(i)||(t[i]={label:n,id:i,activities:{}}),t[i].activities.hasOwnProperty(a.id)||(t[i].activities[a.id]={id:a.id,label:a.label,acronym:a.acronym,total:a.total,days:{},workpackages:{},comment:o})}),Object.keys(this.ts.workpackages).forEach(e=>{let s=this.ts.workpackages[e],a=s.project_id,i=s.activity_id;t[a]&&t[a].activities[i]&&(t[a].activities[i].workpackages[s.id]={label:s.code,description:s.label,total:s.total,days:{}})}),Object.keys(this.ts.days).forEach(s=>{let a=this.ts.days[s];a.declarations.forEach(e=>{let a=e.activity_id,i=e.project_id,n=e.wp_id;t[i].activities[a].days.hasOwnProperty(s)||(t[i].activities[a].days[s]=0),t[i].activities[a].workpackages[n].days.hasOwnProperty(s)||(t[i].activities[a].workpackages[n].days[s]=0),t[i].activities[a].days[s]+=e.duration,t[i].activities[a].workpackages[n].days[s]+=e.duration}),a.othersWP&&a.othersWP.forEach(t=>{let a=t.code;e.hasOwnProperty(a)||(e[a]={days:{},total:0}),e[a].days.hasOwnProperty(s)||(e[a].days[s]=0),e[a].days[s]+=t.duration})}),{lot:t,comments:s,hl:e}},monthRest(){return this.monthLength-this.ts.total},monthLength(){let t=0;for(let e in this.ts.days)t+=this.ts.days[e].dayLength;return t},dayLabel(){return this.selectedDay?c(this.selectedDay.data).format("dddd DD MMMM YYYY"):""},fillDayValue(){let t=this.selectedDay.dayLength-this.selectedDay.duration;return t<0&&(t=0),t},mois(){return c(this.ts.from).format("MMMM YYYY")},periodCode(){return this.ts.from.substr(0,7)},cssDayMenu(){return{display:this.dayMenu,top:this.dayMenuTop+"px",left:this.dayMenuLeft+"px"}},totalWP(){let t=0;for(let e in this.ts.otherWP)this.ts.otherWP[e].total&&(t+=this.ts.otherWP[e].total);return t},weeks(){let t=[];if(this.ts&&this.ts.days){let e=this.ts.days[1],s=e.week,a={label:s,days:[],total:0,totalOpen:0,weekLength:0,editable:this.ts.editable,drafts:0,weekExcess:this.ts.weekExcess};for(let i in this.ts.days){let e=this.ts.days[i];s!=e.week&&(t.push(a),a={label:e.week,days:[],total:0,totalOpen:0,weekLength:0,drafts:0,weekExcess:this.ts.weekExcess}),s=e.week,a.total+=e.duration,e.locked||e.closed||(a.totalOpen+=e.dayLength),e.declarations&&e.declarations.forEach(t=>{2==t.status_id&&a.drafts++}),e.closed||(a.weekLength+=e.dayLength),a.days.push(e)}a.days.length&&t.push(a)}return t}},methods:{handledEditComment(t,e){this.commentEditedLabel=e.label,this.commentEdited=e,this.commentEditedContent=e.comment},handlerSendComment(){if(this.ts.editable){var t,e,s;this.commentEdited.id?(t="wp",e=this.commentEdited.id,s=""):(t="hl",s=this.commentEdited.code,e="");var a=new FormData;a.append("action","comment"),a.append("period",this.ts.period),a.append("type",t),a.append("id",e),a.append("code",s),a.append("content",this.commentEditedContent),this.$http.post("",a).then(t=>{this.fetch()},t=>{this.error=l.resolve("Impossible d'enregistrer le commentaire",t)}).then(t=>{this.selectedWeek=null,this.screensend=null,this.loading=!1,this.commentEdited=null})}},getAcronymColor(t){return this._colorsProjects.hasOwnProperty(t)?this._colorsProjects[t]:"#333333"},handlerChangeColor(t,e){let s=JSON.parse(JSON.stringify(this._colorsProjects));s[t]=e.target.value,this._colorsProjects=s,window.localStorage&&window.localStorage.setItem("colorsprojects",JSON.stringify(this._colorsProjects)),this.$forceUpdate()},handlerFillMonth(t){let e=[];Object.keys(this.ts.days).forEach(s=>{let a=this.ts.days[s];a.closed||a.locked||a.duration>=a.dayLength||e.push({day:a.date,wpId:t.id,code:t.code,commentaire:"",duration:60*(a.dayLength-a.duration)})}),this.performAddDays(e)},handlerPasteDay(t){let e=[];this.clipboardDataDay.forEach(s=>{let a=JSON.parse(JSON.stringify(s));a.day=t.datefull,e.push(a)}),this.performAddDays(e)},handlerCopyDay(t){let e=[];t.declarations&&t.declarations.forEach(t=>{e.push({code:t.wpCode,comment:t.comment,duration:60*t.duration,wpId:t.wp_id})}),t.othersWP&&t.othersWP.forEach(t=>{e.push({code:t.code,comment:"",duration:60*t.duration,wpId:null})}),this.clipboardDataDay=e},editTimesheet(t,e){this.editedTimesheet=t,this.commentaire=t.comment,this.selectedDay=e,this.dayMenuTime=t.duration,t.wp_id?this.selectionWP=this.getWorkpackageById(t.wp_id):t.code&&(this.selectionWP=this.getHorsLotByCode(t.code))},getHorsLotByCode(t){return this.ts.otherWP[t]},getWorkpackageById(t){return this.ts.workpackages[t]},reSendPeriod(t){this.validateMonth("resend")},validateMonth(t="sendmonth"){this.loading=!0,this.$http.get(this.urlValidation+"?year="+this.ts.year+"&month="+this.ts.month).then(e=>{this.sendMonth(t)},t=>{this.error=t.body}).then(t=>{this.selectedWeek=null,this.loading=!1})},sendMonth(t="sendmonth"){if(this.sendaction=t,1!=this.ts.submitable&&1!=this.ts.hasConflict)return void(this.error="Vous ne pouvez pas soumettre vos déclarations pour cette période : "+this.ts.submitableInfos);let e={};Object.keys(this.ts.activities).forEach(t=>{this.ts.activities[t].comment?e[t]=[this.ts.activities[t].comment]:Object.keys(this.ts.days).forEach(s=>{let a=this.ts.days[s];a.declarations.forEach(s=>{if(s.activity_id==t){let t=s.activity_id;e.hasOwnProperty(t)||(e[t]=[]),s.comment&&e[t].indexOf(s.comment)<0&&e[t].push(s.comment)}})})}),Object.keys(this.ts.otherWP).forEach(t=>{this.ts.otherWP[t].comment?e[t]=[this.ts.otherWP[t].comment]:Object.keys(this.ts.days).forEach(s=>{let a=this.ts.days[s];a.declarations.forEach(s=>{if(s.activity_id==t){let t=s.code;e.hasOwnProperty(t)||(e[t]=[]),s.comment&&e[t].indexOf(s.comment)<0&&e[t].push(s.comment)}})})}),Object.keys(e).forEach(t=>{e[t]=" - "+e[t].join("\n - ")}),this.screensend=e},sendMonthProceed(){var t=new FormData;t.append("action",this.sendaction),t.append("comments",JSON.stringify(this.screensend)),t.append("datas",JSON.stringify({from:this.ts.from,to:this.ts.to})),this.loading=!0,this.$http.post("",t).then(t=>{this.fetch()},t=>{this.error=l.resolve("Impossible d'envoyer la période",t)}).then(t=>{this.selectedWeek=null,this.screensend=null,this.loading=!1})},fillWeek(t,e){let s=[];t.days.forEach(t=>{t.closed||t.locked||t.duration>=t.dayLength||s.push({day:t.date,wpId:e.id,code:e.code,commentaire:this.commentaire,duration:60*(t.dayLength-t.duration)})}),this.performAddDays(s)},fillDay(){},selectWeek(t){this.selectedDay=null,this.selectedWeek=t},deleteWeek(t){let e=[];t.days.forEach(t=>{t.declarations.forEach(t=>{e.push(t.id)}),t.othersWP&&t.othersWP.forEach(t=>{e.push(t.id)})}),this.performDelete(e)},deleteTimesheet(t){this.performDelete([t.id])},handlerPasteWeek(t){let e=[];t.days.forEach(t=>{this.clipboardData.forEach(s=>{if(s.day==t.day){let a=JSON.parse(JSON.stringify(s));a.day=t.datefull,e.push(a)}})}),this.performAddDays(e)},handlerCopyWeek(t){let e=[];t.days.forEach(t=>{t.declarations&&t.declarations.forEach(s=>{e.push({code:s.wpCode,comment:s.comment,duration:60*s.duration,day:t.day,wpId:s.wp_id})}),t.othersWP&&t.othersWP.forEach(s=>{e.push({code:s.code,comment:"",duration:60*s.duration,day:t.day,wpId:null})})}),this.clipboardData=e},handlerSaveMenuTime(){let t=[{id:this.editedTimesheet?this.editedTimesheet.id:null,day:this.selectedDay.date,wpId:this.selectionWP.id,duration:60*this.dayMenuTime,comment:this.commentaire,code:this.selectionWP.code}];this.performAddDays(t)},performAddDays(t){let e=new FormData;e.append("timesheets",JSON.stringify(t)),e.append("action","add"),this.loading="Enregistrement des créneaux",this.$http.post(this.url,e).then(t=>{this.fetch(!1)},t=>{this.error=l.resolve("Impossible d'enregistrer les créneaux",t)}).then(t=>{this.selectedWeek=null,this.selectionWP=null,this.loading=!1,this.commentaire="",this.editedTimesheet=null})},performDelete(t){this.loading="Suppression des créneaux",this.$http.delete(this.url+"&id="+t.join(",")).then(t=>{this.fetch(!1)},t=>{this.error=l.resolve("Impossible de supprimer le créneau",t)}).then(t=>{this.selectedWeek=null,this.loading=!1})},handlerDayUpdated(){let t=arguments[0];this.dayMenuTime=t.h+t.m},handlerSelectWP(t){this.selectedWP=t,this.selectionWP=t,this.dayMenu="none"},hideWpSelector(){this.selectedWP=null,this.selectedTime=null,this.dayMenu="none"},handlerKeyDown(t){},handlerClick(){this.hideWpSelector()},handlerWpFromDetails(t){this.handlerSelectWP(t)},handlerDayMenu(t,e){this.dayMenuLeft=t.clientX,this.dayMenuTop=t.clientY,this.dayMenu="block",this.selectedDay=e},handlerSelectData(t){this.selectedDay=t},nextYear(){this.year+=1,this.fetch(!0)},nextMonth(){this.month+=1,this.month>12?(this.month=1,this.nextYear()):this.fetch(!0)},prevYear(){this.year-=1,this.fetch(!0)},prevMonth(){this.month-=1,this.month<1?(this.month=12,this.prevYear()):this.fetch(!0)},fetch(t=!0){let e;this.loading="Chargement de la période",t&&(this.selectedDay=null,this.selectedWeek=null),this.selectedDay&&(e=this.selectedDay.i),this.$http.get(this.url+"&month="+this.month+"&year="+this.year).then(t=>{this.dayLength=t.body.dayLength,this.ts=t.body,e&&(this.selectedDay=this.ts.days[e]),this.selectedWP=null,this.selectionWP=null,this.fillSelectedWP=null},t=>{this.error=l.resolve("Impossible de charger cette période",t)}).then(t=>{this.loading=!1})}},mounted(){c=this.moment,this.month=this.defaultMonth,this.year=this.defaultYear,this.dayLength=this.defaultDayLength,window.localStorage&&(window.localStorage.getItem("colorsprojects")?this._colorsProjects=JSON.parse(window.localStorage.getItem("colorsprojects")):this._colorsProjects={}),this.fetch(!0)}},u=d,h=s("2877"),m=Object(h["a"])(u,n,o,!1,null,null,null),p=m.exports;e["default"]=p}})["default"]}));
//# sourceMappingURL=TimesheetMonth.umd.min.js.map