(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["WorkpackageUI"]=t():e["WorkpackageUI"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="fb15")}({8875:function(e,t,r){var a,n,o;(function(r,s){n=[],a=s,o="function"===typeof a?a.apply(t,n):a,void 0===o||(e.exports=o)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(h){var r,a,n,o=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,s=/@([^@]*):(\d+):(\d+)\s*$/gi,i=o.exec(h.stack)||s.exec(h.stack),l=i&&i[1]||!1,c=i&&i[2]||!1,d=document.location.href.replace(document.location.hash,""),p=document.getElementsByTagName("script");l===d&&(r=document.documentElement.outerHTML,a=new RegExp("(?:[^\\n]+?\\n){0,"+(c-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),n=r.replace(a,"$1").trim());for(var u=0;u<p.length;u++){if("interactive"===p[u].readyState)return p[u];if(p[u].src===l)return p[u];if(l===d&&p[u].innerHTML&&p[u].innerHTML.trim()===n)return p[u]}return null}}return e}))},fb15:function(e,t,r){"use strict";if(r.r(t),"undefined"!==typeof window){var a=window.document.currentScript,n=r("8875");a=n(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:n});var o=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(r.p=o[1])}var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("transition",{attrs:{name:"fade"}},[e.errors.length?r("div",{staticClass:"vue-loader"},e._l(e.errors,(function(t,a){return r("div",{staticClass:"alert alert-danger"},[e._v(" "+e._s(t)+" "),r("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.errors.splice(a,1)}}},[r("i",{staticClass:"icon-cancel-outline"})])])})),0):e._e()]),e.loading?r("div",{staticClass:"vue-loader-component"},[r("span",[e._v("Chargement")])]):e._e(),r("nav",{staticClass:"buttons"},[e.editable?r("a",{staticClass:"btn btn-primary",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.handlerWorkPackageNew.apply(null,arguments)}}},[e._v("Nouveau lot")]):e._e()]),r("section",{staticClass:"workpackages"},e._l(e.workpackages,(function(t){return r("workpackage",{key:t.id,attrs:{workpackage:t,persons:e.persons,editable:e.editable,"is-validateur":e.isValidateur},on:{addperson:e.addperson,workpackageupdate:e.handlerWorkPackageUpdate,workpackagepersonupdate:e.handlerUpdateWorkPackagePerson,workpackagepersondelete:e.handlerWorkPackagePersonDelete,workpackagedelete:e.handlerWorkPackageDelete,workpackagecancelnew:e.handlerWorkPackageCancelNew}})})),1)],1)},i=[],l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("article",{staticClass:"workpackage"},["edit"==e.mode?r("form",{attrs:{action:""},on:{submit:function(t){return t.preventDefault(),e.handlerUpdateWorkPackage.apply(null,arguments)}}},[r("h4",[e.workpackage.id>0?r("span",[e._v("Modification du lot")]):r("span",[e._v("Nouveau lot")]),e._v(" "+e._s(e.formData.label)+" ")]),r("div",{staticClass:"form-group"},[r("label",{attrs:{for:""}},[e._v("Code")]),e._m(0),r("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.code,expression:"formData.code"}],staticClass:"form-control",attrs:{type:"text",placeholder:"CODE"},domProps:{value:e.formData.code},on:{input:function(t){t.target.composing||e.$set(e.formData,"code",t.target.value)}}})]),r("div",{staticClass:"form-group"},[r("label",{attrs:{for:""}},[e._v("Intitulé")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.label,expression:"formData.label"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Intitulé"},domProps:{value:e.formData.label},on:{input:function(t){t.target.composing||e.$set(e.formData,"label",t.target.value)}}})]),r("div",{staticClass:"form-group"},[r("label",{attrs:{for:""}},[e._v("Description")]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.formData.description,expression:"formData.description"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Description"},domProps:{value:e.formData.description},on:{input:function(t){t.target.composing||e.$set(e.formData,"description",t.target.value)}}})]),r("nav",{staticClass:"buttons-bar"},[r("button",{staticClass:"btn btn-default btn-save",class:{disabled:!e.formData.code},attrs:{type:"submit"}},[r("i",{staticClass:"icon-floppy"}),e._v(" Enregistrer ")]),r("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:e.handlerCancelEdit}},[r("i",{staticClass:"icon-block"}),e._v(" Annuler ")])])]):e._e(),"read"==e.mode?r("div",[r("h3",[e._v("["+e._s(e.workpackage.code)+"] "+e._s(e.workpackage.label))]),r("p",[e._v(e._s(e.workpackage.description))]),r("section",{staticClass:"workpackage-persons"},[e._m(1),e._l(e.workpackage.persons,(function(t){return r("workpackageperson",{key:t.id,attrs:{person:t,editable:e.editable},on:{workpackagepersondelete:e.handlerDelete,workpackagepersonupdate:e.handlerUpdate}})}))],2),e.editable&&e.persons.length?r("div",{staticClass:"buttons"},[r("div",{staticClass:"btn-group"},[e._m(2),r("ul",{staticClass:"dropdown-menu"},e._l(e.persons,(function(t){return r("li",[r("a",{attrs:{href:"#"},on:{click:function(r){return r.preventDefault(),e.$emit("addperson",t.id,e.workpackage.id)}}},[e._v(e._s(t.displayname))])])})),0)]),r("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.handlerEditWorkPackage.apply(null,arguments)}}},[r("i",{staticClass:"icon-pencil"}),e._v("Modifier")]),r("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.handlerDeleteWorkPackage.apply(null,arguments)}}},[r("i",{staticClass:"icon-trash"}),e._v("Supprimer")])]):e._e(),e.persons.length<=0?r("div",{staticClass:"text-danger"},[e._v(" Vous n'avez pas encore ajouté de membre à cette activité. "),r("strong",[e._v("Seul les membres d'une activité peuvent être identifiés comme déclarant")]),e._v(". ")]):e._e()]):e._e()])},c=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("p",{staticClass:"text-danger"},[e._v("Le code est "),r("strong",[e._v("utilisé pour l'affichage des créneaux")]),e._v(" simplifiés, utilisez un code de préférence entre 3 et 5 caractères.")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("h4",[r("i",{staticClass:"icon-group"}),e._v(" Déclarants ")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"btn btn-default  btn-xs dropdown-toggle",attrs:{type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[e._v(" Ajouter un déclarant "),r("span",{staticClass:"caret"})])}],d=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("article",{staticClass:"workpackage-person"},[r("div",{staticClass:"displayname"},[r("strong",[e._v(e._s(e.person.person.displayname))]),e.editable&&"read"==e.mode?r("a",{staticClass:"link",attrs:{href:"#",title:"Supprimer ce déclarant"},on:{click:function(t){return t.preventDefault(),e.handlerRemove(e.person)}}},[r("i",{staticClass:"icon-trash"})]):e._e()]),r("div",{staticClass:"tempsdeclare temps"},[e.editable&&"edit"==e.mode?r("div",[e._v(" Heures prévues : "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.durationForm,expression:"durationForm"}],staticStyle:{width:"5em"},attrs:{type:"integer"},domProps:{value:e.durationForm},on:{keyup:function(t){return t.type.indexOf("key")||13===t.keyCode?e.handlerUpdate.apply(null,arguments):null},input:function(t){t.target.composing||(e.durationForm=t.target.value)}}}),r("a",{attrs:{href:"#",title:"Appliquer la modification des heures prévues"},on:{click:function(t){return t.preventDefault(),e.handlerUpdate.apply(null,arguments)}}},[r("i",{staticClass:"icon-floppy"})]),r("a",{attrs:{href:"#",title:"Annuler la modification des heures prévues"},on:{click:function(t){return t.preventDefault(),e.handlerCancel.apply(null,arguments)}}},[r("i",{staticClass:"icon-cancel-outline"})])]):r("span",[r("strong",{staticClass:"wp-hours"},[r("span",{staticClass:"wp-hour unsend",attrs:{title:"Heure(s) saisie(s)"}},[e._v(e._s(e._f("heures")(e.person.unsend)))]),r("span",{staticClass:"wp-hour validate",attrs:{title:"Heure(s) validée(s)"}},[e._v(e._s(e._f("heures")(e.person.validate)))]),e.person.validating>0?r("span",{staticClass:"wp-hour validating",attrs:{title:"Heure(s) en cours de validation"}},[e._v(e._s(e._f("heures")(e.person.validating)))]):e._e(),e.person.conflicts>0?r("span",{staticClass:"wp-hour conflicts",attrs:{title:"Heure(s) en conflit"}},[e._v(e._s(e._f("heures")(e.person.conflicts)))]):e._e(),r("span",{staticClass:"wp-hour duration",attrs:{title:"Heure(s) à valider"}},[e._v(" / "+e._s(e._f("heures")(e.person.duration))+" "),e.editable&&"read"==e.mode?r("a",{attrs:{href:"#",title:"Modifier les heures prévues"},on:{click:function(t){return t.preventDefault(),e.handlerEdit.apply(null,arguments)}}},[r("i",{staticClass:"icon-pencil"})]):e._e()])])])])])},p=[],u={props:{person:{default:function(){return{}}},editable:!1},computed:{duration(){return this.person.duration}},data(){return{canSave:!1,mode:"read",durationForm:666}},methods:{handlerKeyUp(){console.log(arguments)},handlerUpdate(){this.$emit("workpackagepersonupdate",this.person,this.durationForm),this.mode="read"},handlerEdit(){this.mode="edit",this.durationForm=this.person.duration},handlerCancel(){this.mode="read",this.durationForm=this.person.duration},handlerRemove(){this.$emit("workpackagepersondelete",this.person)}}},h=u;function f(e,t,r,a,n,o,s,i){var l,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=r,c._compiled=!0),a&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),s?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},c._ssrRegister=l):n&&(l=i?function(){n.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(e,t){return l.call(t),d(e,t)}}else{var p=c.beforeCreate;c.beforeCreate=p?[].concat(p,l):[l]}return{exports:e,options:c}}var m=f(h,d,p,!1,null,null,null),k=m.exports,v={components:{workpackageperson:k},data(){return{mode:"read",canSave:!1,formData:{id:-1,code:"",label:"",description:""}}},created(){console.log("created",this.workpackage.id),this.workpackage.id<0&&(this.mode="edit")},props:{workpackage:null,persons:{default:function(){return[]}},editable:!1,isValidateur:!1},watch:{"person.duration":function(){console.log("Modification de la durée")}},methods:{handlerEditWorkPackage(){this.formData=JSON.parse(JSON.stringify(this.workpackage)),this.mode="edit"},handlerCancelEdit(){this.workpackage.id<0?this.$emit("workpackagecancelnew",this.workpackage):this.mode="read"},handlerDeleteWorkPackage(){this.$emit("workpackagedelete",this.workpackage)},handlerUpdateWorkPackage(e){if(!this.formData.code)return e.stopPropagation(),e.stopImmediatePropagation(),!1;this.$emit("workpackageupdate",this.formData),this.mode="read"},handlerUpdate(e,t){this.$emit("workpackagepersonupdate",e,t)},handlerDelete(e){this.$emit("workpackagepersondelete",e)},roles(e){return e.roles.join(",")},tempsPrevu(e){return 0},tempsDeclare(e){return 0}}},g=v,_=f(g,l,c,!1,null,null,null),b=_.exports,w={components:{workpackage:b},data(){return{loading:!1,errors:[],workpackages:[],persons:[],editable:!1,isDeclarant:!1,isValidateur:!1,token:"DEFAULT_TKN"}},props:{url:{required:!0},token:{required:!0},isValidateur:{required:!0},editable:{required:!0},Bootbox:{required:!0}},watch:{},computed:{},created(){this.fetch()},methods:{handlerWorkPackageCancelNew(e){this.workpackages.splice(this.workpackages.indexOf(e),1)},handlerWorkPackageNew(){this.workpackages.push({id:-1,code:"Nouveau Lot",label:"",persons:[],description:""})},handlerWorkPackagePersonDelete(e){this.Bootbox.confirm("Supprimer le déclarant ? ",t=>{t&&this.$http.delete(this.url+"?workpackagepersonid="+e.id).then(e=>{this.fetch()},e=>{this.errors.push("Impossible de supprimer le déclarant : "+e.body)})})},handlerWorkPackageDelete(e){this.Bootbox.confirm("Souhaitez-vous supprimer ce lot ?",t=>{t&&this.$http.delete(this.url+"?workpackageid="+e.id).then(e=>{this.fetch()},e=>{this.errors.push("Impossible de supprimer le lot : "+e.body)})})},handlerWorkPackageUpdate(e){var t=new FormData;for(var r in e)t.append(r,e[r]);e.id>0?(console.log("MAJ du LOT"),t.append("workpackageid",e.id),this.$http.post(this.url,t).then(e=>{this.fetch()},e=>{this.errors.push("Impossible de mettre à jour le lot de travail : "+e.body)})):(console.log("NOUVEAU du LOT"),t.append("workpackageid",-1),this.$http.put(this.url,t).then(e=>{this.fetch()},e=>{this.errors.push("Impossible de créer le lot de travail : "+e.body)}).then(e=>this.fetch()))},handlerUpdateWorkPackagePerson(e,t){var r=new FormData;r.append("workpackagepersonid",e.id),r.append("duration",t),this.$http.post(this.url,r).then(r=>{e.duration=t},e=>{this.errors.push("Impossible de mettre à jour les heures prévues : "+e.body)})},addperson(e,t){console.log(arguments);var r=new FormData;r.append("idworkpackage",t),r.append("idperson",e),this.$http.put(this.url,r).then(e=>{this.fetch()},e=>{this.errors.push("Impossible d'ajouter le déclarant : "+e.body)}).then(()=>this.loading=!1)},fetch(){this.loading=!0,console.log(this.url),this.$http.get(this.url).then(e=>{this.workpackages=e.body.workpackages,this.persons=e.body.persons,this.editable=e.body.editable,this.isDeclarant=e.body.isDeclarant,this.isValidateur=e.body.isValidateur},e=>{this.errors.push("Impossible de charger les lots de travail : "+e.body)}).then(()=>this.loading=!1)}}},y=w,C=f(y,s,i,!1,null,null,null),D=C.exports;t["default"]=D}})["default"]}));
//# sourceMappingURL=WorkpackageUI.umd.min.js.map