(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TimesheetDeclarationsList=t():e.TimesheetDeclarationsList=t()})("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(a[i])return a[i].exports;var n=a[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,i){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t){e.exports=function(e,t,a,i,n,s){var o,l=e=e||{},r=typeof e.default;"object"!==r&&"function"!==r||(o=e,l=e.default);var d="function"==typeof l?l.options:l;t&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0),a&&(d.functional=!0),n&&(d._scopeId=n);var c;if(s?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=c):i&&(c=i),c){var u=d.functional,v=u?d.render:d.beforeCreate;u?(d._injectStyles=c,d.render=function(e,t){return c.call(t),v(e,t)}):d.beforeCreate=v?[].concat(v,c):[c]}return{esModule:o,exports:l,options:d}}},function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(5),s=i(n),o=a(6),l=i(o);t.default={name:"TimesheetDeclarationsList",props:{moment:{required:!0},bootbox:{required:!0},urlapi:{default:null},editable:{default:!1}},components:{personautocompleter:l.default},data:function(){return{loading:null,declarations:[],error:null,selectedValidation:null,create:!1,addedPerson:null}},filters:{},methods:{handlerAdd:function(e){console.log("Type:",e),this.create=e},handlerAddPerson:function(e){console.log("ajout",e),this.addedPerson=e},handlerDelete:function(e,t){var a=this;this.loading="Suppression du validateur";var i=new FormData;i.append("person_id",t.id),i.append("declaration_id",this.selectedValidation.id),i.append("action","delete"),i.append("type",e),this.$http.post("",i).then(function(i){switch(e){case"prj":a.selectedValidation.validateursPrj.splice(a.selectedValidation.validateursPrj.indexOf(t,1));break;case"sci":a.selectedValidation.validateursSci.splice(a.selectedValidation.validateursSci.indexOf(t,1));break;case"adm":a.selectedValidation.validateursAdm.splice(a.selectedValidation.validateursAdm.indexOf(t,1))}},function(e){a.error=s.default.resolve("Impossible de supprimer ce validateur",e)}).then(function(e){a.addedPerson=null,a.create=null,a.loading=!1})},handlerConfirmAdd:function(e,t){var a=this;this.loading="Ajout du validateur";var i=new FormData;i.append("person_id",t),i.append("declaration_id",this.selectedValidation.id),i.append("type",e),this.$http.post("",i).then(function(t){switch(e){case"prj":a.selectedValidation.validateursPrj.push(t.body);break;case"sci":a.selectedValidation.validateursSci.push(t.body);break;case"adm":a.selectedValidation.validateursAdm.push(t.body)}},function(e){a.error=s.default.resolve("Impossible d'ajouter le validateur",e)}).then(function(e){a.addedPerson=null,a.create=null,a.loading=!1})},fetch:function(){var e=this;!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading="Chargement des données",this.$http.get("").then(function(t){for(var a in t.body)t.body[a].open=!1;e.declarations=t.body},function(t){e.error=s.default.resolve("Impossible de charger les données",t)}).then(function(t){e.loading=!1})},handlerCancelDeclaration:function(e){var t=this;console.log(e),this.bootbox.confirm("Supprimer la déclaration (le déclarant devra réenvoyer la déclaration) ?",function(a){a&&(t.loading="Suppression de la déclaration",t.$http.delete("?person_id="+e.person_id+"&period="+e.period).then(function(e){t.fetch()},function(e){t.error=s.default.resolve("Impossible de charger les données",e)}).then(function(e){t.loading=!1}))})}},mounted:function(){this.fetch(!0)}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(7),n=function(e){return e&&e.__esModule?e:{default:e}}(i);t.default={data:function(){return{url:"/person?q=",persons:[],expression:"",loading:!1,selectedPerson:null,showSelector:!0}},watch:{expression:function(e,t){e.length>=2&&this.search()}},methods:{search:function(){var e=this;this.loading=!0,this.$http.get(this.url+this.expression).then(function(t){e.persons=t.body.datas,e.showSelector=!0},function(e){n.default.message("Erreur de recherche sur la personne","error")}).then(function(t){return e.loading=!1})},handlerSelectPerson:function(e){this.selectedPerson=e,this.showSelector=!1,this.$emit("change",e)}}}},function(e,t,a){e.exports=a(4)},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(1),n=a.n(i);for(var s in i)"default"!==s&&function(e){a.d(t,e,function(){return i[e]})}(s);var o=a(9),l=a(0),r=l(n.a,o.a,!1,null,null,null);t.default=r.exports},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={resolve:function(e,t){var a="Erreur inconnue";return t&&(a=t.body,403==t.status&&(a="Vous avez été déconnectez de l'application")),e+" (Réponse : "+a+")"}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),n=a.n(i);for(var s in i)"default"!==s&&function(e){a.d(t,e,function(){return i[e]})}(s);var o=a(8),l=a(0),r=l(n.a,o.a,!1,null,null,null);t.default=r.exports},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[],n={id:"BUS"+Math.random(),name:"!OscarBus!",messages:i,message:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"notice";i.push({key:(new Date).getTime(),msg:e,date:new Date,type:t,read:!1})},errors:function(){},unreadErrors:function(){for(var e=[],t=0;t<i.length;t++)i[t].read||e.push(i[t]);return e}};t.default=n},function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("input",{directives:[{name:"model",rawName:"v-model",value:e.expression,expression:"expression"}],attrs:{type:"text"},domProps:{value:e.expression},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?(t.preventDefault(),e.search(t)):null},input:function(t){t.target.composing||(e.expression=t.target.value)}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}]},[a("i",{staticClass:"icon-spinner animate-spin"})]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.persons.length>0&&e.showSelector,expression:"persons.length > 0 && showSelector"}],staticClass:"choose",staticStyle:{position:"absolute","z-index":"3000"}},e._l(e.persons,function(t){return a("div",{key:t.id,staticClass:"choice",on:{click:function(a){a.preventDefault(),a.stopPropagation(),e.handlerSelectPerson(t)}}},[a("img",{attrs:{src:"https://www.gravatar.com/avatar/"+t.mailMd5+"?s=50",alt:t.isplayname}}),e._v(" "),a("div",{staticClass:"infos"},[a("strong",[e._v(e._s(t.displayname))]),a("br"),e._v(" "),a("small",[e._v(e._s(t.affectation))])])])}))])},n=[],s={render:i,staticRenderFns:n};t.a=s},function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"validations-admin"},[a("transition",{attrs:{name:"fade"}},[e.loading?a("div",{staticClass:"pending overlay"},[a("div",{staticClass:"overlay-content"},[a("i",{staticClass:"icon-spinner animate-spin"}),e._v("\n                "+e._s(e.loading)+"\n            ")])]):e._e()]),e._v(" "),a("transition",{attrs:{name:"fade"}},[e.error?a("div",{staticClass:"pending overlay"},[a("div",{staticClass:"overlay-content"},[a("i",{staticClass:"icon-attention-1"}),e._v("\n                "+e._s(e.error)+"\n            ")])]):e._e()]),e._v(" "),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.create,expression:"create"}],staticClass:"overlay"},[a("div",{staticClass:"overlay-content",staticStyle:{"overflow-y":"visible"}},[a("span",{staticClass:"overlay-closer",on:{click:function(t){e.create=null}}},[e._v("X")]),e._v("\n                Choisissez une personne à ajouter :\n                "),a("personautocompleter",{on:{change:e.handlerAddPerson}}),e._v(" "),a("button",{staticClass:"btn btn-primary",class:{disabled:null==e.addedPerson},on:{click:function(t){e.handlerConfirmAdd(e.create,e.addedPerson.id)}}},[null!=e.addedPerson?a("span",[e._v("Ajouter "),a("strong",[e._v(e._s(e.addedPerson.displayname))]),e._v(" comme validateur")]):a("span",[e._v("Selectionner une personne")])])],1)])]),e._v(" "),a("h1",[e._v("Liste des déclarations")]),e._v(" "),a("div",{staticClass:"row"},[a("section",{staticClass:"col-md-8"},e._l(e.declarations,function(t,i){return a("section",{staticClass:"card declaration",on:{click:function(e){t.open=!t.open}}},[a("span",{staticClass:"opener"},[t.open?a("i",{staticClass:"icon-angle-down"}):a("i",{staticClass:"icon-angle-right"})]),e._v(" "),a("strong",[e._v(e._s(t.person))]),e._v(" "),a("time",[e._v(e._s(e._f("period")(t.period)))]),e._v(" "),a("span",{staticClass:"validations-icon"},e._l(t.declarations,function(e){return a("i",{staticClass:"icon",class:"icon-"+e.status,attrs:{title:e.label}})})),e._v(" "),a("nav",[a("a",{staticClass:"btn btn-danger btn-xs",attrs:{href:"#"},on:{click:function(a){a.preventDefault(),a.stopPropagation(),e.handlerCancelDeclaration(t)}}},[a("i",{staticClass:"icon-trash"}),e._v("Annuler cette déclaration")])]),e._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"line.open"}],staticClass:"validations text-small"},e._l(t.declarations,function(t){return a("article",{staticClass:"validation",class:{selected:e.selectedValidation==t},on:{click:function(a){a.preventDefault(),a.stopPropagation(),e.selectedValidation=t}}},[a("span",[a("i",{class:"activity"==t.object?"icon-cube":"icon-tag"}),e._v(" "),a("strong",[e._v(e._s(t.label))])]),e._v(" "),"activity"==t.object?a("span",[t.validation.validationactivity_by?a("span",{staticClass:"cartouche green",attrs:{title:"Validation projet"}},[a("i",{staticClass:"icon-cube"}),e._v(e._s(t.validation.validationactivity_by)+"\n                            ")]):a("span",{directives:[{name:"else",rawName:"v-else"}],staticClass:"validators"},[a("i",{staticClass:"icon-cube"}),e._v(" "),e._l(t.validateursPrj,function(t){return a("span",[e._v(e._s(t.person))])})],2)]):a("span",[e._v("~")]),e._v(" "),"activity"==t.object?a("span",[t.validation.validationsci_by?a("span",{staticClass:"cartouche green",attrs:{title:"Validation scientifique"}},[a("i",{staticClass:"icon-beaker"}),e._v(e._s(t.validation.validationsci_by)+"\n                            ")]):a("span",{staticClass:"validators"},[a("i",{staticClass:"icon-beaker"}),e._v(" "),e._l(t.validateursSci,function(t){return a("span",[e._v(e._s(t.person))])})],2)]):a("span",[e._v("~")]),e._v(" "),a("span",[t.validation.validationadm_by?a("span",{staticClass:"cartouche green",attrs:{title:"Validation administrative"}},[a("i",{staticClass:"icon-book"}),e._v(e._s(t.validation.validationadm_by)+"\n                            ")]):a("span",{staticClass:"validators"},[a("i",{staticClass:"icon-book"}),e._v(" "),e._l(t.validateursAdm,function(t){return a("span",[e._v(e._s(t.person))])})],2)]),e._v(" "),a("em",[a("i",{class:"icon-"+t.status})])])}))])})),e._v(" "),a("section",{staticClass:"col-md-4"},[e.selectedValidation?a("div",{staticClass:"validation-details"},[a("h3",[a("small",[e._v("Validation pour les créneaux")]),a("br"),e._v(" "),"activity"==e.selectedValidation.object?a("strong",[a("i",{staticClass:"icon-cube"}),e._v(" "+e._s(e.selectedValidation.label)+"\n                    ")]):a("strong",[a("i",{class:"icon-"+e.selectedValidation.object}),e._v(" "+e._s(e.selectedValidation.label)+"\n                    ")]),a("br"),e._v(" "),a("small",[e._v("\n                        de "),a("strong",[e._v(e._s(e.selectedValidation.person))]),e._v("\n                        en "),a("strong",[e._v(e._s(e._f("period")(e.selectedValidation.period)))])])]),e._v(" "),"activity"==e.selectedValidation.object?a("div",[e.selectedValidation.validation.validationactivity_by?a("div",{staticClass:"card valid"},[a("i",{staticClass:"icon-ok-circled"}),e._v("\n                        Validation projet par "),a("strong",[a("i",{staticClass:"icon-user"}),e._v(e._s(e.selectedValidation.validation.validationactivity_by))]),e._v(" le\n                        "),a("time",[e._v(e._s(e._f("humandate")(e.selectedValidation.validation.validationactivity_at)))])]):e.selectedValidation.validation.rejectactivity_by?a("div",{staticClass:"card reject"},[a("i",{staticClass:"icon-attention-circled"}),e._v("\n                        Rejet des créneaux par "),a("strong",[a("i",{staticClass:"icon-user"}),e._v(e._s(e.selectedValidation.validation.rejectactivity_by))]),e._v(" le\n                        "),a("time",[e._v(e._s(e._f("humandate")(e.selectedValidation.validation.rejectactivity_at)))]),e._v(" :\n                        "),a("pre",[e._v(e._s(e.selectedValidation.validation.rejectactivity_message))])]):a("div",{staticClass:"card waiting"},[a("strong",[e._v("Validation projet en attente")]),e._v("\n                        par l'un des validateurs suivant :\n                        "),a("ul",e._l(e.selectedValidation.validateursPrj,function(t){return a("li",[a("i",{staticClass:"icon-user"}),e._v(e._s(t.person)+"\n                                "),a("a",{staticClass:"link",on:{click:function(a){a.preventDefault(),a.stopPropagation(),e.handlerDelete("prj",t)}}},[a("i",{staticClass:"icon-trash"}),e._v(" Supprimer")])])})),e._v(" "),a("a",{staticClass:"btn btn-xs btn-primary",on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.handlerAdd("prj")}}},[e._v("Ajouter un validateur")])]),e._v(" "),e.selectedValidation.validation.validationsci_by?a("div",{staticClass:"card valid"},[e._v("\n                        Validation scientifique par "),a("strong",[a("i",{staticClass:"icon-user"}),e._v(e._s(e.selectedValidation.validation.validationsci_by))]),e._v(" le\n                        "),a("time",[e._v(e._s(e._f("humandate")(e.selectedValidation.validation.validationsci_at)))])]):e.selectedValidation.validation.rejectsci_by?a("div",{staticClass:"card reject"},[a("i",{staticClass:"icon-attention-circled"}),e._v("\n                        Rejet scientifique des créneaux par "),a("strong",[a("i",{staticClass:"icon-user"}),e._v(e._s(e.selectedValidation.validation.rejectsci_by))]),e._v(" le\n                        "),a("time",[e._v(e._s(e._f("humandate")(e.selectedValidation.validation.rejectsci_at)))]),e._v(" "),a("pre",[e._v(e._s(e.selectedValidation.validation.rejectsci_message))])]):a("div",{staticClass:"card waiting"},[a("strong",[e._v("Validation scientifique en attente")]),e._v("\n                        par l'un des validateurs suivant :\n                        "),a("ul",e._l(e.selectedValidation.validateursSci,function(t){return a("li",[a("i",{staticClass:"icon-user"}),e._v(e._s(t.person)+"\n                                "),a("a",{staticClass:"link",on:{click:function(a){a.preventDefault(),a.stopPropagation(),e.handlerDelete("sci",t)}}},[a("i",{staticClass:"icon-trash"}),e._v(" Supprimer")])])})),e._v(" "),a("a",{staticClass:"btn btn-xs btn-primary",on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.handlerAdd("sci")}}},[e._v("Ajouter un validateur")])])]):e._e(),e._v(" "),e.selectedValidation.validation.validationadm_by?a("div",{staticClass:"card valid"},[e._v("\n                    Validation administrative par "),a("strong",[a("i",{staticClass:"icon-user"}),e._v(e._s(e.selectedValidation.validation.validationadm_by))]),e._v(" le\n                    "),a("time",[e._v(e._s(e._f("humandate")(e.selectedValidation.validation.validationadm_at)))])]):e.selectedValidation.validation.rejectadm_by?a("div",{staticClass:"card reject"},[a("i",{staticClass:"icon-attention-circled"}),e._v("\n                    Rejet administrative des créneaux par "),a("strong",[a("i",{staticClass:"icon-user"}),e._v(e._s(e.selectedValidation.validation.rejectadm_by))]),e._v(" le\n                    "),a("time",[e._v(e._s(e._f("humandate")(e.selectedValidation.validation.rejectadm_at)))]),e._v(" "),a("pre",[e._v(e._s(e.selectedValidation.validation.validationadm_message))])]):a("div",{staticClass:"card waiting"},[a("strong",[e._v("Validation administrative en attente")]),e._v("\n                    par l'un des validateurs suivant :\n                    "),a("ul",e._l(e.selectedValidation.validateursAdm,function(t){return a("li",[a("i",{staticClass:"icon-user"}),e._v(e._s(t.person)+"\n                            "),a("a",{staticClass:"link",on:{click:function(a){a.preventDefault(),a.stopPropagation(),e.handlerDelete("adm",t)}}},[a("i",{staticClass:"icon-trash"}),e._v(" Supprimer")])])})),e._v(" "),a("a",{staticClass:"btn btn-xs btn-primary",on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.handlerAdd("adm")}}},[e._v("Ajouter un validateur")])]),e._v(" "),a("pre",[e._v(e._s(e.selectedValidation))])]):e._e()])])],1)},n=[],s={render:i,staticRenderFns:n};t.a=s}])});
//# sourceMappingURL=TimesheetDeclarationsList.js.map