(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["ActivityRequest"]=e():t["ActivityRequest"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function a(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(s,n,function(e){return t[e]}.bind(null,n));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s="fb15")}({fb15:function(t,e,a){"use strict";if(a.r(e),"undefined"!==typeof window){var s=window.document.currentScript,n=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(a.p=n[1])}var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"alert alert-info"},[t._v(t._s(t.loading))]),a("transition",{attrs:{name:"fade"}},[t.formData?a("div",{staticClass:"overlay",staticStyle:{"overflow-y":"scroll",padding:"1em"}},[a("form",{staticStyle:{"min-width":"75vw","max-width":"80%","padding-top":"2em"},attrs:{action:"?",enctype:"multipart/form-data",method:"post",name:"save"},on:{submit:function(e){return e.preventDefault(),t.handlerSave(e)}}},[t.formData.id?a("h1",[t._v("Modification de la demande")]):a("h1",[t._v("Nouvelle demande")]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-6"},[a("strong",[t._v("Demandeur : ")]),a("br"),a("span",{staticClass:"cartouche"},[t._v(" "+t._s(t.demandeur)+" "),a("span",{staticClass:"addon"},[t._v("Demandeur")])])]),a("div",{staticClass:"col-md-6"},[a("strong",[t._v("Organisme référent : ")]),a("br"),0==t.organisations.length?a("p",{staticClass:"alert alert-info"},[t._v(" Vous n'êtes associé à aucun organisme. ")]):a("select",{staticClass:"form-control",attrs:{name:"organisation_id"}},t._l(t.organisations,(function(e,s){return a("option",{domProps:{value:s}},[t._v(t._s(e))])})),0)])]),a("hr",{staticClass:"separator"}),a("div",[a("label",{attrs:{for:"form_label"}},[t._v("Intitulé")]),t.formData.id?a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.id,expression:"formData.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:t.formData.id},on:{input:function(e){e.target.composing||t.$set(t.formData,"id",e.target.value)}}}):t._e(),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.label,expression:"formData.label"}],staticClass:"form-control input-lg",attrs:{type:"text",id:"form_label",name:"label"},domProps:{value:t.formData.label},on:{input:function(e){e.target.composing||t.$set(t.formData,"label",e.target.value)}}})]),a("hr",{staticClass:"separator"}),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-4"},[a("strong",[t._v("Début prévu")]),a("p",{staticClass:"help"},[t._v("Vous pouvez laisser ce champ vide.")]),a("datepicker",{attrs:{moment:t.moment,value:t.formData.dateStart},on:{change:function(e){t.formData.dateStart=e}}})],1),a("div",{staticClass:"col-md-4"},[a("strong",[t._v("Fin prévue")]),a("p",{staticClass:"help"},[t._v("Vous pouvez laisser ce champ vide.")]),a("datepicker",{attrs:{moment:t.moment,value:t.formData.dateEnd},on:{change:function(e){t.formData.dateEnd=e}}})],1),a("div",{staticClass:"col-md-4"},[a("label",{attrs:{for:"form_amount"}},[t._v("Montant souhaité")]),a("p",{staticClass:"help"},[t._v("Vous pouvez laisser ce champ vide.")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.amount,expression:"formData.amount"}],staticClass:"form-control",attrs:{type:"text",name:"amount",id:"form_amount"},domProps:{value:t.formData.amount},on:{input:function(e){e.target.composing||t.$set(t.formData,"amount",e.target.value)}}})])]),a("hr",{staticClass:"separator"}),a("div",[a("label",{attrs:{for:"form_description"}},[t._v("Description")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.description,expression:"formData.description"}],staticClass:"form-control",attrs:{type:"text",id:"form_description",name:"description"},domProps:{value:t.formData.description},on:{input:function(e){e.target.composing||t.$set(t.formData,"description",e.target.value)}}})]),a("hr",{staticClass:"separator"}),a("div",[a("label",{attrs:{for:"form_files"}},[t._v("Fichiers à ajouter")]),a("p",{staticClass:"help"},[t._v("Vous pouvez sélectionner plusieurs fichiers en maintenant la touche CTRL enfoncé lors de la sélection d'un fichier")]),a("input",{attrs:{type:"file",name:"files[]",id:"form_files",multiple:""}})]),a("div",{staticClass:"alert alert-info"},[t._v(" Vous pourrez modifier votre saisie, et finaliser la demande en cliquant sur l'action "),a("strong",[t._v("Envoyer la demande")])]),a("hr"),a("nav",{staticClass:"text-center"},[a("button",{staticClass:"btn btn-default",attrs:{type:"reset"},on:{click:function(e){return e.preventDefault(),t.handlerCancelForm.apply(null,arguments)}}},[a("i",{staticClass:"icon-cancel-outline"}),t._v(" Annuler ")]),a("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[a("i",{staticClass:"icon-floppy"}),t._v(" Enregistrer ")])])])]):t._e()]),a("transition",{attrs:{name:"fade"}},[t.error?a("div",{staticClass:"overlay"},[a("div",{staticClass:"alert alert-danger"},[a("h3",[t._v("Erreur "),a("a",{staticClass:"float-right",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.error=null}}},[a("i",{staticClass:"icon-cancel-outline"})])]),a("p",[t._v(t._s(t.error))])])]):t._e()]),a("transition",{attrs:{name:"fade"}},[t.deleteData?a("div",{staticClass:"overlay"},[a("div",{staticClass:"alert alert-danger"},[a("h3",[t._v("Supprimer la demande "),a("strong",[t._v(t._s(t.deleteData.label))]),t._v(" ?")]),a("nav",[a("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(e){e.preventDefault(),t.deleteData=null}}},[a("i",{staticClass:"icon-cancel-outline"}),t._v(" Annuler ")]),a("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.performDelete.apply(null,arguments)}}},[a("i",{staticClass:"icon-ok-circled"}),t._v(" Confirmer ")])])])]):t._e()]),a("transition",{attrs:{name:"fade"}},[t.sendData?a("div",{staticClass:"overlay"},[a("div",{staticClass:"alert"},[a("h3",[t._v("Envoyer la demande "),a("strong",[t._v(t._s(t.sendData.label))]),t._v(" ?")]),a("nav",[a("button",{staticClass:"btn btn-danger",attrs:{type:"reset"},on:{click:function(e){e.preventDefault(),t.sendData=null}}},[a("i",{staticClass:"icon-cancel-outline"}),t._v(" Annuler ")]),a("button",{staticClass:"btn btn-success",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.performSend.apply(null,arguments)}}},[a("i",{staticClass:"icon-ok-circled"}),t._v(" Confirmer ")])])])]):t._e()]),a("header",{staticClass:"row"},[a("h1",{staticClass:"col-md-9"},[t._v(t._s(t.title))]),a("nav",{staticClass:"col-md-3"},[t._v("   État des demandes affichées : "),a("jckselector",{attrs:{choose:t.listStatus,selected:t.selectedStatus},on:{change:function(e){t.selectedStatus=e}}})],1)]),t.activityRequests.length?a("section",t._l(t.activityRequests,(function(e){return a("article",{staticClass:"demande card",class:"status-"+e.statut},[a("h3",{staticClass:"card-title"},[a("strong",[a("i",{class:"icon-"+e.statutText}),t._v(" "+t._s(e.label)+" ")]),a("strong",[a("i",{staticClass:"icon-bank"}),t._v(" "+t._s(e.amount)+" ")])]),a("div",{staticClass:"card-metas text-highlight"},[a("strong",[a("i",{class:"icon-"+e.statut}),t._v(t._s(t._f("renderStatus")(e.statut)))]),t._v(" Créé le : "),a("time",[a("i",{staticClass:"icon-calendar"}),t._v(t._s(t._f("date")(e.dateCreated)))]),t._v(" ~ "),e.worker?a("span",[t._v(" Demande géré par "),a("strong",[t._v(t._s(e.worker))])]):a("em",[t._v(" Non prise en charge pour le moment ")]),t._v(" ~ "),a("strong",[a("i",{staticClass:"icon-building-filled"}),e.organisation?a("span",[t._v(t._s(e.organisation))]):a("em",[t._v("Aucune organisation")])])]),a("hr"),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-6"},[t._m(0,!0),a("ul",[a("li",[a("i",{staticClass:"icon-bank"}),t._v(" Somme demandée : "),a("strong",[t._v(t._s(t._f("montant")(e.amount)))])]),a("li",[a("i",{staticClass:"icon-calendar"}),t._v(" Début (prévu) : "),e.dateStart?a("strong",[t._v(t._s(t._f("date")(e.dateStart)))]):a("em",[t._v("pas de date de début prévue")])]),a("li",[a("i",{staticClass:"icon-calendar"}),t._v(" Fin (prévue) : "),e.dateEnd?a("strong",[t._v(t._s(t._f("date")(e.dateEnd)))]):a("em",[t._v("pas de date de fin prévue")])])]),a("div",{staticClass:"alert alert-help"},[a("strong",[t._v("Description")]),t._v(" : "+t._s(e.description)+" ")]),a("section",{staticClass:"fichiers"},[t._m(1,!0),0==e.files.length?a("div",{staticClass:"alert alert-info"},[t._v(" Vous n'avez fourni aucun document pour cette demande ")]):a("ul",t._l(e.files,(function(s){return a("li",[a("strong",[t._v(t._s(s.name))]),a("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"?dl="+s.file+"&id="+e.id}},[a("i",{staticClass:"icon-download"}),t._v(" Télécharger")]),e.sendable?a("a",{staticClass:"btn btn-default btn-xs",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerDeleteFile(s,e)}}},[a("i",{staticClass:"icon-trash"}),t._v(" Supprimer ce fichier")]):t._e()])})),0)])]),a("div",{staticClass:"col-md-6"},[a("section",[t._m(2,!0),t._l(e.suivi,(function(e){return a("article",{staticClass:"follow"},[a("figure",{staticClass:"avatar"},[a("img",{attrs:{src:"//www.gravatar.com/avatar/"+e.by.gravatar+"?s=64",alt:""}})]),a("div",{staticClass:"content"},[a("small",{staticClass:"infos"},[a("i",{staticClass:"icon-clock"}),t._v(" "+t._s(t._f("date")(e.datecreated))+" par "),a("strong",[a("i",{staticClass:"icon-user"}),t._v(" "+t._s(e.by.username))])]),a("br"),a("p",[t._v(t._s(e.description))])])])}))],2)])]),e.sendable?a("nav",[a("a",{staticClass:"btn btn-default",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerEdit(e)}}},[a("i",{staticClass:"icon-edit"}),t._v(" Modifier")]),a("a",{staticClass:"btn btn-danger",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerDelete(e)}}},[a("i",{staticClass:"icon-trash"}),t._v(" Supprimer")]),a("a",{staticClass:"btn btn-success",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),a.stopPropagation(),t.handlerSend(e)}}},[a("i",{staticClass:"icon-paper-plane"}),t._v(" Envoyer")])]):t._e()])})),0):a("div",[a("p",{staticClass:"alert alert-info"},[t._v(" Aucune demande ")])]),a("hr"),t.allowNew?a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.handlerNew.apply(null,arguments)}}},[a("i",{staticClass:"icon-plus-circled"}),t._v(" Nouvelle Demande ")]):t._e(),t.lockMessages.length?a("div",{staticClass:"alert alert-danger"},[a("ul",t._l(t.lockMessages,(function(e){return a("li",[t._v(t._s(e))])})),0)]):t._e()],1)},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:" icon-edit"}),t._v(" Informations")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:"icon-attach-outline"}),t._v(" Fichiers")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",[a("i",{staticClass:"icon-signal"}),t._v(" Suivi")])}],l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"jck-selector"},[a("div",{staticClass:"selected"},[a("i",{staticClass:"icon-cog"}),a("strong",[t._v(t._s(t.selectedLabel))])]),a("div",{staticClass:"list"},t._l(t.choose,(function(e){return a("div",{staticClass:"item",class:{selected:t.selected.indexOf(e.id)>-1},on:{click:function(a){return t.toggleSelection(e.id)}}},[a("i",{staticClass:"icon-check"}),a("i",{staticClass:"icon-check-empty"}),t._v(" "+t._s(e.label)+" "),a("small",[t._v(" ("+t._s(e.description)+")")])])})),0)])},o=[],c={props:{choose:{default:null},selected:{default:null}},computed:{selectedLabel(){if(this.selected.length){let t=[];return this.choose.forEach(e=>{this.selected.indexOf(e.id)>-1&&t.push(e.label)}),t.join(", ")}return"Aucune selection"}},methods:{toggleSelection(t){let e=[];this.selected&&(e=this.selected);let a=e.indexOf(t);a>-1?e.splice(a,1):e.push(t),console.log(e),this.$emit("change",e)}}},d=c;function u(t,e,a,s,n,i,r,l){var o,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=a,c._compiled=!0),s&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),r?(o=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},c._ssrRegister=o):n&&(o=l?function(){n.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:n),o)if(c.functional){c._injectStyles=o;var d=c.render;c.render=function(t,e){return o.call(e),d(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,o):[o]}return{exports:t,options:c}}var f=u(d,l,o,!1,null,null,null),m=f.exports,p={data(){return{formData:null,addFile:!1,sendData:null,addableFiles:null,file:null,loading:"",activityRequests:[],error:null,deleteData:null,allowNew:!1,demandeur:"",demandeur_id:null,organisations:[],lockMessages:[],selectedStatus:[1,2]}},props:{moment:{required:!0},title:{required:!0}},watch:{selectedStatus(){this.fetch()}},computed:{listStatus(){let t=[{id:1,label:"Brouillon",description:"Demandes en cours de rédaction (non envoyées)"},{id:2,label:"Envoyée",description:"Demandes envoyées mais pas encore traitées"},{id:5,label:"Validée",description:"Demandes validées"},{id:7,label:"Refusée",description:"Demandes refusées"}];return t}},components:{jckselector:m},methods:{processFile(t){this.addableFiles=t.target.files[0].name},handlerAddFile(){this.addFile=!0},fetch(){this.loading="Chargement des Demandes",this.$http.get("?&status="+this.selectedStatus.join(",")).then(t=>{this.activityRequests=t.body.activityRequests,this.allowNew=t.body.allowNew,this.demandeur=t.body.demandeur,this.demandeur_id=t.body.demandeur_id,this.organisations=t.body.organisations,this.lockMessages=t.body.lockMessages},t=>{this.error="Impossible de charger les demandes : "+t.body}).then(t=>{this.loading=null})},sendFile(t,e){let a=new FormData(e.target);this.$http.post("?",a).then(t=>{}).catch(t=>{})},handlerSend(t){this.sendData=t},performSend(){let t=this.sendData,e=new FormData;e.append("action","send"),e.append("id",t.id),this.$http.post("?",e).then(t=>{this.fetch()}).catch(t=>{this.error=t.body}).then(t=>{this.sendData=null})},handlerNew(){this.formData={id:null,label:"",description:"",dateStart:null,dateEnd:null,amount:0,organization:this.organisations[0],files:[]}},handlerEdit(t){this.formData={id:t.id,label:t.label,description:t.description,dateStart:t.dateStart,dateEnd:t.dateEnd,amount:t.amount,organization:t.organization,files:t.files}},handlerDeleteFile(t,e){this.loading="Suppression du fichier "+t.name,this.$http.get("?rdl="+t.file+"&id="+e.id).then(t=>{this.fetch()}).catch(t=>{this.error=t.body}).finally(t=>{this.loading=""})},handlerSave(t){let e=new FormData(t.target);e.append("dateStart",this.formData.dateStart),e.append("dateEnd",this.formData.dateEnd),this.$http.post("?",e).then(t=>{this.fetch(),this.formData=null}).catch(t=>{this.error=t.body,this.formData=null,console.log(t)})},handlerCancelForm(){this.formData=null},handlerDelete(t){this.deleteData=t},performDelete(){this.loading="Suppression de la demande "+this.deleteData.label;let t=this.deleteData;this.$http.delete("?id="+t.id).then(t=>{this.fetch()},t=>{this.error=t.body}).then(t=>this.deleteData=null)}},mounted(){this.fetch()}},v=p,h=u(v,i,r,!1,null,null,null),_=h.exports;e["default"]=_}})["default"]}));
//# sourceMappingURL=ActivityRequest.umd.min.js.map