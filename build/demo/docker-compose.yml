version: "3"
services:
  oscardemo:
    container_name: oscardemo
    env_file:
      - variables.env
    build:
        context: ./dockerFileOscar/
        dockerfile: Dockerfile
        args:
            proxy_environnement: "http://proxy.unicaen.fr:3128"
            user_docker_git_demo: docker-demo
            token_user_docker_git_demo: yxLuCVCrfDgj8ziSRt2U
            tag_version_oscar: "macclane"
            service_oscar_name: oscardemo
            service_gearman_name: gearmandemo
            service_elastic_search_name: elasticsearchdemo
    ports:
      - 8080:80
    networks:
      - demooscar
    tty: true
    restart: unless-stopped
  elasticsearchdemo:
    depends_on:
      - oscardemo
    container_name: elasticsearchdemo
    environment:
      - discovery.type=single-node
    build:
        context: ./dockerFileElasticSearch/
        dockerfile: Dockerfile
        args:
            proxy_environnement: "http://proxy.unicaen.fr:3128"
            tag_version_oscar: "macclane"
            service_oscar_name: oscardemo
            service_gearman_name: gearmandemo
            service_elastic_search_name: elasticsearchdemo
    ports:
      - 9200:9200
    networks:
      - demooscar
    tty: true
    restart: "always"
  postgresdemo:
    depends_on:
      - oscardemo
    container_name: postgresdemo
    build:
      context: ./dockerFilePostgres/
      dockerfile: Dockerfile
      args:
        proxy_environnement: "http://proxy.unicaen.fr:3128"
        pathdatas: "/home/marie/projetsUnicaen/oscar/build/demo/var/dataPostgree"
    environment:
      POSTGRES_PASSWORD: "azerty"
      POSTGRES_USER: "oscar"
      POSTGRES_DB: "oscar_dev"
    ports:
      - 5432:5432
    networks:
      - demooscar
    tty: true
    volumes:
      - /home/marie/projetsUnicaen/oscar/build/demo/var/dataPostgree:/var/lib/postgresql/data
    restart: "always"
  adminerdemo:
    container_name: adminerdemo
    image: adminer
    restart: "always"
    ports:
      - 8082:8080
    networks:
      - demooscar
    tty: true
  gearmandemo:
    container_name: gearmandemo
    build:
        context: ./dockerFileGearman/
        dockerfile: Dockerfile
        args:
            proxy_environnement: "http://proxy.unicaen.fr:3128"
            tag_version_oscar: "macclane"
            service_oscar_name: oscardemo
            service_gearman_name: gearmandemo
            service_elastic_search_name: elasticsearchdemo
    networks:
      - demooscar
    tty: true
    restart: "unless-stopped"
networks:
  demooscar:
    driver: bridge
