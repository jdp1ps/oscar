
<section class="container-fluid">
    <h1>Dépenses pour <strong><?= $activity->getCodeEOTP() ?></strong> (<?= $activity ?>)</h1>
    <nav>
        <a class="btn btn-default" href="<?= $this->url('contract/show', ['id' => $activity->getId()]) ?>">
            <i class="icon-cube"></i>
            Revenir sur la fiche <strong><?= $activity ?></strong>
        </a>
        <?php if($this->grant()->privilege(\Oscar\Provider\Privileges::DEPENSE_SYNC, $activity)): ?>
        <form action="<?= $this->url('contract/list-spent', ['id' => $activity->getId()]) ?>" method="post" class="form-inline">
            <input type="hidden" name="action" value="update" />
            <button type="submit" class="btn btn-primary">
                <i class="icon-file-excel"></i>
                Mettre à jour les données depuis SIFAC
            </button>
        </form>
        <?php endif; ?>

        <?php if($this->grant()->privilege(\Oscar\Provider\Privileges::DEPENSE_DOWNLOAD, $activity)): ?>
        <a class="btn btn-default" href="<?= $this->url('spent/activity-api', ['id' => $activity->getId()]) ?>?format=excel">
            <i class="icon-file-excel"></i>
            Télécharger les dépenses (Excel)
        </a>
        <?php endif; ?>

        <?php if($this->grant()->privilege(\Oscar\Provider\Privileges::DEPENSE_DOWNLOAD, $activity)): ?>
        <a class="btn btn-default" href="<?= $this->url('spent/activity-api', ['id' => $activity->getId()]) ?>?format=excel&mode=details">
            <i class="icon-file-excel"></i>
            Télécharger les dépenses détaillées (Excel)
        </a>
        <?php endif; ?>
    </nav>
    <?php if( count($spents) ): ?>
        <div id="spentlines"></div>
        <script>
            require(['vue', 'vue-resource', 'SpentLinePFI'], function(Vue, VueResource, SpentLinePFI){
                Vue.use(VueResource);
                new Vue({
                    el: "#spentlines",
                    render(h){
                        return h(SpentLinePFI.default, { props: {
                                url: "<?= $this->url('spent/activity-api', ['id' => $activity->getId()]) ?>"
                            }});
                    }

                });
            })
        </script>

    <?php if($msg): ?>
        <div class="alert alert-info"><?= $msg ?></div>
    <?php endif; ?>
    <?php if($error): ?>
        <div class="alert alert-danger"><?= $error ?></div>
    <?php endif; ?>
    <?php else: ?>
        <form action="" method="post">
            <button type="submit" name="action" value="update">Synchroniser</button>
        </form>
    <?php endif; ?>

</section>